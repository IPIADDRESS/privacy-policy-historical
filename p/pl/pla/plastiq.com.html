<!--The following is the downloaded HTML source of the plastiq.com privacy policy that was archived on 2014-06-26.
 Please check the original snapshot on the Wayback Machine (https://web.archive.org/web/20140626084234id_/https%3A//www.plastiq.com/privacy) for the most accurate reproduction.-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html lang="en-US" xmlns="http://www.w3.org/1999/xhtml" dir="ltr" class=" js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths contenteditable no-overflowscrolling bgpositionshorthand cors cssfilters lastchild cssresize svgfilters"><head><script async="" src="//www.googletagmanager.com/gtm.js?id=GTM-3B7R"></script><script type="text/javascript" async="" src="https://ssl.google-analytics.com/ga.js"></script><script type="text/javascript" async="async" src="https://www.adobetag.com/d1/plastiq/live/metrics.js"></script>
	<title>Plastiq | Privacy Policy</title>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	
	<!-- meta tags -->
<meta name="description" content="Plastiq empowers cardholders to make payments for tuition, taxes, utility bills and more with their credit card of choice, enabling rewards, convenience and control.">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!-- favicon -->
<link rel="icon" href="favicon16x16.ico" sizes="16x16" type="image/png">
<link rel="icon" href="favicon24x24.ico" sizes="24x24" type="image/png">
<link rel="icon" href="favicon32x32.ico" sizes="32x32" type="image/png">
<link rel="icon" href="favicon64x64.ico" sizes="64x64" type="image/png">
	   <link rel="stylesheet" href="https://s3.amazonaws.com/icomoon.io/23583/PlastiqFontLive/style.css">
	   <link rel="stylesheet" href="https://s3.amazonaws.com/icomoon.io/23583/PlastiqLoader/style.css">
	   <!-- styles -->
<link rel="stylesheet" href="styles/all.css" media="all">
<link rel="stylesheet" href="styles/print.css" media="print">
<link rel="stylesheet" href="styles/table.css" media="screen">
<link rel="stylesheet" href="styles/fonts.css" media="all">
<link rel="stylesheet" href="styles/style.css" media="all">
<link rel="stylesheet" href="styles/colorbox.css" media="all">
<link rel="stylesheet" href="styles/jscrollpane.css" media="all">
<link rel="stylesheet" href="styles/jquery.ui.selectmenu.css" media="all">
<link rel="stylesheet" href="styles/TableTools.css" media="screen">
<link rel="stylesheet" href="styles/custom-theme/jquery-ui-1.8.18.custom.css" media="screen">
<link rel="stylesheet" href="styles/highlight.default.css" media="screen">
	

<!-- page-specific styles -->

<link rel="stylesheet" href="styles/reg-login.css" media="all">

<!-- cdn javascript libraries -->
	<script type="text/javascript" src="/includes/js/jquery.min.js"></script>
	<script type="text/javascript" src="/includes/js/jquery-ui.min.js"></script>
	<script type="text/javascript" src="/includes/js/highlight.mini.js"></script>
	<script type="text/javascript" src="/includes/js/jquery.dataTables.min.js"></script>
<!--[if IE]>
  <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<script type="text/javascript" src="/includes/js/jquery.colorbox-min.js"></script>
	<style type="text/css">
		.body { width: 700px; margin: 0px auto 0px; text-align: justify; }
		.body p { margin: 10px 0px 10px; line-height: 1.5em; }
		h2 { font-size: 24px; }
		h3 { color: #25aae1; }
		h4 { color: #000; text-decoration: underline; }
		#privacy ul { list-style-type: circle; line-height: 1.4em; padding-left: 20px; }
		#privacy a { color: #25aae1; text-decoration: underline; }
	</style>
</head>
<body id="ch-layout">
	<div id="gtm-data" data-referrer="plastiq.com" data-uid="ip_2c0c570581084da8367510f2a508f105" data-tmstmp="2014-06-26 04:42:35" data-cid="" data-icid="">		
		<!-- Google Tag Manager -->
		<script type="text/javascript">dataLayer = [{
		}];</script>
		<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-3B7R"
		height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
		<script>$(document).ready(function(){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
		new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
		j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
		'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-3B7R');});</script>
		<!-- End Google Tag Manager -->
		
		<!-- SiteCatalyst code version: H.25.3.
		Copyright 1996-2013 Adobe, Inc. All Rights Reserved
		More info available at http://www.omniture.com -->
		
				   	<script language="JavaScript" type="text/javascript" src="/includes/js/s_code.js" class="no-rerun"></script><div id="mboxScriptContainer" style="display:none;visibility:hidden;"></div><style>.mboxDefault{visibility:hidden;}</style>
		   		<script language="JavaScript" type="text/javascript" class="no-rerun"><!--
		/* You may give each page an identifying name, server, and channel on
		the next lines. */
		
				
		s.pageName="cardholders|privacy"
		s.eVar1="D=pageName"
		s.prop1="D=pageName"
				s.server=""
		s.channel="cardholders"
		s.hier1="cardholders|privacy"
		s.pageType=""
		s.prop1=""
		s.prop2="cardholders|privacy"
		s.prop3="cardholders"
		s.prop4="privacy"
		s.prop5="cardholders"
		s.eVar13="D=v0"
		s.eVar14="D=v0"
		s.eVar15="D=v0"
		s.eVar18="D=v0"
		s.eVar19="D=v0"
		s.eVar29="guest";s.events="event4";		/************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
		var s_code=s.t();if(s_code)document.write(s_code)//--></script>
		<script language="JavaScript" type="text/javascript" class="no-rerun"><!--
		if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
		//--></script><noscript><img src="https://plastiq.d1.sc.omtrdc.net/b/ss/plastiq/1/H.25.3--NS/0"
		height="1" width="1" border="0" alt="" /></noscript><!--/DO NOT REMOVE/-->
		<!-- End SiteCatalyst code version: H.25.3. -->
		
		</div>	<input type="hidden" name="loggedin" id="dateTime" value="4 04">
	<!-- end of page-top -->
<div class="shell">
	<div id="header" class="type2">
		<h1 id="logo"><a href="index" class="notext">Plastiq</a></h1>
		
		<a style="" href="pay?reset=1" class="make-payment-btn">MAKE A PAYMENT</a>
		<div id="navigation" style="background: none; height: 0px;">
			<ul><li style="border-bottom: none;"><a href="index">HOME</a></li><li style="border-bottom: none;"><a href="register">REGISTER</a></li><li style="border-bottom: none;"><a href="login">LOGIN</a></li></ul>
			<div class="cl">&nbsp;</div>
		</div>
		<div class="cl">&nbsp;</div>
	</div>

	<!-- End of Header -->
	<div id="page">
				<div class="container">
			<div id="privacy">
				<div class="top">
					<h2>Privacy Policy</h2>
					<p>We at Plastiq do our best to protect your privacy.  Please read below for a more detailed rundown of our policies.</p>
				</div>
				<div class="body">
		
<h2>Welcome to Plastiq</h2>
					
<p>Plastiq enables you to make credit and debit card payments when you previously could not. We understand that privacy matters, and so we take care with the information you choose to share with us. This Privacy Policy (the "Policy") explains our policies and procedures with respect to the information that we collect through our Platform.</p>

<p>This Privacy Policy was last updated on March 12, 2013</p>

<h3>Consent</h3>

<p>By using the Website or our Services you consent to the use of your Personal Data as described in this Policy.  By using the Services, you are accepting the practices described in this Policy. If you do not agree with this Policy, you do not have Plastiq's permission to use our Website and/or Platform.  Except as set forth in this Policy, your Personal Data will not be used for any other purpose without your consent. You may withdraw your consent to our processing of your Personal Data at any time.  However, withdrawing consent may result in your inability to continue using certain features of the Website and/or the Services. Your continued use of our Website or Platform signifies your acceptance of this Policy.</p>

<p>This Privacy Policy will answer the following questions:
	</p><ul>
		<li><a href="#part1">What does this Policy apply to?</a></li>
		<li><a href="#part2">What information does Plastiq collect?</a></li>
		<li><a href="#part3">How does Plastiq collect Personal Data?</a></li>
		<li><a href="#part4">How does Plastiq use the information it collects about me?</a></li>
		<li><a href="#part5">Does Plastiq ever disclose Personal Data or other information?</a></li>
		<li><a href="#part6">How does Plastiq secure collected data?</a></li>
		<li><a href="#part7">How are updates to this Policy handled?</a></li>
	</ul>
<p></p>

<p>If this Policy raises any further privacy questions, comments, or suggestions or if you wish to request a copy of the Personal Data we hold about you, we encourage you to reach out to us at privacy@plastiq.com. Our policies will continually adjust to the exciting and ever-changing landscape of credit card payments and will be informed by the valuable feedback of our visitors and users.</p>

<p>Please also review the <a href="/tos">Terms of Service</a> which governs your use of our Services.  Capitalized terms in this Policy not otherwise defined herein have the same meanings as the definitions of those terms in the User Agreement.</p>

<h3>A note for children under 13 years old.</h3>

<p>Plastiq does not knowingly collect Personal Data from children under the age of 13. If you are under the age of 13, please do not submit any Personal Data through this Website. We encourage parents and legal guardians to monitor their children's Internet usage and to help enforce this Policy by instructing their children never to provide Personal Data on this Website without their permission. If you have reason to believe that a child under the age of 13 has provided Personal Data to Plastiq via this Website, please contact us, and we will endeavor to delete that information from our databases.</p>

<h2 id="part1">What does this Policy apply to?</h2>

<h3>Application of this Policy</h3>

<p>This Policy applies to all interactions and exchanges of information between Plastiq and our Users via the plastiq.com website, including all subpages and successor pages (collectively, the "Website"), and with respect to the infrastructure and applications that enable use of the Services (our "Platform"), including but not limited to sending and managing payments, communications to and from Plastiq, including communications sent via email and SMS, support and maintenance (collectively, the "Services") and our gathering of information such as usage statistics in relation to the usage of the Services.</p>

<p>Visitors to the Website who do not use our Platform for any transactions or other activities , such as making or managing payments, are not required to provide any Personal Data. We may, however, passively collect personally non-identifiable information – information that may correspond to a particular web browsing session, but does not identify the particular person doing the browsing – for the purpose of improving our Website and Platform.</p>

<p>Non-registered and non-authenticated users may use our Platform to make easy payments to any of our Merchants without registering for a user account or logging in. An e-mail address is required for receipt purposes, and we will track your payments to that e-mail address in the event that you choose to register for a user account or login at a later time. Please note that access to your payment history requires validation of your e-mail address.</p>

<p>Registered Plastiq users, in addition to easily sending immediate payments to our Merchants, may schedule and manage future payments and store credit card data for later use.</p>

<h3>Exclusions</h3>

<p>This Policy does not apply to any unsolicited information you provide to us via this Website or any other means. This includes, but is not limited to, information posted to any public areas of the Website, such as bulletin boards (collectively, "Public Areas"), any ideas for new products or modifications to existing products, cookie based information brought to plastiq.com by your web browser, public postings on social media, and other unsolicited submissions (collectively, "Unsolicited Information").</p>

<p>This Website may contain links to other websites not operated or controlled by Plastiq (collectively, "Third Party Sites"). The policies and procedures we describe here do not apply to such Third Party Sites, and furthermore, links from this Website do not imply that Plastiq endorses or has reviewed any Third Party Sites. Please always review the privacy policies and terms of service of any third parties prior to engaging in business or interacting with them.</p>

<h2 id="part2">What information does Plastiq collect?</h2>

<p>The term "Personal Data", as used in this Policy, refers to any information that can be used to identify a specific person, and/or that is linked to a specific identified person. Personal Data does not include information that has been aggregated or made anonymous such that it can no longer identify a specific person.</p>

<p>Plastiq will specifically collect the following Personal Data and other non-identifiable information:
	</p><ul>
		<li><strong>Registration Information:</strong>  We collect Personal Information from you, such as your contact and payment information, when you register for and use our Services.</li>
		<li><strong>Transaction Information:</strong> When you use our Platform to make or accept payments, we collect information about when the transactions occurred, a description of the transactions, the payment amounts, and the merchant you designated to receive the payment.</li>
		<li><strong>Device Information:</strong> We collect device-specific information when you access our Platform, including your hardware model, operating system and version, unique device identifiers, mobile network information, and information about the device's interaction with our Platform. We may also identify other software running on the device (but will not collect any content from such software) for anti-fraud and malware-prevention purposes.</li>
		<li><strong>Use Information:</strong> We collect information about how you use our Platform, including your access times, browser types and language, and Internet Protocol ("IP") addresses.</li>
	</ul>
<p></p>
	
<h2 id="part3">How does Plastiq collect Personal Data and Other Information about me?</h2>

<h3>Personal Data</h3>

<p>In general, Plastiq collects Personal Data about you in two ways: 1) when you provide it directly to us, for example when you register for access to our Services, when you make payments or interact with our client services, or 2) when we receive such data from industry or business partners, for example if your merchant sends us a payment on your behalf, Your usage of this Website and our Platform determines in large part the collection and use of your data – more specific details can be found below in this section. If we ever intend to use your information in a manner that is not consistent with this Policy, you will be informed of such anticipated use prior to or at the time at which the information is collected via explicit electronic notification.  This includes but is not limited to: email notifications, SMS notifications, on-site alerts, modal windows, and other mechanisms that Plastiq may elect to utilize.</p>

<h3>Other Information</h3>

<p>We use various technologies to collect information, and this may include sending cookies to your computer or mobile device. Cookies are small data files that are stored on your hard drive or in device memory by a website. Cookies help provide additional functionality to the Website and help us analyze Website usage more accurately. Through Cookies we can offer additional site functionality, and make sure that those who are most interested can find us online.  For example, we may set a cookie on your browser that enables you to access this Website without needing to enter a password more than once during a single visit. Cookies also support the integrity of our registration process, retain your preferences and account settings, and help evaluate and compile aggregated statistics about user activity. Based on Website usage and browsing data we collect through Cookies, Plastiq can also target specific advertisements directly related to your interest in us.</p>

<p>On most web browsers, you will find a "help" section on the toolbar. Please refer to this section for information on how to receive notification when you are receiving a new cookie and how to turn cookies off. We recommend that you leave cookies turned on because they allow you to take advantage of some of the Website's more advanced features.  If you choose to delete or switch off cookies you may not have access to certain features or areas of the Website.</p>

<p>We may also collect information using web beacons. Web beacons are electronic images that may be used in our Platform or emails. We may use web beacons to deliver cookies, count visits, understand usage and campaign effectiveness, and determine whether an email has been opened and acted upon.</p>

<h2 id="part4">How does Plastiq use the information it collects about me?</h2>

<p>Payment-related data, including your cardholder data, is securely stored for accounting and auditing purposes, and non-sensitive information may be made available to your Merchants via our secure Platform. Merchants paid through Plastiq may customize the information they collect from you via Plastiq at time of payment. This information is subject to change at any time and may include but is not limited to your full name, home address, phone number, and invoice number. You agree to allow Plastiq to share this collected information with the Merchant.</p>

<p>Plastiq, its subsidiaries, and affiliates may also use your Personal Data and other personally non-identifiable information collected through this Website to help us improve the content and functionality of our Website, to better understand our users, and to improve our Platform and Services.</p>
 
<p>We may use your contact information in the future to notify you of important things, including but not limited to new or expanded Platform capabilities, pending payment deadlines, or promotions from Plastiq or our partners. We may contact you via email, mail and/or through SMSs or text messages. If we do so, each communication we send you will contain instructions permitting you to "opt-out" of receiving future marketing communications. This will permanently remove your contact information from all future out-going correspondences.  Additionally, if for any reason you find our "opt-out" instructions unclear, and wish to cease receiving any communications from Plastiq, or you wish to have your name deleted from our mailing lists, please contact us as at <a href="mailto:privacy@plastiq.com">privacy@plastiq.com</a>. We retain the right to contact you regarding your use of the Services.</p>

<p>Plastiq will occasionally conduct research on our customer demographics, interests and behavior based on Personal Data and other information provided to us. This research may be compiled and analyzed on an aggregate basis, and Plastiq may share this aggregate data with its affiliates, agents and business partners. Importantly, this aggregate information cannot be used to personally identify any Plastiq user or users. We may also disclose aggregated user statistics in order to describe our Platform to current and prospective business partners, and to other third parties for other lawful purposes.</p>

<h2 id="part5">Does Plastiq ever disclose Personal Data or other information?</h2>

<p>Plastiq does not sell or rent your Personal Data to marketers or third parties for marketing purposes.</p>

<p>Like many companies, we sometimes share information with trusted third parties to perform functions related to this Website and our Platform. These trusted third parties may include, but are not limited to, credit card associations, banking and processing partners, security and audit providers, as well as any other entities that you have directly authorized to receive your Personal Data. Any information shared with such parties is disclosed on a strictly ad hoc basis. We take efforts to limit the amount of information that is shared with third parties to what is necessary to accomplish the specific business purpose.</p>

<p>We may disclose your Personal Data to law enforcement, government officials, regulators and/or other third parties from the jurisdiction in which you reside or from other foreign jurisdictions if required to do so by law or in the good faith belief that such action is necessary to (i) comply with a legal obligation, (ii) protect and defend our rights or property, (iii) act in urgent circumstances to protect the personal safety of users of this Website or the public, or (iv) protect against legal liability.</p>

<p>In the event of a corporate sale, merger, reorganization, dissolution or similar event, Personal Data may be part of the transferred assets.</p>

<p>From time to time we may employ third parties to help us improve the Website and/or the Services. These third parties may have limited access to databases of user information solely for the purpose of helping us to improve the Website and/or the Services. </p>

<h2 id="part6">How does Plastiq secure Personal Data?</h2>

<p>Credit and debit card data is stored and managed in compliance with strict Payment Card Industry (PCI) standards. Plastiq utilizes tokenization, a payments industry-standard procedure, to limit exposure of sensitive cardholder data. Your credit and/or debit card information is sent directly to our secure, encrypted data vault, which generates a random, cryptographically secure token that is used by our payment application to submit payments on your card. Once information is deposited into the vault, it cannot be directly retrieved by our payment application or any third parties.</p>

<p>Although no data transmission or storage can be guaranteed 100% secure and error free, Plastiq takes great care to protect Personal Data collected via this Website from loss, misuse, and unauthorized access, disclosure, alteration, or destruction, in both transit and at rest. Access to user data is limited (via username/password authentication and 2-factor verification, among other safeguards) only to those employees who require it to perform their job functions. Connections to this Website are secured with an Extended Validation (EV) SSL certificate with 256-bit encryption, and our data centers, located in the United States, boast enterprise-level security with top-level industry certifications and fault-tolerant, distributed systems. Other security safeguards include, but are not limited to, encrypted vault storage for sensitive data, strict hardware firewalls, and limited physical access to buildings, servers, and files.</p>

<p>As our data centers are located in Canada, your Personal Data may be available to the Canadian government or its agencies under a lawful order, irrespective of the safeguards we have put in place for the protection of your Personal Data.</p>

<p>We at Plastiq do our best to secure your data, and we ask that you take reasonable precautions as well. Ensure your personal computing device has up-to-date security and anti-virus software, and please consider carefully what information you choose to send anyone via the Internet and log of your account when you are finished using the Services and do not share your password with anyone.</p>

<h2 id="part7">How are updates to this Policy handled?</h2>

<p>This Website and Services may change from time to time, which may necessitate revisions to this Policy. Plastiq reserves the right to update or modify this Policy at any time without prior notice. Please review this policy periodically, and especially prior to providing any Personal Data.  If you use the Website and/or Services after a revised Privacy Policy is posted, you will be bound by the terms of the revised Privacy Policy.</p>

<h3>Access and Accuracy</h3>

<p>You have the right to access the Personal Data we hold about you in order to verify the accuracy of that information.  Upon receipt of your written request, we will provide you with a copy of your Personal Information.  We will endeavor to deal with all such requests for access in a timely manner.</p>

<p>Having accurate Personal Data about you enables us to give you better service.  We will make every reasonable effort to keep your Personal Data accurate and up-to-date.</p>

<h3>Retention</h3>

<p>We will keep your Personal Information for as long as it remains necessary for the operation of the Website and Services or as required by law, which may extend beyond the termination of our relationship with you. Subject to the foregoing, in general, once you inform us that you no longer wish to use the Website or Services, we will delete your records from our systems as soon as practicable.</p>

<h3>Updating your Information; Contacting Us</h3>

<p>Please keep us informed of any changes such as a change of address or telephone number. If you would like to access your information, if you have any questions, comments or suggestions of if you find any errors in our information about you, please contact us at: <a href="mailto:privacy@plastiq.com">privacy@plastiq.com</a></p>
					
					
				</div>
			</div>
		</div>
		</div>
	<!-- Footer -->
	<div id="footer">
		<a href="#" class="flogo alignright"><img src="styles/images/flogo.png" alt=""></a>
		<p class="links"><a href="contact" target="_blank">Contact</a>, <a href="security" target="_blank">Security</a>, <a target="_blank" href="http://support.plastiq.com/">Help</a>, <a href="tos" target="_blank">Terms of Service</a>, <a href="privacy" target="_blank">Privacy Policy</a>.</p>
		<p class="copy">¬© 2014 All Rights Reserved. Plastiq and the Plastiq logo are property of Plastiq Inc.</p>
		<div class="cl">&nbsp;</div>
	</div>
	<!-- End of Footer -->
</div>
	<!--[if lt IE 8]>
<div class="pq-modal-cover"></div>
<div class="pq-modal" id="browser-fail" style="display: block;">
	<h2>- Browser is not supported -</h2>
	<p>We see you’re using an outdated browser.  This browser is not fully supported 
	by the Plastiq web site. We can’t guarantee that every page, it’s content, and
	functionality will display or function properly. We highly recommend taking
	a few minutes to upgrade your browser to its more modern version.<br />
	<span class="subtle-info">Visit <a href="http://browsehappy.com/">“Browse Happy”</a> to upgrade and learn more ></span></p>
	
	<ul id="browser-group" class="clearfix">
		<li>
			<a href="http://www.google.com/chrome" class="chrome">chrome</a>
		</li>
		<li>
			<a href="http://www.firefox.com/" class="firefox">firefox</a>
		</li>
		<li>
			<a href="http://www.apple.com/safari/" class="safari">safari</a>
		</li>
		<li>
			<a href="http://www.opera.com/" class="opera">opera</a>
		</li>
		<li>
			<a href="http://windows.microsoft.com/ie" class="internet-explorer">internet explorer</a>
		</li>
	</ul>
</div>
<script type="text/javascript">
	$(document).ready(function(){
		var x = 6.28318530717958620000;
		var val = Math.sin(x);
		if(!(Math.abs(val) === 2.4492127076447545e-16)){
			$('.pq-modal-cover, .pq-modal').remove();
		}
	});
</script>
<![endif]-->

<!--[if lt IE 10]>
<script src="/includes/js/jquery.placeholder.min.js"></script>
<![endif]-->

<script type="text/javascript">
 var RecaptchaOptions = {
    theme : 'blackglass'
 };
 </script>

<!-- local javascript libraries -->
<script type="text/javascript" src="includes/js/jquery.maskedinput-1.2.2.min.js"></script>
<script type="text/javascript" src="includes/js/jquery.numeric.min.js"></script>
<script type="text/javascript" src="includes/js/jquery.tools.min.js"></script>
<script type="text/javascript" src="includes/js/jquery.password-strength.min.js"></script>
<script type="text/javascript" src="includes/js/TableTools.min.js"></script>
<script type="text/javascript" src="includes/js/ZeroClipboard.min.js"></script>
<script type="text/javascript" src="includes/js/FixedColumns.min.js"></script>
<script type="text/javascript" src="includes/js/highstock.js"></script>
<script type="text/javascript" src="includes/js/highstock-exporting.js"></script>
<script type="text/javascript" src="includes/js/qWidget.js"></script>
<script type="text/javascript" src="includes/js/qReport.js"></script>
<script type="text/javascript" src="includes/js/jquery.mousewheel.js"></script>
<script type="text/javascript" src="includes/js/jquery.jscrollpane.min.js"></script>
<script type="text/javascript" src="includes/js/jquery.scrollTo-min.js"></script>
<script type="text/javascript" src="includes/js/jquery.easing.js"></script>
<script type="text/javascript" src="includes/js/jTour.min.js"></script>
<script type="text/javascript" src="includes/js/jquery.ui.selectmenu.js"></script>
<script type="text/javascript" src="includes/js/json2.js"></script>
<script type="text/javascript" src="includes/js/alertMessage.js"></script>
<script type="text/javascript" src="/includes/js/reg-login.js"></script>
<script type="text/javascript">

	var Validate = {
		email: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|”(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*”)@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your e-mail was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your email was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid email.');
				field.select();
				return false;
			}
		},
		url: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[.\!\/\\w]*))?)/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your url was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your url was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid url.');
				field.select();
				return false;
			}
		},
		principal: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/^\d+(\.\d\d)?$/.test(input) && input >= 1) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your amount was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your amount was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid amount.');
				field.select();
				return false;
			}
		},
		amount: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/^\d+(\.\d\d)?$/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your amount was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your amount was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid amount.');
				field.select();
				return false;
			}
		},
		zip: function(field, div, min_length, max_length) {
			var input = field.val();
			input = input.toUpperCase();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/^[A-Za-z0-9 ]+$/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your zip was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your zip was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid zip/postal code.');
				field.select();
				return false;
			}
		},
		uszip: function(field, div, min_length, max_length) {
			var input = field.val();
			input = input.toUpperCase();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/(^\d{5}(-\d{4})?$)|(^[ABCEGHJKLMNPRSTVXY]{1}\d{1}[A-Z]{1} *\d{1}[A-Z]{1}\d{1}$)/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your zip was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your zip was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid zip/postal code.');
				field.select();
				return false;
			}
		},
		password: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/^.*(?=.{8,})(?=.*[\w])(?=.*[\d\W]).*$/.test(input) && input.length < 256) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				//alert(min_length);
				if (input.length < min_length) {
					if (div != "") div.html('Your password was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your password was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a password at least 8 characters long and that includes one number or symbol.');
				field.select();
				return false;
			}
		},
		validation_code: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/\w+/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your validation code was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your validation code was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a proper validation code.');
				field.select();
				return false;
			}
		},
	    datetime: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/^\d{4}-\d\d-\d\d \d\d:\d\d:\d\d$/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your datetime was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your datetime was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid date.');
				field.select();
				return false;
			}
		},
		exp_month: function(field, div, min_length, max_length) {
			var input = $(field).find('option[selected="selected"]').val();
			if(input == undefined){
				input = $(field).val();
			}
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/^\d{2}$/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your expiration month input was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your expiration month input was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid expiration month.');
				field.select();
				return false;
			}
		},
		exp_year: function(field, div, min_length, max_length) {
			var input = $(field).find('option[selected="selected"]').val();
			if(input == undefined){
				input = $(field).val();
			}
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/^\d{4}$/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your expiration year input was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your expiration year input was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid expiration year.');
				field.select();
				return false;
			}
		},
		expiration: function(exp_month_field, exp_year_field, div) {
			var exp_month = $(exp_month_field).find('option[selected="selected"]').val();
			var exp_year = $(exp_year_field).find('option[selected="selected"]').val();

			if(exp_month == undefined){
				exp_month = $(exp_month_field).val();
			}
			if(exp_year == undefined){
				exp_year = $(exp_year_field).val();
			}

			div = div || '';
			if (div != '') div.css("color","#cc0000");
			if (!Validate.exp_month(exp_month_field, div) || !Validate.exp_year(exp_year_field, div)) return false;
			var current_date = new Date(2014, 5, 01);
			var expiration_date = new Date(exp_year, exp_month-1, 01);
			if (expiration_date >= current_date) {
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Your credit card is expired!');
				exp_month_field.select();
				return false;
			}
		},
		ccv: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/^\d{0,4}$/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your ccv was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your ccv was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid card CCV.');
				field.select();
				return false;
			}
		},
		pan: function(field, div, merchant_id) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			merchant_id = merchant_id || 0;
			
                        var $param = {payment_method_id : input, merchant_id: merchant_id};
			var card_brand = new Array();
			$.ajaxSetup({async:false});
			$.post('scripts/valid-card-brands.php', $param, function(data) {
				card_brand = data;
			}, "json");
			$.ajaxSetup({async:true});
			
//			var regex = "";
//						
                        if (card_brand.found)
                            return true;
                        
			if (div != "") div.html('Card number did not match any valid card brands.');
			field.select();
			return false;
		},
		cardholder_name: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/\w+/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 60;
				if (input.length < min_length) {
					if (div != "") div.html('Your cardholder name was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your cardholder name was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid name.');
				field.select();
				return false;
			}
		},
		cardholder_first_name: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/\w+/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 60;
				if (input.length < min_length) {
					if (div != "") div.html('Your cardholder first name was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your cardholder first name was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid first name.');
				field.select();
				return false;
			}
		},
		cardholder_last_name: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/\w+/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 60;
				if (input.length < min_length) {
					if (div != "") div.html('Your cardholder last name was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your cardholder last name was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid last name.');
				field.select();
				return false;
			}
		},
		numeric: function(field, div, min_length, max_length) {
			var input = field.val();
			div = div || '';
			if (div != '') div.css("color","#cc0000");
			
			if (/^[0-9 ]+$/.test(input)) {
				// check lengths
				min_length = min_length || 1;
				max_length = max_length || 255;
				if (input.length < min_length) {
					if (div != "") div.html('Your input was too short.');
					field.select();
					return false;
				}
				if (max_length > 0 && input.length > max_length) {
					if (div != "") div.html('Your input was too long.');
					field.select();
					return false;
				}
				if (div != "") div.html('');
				return true;
			}
			else {
				if (div != "") div.html('Please enter a valid number.');
				field.select();
				return false;
			}
		},
		sin: function(field, div, min_length, max_length) { //http://www.hackcanada.com/canadian/other/sin.html
			var input = field.val();
			if(input.length == 9){
				var objRegExp = new RegExp(/^\d{9}$/);
				if(objRegExp.test(input)){
					div.html('');
					return true;
				}else{
					div.html('Please enter a valid SIN.');
					field.select();
					return false;
				}
		   }else{
			   if (div != "") div.html('SIN # needs to be 9 digits.');
				field.select();
				return false;
		   }
		},
		bin: function(field, div, min_length, max_length) {
			var input = field.val();
			if(input.length == 9){
				var objRegExp = new RegExp(/^\d{9}$/);
				if(objRegExp.test(input)){
					div.html('');
					return true;
				}else{
					div.html('Please enter a valid BIN.');
					field.select();
					return false;
				}
		   }else{
			   if (div != "") div.html('BIN # needs to be 9 digits.');
				field.select();
				return false;
		   }
		},
		phone: function(field, div, min_length, max_length) {
			var input = field.val();
			if (input.length < 10) {
				return false;
			}else {
				return true;
			}
		},
		field: function(input, type, min_length, max_length) {
			type = type || '';
			
			// check lengths
			min_length = min_length || 0;
			max_length = max_length || 255;
			if (input.length < min_length) return false;
			if (max_length > 0 && input.length > max_length) return false;

			switch (type) {
				case 'alphanum':
					return /^[A-Za-z0-9 ]+$/.test(input);
					break;
				case 'alpha':
					return /^[A-Za-z ]+$/.test(input);
					break;
				case 'numeric':
					return /^[0-9 ]+$/.test(input);
					break;
				case 'alphanum_nospace':
					return /^[A-Za-z0-9]+$/.test(input);
					break;
				case 'alpha_nospace':
					return /^[A-Za-z]+$/.test(input);
					break;
				case 'numeric_nospace':
					return /^[0-9]+$/.test(input);
					break;
				default:
					return true;
					break;
			}
	    }
	};
</script><script type="text/javascript">
	var Utility = {
		entities: function(str) {
			return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/\\/g, '');
		},
		email: function(str) {
			return str+'@plastiq.com';
		},
		post: function(path, params, method) {
			method = method || "post"; // Set method to post by default, if not specified.

		    // The rest of this code assumes you are not using a library.
		    // It can be made less wordy if you use one.
		    var form = document.createElement("form");
		    form.setAttribute("method", method);
		    form.setAttribute("action", path);

		    for(var key in params) {
		        if(params.hasOwnProperty(key)) {
		            var hiddenField = document.createElement("input");
		            hiddenField.setAttribute("type", "hidden");
		            hiddenField.setAttribute("name", key);
		            hiddenField.setAttribute("value", params[key]);

		            form.appendChild(hiddenField);
		         }
		    }

		    document.body.appendChild(form);
		    form.submit();
		},
		is_array: function(input){
		    return typeof(input)=='object'&&(input instanceof Array);
		},
		in_array: function(needle, haystack){
			var length = haystack.length;
		    for (var i = 0; i < length; i++) {
		        if (haystack[i] == needle) return true;
		    }
		    return false;
		},
		set_cookie: function(cookieName, value, daysToExpire, path, domain, secure) {
			var expiryDate;

			if (daysToExpire) {
				expiryDate = new Date();
				expiryDate.setTime(expiryDate.getTime() + (daysToExpire * 8.64e7));
			}

			document.cookie = cookieName + '=' + (value.toString()) +
			(daysToExpire ? ';expires=' + expiryDate.toGMTString() : '') +
			';path=' + (path ? path : '/') +
			(domain ? ';domain=' + domain : '') +
			(secure ? ';secure' : '');
		},
		get_cookie: function(cookieName) {
			var cookiePattern = new RegExp('(^|;)[ ]*' + cookieName + '=([^;]*)'),
			cookieMatch = cookiePattern.exec(document.cookie);
			if(cookieMatch)return cookieMatch[2];
			return 0;
		}
	}
	
</script><script type="text/javascript">

	var Populate = {
		regions: function(input) {
			var regions = [
				"United States", "Canada", "Other", 			];
			input.autocomplete({ source: regions });
			return regions;
		},
		industries: function(input) {
			var industries = [
				"Automobiles", "Education", "Real Estate", "Tax", "Other", "Auction House", "Art", "Club", "Faith-Based Organization", "Non-profit", "Boat", "Professional", "Utilities", "Insurance", "Advertising", "Legal", "Telecomm", "Fuel Dealers", "Equipment", "Sport", "Hospitals", "Membership Organizations ", 			];
			input.autocomplete({ source: industries });
			return industries;
		},
		acquirers: function(input) {
			var acquirers = [
				"Moneris", "Global Payments", "OPTIMAL", "DEMO", "GLOBAL", "PSIGATE", "FIRSTDATA", "VANTIV", "PCHASE", "TELUS", "PLASTIQ", "BAML", "BMO", 			];
			input.autocomplete({ source: acquirers });
			return acquirers;
		}
	}
	
</script><script type="text/javascript">
 
    var PaymentMethod = {
    getPaymentMethod: function(cardholder_name, pan, zip, exp_month, exp_year){
            var card_data = {
                pan : pan,
                zip : zip,
                exp_year : exp_year, 
                exp_month : exp_month,
                cardHolderName : cardholder_name                              
            };
            var error = false;
            var payment_method_id = 0;
            $.ajaxSetup({async:false});
            $.post('scripts/create-payment-method.php', card_data, function(data) {
                error = data.error;
                if (!error) {
                    payment_method_id = data;
                }
            }, "json");
//                .error(function(data) { alert("Error" + data); })
//                .complete(function(data) { alert("complete" + data); });

            $.ajaxSetup({async:true});                            

            return payment_method_id;        
    },
    createPaymentMethod: function(cardholder_name, pan, zip, exp_month, exp_year, payment_method_id) {
       
        var card_data = {
            paymentMethod : {
                cardData : {
                    zipcode : zip,
                    expirationDate : exp_year.substring(2) + exp_month,
                    cardHolderName : cardholder_name
                }
            }
        };

       if (pan)
           card_data.paymentMethod.cardData.accountNumber = pan;

       if (payment_method_id)
           {
               card_data.paymentMethod.id = payment_method_id;
           }
       else
       {
            var ticket = PaymentMethod.getTicket();
       
            if (ticket.error)
                 return false;
        
            card_data.ticket = ticket.ticket;
            card_data.paymentMethod.cardData.id = ticket.paymentMethod.id;
       }
            
        
        var error = true;

        $.ajaxSetup({async:false});

        if (payment_method_id){
            var ticket = new Array();
            $.post('scripts/update-payment-method.php', card_data, function(data) {
                    error = data.error;
                }
            , "json");
//                .error(function(data) { alert("Error" + data); })
//                .complete(function(data) { alert("complete" + data); });
          }
        else {
            $.ajax({
                  url: '/pmt/base/services/register',
                  type: 'POST',
                  dataType: 'json', 
                  data: JSON.stringify(card_data),
                  headers: {
                      'Accept': "application/json",
                      'Content-Type': 'application/json'
                  },
                  sucess: function(data) {error = data.error;}
              })        
              .complete(function(data) { 
                  if (data.readyState == 4 && data.status == 200)
                  {
                      error = false;
                      var x = $.parseJSON(data.responseText);
                      if (x && x.statusCode && x.statusCode != 0)
                        error = true;                                            
                  }

                      
 //                 if(!error){
 //                 	if($('#save_card').length > 0){
 //                 		if($('#save_card').attr('checked') == "checked"){
 //                 			var s=s_gi('plastiq');
//                  			s.events='event20';
//                  			s.tl(this,'o','card added and saved');
//                  		}else {
//							var s=s_gi('plastiq');
//							s.events='event4';
//							s.tl(this,'o','card added');
//						}
//                  	}else {
//                  		var s=s_gi('plastiq');
//                  		s.events='event20';
//                  		s.tl(this,'o','card added and saved');
//                  	}
 //                 }
                  //alert("complete" + data); 
              });}

        $.ajaxSetup({async:true});
        
        if (error)
            return false;
            
        return ticket.paymentMethod.id;
        
    },
    createAirMilesPaymentMethod: function(brand_type, account_number) {

        var payload = {
            paymentMethod :
            {
                incentiveData:
                {
                 brand: brand_type,
                 accountNumber: account_number
                 }
            }
        };
 
        var ticket = PaymentMethod.getTicket("INCENTIVE");

        if (ticket.error)
             return false;

        payload.ticket = ticket.ticket;

        var error = true;

        $.ajaxSetup({async:false});

        $.ajax({
              url: '/pmt/base/services/register',
              type: 'POST',
              dataType: 'json', 
              data: JSON.stringify(payload),
              headers: {
                  'Accept': "application/json",
                  'Content-Type': 'application/json'
              },
              sucess: function(data) {error = data.error;}
          })        
          .complete(function(data) { 
              if (data.readyState == 4 && data.status == 200)
              {
                  error = false;
                  var x = $.parseJSON(data.responseText);
                  if (x && x.statusCode && x.statusCode != 0)
                    error = true;                                            
              }
          });

        $.ajaxSetup({async:true});
        
        if (error)
            return false;
            
        return ticket.paymentMethod.id;        
    },

    createPaymentMethod2: function(payment_data, payment_method_id, payment_type) {

    	payment_type = typeof payment_type !== 'undefined' ? payment_type : 'CREDITCARD';
        payment_data = $.parseJSON(payment_data);

        if(payment_type == 'CREDITCARD' || payment_type == 'DEBITCARD'){
	        var payload = {
	            paymentMethod : {
	                cardData : {
	                    zipcode : payment_data.zip,
	                    expirationDate : payment_data.exp_year.substring(2) + payment_data.exp_month,
	                    cardHolderName : payment_data.cardholder_name
	                }
	            }
	        };
	
	       if (payment_data.pan)
	    	   payload.paymentMethod.cardData.accountNumber = payment_data.pan;
    	   
        }else if(payment_type != 'NA') {
        	var payload = {
    	            paymentMethod : payment_data
    	        };
        }
        

            if (payment_data.payment_method_id){
                    payload.paymentMethod.id = payment_data.payment_method_id;
            }else{
            var ticket = PaymentMethod.getTicket(payment_type);
       
            if (ticket.error)
                 return false;
        
            payload.ticket = ticket.ticket;
		}
            
        
        
       alert(JSON.stringify(payload));

        var error = true;

        $.ajaxSetup({async:false});

        if (payment_data.payment_method_id){
            var ticket = new Array();
            $.post('scripts/update-payment-method.php', payload, function(data) {
                    error = data.error;
                }
            , "json");
//                .error(function(data) { alert("Error" + data); })
//                .complete(function(data) { alert("complete" + data); });
          }
        else {
            $.ajax({
                  url: '/pmt/base/services/register',
                  type: 'POST',
                  dataType: 'json', 
                  data: JSON.stringify(payload),
                  headers: {
                      'Accept': "application/json",
                      'Content-Type': 'application/json'
                  },
                  sucess: function(data) {error = data.error;}
              })        
              .complete(function(data) { 
                  if (data.readyState == 4 && data.status == 200)
                  {
                      error = false;
                      var x = $.parseJSON(data.responseText);
                      if (x && x.statusCode && x.statusCode != 0)
                        error = true;                                            
                  }

                      
 //                 if(!error){
 //                 	if($('#save_card').length > 0){
 //                 		if($('#save_card').attr('checked') == "checked"){
 //                 			var s=s_gi('plastiq');
//                  			s.events='event20';
//                  			s.tl(this,'o','card added and saved');
//                  		}else {
//							var s=s_gi('plastiq');
//							s.events='event4';
//							s.tl(this,'o','card added');
//						}
//                  	}else {
//                  		var s=s_gi('plastiq');
//                  		s.events='event20';
//                  		s.tl(this,'o','card added and saved');
//                  	}
 //                 }
                  //alert("complete" + data); 
              });}

        $.ajaxSetup({async:true});
        
        if (error)
            return false;
            
        return ticket.paymentMethod.id;
        
    },
    
    getTicket: function(payment_type){
            var error = false;
            var ticket = new Array();
            $.ajaxSetup({async:false});
            $.post('scripts/create-payment-method.php', {ttl: 6000, pt: payment_type}, function(data) {
                error = data.error;
                if (!error) {
                    ticket = data;
                }
            }, "json");
//                .error(function(data) { alert("Error" + data); })
//                .complete(function(data) { alert("complete" + data); });

            $.ajaxSetup({async:true});                            

            return ticket;        
    },
    
    validateAirMiles: function(airmile_account){
    		airmile_account = airmile_account || 1;
    		
            if (airmile_account.length != 11)
                return false;
            
            var total = airmile_account[0]*6+airmile_account[1]*5+airmile_account[2]*4+airmile_account[3]*3;
            total += airmile_account[4]*8+airmile_account[5]*7+airmile_account[6]*6+airmile_account[7]*5;
            total += airmile_account[8]*4+airmile_account[9]*3;
            
            var count = ~~(total / 11);
            
            var remainder = total - (count * 11);
            
            var checksum = remainder < 2?0:11-remainder;
            
            if (checksum == airmile_account[10])
                return true;

            return false;        
    }
    
}

 </script>
<script src="https://maps.googleapis.com/maps/api/js?libraries=visualization,places&amp;key=AIzaSyBBwqJ5mtKckI3ZxS3YQegudOUktNSLu_Q&amp;sensor=false" type="text/javascript"></script>
<script type="text/javascript">
	var countries = '<option value="0" selected="selected">Country</option><option value="US">UNITED STATES</option><option value="CA">CANADA</option><option value="AF">AFGHANISTAN</option><option value="AX">ALAND ISLANDS</option><option value="AL">ALBANIA</option><option value="DZ">ALGERIA</option><option value="AS">AMERICAN SAMOA</option><option value="AD">ANDORRA</option><option value="AO">ANGOLA</option><option value="AI">ANGUILLA</option><option value="AQ">ANTARCTICA</option><option value="AG">ANTIGUA AND BARBUDA</option><option value="AR">ARGENTINA</option><option value="AM">ARMENIA</option><option value="AW">ARUBA</option><option value="AU">AUSTRALIA</option><option value="AT">AUSTRIA</option><option value="AZ">AZERBAIJAN</option><option value="BS">BAHAMAS</option><option value="BH">BAHRAIN</option><option value="BD">BANGLADESH</option><option value="BB">BARBADOS</option><option value="BY">BELARUS</option><option value="BE">BELGIUM</option><option value="BZ">BELIZE</option><option value="BJ">BENIN</option><option value="BM">BERMUDA</option><option value="BT">BHUTAN</option><option value="BO">BOLIVIA</option><option value="BQ">BONAIRE</option><option value="BA">BOSNIA AND HERZEGOVINA</option><option value="BW">BOTSWANA</option><option value="BV">BOUVET ISLAND</option><option value="BR">BRAZIL</option><option value="IO">BRITISH INDIAN OCEAN TERRITORY</option><option value="BN">BRUNEI DARUSSALAM</option><option value="BG">BULGARIA</option><option value="BF">BURKINA FASO</option><option value="BI">BURUNDI</option><option value="KH">CAMBODIA</option><option value="CM">CAMEROON</option><option value="CV">CAPE VERDE</option><option value="KY">CAYMAN ISLANDS</option><option value="CF">CENTRAL AFRICAN REPUBLIC</option><option value="TD">CHAD</option><option value="CL">CHILE</option><option value="CN">CHINA</option><option value="CX">CHRISTMAS ISLAND</option><option value="CC">COCOS (KEELING) ISLANDS</option><option value="CO">COLOMBIA</option><option value="KM">COMOROS</option><option value="CG">CONGO</option><option value="CD">THE DEMOCRATIC REPUBLIC OF THE CONGO</option><option value="CK">COOK ISLANDS</option><option value="CR">COSTA RICA</option><option value="CI">COTE D\'IVOIRE</option><option value="HR">CROATIA</option><option value="CU">CUBA</option><option value="CW">CURACAO</option><option value="CY">CYPRUS</option><option value="CZ">CZECH REPUBLIC</option><option value="DK">DENMARK</option><option value="DJ">DJIBOUTI</option><option value="DM">DOMINICA</option><option value="DO">DOMINICAN REPUBLIC</option><option value="EC">ECUADOR</option><option value="EG">EGYPT</option><option value="SV">EL SALVADOR</option><option value="GQ">EQUATORIAL GUINEA</option><option value="ER">ERITREA</option><option value="EE">ESTONIA</option><option value="ET">ETHIOPIA</option><option value="FK">FALKLAND ISLANDS (MALVINAS)</option><option value="FO">FAROE ISLANDS</option><option value="FJ">FIJI</option><option value="FI">FINLAND</option><option value="FR">FRANCE</option><option value="GF">FRENCH GUIANA</option><option value="PF">FRENCH POLYNESIA</option><option value="TF">FRENCH SOUTHERN TERRITORIES</option><option value="GA">GABON</option><option value="GM">GAMBIA</option><option value="GE">GEORGIA</option><option value="DE">GERMANY</option><option value="GH">GHANA</option><option value="GI">GIBRALTAR</option><option value="GR">GREECE</option><option value="GL">GREENLAND</option><option value="GD">GRENADA</option><option value="GP">GUADELOUPE</option><option value="GU">GUAM</option><option value="GT">GUATEMALA</option><option value="GG">GUERNSEY</option><option value="GN">GUINEA</option><option value="GW">GUINEA-BISSAU</option><option value="GY">GUYANA</option><option value="HT">HAITI</option><option value="HM">HEARD ISLAND AND MCDONALD ISLANDS</option><option value="VA">HOLY SEE (VATICAN CITY STATE)</option><option value="HN">HONDURAS</option><option value="HK">HONG KONG</option><option value="HU">HUNGARY</option><option value="IS">ICELAND</option><option value="IN">INDIA</option><option value="ID">INDONESIA</option><option value="IR">ISLAMIC REPUBLIC OF IRAN</option><option value="IQ">IRAQ</option><option value="IE">IRELAND</option><option value="IM">ISLE OF MAN</option><option value="IL">ISRAEL</option><option value="IT">ITALY</option><option value="JM">JAMAICA</option><option value="JP">JAPAN</option><option value="JE">JERSEY</option><option value="JO">JORDAN</option><option value="KZ">KAZAKHSTAN</option><option value="KE">KENYA</option><option value="KI">KIRIBATI</option><option value="KP">DEMOCRATIC PEOPLE\'S REPUBLIC OF KOREA</option><option value="KR">REPUBLIC OF KOREA</option><option value="KW">KUWAIT</option><option value="KG">KYRGYZSTAN</option><option value="LA">LAO PEOPLE\'S DEMOCRATIC REPUBLIC</option><option value="LV">LATVIA</option><option value="LB">LEBANON</option><option value="LS">LESOTHO</option><option value="LR">LIBERIA</option><option value="LY">LIBYA</option><option value="LI">LIECHTENSTEIN</option><option value="LT">LITHUANIA</option><option value="LU">LUXEMBOURG</option><option value="MO">MACAO</option><option value="MK">MACEDONIA</option><option value="MG">MADAGASCAR</option><option value="MW">MALAWI</option><option value="MY">MALAYSIA</option><option value="MV">MALDIVES</option><option value="ML">MALI</option><option value="MT">MALTA</option><option value="MH">MARSHALL ISLANDS</option><option value="MQ">MARTINIQUE</option><option value="MR">MAURITANIA</option><option value="MU">MAURITIUS</option><option value="YT">MAYOTTE</option><option value="MX">MEXICO</option><option value="FM">FEDERATED STATES OF MICRONESIA</option><option value="MD">MOLDOVA</option><option value="MC">MONACO</option><option value="MN">MONGOLIA</option><option value="ME">MONTENEGRO</option><option value="MS">MONTSERRAT</option><option value="MA">MOROCCO</option><option value="MZ">MOZAMBIQUE</option><option value="MM">MYANMAR</option><option value="NA">NAMIBIA</option><option value="NR">NAURU</option><option value="NP">NEPAL</option><option value="NL">NETHERLANDS</option><option value="NC">NEW CALEDONIA</option><option value="NZ">NEW ZEALAND</option><option value="NI">NICARAGUA</option><option value="NE">NIGER</option><option value="NG">NIGERIA</option><option value="NU">NIUE</option><option value="NF">NORFOLK ISLAND</option><option value="MP">NORTHERN MARIANA ISLANDS</option><option value="NO">NORWAY</option><option value="OM">OMAN</option><option value="PK">PAKISTAN</option><option value="PW">PALAU</option><option value="PS">STATE OF PALESTINE</option><option value="PA">PANAMA</option><option value="PG">PAPUA NEW GUINEA</option><option value="PY">PARAGUAY</option><option value="PE">PERU</option><option value="PH">PHILIPPINES</option><option value="PN">PITCAIRN</option><option value="PL">POLAND</option><option value="PT">PORTUGAL</option><option value="PR">PUERTO RICO</option><option value="QA">QATAR</option><option value="RE">REUNION</option><option value="RO">ROMANIA</option><option value="RU">RUSSIAN FEDERATION</option><option value="RW">RWANDA</option><option value="BL">SAINT BARTHELEMY</option><option value="SH">SAINT HELENA</option><option value="KN">SAINT KITTS AND NEVIS</option><option value="LC">SAINT LUCIA</option><option value="MF">SAINT MARTIN (FRENCH PART)</option><option value="PM">SAINT PIERRE AND MIQUELON</option><option value="VC">SAINT VINCENT AND THE GRENADINES</option><option value="WS">SAMOA</option><option value="SM">SAN MARINO</option><option value="ST">SAO TOME AND PRINCIPE</option><option value="SA">SAUDI ARABIA</option><option value="SN">SENEGAL</option><option value="RS">SERBIA</option><option value="SC">SEYCHELLES</option><option value="SL">SIERRA LEONE</option><option value="SG">SINGAPORE</option><option value="SX">SINT MAARTEN (DUTCH PART)</option><option value="SK">SLOVAKIA</option><option value="SI">SLOVENIA</option><option value="SB">SOLOMON ISLANDS</option><option value="SO">SOMALIA</option><option value="ZA">SOUTH AFRICA</option><option value="GS">SOUTH GEORGIA AND THE SOUTH SANDWICH ISLANDS</option><option value="SS">SOUTH SUDAN</option><option value="ES">SPAIN</option><option value="LK">SRI LANKA</option><option value="SD">SUDAN</option><option value="SR">SURINAME</option><option value="SJ">SVALBARD AND JAN MAYEN</option><option value="SZ">SWAZILAND</option><option value="SE">SWEDEN</option><option value="CH">SWITZERLAND</option><option value="SY">SYRIAN ARAB REPUBLIC</option><option value="TW">TAIWAN</option><option value="TJ">TAJIKISTAN</option><option value="TZ">UNITED REPUBLIC OF TANZANIA</option><option value="TH">THAILAND</option><option value="TL">TIMOR-LESTE</option><option value="TG">TOGO</option><option value="TK">TOKELAU</option><option value="TO">TONGA</option><option value="TT">TRINIDAD AND TOBAGO</option><option value="TN">TUNISIA</option><option value="TR">TURKEY</option><option value="TM">TURKMENISTAN</option><option value="TC">TURKS AND CAICOS ISLANDS</option><option value="TV">TUVALU</option><option value="UG">UGANDA</option><option value="UA">UKRAINE</option><option value="AE">UNITED ARAB EMIRATES</option><option value="GB">UNITED KINGDOM</option><option value="UM">UNITED STATES MINOR OUTLYING ISLANDS</option><option value="UY">URUGUAY</option><option value="UZ">UZBEKISTAN</option><option value="VU">VANUATU</option><option value="VE">VENEZUELA</option><option value="VN">VIET NAM</option><option value="VG">BRITISH VIRGIN ISLANDS</option><option value="VI">U.S. VIRGIN ISLANDS</option><option value="WF">WALLIS AND FUTUNA</option><option value="EH">WESTERN SAHARA</option><option value="YE">YEMEN</option><option value="ZM">ZAMBIA</option><option value="ZW">ZIMBABWE</option>';
			
	//############################################################################################
	// #################### Secondary Menu Controls Start ########################################
	//############################################################################################
	CHNav = (function(window, document, $, undefined){
		$(document).ready(function(){
			if($('#ch-layout').length){
				sizeAdjust();
				
				CHNav.enviorment = $('#apenviorment').val();
				CHNav.sType = (CHNav.enviorment == 'dev' ? 'plastiq' : 'plastiqplastiqtax');
				
				CHNav.nav.secondary.on('click', 'a', function(e){
					$(this).siblings().removeClass('active');
					$(this).addClass('active');
				
					if($(this).attr('href') == '#account'){
						CHNav.accountPage.show();
						CHNav.cardsPage.hide();
						
						CHAccount.resetInfo();
					}else if($(this).attr('href') == '#cards'){
						CHNav.accountPage.hide();
						CHNav.cardsPage.show();						
					}
					
					$('body').addClass('secondary-open');
				
					e.preventDefault();
				});
			
				$('#close-secondary-page').click(function(){
					$('body').removeClass('secondary-open');
					CHNav.nav.secondary.find('.active').removeClass('active');
				});
				
				$('#account-password-btn').click(function(){
					$('#account-nav').find('.active').removeClass('active');
					$(this).addClass('active');
					CHNav.accountPage.attr('class', 'account-password-show');
					
					setTimeout(function(){
						CHAccount.form.password.current.focus();
					}, 350);
				});
				
				$('#account-information-btn').click(function(){
					$('#account-nav').find('.active').removeClass('active');
					$(this).addClass('active');
					CHNav.accountPage.attr('class', '');
				});
				
				$('#account-rewards-btn').click(function(){
					$('#account-nav').find('.active').removeClass('active');
					$(this).addClass('active');					
					CHNav.accountPage.attr('class', 'account-rewards-show');
				});
				
				$('#account-airmiles').numeric();
				
				$('#save-reward-changes').click(function(){
					saveEditAirmiles();
					
					return false;
				});
				
				$(window).resize(function(){
					sizeAdjust();
				});
				
				$('#ch-secondary-page-scroll').scroller({width: 300});

				$('#ch-page-cont').scroll(function(){
					var currentPos = $(this).scrollTop();
					
					if(currentPos >= 140 && !CHNav.attached){
						CHNav.attached = true;
					
						$('#ch-nav-cont').prependTo('#ch-page-scroller').addClass('full');
						
						$('#back-to-top-btn').transition({
							width: 36,
							marginRight: 35
						}, 500, CHMessage.ease);
					}else if(CHNav.attached && currentPos < 140){
						CHNav.attached = false;
						
						$('#ch-nav-cont').appendTo('#ch-header').removeClass('full');
						
						$('#back-to-top-btn').transition({
							width: 0,
							marginRight: 0
						}, 500, CHMessage.ease)
					}
				}).scroller({id:'ch-page-scroller'});
				
				CHNav.nav.main.children().hover(function(){
					var hoverSec = $(this).data('link-title');
					
					CHNav.nav.cont.attr('data-active-page', hoverSec);
				}, function(){
					var realPage = CHNav.nav.cont.attr('data-actual-page');
					
					CHNav.nav.cont.attr('data-active-page', realPage);
				});
				
				CHNav.topBtn.click(function(){
					$('#ch-page-cont').animate({
						scrollTop: 0
					}, 500);
				});
				
				$('#account-airmiles').focus(function(){
					CHNav.prevAirmiles = $(this).val();
					
					clearTimeout(CHNav.rewardsTimer);
					
					$('#account-rewards').addClass('submittable');
				}).blur(function(){
					CHNav.rewardsTimer = setTimeout(function(){
						$('#account-airmiles').val(CHNav.prevAirmiles);
						
						$('#account-rewards').removeClass('submittable');
					}, 2000);
				});
				
				$('.view-program-details').click(function(){
					$(this).slideUp(500);
					$(this).siblings('.program-details').slideDown(500);
				});
				
				$('.close-program-details').click(function(){
					var details = $(this).closest('.program-details');
					
					details.slideUp(500);
					details.siblings('.view-program-details').slideDown(500);
				});
			}
		});
		
		function saveEditAirmiles(){
			var airmilesNumber = $('#account-airmiles').val(),
				airmilesValidation = PaymentMethod.validateAirMiles(airmilesNumber),
				s = s_gi(CHNav.sType);
			
			if(CHNav.prevAirmiles == airmilesNumber){
				CHMessage.add('Your AIR MILES number is already set.', 'error');
			}else if(airmilesValidation){
				var paymentMethod = PaymentMethod.createAirMilesPaymentMethod('AIRMILES', airmilesNumber);
				
				if(paymentMethod){
					var data = {
							User_Profiles: [{
								reference_type: 'incentive_types',
								reference_id: 'AirMiles',
								key: 'account',
								value: paymentMethod,
								active: 1
							}]
						}
					
					s.linkTrackVars = 'eVar31';
					s.eVar31 = airmilesNumber;
					s.tl(this,'o','airmiles number added');
					
					$.ajax({
						type: 'POST',
						dataType: 'json',
						url: '/scripts/add-user-profile.php',
						data: data,
						error: function(jqXHR, status, exception) {
					        if(exception.length){
					        	$('#account-airmiles').val(CHNav.prevAirmiles);
					        	
					            CHMessage.add('Error validating your AIR MILES number, please try again.', 'error');
					        }
					    },
					    success: function(data, status, jqXHR){
					    	if(status == 'success'){
					    		CHNav.prevAirmiles = airmilesNumber;
					    		$('#account-airmiles').val(airmilesNumber);
					    		
					    		CHMessage.add('Your Airmiles number was successfully saved!');
					    	}else{
					    		$('#account-airmiles').val(CHNav.prevAirmiles);
					    		
					    		CHMessage.add('Error validating your AIR MILES number, please try again.', 'error');
					    	}
					    }
					});
				}else{
					$('#account-airmiles').val(CHNav.prevAirmiles);
					
					CHMessage.add('Error validating your AIR MILES number, please try again.', 'error');
				}
			}else{
				$('#account-airmiles').val(CHNav.prevAirmiles);
				
				CHMessage.add('Error validating your AIR MILES number, please try again.', 'error');
			}
		}
		
		function sizeAdjust(){
			var changedWidth = 0,
				mainPage = $('#ch-page');
			
			CHNav.width = $('#ch-header').width();
			CHNav.height = $(window).height();
			
			if(CHNav.height > mainPage.height() + 260){
				mainPage.css('min-height', CHNav.height - 259);
			}else {
				mainPage.css('min-height', 0);
			}
		}
		
		return {
			accountPage: $('#account-page'),
			cardsPage: $('#cards-page'),
			nav: {
				cont: $('#ch-nav'),
				main: $('#ch-main-nav'),
				secondary: $('#ch-secondary-nav')
			},
			width: $('#ch-header').width(),
			topBtn: $('#back-to-top-btn'),
			attached: false
		}
	})(window, document, $)
	
	
	//############################################################################################
	// ########################### Account Controls Start ########################################
	//############################################################################################
	
	CHAccount = (function(window, document, $, undefined){
		$(document).ready(function(){
			if($('#loggedin').length && $('#ch-layout').length){
				getAccountInfo();
				
				CHAccount.form.information.cont.submit(function(e){
					saveAccountInfo();
					
					e.preventDefault();
					
					return false;
				});
				
				CHAccount.form.password.cont.submit(function(e){
					saveNewPassword();
					
					e.preventDefault();
					
					return false;
				});
			}
		});
		
		function getAccountInfo(){
			$.ajax({
				type: 'POST',
				dataType: 'json',
				url: '/scripts/account_management.php',
				data: {
					action: 'load',
					security_token: CHAccount.securityToken
				},
				error: function(jqXHR, status, exception) {
		            if(exception.length){
		                CHMessage.add('Error Loading Your Account Info', 'error');
		            }
		        },
		        success: function(data, status, jqXHR){
		        	if(status == 'success'){
		        		if(!data.error){
		        			CHAccount.info = data.acct_info;
		        			
		        			fillAccountData();
		        		}
		        	}else{
		        		CHMessage.add('Error Loading Your Account Info', 'error');
		        	}
		        }
			});
		}
		
		function saveAccountInfo(){
			if(CHAccount.form.information.firstName.val().trim().length){
				CHAccount.form.information.firstName.removeError();
			}else{
				CHAccount.form.information.firstName.addError('Please add your first name.', {
					parent: CHAccount.form.information.cont,
					offset: {
						top: -1,
						left: 1
					},
					errorAlign: 'right'
				});
				
				return false;
			}
			
			if(CHAccount.form.information.lastName.val().trim().length){
				CHAccount.form.information.lastName.removeError();
			}else{
				CHAccount.form.information.lastName.addError('Please add your last name.', {
					parent: CHAccount.form.information.cont,
					offset: {
						top: -1,
						left: 1
					},
					errorAlign: 'right'
				});
				
				return false;
			}
			
			if(!$.validate('email', CHAccount.form.information.email.val())){
				CHAccount.form.information.email.removeError();
			}else{
				CHAccount.form.information.email.addError('Please add a valid email.', {
					parent: CHAccount.form.information.cont,
					offset: {
						top: -1,
						left: 1
					},
					errorAlign: 'right'
				});
				
				return false;
			}
			
			if(!$.validate('phone', CHAccount.form.information.phone.val())){
				CHAccount.form.information.phone.removeError();
			}else{
				CHAccount.form.information.phone.addError('Please enter a valid phone number.', {
					parent: CHAccount.form.information.cont,
					offset: {
						top: -1,
						left: 1
					},
					errorAlign: 'right'
				});
				
				return false;
			}
			
			if(!CHAccount.form.information.cont.find('.error').length){
				CHAccount.form.information.cont.find('button').btnLoad('Saving Information...');
				
				$.ajax({
					type: 'POST',
					dataType: 'json',
					url: '/scripts/account_management.php',
					data: {
						action: 'update',
						security_token: CHAccount.securityToken,
						first_name: CHAccount.form.information.firstName.val(),
						last_name: CHAccount.form.information.lastName.val(),
						email: CHAccount.form.information.email.val(),
						phone: CHAccount.form.information.phone.val()
					},
					complete: function(data, status){
						data = $.parseJSON(data.responseText);
						
						if(status == 'success'){
							if(!data.error){
								CHAccount.form.information.cont.find('button').btnComplete('Information Saved...');
								CHMessage.add('Information Successfully Saved');
								
								getAccountInfo();
							}else {
								CHAccount.form.information.cont.find('button').btnComplete('Error Saving...', true);
								CHMessage.add('Error Saving Information', 'error');
							}
						}else{
							CHAccount.form.information.cont.find('button').btnComplete('Error Saving...', true);
							CHMessage.add('Error Saving Information', 'error');
						}
					}
				});
			}
		}
		
		function saveNewPassword(){
			if(CHAccount.form.password.current.val().trim().length){
				CHAccount.form.password.current.removeError();
			}else{
				CHAccount.form.password.current.addError('Please enter your current password.', {
					parent: CHAccount.form.password.cont,
					offset: {
						top: -1,
						left: 1
					},
					errorAlign: 'right'
				});
				
				return false;
			}
			
			if(CHAccount.form.password.new1.val().trim().length){
				CHAccount.form.password.new1.removeError();
			}else{
				CHAccount.form.password.new1.addError('Please enter your new password.', {
					parent: CHAccount.form.password.cont,
					offset: {
						top: -1,
						left: 1
					},
					errorAlign: 'right'
				});
				
				return false;
			}
			
			if(CHAccount.form.password.new2.val().trim().length){
				CHAccount.form.password.new2.removeError();
			}else{
				CHAccount.form.password.new2.addError('Please enter your new password again.', {
					parent: CHAccount.form.password.cont,
					offset: {
						top: -1,
						left: 1
					},
					errorAlign: 'right'
				});
				
				return false;
			}
			
			if(CHAccount.form.password.new2.val() == CHAccount.form.password.new1.val()){
				CHAccount.form.password.new2.removeError();
			}else{
				CHAccount.form.password.new2.addError('This must match your new password.', {
					parent: CHAccount.form.password.cont,
					offset: {
						top: -1,
						left: 1
					},
					errorAlign: 'right'
				});
				
				return false;
			}
			
			if(!CHAccount.form.password.cont.find('.error').length){
				CHAccount.form.password.cont.find('button').btnLoad('Changing Password...');
				
				$.ajax({
					type: 'POST',
					dataType: 'json',
					url: '/scripts/account_management.php',
					data: {
						action: 'change-password',
						security_token: CHAccount.securityToken,
						old_password: CHAccount.form.password.current.val(),
						password: CHAccount.form.password.new1.val(),
						password2: CHAccount.form.password.new2.val()
					},
					complete: function(data, status){
						data = $.parseJSON(data.responseText);
						
						if(status == 'success'){
							if(!data.error){
								CHAccount.form.password.cont.find('button').btnComplete('Password Changed...');
								CHMessage.add('Password Successfully Changed');
							}else {
								CHAccount.form.password.cont.find('button').btnComplete('Error Changing...', true);
								CHMessage.add(data.message, 'error');
							}
						}else{
							CHAccount.form.password.cont.find('button').btnComplete('Error Changing...', true);
							CHMessage.add('Error Saving Password', 'error');
						}
						
						CHAccount.form.password.current.val('');
						CHAccount.form.password.new1.val('');
						CHAccount.form.password.new2.val('');
					}
				});
			}
		}
		
		function fillAccountData(){
			CHAccount.form.information.firstName.val(CHAccount.info.first_name);
			CHAccount.form.information.lastName.val(CHAccount.info.last_name);
			CHAccount.form.information.email.val(CHAccount.info.email);
			CHAccount.form.information.phone.val(CHAccount.info.phone);
		}
		
		return {
			info: undefined,
			securityToken: $('input[name="security_token"]').val(),
			form: {
				information: {
					cont: $('#account-information'),
					firstName: $('#account-first-name'),
					lastName: $('#account-last-name'),
					email: $('#account-email'),
					phone: $('#account-phone')
				},
				password: {
					cont: $('#account-password'),
					current: $('#account-current-password'),
					new1: $('#account-new-password'),
					new2: $('#account-confirm-password')
				}
			},
			resetInfo: function(){
				fillAccountData();
			}
		}
	})(window, document, $);

//############################################################################################
// ############################# Cards Controls Start ########################################
//############################################################################################
	
//############################################################################################
// ########################### System Message Controls Start #################################
//############################################################################################
	
	CHMessage = (function(window, document, $, undefined){
		$(document).ready(function(){
			if(!Modernizr.csstransitions){
				CHMessage.ease = $.bez([.25,.1,.25,1]);
			}
		});
		
		function addMessage(message, messageType){
			var messageEl = $('<div class="system-message">'),
				messageID = 'message'+ CHMessage.ids,
				classes = '';
			
			messageType = messageType || 'regular';
			CHMessage.ids++;
			
			CHMessage.messages[messageID] = {
				message: message,
				el: messageEl,
				messageType: messageType
			}
			
			if(messageType == 'sticky'){
				messageEl.addClass('sticky').html('<div class="message-cont">'+ (message.title ? '<h2>'+ message.title +'</h2>' : '') + (message.message ? '<p>'+ message.message +'</p>' : '') +'</div>');
								
				$('body').prepend(messageEl);

				setTimeout(function(){
					messageEl.addClass(classes).find('.message-cont').css({
						'transform': 'rotateX(0deg)',
						'-moz-transform': 'rotateX(0deg)',
						'-webkit-transform': 'rotateX(0deg)',
						'-o-transform': 'rotateX(0deg)',
						'-ms-transform': 'rotateX(0deg)'
					}).toolTip({options: {
						direction: 'left',
						tipFollowMouse: true,
						title: 'Click to close'
					}});
				}, 10);
			}else{
				messageEl.html(message);
				
				$('body').prepend(messageEl);
				
				messageEl.css('margin-left', -(messageEl.outerWidth() / 2)).addClass((messageType == 'error' ? 'error' : '')).transition({
					top: 250
				}, 500, CHMessage.ease);
				
				CHMessage.messages[messageID].timer = setTimeout(function(){
					removeMessage(messageID);
				}, 3500);
			}
			
			messageEl.bind('click.CHMessage', function(){
				clearTimeout(CHMessage.messages[messageID].timer);
				
				removeMessage(messageID);
			});
		}
		
		function removeMessage(groupID){
			var messageType = CHMessage.messages[groupID].messageType;
			
			if(messageType == 'sticky'){
				CHMessage.messages[groupID].el.find('.message-cont').css({
					'transform': 'rotateX(90deg)',
					'-moz-transform': 'rotateX(90deg)',
					'-webkit-transform': 'rotateX(90deg)',
					'-o-transform': 'rotateX(90deg)',
					'-ms-transform': 'rotateX(90deg)'
				});
				
				setTimeout(function(){
					CHMessage.messages[groupID].el.remove();
					
					delete CHMessage.messages[groupID];
				}, 500);
			}else{
				CHMessage.messages[groupID].el.transition({
					scale: 2,
					opacity: 0
				}, 250, CHMessage.ease, function(){
					$(this).remove();
					
					delete CHMessage.messages[groupID];
				});
			}
		}
		
		return {
			ids: 0,
			messages: {},
			add: function(message, messageType){			
				messageType = (messageType == true ? 'error' : messageType);
				addMessage(message, messageType);
			},
			ease: 'ease'
		}
	})(window, document, $);

//############################################################################################
// #################################### Merchant Modal Start #################################
//############################################################################################

	var merchantModal = (function(window, document, $, undefined){
		window.merchantModal = merchantModal = this;
		
		$(window).resize(function(){
			pqScrolling.init();
		});
		
		return {
			merchantInfoCall: null,
			show: function(merchant){
				var data = {
					merchant_id: merchant
				},
				merchantModalCont = $('#merchant-modal-cont');
				
				merchantModal.merchant = merchant;
				
				if(merchantModalCont.length < 1){
					merchantModalCont = $('<div id="merchant-modal-cont"><div id="merchant-modal-loader"></div><div id="merchant-modal-close-btn"></div></div>');
					
					$('body').prepend(merchantModalCont);
				}
				
				$('#merchant-modal-close-btn').unbind('click.merchantModalClose').bind('click.merchantModalClose', function(){
					merchantModal.hide(merchantModalCont);
				});
				
				merchantModal.moveIn(merchantModalCont);
				
				if(merchantModal.merchantInfoCall){
					merchantModal.merchantInfoCall.abort();
				}
				
				merchantModal.merchantInfoCall = $.ajax({
					type: 'POST',
					dataType: 'json',
					url: '/scripts/get-merchant-info.php',
					data: data,
					complete: function(data, status){
						data = $.parseJSON(data.responseText);
						
						if(status == 'success'){
							var profile = $(merchantModal.getProfile(data));
							
							$(merchantModalCont).prepend(profile);

							if(window.google && (data.latitude != null) && (data.latitude != '') && (data.latitude != undefined)){
								merchantModal.loadMerchantMap(data);
							}else {
								$('#merchant-modal-map').remove();
							}
							
							$('.title-tooltip').toolTip();
							$('#merchant-modal-head').find('h2').scrollText();
							
							if($('.lt-ie9').length < 1){
								pqScrolling.init();
								merchantModal.hideLoader();
							}else {
								merchantModal.hideLoader();
								pqScrolling.init();
							}
						}
					}
				});
			},
			moveIn: function(merchantModalCont){
				var modalHeight = 0;
				
				$(merchantModalCont).css({
					zIndex: -99,
					bottom: 40,
					top: 0,
					height: 'auto'
				});
				
				modalHeight = $(merchantModalCont).height();
				
				$(merchantModalCont).css({
					zIndex: 999999,
					bottom: 'auto',
					top: '-500%',
					height: modalHeight
				});
				
				$(window).bind('keyup.merchantModal', function(key){
					if(key.keyCode == 27){
						merchantModal.hide(merchantModalCont);
					}
				})
				
				$(merchantModalCont).find('#merchant-modal-loader').css({
					display: 'block'
				});
				
				$(merchantModalCont).animate({
					top: 0
				}, 750, function(){
					$(this).css({
						height: 'auto',
						bottom: '40px'
					});
				});
			},
			hide: function(merchantModalCont){
				var modalHeight = $(merchantModalCont).height();
				
				merchantModal.merchantInfoCall.abort();
				
				$(merchantModalCont).css({
					bottom: 'auto',
					height: modalHeight
				}).animate({
					top: '-'+ (modalHeight + 10) +'px'
				}, 500, function(){
					$(merchantModalCont).html('<div id="merchant-modal-loader"></div><div id="merchant-modal-close-btn"></div>');
				});
				
				$(window).unbind('keyup.merchantModal');
			},
			hideLoader: function(){
				$('#merchant-modal-loader').fadeOut();
			},
			getProfile: function(data){
				var description = data.description || 'None...',
					refund = data.refund_policy || 'No Refunds.',
					tos = data.tos || 'None entered. Please refer to Plastiq’s Terms of Service.',
					scrollClass = 'pq-scroller',
					prettyURL = data.url,
					decodedhtml = '';
					
				if(window.mobilecheck()){
					scrollClass = '';
				}
				
				refund = $('<div/>').html(refund).text();
				tos = $('<div/>').html(tos).text();
				
				prettyURL = prettyURL.replace("http://","");
				prettyURL = prettyURL.replace("https://","");
				
				html = '<div id="merchant-modal-head"><h2>'+ data.name +'</h2><address>'+ data.address +', '+ data.city +', '+ data.state +'  '+ data.zip +' - '+ data.country +'</address><a href="'+ data.url +'">'+ prettyURL +'</a><a href="tel:'+ data.phone +'">'+ data.phone +'</a></div><div id="merchant-modal-scroll-sec" class="'+ scrollClass +'" data-scroll-bottom="0" data-scroll-shadow="true"><div id="merchant-modal-map" class="title-tooltip" data-tip-title="Click to view in google." data-tip-on-mouse="true" data-tip-outside="true"></div><div class="merchant-modal-section"><h3>Funding Type &amp; Timeline</h3>'+ merchantModal.getFundingBlock(data) +'</div>'; 
				html += (description != 'None...') ? '<div class="merchant-modal-section"><h3>Description</h3><p class="important">'+ description +'</p></div>' : ''; 
//				html += data.rate?'<div class="merchant-modal-section"><h3>Cards &amp; Rates</h3>'+ merchantModal.getRatesTable(data.rate) +'</div>':'';
                                html +='<div class="merchant-modal-section"><h3>'+ data.name +' Policies &amp; Terms</h3><h4>Refund Policy</h4><div id="merchant-refund-cont" class="pq-scroller"><p>'+ refund +'</p></div><h4>Terms of Service</h4><div id="merchant-tos-cont" class="pq-scroller"><p>'+ tos +'</p></div></div></div>';
					
				return html;
			},
			loadMerchantMap: function(data){
				var pos = {
						lat: data.latitude,
						lng: data.longitude
					},
					address= data.address +', '+ data.city +', '+ data.state +'  '+ data.zip +' - '+ data.country,
					mapLatLong = new google.maps.LatLng(pos.lat, pos.lng),
					mapOptions = {
						center: mapLatLong,
						zoom: 14,
						mapTypeId: google.maps.MapTypeId.ROADMAP,
						disableDefaultUI: true,
						draggableCursor: 'pointer'
					},
					map = new google.maps.Map(document.getElementById("merchant-modal-map"), mapOptions),
					marker = new google.maps.Marker({
						position: mapLatLong,
						map: map,
						title: data.name
					});
				google.maps.event.addListener(map, 'click', function() {
					window.open('https://maps.google.com/?q='+ address +'&z=14', '_blank');
				});
				google.maps.event.addListener(marker, 'click', function() {
					window.open('https://maps.google.com/?q='+ address +'&z=14', '_blank');
				});
			},
			getFundingBlock: function(data){
				var busModel = data.business_model,
					periodMin = data.settlement_period.min,
					periodMax = data.settlement_period.max,
					timePeriod = '';

				if(periodMin < 1){
					timePeriod = 'instant';
				}else if(periodMin < 4){
					timePeriod = 'quick';
				}else if(periodMin < 5){
					timePeriod = 'fast';
				}else{
					timePeriod = 'slow';
				}
								
				if(merchantModal.merchant == 10327 || merchantModal.merchant == 13959){
					return '<h5 class="'+ timePeriod +' funding-type">Funded Electronically - '+ periodMin +'-'+ periodMax +' business days</h5><p>' + data.name + ' acknowledges Plastiq and accepts electronic payments. Payment delivery takes '+ periodMin +' - '+ periodMax +' business days.</p>';
				}else if(busModel.bm_id == 'STD1'){
					return '<h5 class="'+ timePeriod +' funding-type">Funded Electronically - '+ periodMin +'-'+ periodMax +' business days</h5><p>' + data.name + ' has a relationship with Plastiq and accepts electronic payments. Payment delivery takes '+ periodMin +' - '+ periodMax +' business days.</p>';
				}else if(busModel.bm_id == 'STD2'){
					return '<h5 class="'+ timePeriod +' funding-type">Funded Electronically - '+ periodMin +'-'+ periodMax +' business days</h5><p>' + data.name + ' has a relationship with Plastiq and accepts electronic payments. Payment delivery takes '+ periodMin +' - '+ periodMax +' business days.</p>';
				}else if(busModel.bm_id == 'AIM'){
					return '<h5 class="'+ timePeriod +' funding-type">Funded Electronically - '+ periodMin +'-'+ periodMax +' business days</h5><p>' + data.name + ' has a relationship with Plastiq and accepts electronic payments. Payment delivery takes '+ periodMin +' - '+ periodMax +' business days.</p>';
				}else if(busModel.bm_id == 'MIM'){
					return '<h5 class="'+ timePeriod +' funding-type">Funded By Check - '+ periodMin +'-'+ periodMax +' business days</h5><p>' + data.name + ' does not accept electronic funding from Plastiq. When a merchant does not accept electronic funding, Plastiq issues a check on your behalf. Payment delivery may take '+ periodMin +' - '+ periodMax +' business days to reach '+ data.name +'.</p>';
				}else if(busModel.bm_id == 'PAYANY1'){
					return '<h5 class="'+ timePeriod +' funding-type">Funded By Check - '+ periodMin +'-'+ periodMax +' business days</h5><p>' + data.name + ' does not accept electronic funding from Plastiq. When a merchant does not accept electronic funding, Plastiq issues a check on your behalf. Payment delivery may take '+ periodMin +' - '+ periodMax +' business days to reach '+ data.name +'.</p>';
				}else if(busModel.bm_id == 'BILLPAY'){
					return '<h5 class="'+ timePeriod +' funding-type">Funded Electronically - '+ periodMin +'-'+ periodMax +' business days</h5><p>' + data.name + ' will receive an electronic payment from Plastiq.  Electronic payment delivery takes '+ periodMin +' - '+ periodMax +' business days.</p>';
				}			
			},
			getRatesTable: function(rates){
				var ratesTable = '';
				window.tester = rates;

				if(Object.size(rates) == 1){
					ratesTable = merchantModal.getRateRow('Any Amount', rates.all);
				}
				
				delete rates.all;
				
				$.each(rates, function(form, rate){
					ratesTable += merchantModal.getRateRow(form, rate);
				});
				
				return '<table id="merchant-rates">' + ratesTable + '</table>';
			},
			getRateRow: function(name, rates){
				var master = rates['1'],
					visa = rates['2'],
					amex = rates['3'],
					mcDis = '',
					visaDis = '',
					amexDis = '';
				
				if(master === undefined){
					mcDis = ' disabled';
					master = '---';
				}
				
				if(visa === undefined){
					visaDis = ' disabled';
					visa = '---';
				}
				
				if(amex === undefined){
					amexDis = ' disabled';
					amex = '---';
				}
				
				if(name == 'Payment Identification Information'){
					name = 'All Payments';
				}		
				
				return '<tr><td><div class="td-ff"><span>'+ name +'</span><div class="strike"></div></div></td><td class="amex'+ amexDis +'"><div class="td-ff"><div class="logo">American Express</div>'+ amex +'%</div></td><td class="mastercard'+ mcDis +'"><div class="td-ff"><div class="logo">Master Card</div>'+ master +'%</div></td><td class="visa'+ visaDis +'"><div class="td-ff"><div class="logo">Visa</div>'+ visa +'%</div></td></tr>';
			}
		}
	})(window, document, $);
	
//############################################################################################
// ########################### Start Document Listener #######################################
//############################################################################################

	//setTimeout(function() {
	$(document).ready(function(){
		$('a[href="sign-in"], a[href="/sign-in"]').live('click', function(e){
			pqLoginReg.load('login');
			
			e.preventDefault();
		});
		
		$('a[href="register"], a[href="/register"]').live('click', function(e){
			pqLoginReg.load('register');
			
			e.preventDefault();
		});
		
		if(Modernizr.touch){
		//	FastClick.attach(document.body);
		}
	
		if(!window.plastiqCH){
			window.plastiqCH = (function(){
				$(window).resize(function(){
					plastiqCH.width = $(window).width();
				});
			
				function loadPrintReceipt(payment){
					var print = $('<div id="print">'),
						html = '',
						dateArray = payment.datetime.split(' ');
					
					$('body').addClass('print-receipt-view');
					
					html += '<div id="print-logo"><img src="/styles/images/svg/dark-logo.svg" /></div><h3>Payment Info</h3><div class="print-row clearfix"><div class="print-label">Payment ID:</div><div class="print-value">'+ payment.id +'</div></div><div class="print-row clearfix"><div class="print-label">Processed:</div><div class="print-value">'+ $.getFormattedDate(dateArray[0], 'extended') +' '+ $.getFormattedTime(dateArray[1]) +'</div></div><div class="print-row clearfix"><div class="print-label">Medium:</div><div class="print-value">'+ getFundingType(payment.funding_type) +'</div></div><br /><div class="print-row clearfix"><div class="print-label">Payment To:</div><div class="print-value"><span class="impt">'+ payment.merchant.name +'</span><br />'+ payment.merchant.address +'<br />'+ payment.merchant.city +', '+ payment.merchant.state +' '+ payment.merchant.zip +'</div></div><div class="print-row clearfix"><div class="print-label">Phone:</div><div class="print-value">'+ payment.merchant.phone +'</div></div><div class="print-row clearfix"><div class="print-label">Website:</div><div class="print-value">'+ payment.merchant.url +'</div></div><br />'+ (payment.form_name ? ('<div class="print-row clearfix form-row"><div class="print-label">Payment For:</div><div class="print-value"><div class="impt">'+ payment.form_name +'</div>') : '') + (payment.answers ? (payment.answers.questions ? getReceiptQuestions(payment.answers) : '') : '') + (payment.form_name ? ('</div></div>') : '')+'<div class="print-row clearfix"><div class="print-label">- - -</div></div><div class="print-row clearfix"><div class="print-label">Amount:</div><div class="print-value"><span class="impt larger">$'+ payment.a_principal.formatMoney(2) +'</span></div></div><div class="print-row clearfix"><div class="print-label">Plastiq Fee:</div><div class="print-value"><span class="impt larger">$'+ payment.a_fee.formatMoney(2) +'</span> <span class="larger">('+ (payment.adjusted_rates ? payment.adjusted_rates : getRate(payment.a_fee, payment.a_principal)) +'%)</span></div></div><div class="print-row clearfix" id="print-total"><div class="print-label"><span class="impt">TOTAL:</span></div><div class="print-value"><span class="impt larger">$'+ payment.a_total.formatMoney(2) +'</span></div></div><h3>Card Info</h3><div class="print-row clearfix"><div class="print-label">Card:</div><div class="print-value"><span class="impt">'+ (payment.card_brand ? payment.card_brand : payment.card_brand_name) +' ending '+ payment.short_pan +'</span></div></div><div class="print-row clearfix"><div class="print-label">Name on Card:</div><div class="print-value"><span class="impt">'+ (payment.cardholder_name ? payment.cardholder_name : '') +'</span></div></div><div class="print-row clearfix"><br /><div class="print-label">- - -</div></div><br /><br /><p>Thank you for using Plastiq. Feel free to contact us any time of the day with inquiries about this payment.</p><br /><br /><div class="print-row clearfix"><div class="print-label">Address:</div><div class="print-value"><span class="impt">Plastiq Inc.</span><br />181 Newbury St., 6<sup>th</sup> Floor<br />Boston, MA 02116<br />USA<br /><br /></div></div><div class="print-row clearfix"><div class="print-label">Phone:</div><div class="print-value"><span class="impt"><a href="tel:18447527847">1-844-PLASTIQ</a></span></div></div><div class="print-row clearfix"><div class="print-label">Website:</div><div class="print-value">www.plastiq.com</div></div>';
					
					print.html(html).appendTo('body');
					window.print();
					
					setTimeout(function(){
						print.remove();
						$('body').removeClass('print-receipt-view');
					}, 50);
				}
				
				function getReceiptQuestions(form){
					var html = '';
							
					$.each(form.questions, function(key, question){
						var answers = '';
						
						if(typeof question.answer == 'object'){
							$.each(question.answer, function(key, answer){
								answers += (key == 0 ? '' : ', ') + answer;
							});
						}else{
							answers = question.answer;
						}
						
						html += Utility.entities(question.label) +'<div class="emph">'+ Utility.entities(answers) +'</div>';
					});
								
					return html;
				}
				
				return {
					width: $(window).width(),
					printReceipt: function(paymentID){
						var data = {
							payment_id: paymentID || 0
						};
						
						
						if($('#payment-detail-json').length){
							loadPrintReceipt(paymentJSON);
						}else{
							$.ajax({
								type: 'POST',
								dataType: 'json',
								url: '/scripts/fetch-payment-details.php',
								data: data,
								complete: function(data, status){
									data = $.parseJSON(data.responseText);							
																		
									if(status == 'success'){
										data.payment.id = paymentID;
										loadPrintReceipt(data.payment);
									}else{
										CHMessage.add('Error printing your receipt, please try again.', 'error');
									}
								}
							});
						}
					}
				}	
			})()
		}
	
		$('#rewards-btn').click(function(e){
			$('#rewards-modal-cont').fadeIn(500);
			
			e.preventDefault();
		});
		
		if($('body > .triangle-bg-cont').length){
			$('.first-bg-triangle').css({
				'left': 0,
				'borderWidth': '0 4000px 4000px 0'
			});
			
			$('.second-bg-triangle').css({
				'left': $(window).width() / 2,
				'borderWidth': '0 4000px 4000px 0'
			});
		}
	
		$('.listing .element:first').addClass('first');
		
		$('#rewards-banner, #rewards-block-ad').click(function(){
			$('#rewards-modal-cont').fadeIn(500);
		});
		$('#rewards-close-btn').click(function(){
			$('#rewards-modal-cont').fadeOut(500);
		});
		
		function accordionLoader(holder){
			var accEntry = holder.find('.entry');
			holder.find('a.trigger').on('click', function(){
				$(this).toggleClass('state2');
				if (accEntry.hasClass('visible')) {
					accEntry.slideUp();
					accEntry.removeClass('visible');
				} else {
					accEntry.slideDown();
					accEntry.addClass('visible');
				}
				return false;
			})
		}

		function msgArrow(){
//			var wrap = $('.share'),
//				activeTab = wrap.find('a.active'),
//				arrow = wrap.find('.arrow'),
//				arrowWidth = 15; 
//				if (wrap.length) {
//					var newPos = activeTab.position().left + activeTab.width()/2 - arrowWidth/2;
//					arrow.css('left', newPos)
//				}
		}

		// FB/TWITTER
		$(document).on('click', '.share .tabs a', function(){
			$(this).addClass('active').siblings().removeClass('active');
			msgArrow();

			if( $(this).hasClass('tw') ) {
				$('.share .btns input').hide();
				$('.share .btns input.tw-post-button').show();
			}

			if( $(this).hasClass('fb') ) {
				$('.share .btns input').hide();
				$('.share .btns input.fb-post-button').show();
			}

			return false;
		});

		msgArrow();
		if( $('.share .row .tabs .active').hasClass('tw') ) {
			$('.share .btns input').hide();
			$('.share .btns input.tw-post-button').show();
		}
		if( $('.share .row .tabs .active').hasClass('fb') ) {
			$('.share .btns input').hide();
			$('.share .btns input.fb-post-button').show();
		}
		
		// post to facebook / twitter
		$('input.tw-post-button').live('click', function(){
			var twitter_url = 'https://twitter.com/intent/tweet?text=';
			var text = encodeURIComponent( $('textarea#message-field').val() + ' ' + window.location.href);
			window.open (twitter_url + text,"win","menubar=1,resizable=1,width=480,height=335");
			return false;
		});

		$('input.fb-post-button').live('click', function(){
			var page_title = encodeURIComponent( $('title').html() );
			var summary = encodeURIComponent( $('textarea#message-field').val() );
			var url = encodeURIComponent( window.location.href.toString() );
			var fb_url = 'http://www.facebook.com/sharer.php?s=100&p[title]='+page_title+'&p[summary]='+summary+'&p[url]=' + url;
			window.open (fb_url,"win","menubar=1,resizable=1,width=660,height=350");
			return false;
		});

		accordionLoader($('.merchant-info'));
		msgArrow();
		
		$(document).on('focus', 'input', function(){
			var parentELement = $(this).parent().parent();
			
			$('label[for="'+this.id+'"]').addClass('focused');
			
			if(parentELement[0].nodeName == 'FIELDSET'){
				$(parentELement).addClass('focused');
			}
		}).on('blur', 'input', function(){
			$('label[for="'+this.id+'"]').removeClass('focused');
			$('fieldset.focused').removeClass('focused');
		});
		
		$('.info-popup-link').colorbox({
			fixed: true,
			opacity: 0.4,
			onOpen: function() { $("body").css("overflow", "hidden"); },
			onComplete: function() {
				// initialize scrollpane
				//$('.info-page .scroll-pane').jScrollPane();
			}, 
			onCleanup: function() { $("body").css("overflow", "auto"); }
		});

		$(document).on('mouseenter', '.listing .element' , function(){
			$(this).stop(true,false).animate({'padding-left': 24}, 200, "linear").find('.arrow').stop(true,false).fadeIn(200);
		});
		
		$(document).on('mouseleave', '.listing .element' , function(){
			$(this).animate({'padding-left': 0}, 200, "linear").find('.arrow').fadeOut(200);
		});

		$('.dashboard .actions a').hover(function(){
			if($('span.tooltip').length){
				$('span.tooltip').hide().remove();
			}
			var tip = $(this).text();
			var targetX = $(this).offset().left;
			var targetY = $(this).offset().top - 32;
			var tipHolder = $('<span class="tooltip">'+tip+'<span class="arrow"></span></span>');

			tipHolder.appendTo('body');

			var tipWidth = parseInt(tipHolder.width());
			var tipLeft = parseInt(tipWidth / 2);
			tipHolder.css({
				'top' : targetY,
				'left' : targetX,
				'margin-left' : - (tipLeft -2),
				'opacity' : 0
			}).animate({opacity: 1}, 50);

		}, function(){
			$('span.tooltip').fadeOut(function(){
				$(this).remove();
			});
		});
		
		$('#navigation ul li.has-dd .trigger').hover(function() {
			$(this).addClass('active');
			$(this).next().slideDown('fast');
		});
		
		$('#navigation ul li.has-dd').hover(function() {}, function() {
			$(this).children('.trigger').removeClass('active');
			$(this).children('ul').slideUp('fast');
		});
	});

//############################################################################################
// ########################### Account Controls Start ########################################
//############################################################################################
	
	var pqValidator = {
		errors: {},
		addError: function(element, message){
			var elementOffset = $(element).offset();
			var elementID = $(element).attr('id');
		
			if($(element).is('input:text') || $(element).is('input:password')){
				var tooltipTop, tooltipLeft, elementLeft, tooltipWidth = 0;
				var elementWidth = $(element).outerWidth() - 40;
				var elementHeight = $(element).outerHeight() - ($(element).css("border-bottom-width").replace('px', '')*1) - ($(element).css("border-top-width").replace('px', '')*1) - 2;
				
				if($(element).hasClass('error-left')){
					$(element).addClass('error-marg');
					elementLeft = elementOffset.left + 2;
				}else {
					elementLeft = elementOffset.left + elementWidth;
				}
				
				if($(window).width() < 540){
					var errorLeft = elementLeft + 2;
					var errorHeight = elementHeight + 2;
				}else {
					var errorLeft = elementLeft + 1;
					var errorHeight = elementHeight + 1;
				}
				
				var errorElement = $('<div>')
					.attr('id', 'error-'+elementID)
					.css({
						top: elementOffset.top + 1,
						left: errorLeft,
						height: errorHeight
					}).addClass('pq-error').addClass('showing');
				
				if($(element).hasClass('error-left')){
					$(errorElement).css('left', elementLeft-1)
					$(errorElement).addClass('error-left');
				}
				
				if($('#error-'+elementID).length < 1){	
					$('body').prepend(errorElement);
					pqValidator.errors['error-'+elementID] = errorElement;
				}
				
				$(element).addClass('error').keyup(function(){
					if($(this).val().length > 0){
						$(this).removeClass('error');
					}
				}).siblings('label').addClass('error');
				
				if(message.length > 0){
					$(errorElement).html('<div class="error-tooltip">'+ message +'<div class="tip"></div></div>');
					
					tooltipWidth = $(errorElement).find('.error-tooltip').textWidth(message);
					
					if(tooltipWidth > 150){
						tooltipWidth = 150;
					}
					
					$(errorElement).find('.error-tooltip').width(tooltipWidth);
					
					tooltipTop = ($(errorElement).find('.error-tooltip').outerHeight() + 12)*-1;
					
					tooltipLeft = (tooltipWidth+30)*-1 / 2;

					$(errorElement).find('.error-tooltip').css({
						marginLeft: tooltipLeft + 'px',
						top: tooltipTop + 'px'
					}).animate({ opacity: 1 }, 500);
					
					$('#error-'+elementID).hover(function(){
						if($(window).width() >= 540){
							$(errorElement).find('.error-tooltip').fadeIn();
						}
					}, function(){
						if($(window).width() >= 540){
							$(errorElement).find('.error-tooltip').fadeOut();
						}
					});
					
					$('#error-'+elementID).unbind('click').click(function(){
						if($(this).hasClass('showing')){
							$(this).removeClass('showing');
						}else {
							$(this).addClass('showing');
						}
					});
					
					$('html, body').animate({
						scrollTop: $(element).offset().top - 90
					}, 500, function(){
						$(element).focus();
					});
					
					setTimeout(function(){
						if($(window).width() >= 540){
							$(errorElement).find('.error-tooltip').fadeOut();
						}else {
							$(errorElement).removeClass('showing');
						}
					}, 3000)
				}	
			}else {
				var errorElement = $('<div>').attr('id', 'error-'+elementID).addClass('pq-error-select');
				
				if($('#error-'+elementID).length < 1){	
					if($(element).siblings('label').length < 1){
						$(element).closest('.field-holder').find('label').addClass('error').prepend(errorElement);
					}else {
						$(element).siblings('label').addClass('error').prepend(errorElement);
					}
					pqValidator.errors['error-'+elementID] = errorElement;
				}
				
				if(message.length > 0){
					$(errorElement).html('<div class="error-tooltip">'+ message +'<div class="tip"></div></div>');
					
					tooltipWidth = $(errorElement).find('.error-tooltip').textWidth(message);
					
					if(tooltipWidth > 150){
						tooltipWidth = 150;
					}
					
					$(errorElement).find('.error-tooltip').width(tooltipWidth);
					
					tooltipTop = ($(errorElement).find('.error-tooltip').outerHeight() + 12)*-1;
					
					tooltipLeft = (tooltipWidth+30)*-1 / 2;

					$(errorElement).find('.error-tooltip').css({
						marginLeft: tooltipLeft + 'px',
						top: tooltipTop + 'px'
					}).animate({ opacity: 1 }, 500);
					
					$('#error-'+elementID).hover(function(){
						$(errorElement).find('.error-tooltip').fadeIn();
					}, function(){
						$(errorElement).find('.error-tooltip').fadeOut();
					});
					
					setTimeout(function(){
						$(errorElement).find('.error-tooltip').fadeOut();
					}, 3000)
				}				
			}	
		},
		removeError: function(element){
			var elementID = $(element).attr('id');
			
			$(element).removeClass('error').removeClass('error-marg');
			
			if($(element).siblings('label').length < 1){
				$(element).closest('.field-holder').find('label').removeClass('error');
			}else {
				$(element).siblings('label').removeClass('error');
			}

			$('#error-'+elementID).remove();
			
			delete(pqValidator.errors['error-'+elementID]);
		},
		hide: function(element, showOthers, time){
			$.each(pqValidator.errors, function(id, error){

				if($(element).find('#' + id.replace('error-', '')).length < 1){
					$('#' + id).fadeOut(100);
				}
			});
			
			setTimeout(function(){
				$.each(pqValidator.errors, function(id, error){
					if($(element).find('#' + id.replace('error-', '')).length > 0){
						$('#' + id).fadeIn();
					}
				});
			}, time);
		}
	}
	
	//Plastiq Scrolling
	var pqScrolling = {
			scrollCallback: function(){},
			init: function(){
				var allScrolls = $('.pq-scroller');
				$.each(allScrolls, function(key, element){
					if(!$(element).hasClass('scrollActive')){
						pqScrolling.addScroll(element);
					}else{
						pqScrolling.update(element);
					}
				});
			},
			addScroll: function(element){
			//set up scroll bar
				//pqScrolling.scrollCont = $('.pq-scroller');
				var scrollWidth = $(element).outerWidth(),
					scrollPadRight = $(element).css('padding-right'),
					scrollHeight = $(element).outerHeight(),
					scrollPos = $(element).css('position'),
					scrollPadRight = $(element).css('padding-right'),
					scrollMargin = $(element).css('margin'),
					scrollMarginLeft = $(element).css('margin-left'),
					scrollMarginRight = $(element).css('margin-right'),
					scrollBorder = $(element).css('border'),
					scrollMaxHeight = $(element).css('max-height'),
					//scrollPage = $(element).children(0),
					scrollFloat = $(element).css('float'),
					scrollShadow = $(element).data('scroll-shadow'),
					scrollHider = null,
					scrollGroup = null,
					scrollBar = null;				
				
				if(scrollMaxHeight != 'none'){
					var elementHeight = $(element).outerHeight();
					var addPad = parseInt($(element).css('padding-top')) + parseInt($(element).css('padding-bottom'));
					
					if(parseInt(elementHeight) < parseInt(scrollMaxHeight)){
						return;
					}					
					
					scrollHeight = parseInt(scrollMaxHeight) + addPad;
				}
				
				$(element).css({
					paddingRight: parseInt(scrollPadRight) + 30,
					margin: 0,
					border: 'none',
					maxHeight: 'none'
				}).addClass('scrollActive');
				
				$(element).wrap('<div class="pq-scroller-hider">');
				scrollHider = $(element).closest('.pq-scroller-hider');
				
				$(scrollHider).wrap('<div class="pq-scroller-cont">');
				scrollGroup = $(scrollHider).closest('.pq-scroller-cont');
				$(scrollGroup).css({
					height: scrollHeight,
					width: scrollWidth,
					margin: scrollMargin,
					float: scrollFloat,
					border: scrollBorder
				});
				
				if(scrollPos == 'absolute' || scrollPos == 'fixed'){
					var scrollTop = $(element).css('top'),
						scrollright = $(element).css('right'),
						scrollBtm = $(element).css('bottom'),
						scrollLeft = $(element).css('left');
						
					$(scrollGroup).css({
						position: scrollPos,
						top: scrollTop,
						right: scrollright,
						bottom: scrollBtm,
						left: scrollLeft
					});
					
					$(element).css({
						top: 0,
						right: 0,
						bottom: 0,
						left: 0
					})
				}
				
				if(scrollShadow == true){
					var leftPos = parseInt(scrollMarginLeft) * -1,
						rightPos = parseInt(scrollMarginRight) * -1,
						shadows = $('<div class="pq-scroller-top-shadow"></div><div class="pq-scroller-btm-shadow"></div>').css({
							left: leftPos,
							right: rightPos
						});
					
					$(scrollGroup).prepend(shadows);
				}
				
				scrollBar = $('<div class="pq-scroller-bar">');
				$(scrollGroup).prepend(scrollBar);
				
				//$(pqScrolling.scrollGroup).height($(pqScrolling.scrollGroup).parent().height());
			
			//initiate scroll bar for drag	
				$(scrollBar).draggable({
					axis: 'y',
					containment: 'parent',
					drag: function(event, ui){
						var posY = ui.position.top;
						
						pqScrolling.scrollPageTo(element, posY);
					}
				});
				
				pqScrolling.update(element);
			
			//init scroll body scroll listener	
				$(element).scroll(function(){
					pqScrolling.checkScroll(element);
				});
			
			},
			update: function(element){
				pqScrolling.setBarHeight(element);
				pqScrolling.checkScroll(element);
			},
			scrollPageTo: function(element, posY){
				var scrollContHeight = $(element).height(),
					pageHeight = pqScrolling.getPageHeight(element),
					maxScrollTop = $(element).prop('scrollHeight') - scrollContHeight,
					scrollTop = (posY / ((scrollContHeight * (1 - (scrollContHeight / pageHeight))) - 4)) * maxScrollTop;
								
				$(element).animate({
					scrollTop: scrollTop
				}, 0);
			},
			checkScroll: function(element){
				var pageHeight = pqScrolling.getPageHeight(element),
					scrollContHeight = $(element).outerHeight(),
					maxScrollPos = (scrollContHeight * (1 - (scrollContHeight / pageHeight))) - 4,
					maxScrollTop = $(element).prop('scrollHeight') - scrollContHeight,
					scrollTop = $(element).scrollTop(),
					scrollPer = scrollTop / maxScrollTop,
					scrollPos = scrollPer * maxScrollPos,
					scrollObject = $(element).data('scroll-object'),
					callBack = $(element).data('scroll-callback'),
					scrollCont = $(element).closest('.pq-scroller-cont'),
					scrollBar = $(scrollCont).find('> .pq-scroller-bar'),
					scrollShadowTop = $(scrollCont).find('> .pq-scroller-top-shadow'),
					scrollShadowBtm = $(scrollCont).find('> .pq-scroller-btm-shadow');
				
				if(scrollObject){
					window[scrollObject][callBack]();
				}
				
				if((pageHeight) > scrollContHeight){
					$(scrollBar).fadeIn();
					
					if(scrollTop == 0){
						$(scrollShadowBtm).fadeIn(100);
						$(scrollShadowTop).fadeOut(100);
					}else if(scrollTop == maxScrollTop){
						$(scrollShadowTop).fadeIn(100);
						$(scrollShadowBtm).fadeOut(100);
					}else{
						$(scrollShadowBtm).fadeIn(100);
						$(scrollShadowTop).fadeIn(100);
					}
				}else {
					$(scrollBar).fadeOut();
					$(scrollShadowBtm).fadeOut(100);
					$(scrollShadowTop).fadeOut(100);
				}
				
				$(element).closest('.pq-scroller-hider').siblings('.pq-scroller-bar').css('top', scrollPos);
			},
			setBarHeight: function(element){
				var pageHeight = pqScrolling.getPageHeight(element);
				var scrollContHeight = $(element).outerHeight();
				var barRatio = scrollContHeight/pageHeight;
				var barHeight = scrollContHeight * barRatio;
				
				$(element).closest('.pq-scroller-hider').siblings('.pq-scroller-bar').height(barHeight);
			},
			getPageHeight: function(element){
				var children = $(element).children();
				var elementPad = parseInt($(element).css('padding-top')) + parseInt($(element).css('padding-bottom'));
				
				if(children.length > 1){
					var childrenHeight = 0;
					
					$.each(children, function(key, child){
						childrenHeight += $(child).outerHeight();
					});
					
					return parseInt(childrenHeight) + elementPad;
				}else{
					return parseInt($(children[0]).outerHeight()) + elementPad;
				}
			}
		}
	
	$(window).load(function(){
		//adjustTriangleBg();
	});
	
	$(document).ready(function() {
	
		if($().placeholder){
			$('input').placeholder();
		}
		
	});
	
	function getValidation(validation){
		var validationBlock = '';
		
		$.each(validation, function(key, valType){
			if(valType.validation_type == 'email'){
				validationBlock += ' data-validate-email="true"';
			}
			
			if(valType.validation_type == 'url'){
				validationBlock += ' data-validate-url="true"';
			}
			
			if(valType.validation_type == 'phone'){
				validationBlock += ' data-validate-phone="true"';
			}
			
			if(valType.validation_type == 'zipcode'){
				validationBlock += ' data-validate-zipcode="true"';
			}
			
			if(valType.validation_type == 'regex'){
				if(valType.validation_value.charAt(0) == '/'){
					valType.validation_value = valType.validation_value.substr(1, valType.validation_value.length - 2);
				}
			
				validationBlock += ' data-validate-regex="true"';
				validationBlock += ' data-validate-regex-hint="'+ valType.validation_hint +'"';
				validationBlock += ' data-validate-regex-value="'+ valType.validation_value +'"';
			}
			
			if(valType.validation_type == 'numeric'){
				validationBlock += ' data-validate-numeric="true"';
			}
			
			if(valType.validation_type == 'alpha'){
				validationBlock += ' data-validate-alpha="true"';
			}
			
			if(valType.validation_type == 'alpha-numeric'){
				validationBlock += ' data-validate-alpha-numeric="true"';
			}
			
			if(valType.validation_type == 'min-length'){
				validationBlock += ' data-validate-min-length="true"';
				validationBlock += ' data-validate-min-length-value="'+ valType.validation_value +'"';
			}
			
			if(valType.validation_type == 'max-length'){
				validationBlock += ' data-validate-max-length="true"';
				validationBlock += ' data-validate-max-length-value="'+ valType.validation_value +'"';
			}
			
			if(valType.validation_type == 'less-than'){
				validationBlock += ' data-validate-less-than="true"';
				validationBlock += ' data-validate-less-than-value="'+ valType.validation_value +'"';
			}
			
			if(valType.validation_type == 'greater-than'){
				validationBlock += ' data-validate-greater-than="true"';
				validationBlock += ' data-validate-greater-than-value="'+ valType.validation_value +'"';
			}
			
			if(valType.validation_type == 'sin'){
				validationBlock += ' data-validate-sin="true"';
			}
			
			if(valType.validation_type == 'orcc'){
				validationBlock += ' data-validate-orcc="true"';
			}
		});
				
		return validationBlock;
	}
	
	function loadAnswers(answers){
		if(answers){
			$.each(answers.questions, function(key, question){
				if(question.type == "password" || question.type == "text" || question.type == "hidden" || question.type == "paragraph"){
					$('#'+ key).val(question.answer);
				}else if(question.type == "radio"){					
					$('.pq-radio [name="answer['+ key +']"]').attr('checked', false);

					$('.pq-radio [name="answer['+ key +']"][value="'+ question.answer +'"]').attr('checked', true).closest('.pq-radio').addClass('active');
				}else if(question.type == "checkbox"){		
					$('.pq-radio [name="answer['+ key +'][]"]').attr('checked', false).closest('.pq-radio').removeClass('active');
					
					$.each(question.answer, function(key2, answer){
						$('.pq-radio [name="answer['+ key +'][]"][value="'+ answer +'"]').attr('checked', true).closest('.pq-radio').addClass('active');
					});
				}else if(question.type == "dropdown"){
					$('#'+ key).find('option').attr('selected', false);
					$('#'+ key).find('option[value="'+ question.answer +'"]').attr('selected', true).change();
				}
			});
		}
		
		prevAnswers = undefined;
	}
	
	function getValidationFormat(format){
		var validationBlock = $('<div id="validation-format">'),
			html = '<p>Account format is incorrect. Try and match the format below...</p><div id="format"><span id="format-title">Account Format:</span>',
			totalSteps = Object.size(format);
		
		$.each(format, function(key, step){
			counter = step.count * 1;
			
			html += '<div class="step" data-tip-title="'+ counter +' '+ step.type +' character'+ (counter > 1 ? 's' : '') +'">'+ ((key != (totalSteps - 1)) ? '<div class="plus-format">+</div>' : '');
			
			while(counter){
				if(step.type == 'alpha'){
					html += 'A';
				}else if(step.type == 'numeric'){
					html += '#';
				}else if(step.type == 'alphanumeric'){
					html += '<span class="icon">&#xe073;</span>';
				}else{
					html += step.type.toUpperCase();
				}
				
				counter--;
			}
			
			html += '</div>';
		});
		
		html += '</div>'
		
		validationBlock.html(html);
						
		return validationBlock;
	}
	
	function add_question(questionData) {
		var question = '',
			validation = undefined;
		
		if(questionData.validation){
			validation = questionData.validation
		}
		
		switch (questionData.type) {
			case 'text':
				question = '<div class="row question'+ (questionData.required == 1 ? ' required' : '') +'"'+ (validation ? getValidation(validation) : '') +'>';
				question += '<label for="'+ questionData.handle +'">'+ questionData.label + (questionData.required == 1 ? '*' : '') +' <span class="hint">'+ (questionData.hint ? questionData.hint : '') +'</span></label>';
				question += '<input autocomplete="off" '+ (questionData.readonly == 1 ? 'readonly="readonly"' : '') +' class="field" type="text" name="answer['+ questionData.handle +']" id="'+ questionData.handle +'" value="'+ questionData.default_value +'" placeholder="'+ questionData.placeholder +'">';
				question += '<span class="validate"></span></div>';
				
				break;
			case 'paragraph':
				question = '<div class="row question'+ (questionData.required == 1 ? ' required' : '') +'"'+ (validation ? getValidation(validation) : '') +'>';
				question += '<label for="'+ questionData.handle +'">'+ questionData.label + (questionData.required == 1 ? '*' : '') +' <span class="hint">'+ (questionData.hint ? questionData.hint : '') +'</span></label>';
				question += '<textarea autocomplete="off" '+ (questionData.readonly == 1 ? 'readonly="readonly"' : '') +' class="field" name="answer['+ questionData.handle +']" id="'+ questionData.handle +'">'+ questionData.default_value +'</textarea>';
				question += '<span class="validate"></span></div>';
				
				break;
			case 'radio':
				question = '<div class="row question'+ (questionData.required == 1 ? ' required' : '') +'"'+ (validation ? getValidation(validation) : '') +'>';
				question += '<label for="'+ questionData.handle +'">'+ questionData.label + (questionData.required == 1 ? '*' : '') +' <span class="hint">'+ (questionData.hint ? questionData.hint : '') +'</span></label>';
				
				$.each(questionData.choices, function(key, choice){
					question += '<input type="radio" name="answer['+ questionData.handle +']" id="'+ questionData.handle + key +'" value="'+ choice.label +'"'+ (choice.default_value == '1' ? ' checked="checked"' : '') +' /> <label for="'+ questionData.handle + key +'">'+ choice.label +'</label>';
				});
				question += '<span class="validate"></span></div>';
				
				break;
			case 'checkbox':
				console.log(questionData);
			
				question = '<div class="row question'+ (questionData.required == 1 ? ' required' : '') +'"'+ (validation ? getValidation(validation) : '') +'>';
				question += '<label for="'+ questionData.handle +'">'+ questionData.label + (questionData.required == 1 ? '*' : '') +' <span class="hint">'+ (questionData.hint ? questionData.hint : '') +'</span></label>';
				
				$.each(questionData.choices, function(key, choice){
					question += '<input type="checkbox" name="answer['+ questionData.handle +'][]" id="'+ questionData.handle + key +'" value="'+ choice.label +'"' + (choice.default_value == '1' ? ' checked="checked"' : '') + ' /> <label for="'+ questionData.handle + key +'">'+ choice.label +'</label>';
				});
				question += '<span class="validate"></span></div>';
				
				break;
			case 'password':
				question = '<div class="row question'+ (questionData.required == 1 ? ' required' : '') +'"'+ (validation ? getValidation(validation) : '') +'>';
				question += '<label for="'+ questionData.handle +'">'+ questionData.label + (questionData.required == 1 ? '*' : '') +' <span class="hint">'+ (questionData.hint ? questionData.hint : '') +'</span></label>';
				question += '<input autocomplete="off" '+ (questionData.readonly == 1 ? 'readonly="readonly"' : '') +' class="field" type="password" name="answer['+ questionData.handle +']" id="'+ questionData.handle +'" value="'+ questionData.default_value +'" placeholder="'+ questionData.placeholder +'">';
				question += '<span class="validate"></span></div>';
				
				break;
			case 'hidden':
				question += '<input autocomplete="off" '+ (questionData.readonly == 1 ? 'readonly="readonly"' : '') +' class="field" type="hidden" name="answer['+ questionData.handle +']" id="'+ questionData.handle +'" value="'+ questionData.default_value +'">';
				
				break;
				
			case 'dropdown':
				question = '<div class="row question'+ (questionData.required == 1 ? ' required' : '') +'"'+ (validation ? getValidation(validation) : '') +'>';
				question += '<label for="'+ questionData.handle +'">'+ questionData.label + (questionData.required == 1 ? '*' : '') +' <span class="hint">'+ (questionData.hint ? questionData.hint : '') +'</span></label>';
				
				question += '<div class="pq-dropdown"><select name="answer['+ questionData.handle +']" id="'+ questionData.handle +'">';
				$.each(questionData.choices, function(key, choice){
						var choice_part = choice.label.split("||"),
							text = '';
						
						if(choice_part[1]){
							text = choice_part[0];
						}else{
							text = choice.label;
						}
					
						question += '<option value="'+ choice.label +'"' + (choice.default_value == '1' ? ' selected="selected"' : '') + '>'+ text +'</option>';
				});
				question += '</select></div><span class="validate"></span></div>';
				
				break;
			case 'address':
				question = '<div class="question row address-group'+ (questionData.City.required == 1 ? ' required' : '') +'"><label for="'+ questionData['Street 1'].handle +'">'+ questionData.City.group_label + (questionData.City.required == 1 ? '*' : '') +' <span class="hint">'+ questionData.City.group_hint +'</span></label>';
				question += '<div class="address-inputs"><div class="row inset-row"><label for="'+ questionData['Street 1'].handle +'">Street 1</label><input autocomplete="off" class="field" type="text" id="'+ questionData['Street 1'].handle +'" name="answer['+ questionData['Street 1'].handle +']" data-orig-field="street-1" value=""></div><div class="row inset-row"><label for="'+ questionData['Street 2'].handle +'">Street 2</label><input autocomplete="off" class="field" type="text" id="'+ questionData['Street 2'].handle +'" data-orig-field="street-2" name="answer['+ questionData['Street 2'].handle +']" value=""></div><div class="row inset-row"><label for="'+ questionData['City'].handle +'">City</label><input autocomplete="off" class="field" type="text" id="'+ questionData['City'].handle +'" data-orig-field="city" name="answer['+ questionData['City'].handle +']" value=""></div><div class="row clearfix inset-row"><span class="field-holder"><input class="field no-label" placeholder="State/Province" maxlength="2" data-orig-field="state" type="text" autocomplete="off" id="'+ questionData['State'].handle +'" name="answer['+ questionData['State'].handle +']" value=""></span><span class="field-holder"><input class="field no-label" type="text" data-orig-field="zip" placeholder="Zip/Postal" autocomplete="off" id="'+ questionData['Zip Code'].handle +'" name="answer['+ questionData['Zip Code'].handle +']" value=""></span><span class="field-holder last"><div class="pq-dropdown" style="width: 135px; height: 34px;"><select class="select-field pqdd-select" data-orig-field="country" id="'+ questionData['Country'].handle +'" name="answer['+ questionData['Country'].handle +']">'+ countries +'</select></div></span></div></div>';
				question += '<span class="validate"></span></div>';
				
				break;
			case 'full_name':
				question = '<div class="question row full-name-group'+ (questionData['First Name'].required == 1 ? ' required' : '') +'"><label for="'+ questionData['First Name'].handle +'">'+ questionData['First Name'].group_label + (questionData['First Name'].required == 1 ? '*' : '') +' <span class="hint">'+ questionData['First Name'].group_hint +'</span></label>';
				question += '<div class="input-group dbl-input clearfix"><input autocomplete="off" placeholder="First Name" class="field" type="text" id="'+ questionData['First Name'].handle +'" name="answer['+ questionData['First Name'].handle +']" value=""><input autocomplete="off" placeholder="Last Name" class="field" id="'+ questionData['Last Name'].handle +'" name="answer['+ questionData['Last Name'].handle +']" type="text" value=""></div>';
				question += '<span class="validate"></span></div>';
				
				break;
		}
		return question;
	}
	 
	 function adjustTriangleBg(){
	 	var secondOffset = 0;
	 	var pageHeight = 0;
	 	var secondBgHeight = 0;
	 	
	 	if($('#our-investors').length > 0){
	 		secondOffset = $('#our-investors').offset().top;
	 	}
	 	
	 	$('.triangle-bg-cont.second-bg').css('top', 0);
	 	
	 	pageHeight = $(document).height();
	 	secondBgHeight = pageHeight - secondOffset;
	 	
	 	if(secondBgHeight < 4000){
	 		if(pageHeight > 4000){
	 			pageHeight = 4000;
	 		}
	 		$('.triangle-bg-cont').height(pageHeight);
	 		$('.triangle-bg-cont.second-bg').height(secondBgHeight);
	 	}else {
	 		if(pageHeight > 4000){
	 			pageHeight = 4000;
	 		}
	 		$('.triangle-bg-cont').height(pageHeight);
	 		$('.triangle-bg-cont.second-bg').height(pageHeight);
	 	}
	 	
	 	$('.triangle-bg-cont.second-bg').css('top', secondOffset);
	 }
	 	
	 $(document).ready(function(){
	 	//start merchant modal
	 	merchantInfo = (function (window, document, undefined){
		 		
		 		
		 		return {
		 			test: function(){
		 				alert('this rules');
		 			}
		 		};
		 	})(window, document);
	 });
	
	jQuery.extend( jQuery.easing,
	{
		easeIn: function (x, t, b, c, d) {
			return jQuery.easing.easeInQuad(x, t, b, c, d);
		},
		easeOut: function (x, t, b, c, d) {
			return jQuery.easing.easeOutQuad(x, t, b, c, d);
		},
		easeInOut: function (x, t, b, c, d) {
			return jQuery.easing.easeInOutQuad(x, t, b, c, d);
		},
		expoin: function(x, t, b, c, d) {
			return jQuery.easing.easeInExpo(x, t, b, c, d);
		},
		expoout: function(x, t, b, c, d) {
			return jQuery.easing.easeOutExpo(x, t, b, c, d);
		},
		expoinout: function(x, t, b, c, d) {
			return jQuery.easing.easeInOutExpo(x, t, b, c, d);
		},
		bouncein: function(x, t, b, c, d) {
			return jQuery.easing.easeInBounce(x, t, b, c, d);
		},
		bounceout: function(x, t, b, c, d) {
			return jQuery.easing.easeOutBounce(x, t, b, c, d);
		},
		bounceinout: function(x, t, b, c, d) {
			return jQuery.easing.easeInOutBounce(x, t, b, c, d);
		},
		elasin: function(x, t, b, c, d) {
			return jQuery.easing.easeInElastic(x, t, b, c, d);
		},
		elasout: function(x, t, b, c, d) {
			return jQuery.easing.easeOutElastic(x, t, b, c, d);
		},
		elasinout: function(x, t, b, c, d) {
			return jQuery.easing.easeInOutElastic(x, t, b, c, d);
		},
		backin: function(x, t, b, c, d) {
			return jQuery.easing.easeInBack(x, t, b, c, d);
		},
		backout: function(x, t, b, c, d) {
			return jQuery.easing.easeOutBack(x, t, b, c, d);
		},
		backinout: function(x, t, b, c, d) {
			return jQuery.easing.easeInOutBack(x, t, b, c, d);
		}
	});
	
	if (!window.console ) console = { log: function(){} };
	
	window.mobilecheck = function() {
		var check = false;
		(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check = true})(navigator.userAgent||navigator.vendor||window.opera);
		return check; }
	
	function decodeHTML(normHTML){
		var html = '',
			div = $('#decodeHTML');
		
		if($(div).length < 1){
			$('body').prepend('<div id="decodeHTML">');
			div = $('#decodeHTML');
		}
		
		$(div).html(normHTML);
		return $(div).text();
	}
	
	$.fn.serializeObject = function()
	{
	    var o = {};
	    var a = this.serializeArray();
	    $.each(a, function() {
	        if (o[this.name] !== undefined) {
	            if (!o[this.name].push) {
	                o[this.name] = [o[this.name]];
	            }
	            o[this.name].push(this.value || '');
	        } else {
	            o[this.name] = this.value || '';
	        }
	    });
	    return o;
	};
	
	jQuery.extend({bez:function(b){var c="bez_"+jQuery.makeArray(arguments).join("_").replace(/\./g,"p");if("function"!==typeof jQuery.easing[c]){var m=function(b,c){var f=[null,null],e=[null,null],d=[null,null],k=function(g,a){d[a]=3*b[a];e[a]=3*(c[a]-b[a])-d[a];f[a]=1-d[a]-e[a];return g*(d[a]+g*(e[a]+g*f[a]))};return function(b){for(var a=b,c=0,h;14>++c;){h=k(a,0)-b;if(0.001>Math.abs(h))break;a-=h/(d[0]+a*(2*e[0]+3*f[0]*a))}return k(a,1)}};jQuery.easing[c]=function(c,l,f,e,d){return e*m([b[0],b[1]],
	[b[2],b[3]])(l/d)+f}}return c}});
</script>


<!-- page-specific javascript -->

<script type="text/javascript">
	function strpos (haystack, needle, offset) {
	    var i = (haystack + '').indexOf(needle, (offset || 0));
	    return i === -1 ? false : i;
	}
	
	// custom datatables sort functions
	jQuery.fn.dataTableExt.oSort['html-numeric-asc']  = function(a,b) {
		var x = parseFloat(a.replace( /<.*?>/g, "" ).toLowerCase());
		var y = parseFloat(b.replace( /<.*?>/g, "" ).toLowerCase());
		return ((x < y) ? -1 : ((x > y) ? 1 : 0));
	};

	jQuery.fn.dataTableExt.oSort['html-numeric-desc'] = function(a,b) {
		var x = parseFloat(a.replace( /<.*?>/g, "" ).toLowerCase());
		var y = parseFloat(b.replace( /<.*?>/g, "" ).toLowerCase());
		return ((x < y) ? 1 : ((x > y) ? -1 : 0));
	};
	
	// custom datatables sort functions
	jQuery.fn.dataTableExt.oSort['string-date-asc']  = function(a,b) {
		var hour = a.substring(strpos(a, ':')-2, strpos(a, ':'));
		var ampm = a.substring(a.length-2, a.length);
		if (ampm == 'PM' && hour != '12') hour = parseInt(hour)+12;
		a = a.substring(0, strpos(a, ':')-2)+hour+a.substring(strpos(a, ':'), a.length-2)+':00';
		var test = new Date(a);
		x = test.getTime();
		
		hour = b.substring(strpos(b, ':')-2, strpos(b, ':'));
		ampm = b.substring(b.length-2, b.length);
		if (ampm == 'PM' && hour != '12') hour = parseInt(hour)+12;
		b = b.substring(0, strpos(b, ':')-2)+hour+b.substring(strpos(b, ':'), b.length-2)+':00';
		test = new Date(b);
		y = test.getTime();
		return ((x < y) ? -1 : ((x > y) ? 1 : 0));
	};

	jQuery.fn.dataTableExt.oSort['string-date-desc'] = function(a,b) {
		var hour = a.substring(strpos(a, ':')-2, strpos(a, ':'));
		var ampm = a.substring(a.length-2, a.length);
		if (ampm == 'PM' && hour != '12') hour = parseInt(hour)+12;
		a = a.substring(0, strpos(a, ':')-2)+hour+a.substring(strpos(a, ':'), a.length-2)+':00';
		var test = new Date(a);
		x = test.getTime();
		
		hour = b.substring(strpos(b, ':')-2, strpos(b, ':'));
		ampm = b.substring(b.length-2, b.length);
		if (ampm == 'PM' && hour != '12') hour = parseInt(hour)+12;
		b = b.substring(0, strpos(b, ':')-2)+hour+b.substring(strpos(b, ':'), b.length-2)+':00';
		test = new Date(b);
		y = test.getTime();
		return ((x < y) ? 1 : ((x > y) ? -1 : 0));
	};
	
	// set code syntax highlighting
	$(document).ready(function() {
		$('pre code').each(function(i, e) {
			hljs.highlightBlock(e, '    ');
		});
	});
</script>
<script src="/includes/js/transit.js" type="text/javascript"></script>
<script src="/includes/js/fastclick.js" type="text/javascript"></script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30869371-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

$(document).ready(function(){
	$('#browser-fail #close-btn').click(function(){
		$('#browser-fail, .pq-modal-cover').fadeOut()
	});
});
</script>


<input type="hidden" name="enviorment" id="apenviorment" value="live">
<script src="includes/js/html5-shiv.js" type="text/javascript"></script>
<script src="/includes/js/all.js" type="text/javascript"></script>
<script type="text/javascript">
//	if($.browser.msie){
//		if(window.scriptReloaded != true){
//			window.scriptReloaded = true;
//			var scripts = $('body script').not('.no-rerun');
//			
//			$.each(scripts, function(key, script){
//				var newScript = $(script).html();
//				
//				if(newScript.length > 0){
//					console.log(newScript);
//					eval(newScript);
//				}	
//			});
//		}
//	}
</script>
<div id="login-reg-modal-cont"><div id="login-reg-modal">
	<div id="login-reg-scroller">
		<div id="login-reg-nav">
			<button type="button" id="switch-reg-login-btn">Already a Member? <span class="impt">Sign In</span></button>
			<button type="button" id="close-reg-login-btn" class="icon"></button>
		</div>
		
		<div id="login-reg-cont">
			<div id="login-reg-outline">
				<div id="lr-outline-top"></div>
				<div id="lr-outline-right"></div>
				<div id="lr-outline-bottom"></div>
				<div id="lr-outline-left"></div>
			</div>
			
			<div id="login-reg-perspective">
				<div id="login-reg-flipper">
					<div id="login-reg-side-1">
						<div class="login-reg-bg-holder">
							<div id="login-reg-side-1-bg"></div>
						</div>
						<div id="reg-details">
							<h2>Please Register</h2>
							<p>Registering to become a Plastiq member is free and provides you with access to payment scheduling tools, a detailed payment history, and real-time payment status updates.</p>
							
							<ul id="reg-values">
								<li class="reg-value" id="reg-val1">
									<h3>Convenience</h3>
									<p>Say goodbye to inconveniences like tracking down stamps and leaving paper trails, and say hello to the ease of making your payments all at once online.</p>
								</li>
								<li class="reg-value" id="reg-val2">
									<h3>Rewards</h3>
									<p>Rack up card rewards on payments you couldn’t use your card for until now. Earn rewards just for paying expenses you're already committed to.</p>
								</li>
								<li class="reg-value" id="reg-val3">
									<h3>Control</h3>
									<p>Enjoy the security, payment management tools, and protection that result from the combined offerings of your card, plus Plastiq.</p>
								</li>
							</ul>
							
							<div id="reg-values-nav">
								<button type="button" class="active"><span class="text">Registration value 1</span></button>
								<button type="button"><span class="text">Registration value 2</span></button>
								<button type="button"><span class="text">Registration value 3</span></button>
							</div>
						</div>
						
						<div id="login-cont">
							<div id="login-bg"></div>
							<div class="details">
								<h2>Sign In</h2>
								<p>Enter your email address &amp; password.</p>
							</div>
							
							<form method="post" id="login-form">
								<input type="text" name="email" id="email" placeholder="Email address" value="">
								<input type="password" name="password" id="password" autocomplete="off" placeholder="Password" value="">
								<div class="pq-hide">
									<input type="text" name="secureLoginToken" class="secureLoginToken" value="" tabindex="-1">
								</div>
								
								<div class="buttons-cont">
									<button type="submit" class="black-flat-btn" id="login-btn">Sign In</button>
									<button type="button" id="forgot-password">Forgot Password?</button>
								</div>
							</form>
						</div>
					</div>
					
					<div id="login-reg-side-2">
						<form method="post" id="reg-form">
							<div class="login-reg-bg-holder">
								<div id="login-reg-side-2-bg"></div>
							</div>
							
							<fieldset class="dbl-row clearfix">
								<input type="text" name="first-name" id="first-name" placeholder="First Name" value="">
								<input type="text" name="last-name" id="last-name" placeholder="Last Name" value="">
							</fieldset>
							
							<input type="text" name="reg-email" id="reg-email" placeholder="Email Address" value="">
							<input type="text" name="phone" id="phone" placeholder="Phone Number" value="">
							<button id="phone-info-btn" class="icon" type="button" tabindex="-1"></button>
							<input type="password" name="reg-password" autocomplete="off" id="reg-password" placeholder="Password (at least 8 characters, 1 number/symbol)" value="">
							<input type="password" name="reg-password2" autocomplete="off" id="reg-password2" placeholder="Password Again" value="">
							<div class="pq-hide">
								<input type="text" name="secureLoginToken" class="secureLoginToken" value="" tabindex="-1">
							</div>
							
							<div id="marketing-email-cont" class="custom-check">
								<div class="pq-hide">
									<input type="checkbox" name="marketing-email" id="marketing-email" value="">
								</div>
								<label for="marketing-email"><div class="mobile-hidden">Send me reward opportunities, news &amp; updates from Plastiq.</div><div class="mobile-text"></div></label>
							</div>
							
							<div class="buttons-cont">
								<button type="submit" id="register-btn" class="black-flat-btn">Register</button>
								<p class="sub-para">By registering you agree to Plastiq’s <a href="/privacy" target="_blank">Privacy Policy</a> &amp; <a href="/tos" target="_blank">Terms of Service</a>.</p>
								
								<button type="button" id="skip-reg-btn">Pay as guest &gt;</button>
							</div>
							
							<div id="reg-info-cont">
								<button type="button" id="close-reg-info-cont" class="icon"></button>
								
								<div id="reg-info">
									<h3>- Phone Number -</h3>
									<p>Plastiq requires a phone number to register for the sole purpose of providing great service. This information helps us get in touch with you in a timely fashion if we need to contact you regarding your payment.</p>
									
									<p>*Plastiq does not share this information and we will not use your phone number for marketing purposes.</p>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
			
			<div id="reg-working-cont">
				<div id="reg-working-info">
					<h3>Completing Registration</h3>
					<p id="reg-working-para">Once complete, you’ll be directed to your new Plastiq Member Dashboard.</p>
					<div class="loader"></div>
				</div>
			</div>
		</div>
		
		<div id="login-reg-footer">
			<a href="/" class="logo">Plastiq</a>
			<p id="login-footer-nav">
				<a href="/privacy" target="_blank">Privacy Policy</a><span class="mobile-hidden">&nbsp;&nbsp;\&nbsp;&nbsp;</span><a href="/tos" target="_blank" id="reg-login-tos">Terms &amp; Conditions</a><span class="mobile-hidden">&nbsp;&nbsp;\&nbsp;&nbsp;</span>© 2014 Plastiq, Inc. All Rights Reserved
			</p>
		</div>
	</div>
</div>
<script type="text/javascript">
	var secureLogin = (function(window, document, $, undefined){
		var loginSecurityToken = 'cj^)E5K6$PROw2WG.3415xH1fYOGNebQo(OS3dCVS(n$Y.zMRgr';
		
		function addFormListener(form, input){
			$(form).focus(function(){
				flipInput(input);
			});
			
			$(form).click(function(){
				flipInput(input);
			});
		}
		
		function flipInput(input){
			$(input).val(loginSecurityToken);
		}
		
		return {
			listenTo: function(form, input){
				addFormListener(form, input);
			}
		};
	})(window, document, $);
</script></div><input type="hidden" name="security_token" value="cj^)E5K6$PROw2WG.3415xH1fYOGNebQo(OS3dCVS(n$Y.zMRgr">

</body></html>