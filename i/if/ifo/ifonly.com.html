<!--The following is the downloaded HTML source of the ifonly.com privacy policy that was archived on 2016-10-24.
 Please check the original snapshot on the Wayback Machine (https://web.archive.org/web/20161024163153id_/https%3A//www.ifonly.com/website/privacy) for the most accurate reproduction.-->

<!DOCTYPE html><html lang="en-US"><head><script type="text/javascript" async="" src="https://s3.amazonaws.com/ki.js/62193/eb8.js"></script><script src="//www.googleadservices.com/pagead/conversion.js" type="text/javascript" async=""></script><script src="https://www.sc.pages03.net/lp/static/js/iMAWebCookie.js?2edcd082-1461604bde3-943e27de0c8b91cc3fcf1475c3e5d726&amp;h=www.pages03.net" type="text/javascript" async=""></script><script src="https://platform.twitter.com/oct.js" type="text/javascript" async=""></script><script async="" src="//www.google-analytics.com/analytics.js"></script><script async="" src="//connect.facebook.net/en_US/fbevents.js"></script><script id="facebook-jssdk" src="//connect.facebook.net/en_US/sdk.js"></script><script>
        var startTime = new Date().getTime();
    </script>
    
    <script type="text/javascript">
    var g_password_length      = '8';
    var g_controller_id        = 'website';
    var g_controller_action_id = 'privacy';
    var g_page                 = 'website.privacy';
    var g_is_mobile            = false;
    var g_siteUrlPrefix     = 'https://www.ifonly.com';
    var g_sessionAccessCode = '';
    var g_forVendorSignUp   = false;
    var g_is_pickonePromo   = false;
    var g_instantAccessCode = '';
    var g_vendorPortalLayout = '';
    var g_concierge = '';
    var g_is_amex   = '';       // used in checkout.js
    var g_is_guest  = true;
    var g_tempUser  = false;
    var g_redemption_code = '';
    var g_guest_productId = '';
    var g_guest_clicked_btn = "";
    var g_guest_parent_productId = '';  // used for adding guest sweepstakes entry product into cart
    var g_catId           = '0';
    var g_googleClientKey = '1003217091248-kdmpe9c3hpbnsg0okgqfoarg8rb8kkgd.apps.googleusercontent.com';
    var g_linkedInId      = '75az42qj3a92uq';
    var g_showCallOut = false;
    var g_popupId = '';
    var g_active_popup = '';
    var g_readyFor_cart = false;
    var g_productId = '';
    var g_bespoke = '';
    var g_vendorProfile = '';
    var g_vendorSignUp  = '';
    var g_cat_featured_products = false;
    var g_localRadiusMiles     = ''; // used in vendorPortal
    var g_regionalRadiusMiles  = ''; // used in vendorPortal
    var g_vendorLocation       = ''; // used in vendorPortal
    var g_inCoversationPage    = false; // used in vendorPortal
    var g_signup_timer = 2000;
    var g_login_timer  = 1000;
    var g_site_id   = 1;
    var g_sourceId  = 0;
    var g_user_lvl  = 1;  // should be number
    var g_userId    = '0';
    var g_vendorId  = '';
    var g_forceSignup          = true;
    var g_disableAutoPopups    = false;
    var g_stream_lined_sign_up = true;
    var g_loggedInManually     = false;
    var g_need_password = 0;
    var g_thisHost  = 'www';
    var g_showNewMobileCat = false;
    var g_isMobileApp = 0;
    var g_uaType = 1; // should be number
    var autoPopupTimer;

    var wishlistProducts = '';
    var g_filter_only_type = '';
    var g_is_responsive = false;
    var g_chrome_iOS = false;
    var g_thisDomain = 'www.ifonly.com';
    var g_enable_websocket = true;
    var g_dashboard_page = '';

    var g_show_how_it_works = true;
    var g_discovery_type = {
        desktopNav:"DESKTOP-NAV",
        desktopWidget:"DESKTOP-WIDGET",
        mobileWidget:"MOBILE-WIDGET"
    };
    var g_followingCelebIds = [];
    var g_infobox_modes = {
        edit: 'EDIT',
        exe:  'EXE',
        display: 'DISPLAY'
    };

    var g_is_local_host = false;
    var g_welcomeString = "";    // see /common/_loginAndRegistrationDialogs.php
    var g_accesscodeTitle = "";  // see /common/_loginAndRegistrationDialogs.php
    
    var g_isDesktop = true;
    var g_isTablet  = false;
    var g_link = window.location.pathname;
    var g_searchTerm = "";
    var g_agent_type = 1;
    var g_agent_type_options = {'ios':4};
    var g_homepage_catId = 67;
    var g_autoAddAvaEveryWhere = true; // used in filter
    var g_filter_from_date = "";
    var g_filter_to_date   = "";
    var g_filter_from_mobile_menu = false;
    var g_filter_get_products_ajax = "";
    var g_filter_get_products_ajax_data = {};
    var g_filter_stay_in_page = false;
    var g_manuallyScroll   = true;
    var g_list_type = {'category':'category', 'filter':'filter', 'productization':'productization'};
    var g_currentListType                   = undefined;  // can be (1) category, (2) filter (3) productization
    var g_category_products_and_collections = [];
    var g_cat_pro_col_index                 = 0;
    var g_no_lazysize_img_cnt               = 8;
    var g_block_pCnt = '20';
    var g_renderedTileIndex  = 0;   // used to store g_cat_pro_col_index value from localStorage
                                    // for back btn usage purpose
    var g_getVar = '{"q":"\/website\/privacy"}';
    var g_downloading_new_tiles = false;
    var g_localStorage_available = true;

    // *****************************  map settings **************************************
    var g_grayScale = [{"featureType":"landscape","stylers":[{"saturation":-100},{"lightness":65},{"visibility":"on"}]},
                    {"featureType":"poi","elementType": "geometry","stylers":[{"saturation":-100},{"lightness":51},{"visibility":"simplified"}]},
                    {"featureType":"poi","elementType": "labels","stylers":[{"visibility":"off"}]},
                    {"featureType":"road.highway","stylers":[{"saturation":-100},{"visibility":"simplified"}]},
                    {"featureType":"road.arterial","stylers":[{"saturation":-100},{"lightness":30},{"visibility":"on"}]},
                    {"featureType":"road.local","stylers":[{"saturation":-100},{"lightness":40},{"visibility":"on"}]},
                    {"featureType":"transit","stylers":[{"saturation":-100},{"visibility":"simplified"}]},
                    {"featureType":"administrative.province","stylers":[{"visibility":"off"}]},
                    {"featureType":"water","elementType":"labels","stylers":[{"visibility":"on"},{"lightness":-25},{"saturation":-100}]},
                    {"featureType":"water","elementType":"geometry","stylers":[{"hue":"#ffff00"},{"lightness":-25},{"saturation":-97}]}];


    var g_ifonly_socket = "";




</script>
<script type="text/javascript">
// pure javascript to simulate $(document).ready()
// From https://github.com/jfriend00/docReady
(function(funcName, baseObj) {
    "use strict";
    // The public function name defaults to window.docReady
    // but you can modify the last line of this function to pass in a different object or method name
    // if you want to put them in a different namespace and those will be used instead of
    // window.docReady(...)
    funcName = funcName || "docReady";
    baseObj = baseObj || window;
    var readyList = [];
    var readyFired = false;
    var readyEventHandlersInstalled = false;

    // call this when the document is ready
    // this function protects itself against being called more than once
    function ready() {
        if (!readyFired) {
            // this must be set to true before we start calling callbacks
            readyFired = true;
            for (var i = 0; i < readyList.length; i++) {
                // if a callback here happens to add new ready handlers,
                // the docReady() function will see that it already fired
                // and will schedule the callback to run right after
                // this event loop finishes so all handlers will still execute
                // in order and no new ones will be added to the readyList
                // while we are processing the list
                readyList[i].fn.call(window, readyList[i].ctx);
            }
            // allow any closures held by these functions to free
            readyList = [];
        }
    }

    function readyStateChange() {
        if ( document.readyState === "complete" ) {
            ready();
        }
    }

    // This is the one public interface
    // docReady(fn, context);
    // the context argument is optional - if present, it will be passed
    // as an argument to the callback
    baseObj[funcName] = function(callback, context) {
        // if ready has already fired, then just schedule the callback
        // to fire asynchronously, but right away
        if (readyFired) {
            setTimeout(function() {callback(context);}, 1);
            return;
        } else {
            // add the function and context to the list
            readyList.push({fn: callback, ctx: context});
        }
        // if document already ready to go, schedule the ready function to run
        // IE only safe when readyState is "complete", others safe when readyState is "interactive"
        if (document.readyState === "complete" || (!document.attachEvent && document.readyState === "interactive")) {
            setTimeout(ready, 1);
        } else if (!readyEventHandlersInstalled) {
            // otherwise if we don't have event handlers installed, install them
            if (document.addEventListener) {
                // first choice is DOMContentLoaded event
                document.addEventListener("DOMContentLoaded", ready, false);
                // backup is window load event
                window.addEventListener("load", ready, false);
            } else {
                // must be IE
                document.attachEvent("onreadystatechange", readyStateChange);
                window.attachEvent("onload", ready);
            }
            readyEventHandlersInstalled = true;
        }
    };
})("docReady", window);
/************************************************

Ifonly Event emitter

*************************************************/

// ifOnly ready custom event
var g_eventHandlers = [];

// old old-fashioned way to create custom event to cover IE
// Create the event.
if(document.createEvent){
    var g_ioReadyEvent = document.createEvent('Event');
    // Define that the event name is 'build'.
    g_ioReadyEvent.initEvent('ioReady', true, true);
}else{
    var g_ioReadyEvent = document.createEventObject();
    // Define that the event name is 'build'.
    g_ioReadyEvent.eventType = 'ioReady';
}


(function(funcName, baseObj) {
    "use strict";

    funcName = funcName || "ioReady";
    baseObj = baseObj || window;

    baseObj[funcName] = function(callback) {
        //var handler = funcName();
        g_eventHandlers.push(callback);
        document.addEventListener("ioReady", callback);
    };
})("ioReady", window);

function destroyIfonlyReadyEvent(){
    if(g_eventHandlers.length > 0){
        for(var key in g_eventHandlers){
            document.removeEventListener("ioReady", g_eventHandlers[key]);
        }
        // empty the array
        // garbage collector take care of the memory thing
        g_eventHandlers = [];
    }
}
//console.log("register ioReady");

//
// helper function to handle customed events
//
function ioTriggerEvent(el, eventName, event){
    if(el.dispatchEvent){
        el.dispatchEvent(event);
    }else if(el.fireEvent){// IE < 9
        el.fireEvent('on'+eventName,event);// can trigger only real event (e.g. 'click')
    }
}

//
// trigger ioReadyEvent
//
function triggerIOReadyEvent(){
    docReady(function() {
        ioTriggerEvent(document, "ioReady", g_ioReadyEvent);
        //console.log("triggered io ready event");
        // destry listden events
        destroyIfonlyReadyEvent();
        //console.log("destroy io ready event");
    });

}

// The follow codes add the
// addEventListener, removeEventListener, Event.preventDefault and Event.stopPropagation  which are not being supported by IE 8
(function() {
  if (!Event.prototype.preventDefault) {
    Event.prototype.preventDefault=function() {
      this.returnValue=false;
    };
  }
  if (!Event.prototype.stopPropagation) {
    Event.prototype.stopPropagation=function() {
      this.cancelBubble=true;
    };
  }
  if (!Element.prototype.addEventListener) {
    var eventListeners=[];
    var addEventListener=function(type,listener /*, useCapture (will be ignored) */) {
      var self=this;
      var wrapper=function(e) {
        e.target=e.srcElement;
        e.currentTarget=self;
        if (typeof listener.handleEvent !== 'undefined') {
          listener.handleEvent(e);
        } else {
          listener.call(self,e);
        }
      };
      if (type==="DOMContentLoaded") {
        var wrapper2=function(e) {
          if (document.readyState==="complete") {
            wrapper(e);
          }
        };
        document.attachEvent("onreadystatechange",wrapper2);
        eventListeners.push({object:this,type:type,listener:listener,wrapper:wrapper2});

        if (document.readyState==="complete") {
          var e=new Event();
          e.srcElement=window;
          wrapper2(e);
        }
      } else {
        this.attachEvent("on"+type,wrapper);
        eventListeners.push({object:this,type:type,listener:listener,wrapper:wrapper});
      }
    };
    var removeEventListener=function(type,listener /*, useCapture (will be ignored) */) {
      var counter=0;
      while (counter<eventListeners.length) {
        var eventListener=eventListeners[counter];
        if (eventListener.object==this && eventListener.type==type && eventListener.listener==listener) {
          if (type=="DOMContentLoaded") {
            this.detachEvent("onreadystatechange",eventListener.wrapper);
          } else {
            this.detachEvent("on"+type,eventListener.wrapper);
          }
          eventListeners.splice(counter, 1);
          break;
        }
        ++counter;
      }
    };
    Element.prototype.addEventListener=addEventListener;
    Element.prototype.removeEventListener=removeEventListener;
    if (HTMLDocument) {
      HTMLDocument.prototype.addEventListener=addEventListener;
      HTMLDocument.prototype.removeEventListener=removeEventListener;
    }
    if (Window) {
      Window.prototype.addEventListener=addEventListener;
      Window.prototype.removeEventListener=removeEventListener;
    }
  }
})();
/************************************************

Ifonly Event emitter   End

*************************************************/
</script>

    <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1;text/html;">
    <meta charset="utf-8">
    <meta name="description" content="IfOnly delivers extraordinary experiences with top talents in sports, music, entertainment, food, wine, golf, tennis and more, all while benefiting deserving non-profits.">
    <meta name="keywords" content="">
    <meta property="twitter:account_id" content="552257090">
    <meta name="p:domain_verify" content="cee26ed1d8359e6be354626271de9d1f">
    <meta name="msvalidate.01" content="F162C6F11AC64DD838FFF10F954FF152">
    <meta name="apple-itunes-app" content="app-id=1031395373, affiliate-data=, app-argument=">
    <meta name="com.silverpop.brandeddomains" content="www.pages03.net,ifonly.com,ifonly.mkt6597.com">
    <meta name="google-site-verification" content="3_iRqQVA0Vt711tHoPwaaxIdueeWE5WhMyc4dz0M8U8">

    
    <link rel="icon" type="image/png" href="/images/favicon_io.ico">
    <link rel="apple-touch-icon" href="/images/io/touch-icon-57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/io/touch-icon-72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/io/touch-icon-114-precomposed.png">
    <link rel="stylesheet" type="text/css" href="/assets/3292c487/frontend.all.min.css">
<script type="text/javascript" src="/assets/3190acbd/jquery.min.js"></script>
<script type="text/javascript" src="/assets/3292c487/desktop_main.js" defer="defer"></script>
<title>IfOnly | Extraordinary Experiences for Good</title>
    <link rel="alternate" media="only screen and (max-width: 640px)" href="https://www.ifonly.com/m/website/privacy">
<meta property="fb:app_id" content="153088091495120">
<meta property="og:site_name" content="IfOnly">
<meta property="og:title" content="IfOnly - Extraordinary Experiences for Good">
<meta property="og:url" content="https://www.ifonly.com/website/privacy">
<meta property="og:type" content="product">
<meta property="og:description" content="IfOnly delivers extraordinary experiences with top talents in sports, music, entertainment, food, wine, golf, tennis and more, all while benefiting deserving non-profits. At IfOnly, we believe that true luxury is not another item or thing, but rather the extraordinary experiences we remember and share.">
<meta property="og:image" content="https://www.ifonly.com/images/io/FB-share-logo.jpg">
<script type="text/javascript">
                function facebooktrack(value, pixelId){
                    var fb_param = {};
                    fb_param.pixel_id = pixelId;
                    fb_param.value = value;
                    fb_param.currency = 'USD';

                    (function(){
                        var fpw = document.createElement('script');
                        fpw.async = true;
                        fpw.src = 'https://connect.facebook.net/en_US/fp.js';
                        var ref = document.getElementsByTagName('script')[0];
                        ref.parentNode.insertBefore(fpw, ref);
                     })();
                }
            </script><script async="true" type="text/javascript" src="https://s.adroll.com/j/roundtrip.js"></script></head>
<body id="body">
    <script>
        //var midTime = new Date().getTime();
        //console.log("mid "+ (midTime - startTime)/1000 +" seconds");
    </script>
    <div id="body-overlay"></div>

    <!--  used to find the current responsive range -->
    <div id="responsive_range" style="display:none;"></div>

    <div class="ifonly-templates" style="display:none;">
        <input type="hidden" id="loadedACnt" value="0">
        <input type="hidden" id="loadedPCnt" value="0">
        <input type="hidden" id="loadedSCnt" value="0">
        <input type="hidden" id="needMoreTiles" value="1">
        <input type="hidden" id="loadedBCnt" value="0">
        <div id="product_template" style="display:none;">
            <div class="productTile product default">
                
<a class="tile_product tile js-product-title desktop" href="" pid="">

    <div>
        <div class="product_img_container">
            
                        
            <div class="buy_type" style="display:none; ">
                <div class="buy_type_text">
                    <span>
                         
                    </span>
                </div>
                <div class="buy_type_angle"></div>
            </div>
            <div class="product_image_wrapper">
                <div class="product_image_viewport">
                    <img class="product_img js-lazyload" data-src="">
                </div>    
            </div>
            <img class="celeb_img js-lazyload" data-src="" style="">

            <div class="heart_img wishlist " pid="" title="wishlist" lvl="1">
            </div>

        </div>

    </div>

    
    <div class="product_text_container">
        <div class="details_div">
            <div class="min_height_placeholder"></div>
            <div class="product_celeb_name"></div>
            <div style="clear:both;"></div>
        </div>

        <div class="product_location"></div>

        <div class="product_title">
            <p></p>
        </div>

        <div class="product_price"></div>
    </div>    
</a>
            </div>
        </div>

        <div id="collection_template" style="display:none;">
            
<a class="tile_collection tile desktop " href="">
    <div class="collection_img_container">
        <img class="collection_img js-lazyload " data-src="">
        <div class="collection-text-wrapper">
            <table class="collection-text-content">
                <tbody><tr>
                    <td>
                        <div class="collection_title"></div>
                        <div class="collection_description"></div>
                    </td>
                </tr>    
            </tbody></table>
        </div>
        <div class="gradient"></div>
    </div>
    
    
            
</a>

        </div>

        <div id="ad_template" style="display:none;">
            
<a class="tile_ad tile desktop " href="javascript:;">
    
    <div class="ad_img_container">
        <img class="tile_img js-lazyload" data-src="">
    </div>
</a>
        </div>

        <div id="ad_template" style="display:none;">
            
<a class="tile_ad tile desktop " href="javascript:;">
    
    <div class="ad_img_container">
        <img class="tile_img js-lazyload" data-src="">
    </div>
</a>
        </div>

        <div id="productization_product_template" style="display:none;">
            


    
    
    
<div class="productization_product discovery">

    <div class="luminary_img_div productization_info_div">


        <div class="luminary_img_box_wrapper">
            <a class="luminary_img_box" href="" data-celebid="">
                <img class="luminary_img js-lazyload" src="">
            </a>    

        </div>   

        
        <!-- for mobile -->
        <div class="luminary_title_wrapper">
            <div class="luminary_info_row">
                <div class="luminary_name" data-celebid=""></div>
                 <div lvl="2" data-id="" style="margin: 10px 0 0 2px; " class="follow following  wide primaryButton button "><span class="title"><img class="greenCheck" src="/images/io/icon_checkmark_green.png" style="display: none;">
                       <font class="title following-text">FOLLOW</font></span></div>                <div style="clear:both;"></div>
            </div>    
            
            <div class="charity_name" data-charityid=""></div>
            
        </div>  
        
        <div style="clear:both;"></div>

    </div>


    <div class="product_description_div productization_info_div">

        <!-- for desktop -->
        <div class="header_row">
            <div class="luminary_name" data-celebid=""></div>
            <div class="charity_name" data-charityid=""></div>
             <div lvl="2" data-id="" style="margin: 10px 0 0 2px; " class="follow following  wide primaryButton button "><span class="title"><img class="greenCheck" src="/images/io/icon_checkmark_green.png" style="display: none;">
                       <font class="title following-text">FOLLOW</font></span></div>        </div>  

        <div class="bio_row"></div>

        <div class="quote_row"></div>
        
        <table class="attr_table">
            <tbody><tr>
                <td class="location_td" style="display:none"><img src="/images/icon_loc_000.png"><span></span></td><td class="guests_td" style="display:none"><img src="/images/icon_manypeeps_000-mbpng.png"><span></span></td><td class="duration_td" style="display:none"><img src="/images/icon_clock_000.png"><span></span></td>                
            </tr>    
        </tbody></table>


    </div>    



    <div class="product_price_div productization_info_div">

        <div class="price_text"></div>


        <form class="js-productization-add-to-bag add_to_bag_form" action="/product/addProductizedProductToBag" method="post">
            
            
             <div class="add_to_bag_btn primaryButton button " style="" onclick="add_productized_product_to_cart(this)"><span class="title">ADD TO BAG</span></div>            <input type="hidden" class="js-productId-to-add" name="productId" value="">
            
            <input type="hidden" class="" name="pageId" value="5">
        </form>    


    </div>   
    
    
    <div style="clear:both;"></div>


</div>   
    
    
    

        </div>

    </div>

    <div style="display:none; position: absolute;"><img src="/images/io/header_bg.png"><img src="/images/io/search_icon.png"><img src="/images/io/scroll_left.png"><img src="/images/io/scroll_right.png"><img src="/images/io/scroll_left_hover.png"><img src="/images/io/scroll_right_hover.png"><img src="/images/icon_luminaries_active.png"><img src="/images/icon_experiences_active.png"><img src="/images/icon_shops_active.png"><img src="/images/icon_luminaries_green.png"><img src="/images/icon_experiences_green.png"><img src="/images/icon_shops_green.png"><img src="/images/arrow_more_active.png"><img src="/images/arrow_more_green.png"></div><div id="fb-root"></div>
<script>
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '153088091495120',
        status     : true, // check login status
        cookie     : true, // enable cookies to allow the server to access the session
        xfbml      : true, // parse XFBML
        version    : 'v2.3'
      });
    };
    (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
</script>



<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function()
{n.callMethod? n.callMethod.apply(n,arguments):n.queue.push(arguments)}
;if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','//connect.facebook.net/en_US/fbevents.js');
fbq('init', '726407990740927');
fbq('track', "PageView");
</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=726407990740927&ev=PageView&noscript=1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- IO Wrapper -->
<script>
function fb_p(t, k, obj){ if( g_thisHost==='www'){ if(obj===undefined){fbq(t, k);}else{fbq(t,k,obj)}}}
</script><script>
    //var headTime04 = new Date().getTime();
    //console.log("headTime04 "+ (headTime04 - startTime)/1000 +" seconds");
</script>
<script type="text/javascript" src="/scripts/jquery.min.js"></script>
<script type="text/javascript">
// ********************************   Assets Loading Prioritizing  Codes   ********************************** //
var g_CoreJSLibs = {
    jqueryUI: false,
    jqueryTOOL: false,
    jqueryCookie: false,
    globalJs: false,
    commonJs: false,
    mainJs: false,
    timepicker: (g_controller_id === "product"  || g_controller_id === "cart")? false:true
};


var secondPriorityJs = {
    googleJsApi:  {
        defer: false,
        loaded: (g_controller_id === "product" || g_controller_id === "cart")? false:true,
        url: "https://www.google.com/jsapi?autoload={'modules':[{name:'maps',version:3,other_params:'libraries=places'}]}"
    },
    googleSignUp: {
        loaded: (g_is_guest || ! g_loggedInManually) ? false : true,
        url: "https://apis.google.com/js/client:platform.js?onload=loadProfile"
    },
    lazysizes:  {
        defer: false,
        loaded: false,
        url: "/scripts/lazysizes.min.js"
    },
    /*
    timepicker:  {
        loaded: (g_controller_id == "product"  || g_controller_id == "cart")? false:true,
        url: "/scripts/jquery-ui-timepicker-addon.js",
    },

    jqueryUITouchPunch:{
       loaded: false,
       url: "https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js",
    },
    */
    socketIo:  {
        loaded: false,
        url: "/scripts/socket.io-1.4.5.min.js"
    }

};


if(g_is_mobile){

}else{
    secondPriorityJs['mousewheel'] = {
        loaded: false,
        url: "/scripts/jquery.mousewheel.min.js"
    };
    secondPriorityJs['mCustomScrollbar'] = {
        loaded: false,
        url: "/scripts/jquery.mCustomScrollbar.js"
    };
}

/*
function loadJSAfterJquery(){
    var dependantJs = {
        jqueryUI:'/scripts/jquery-ui.min.js',
        jqueryMigrate:'/scripts/jquery-migrate-1.2.1.min.js',
        jqueryTOOL:'/scripts/jquery.tools.min.fix.js',
        jqueryCookie:'/scripts/jquery.cookie.js',
        globalJs:'/scripts/global.js',
        commonJs:'/scripts/common.js',
    };

    for(var key in dependantJs){
        var script = document.createElement('script');
        script.async = true;
        script.src = dependantJs[key];
        script.onload = coreJSLoadingHandling(key);
        document.head.appendChild(script);
    }
}
*/

function secondPriorityJSLibLoading(){

    for(var key in secondPriorityJs){
        if(!secondPriorityJs[key]['loaded']){

            //console.log("loading " + key);
            var script = document.createElement('script');
            script.src = secondPriorityJs[key]['url'];
            script.onload = secondPriorityJSHandling(key);
            if(secondPriorityJs[key].block === undefined){
                if(secondPriorityJs[key].defer !== undefined && !secondPriorityJs[key].defer){
                    script.async = true;
                }else{
                    script.defer = true;
                }
            }

            document.head.appendChild(script);
        }
    }
}

function coreJSLoadingHandling(keyName){

    //console.log(keyName+" loaded!");
    g_CoreJSLibs[keyName] = true;

    var allLoaded = true;
    for(var key in g_CoreJSLibs){
        if(!g_CoreJSLibs[key]){
            allLoaded = false;
            break;
        }
    }

    // all depend JS Lib is loaded
    // do the UI things NOW :)
    if(allLoaded){
        //console.log("all dependant JS loaded!");
        var allLoaded = new Date().getTime();
        //console.log("js loaded "+ (allLoaded - startTime)/1000 +" seconds");

        coreJSAllLoaded();
    }
}


function coreJSAllLoaded(){

    // less priority JS loading
    secondPriorityJSLibLoading();

    // less priority CSS loading
    lessPriorityCSSHandling();

    docReady(function() {

        // before docuument is ready, the whole page is cover by #body-overlay
        // to make sure no button is clicked before document is ready
        if($("#body-overlay").length > 0){
            $("#body-overlay").hide();
        }
    });

    // trigger the ioReadyEvent
    triggerIOReadyEvent();

}

function secondPriorityJSHandling(key){
    secondPriorityJs[key]['loaded'] = true;

    var allLoaded = true;
    for(var key in secondPriorityJs){
        if(!secondPriorityJs[key]['loaded']){
            allLoaded = false;
            break;
        }
    }

    // all secondPriorityJS  is loaded
    if(allLoaded){
        //console.log("all secondPriorityJS loaded!");
        var allLoaded = new Date().getTime();
        //console.log("all secondPriorityJS "+ (allLoaded - startTime)/1000 +" seconds");
        secondPriorityJSAllLoaded();
    }
}

function secondPriorityJSAllLoaded(){
    var thirdPriorityJS = {
        googleMapInitiation: (g_controller_id === "product" || g_controller_id === "cart") ? "/scripts/googleMapInitiation.js":"",
        infobubble:          (g_controller_id === "product" ) ? "/scripts/googlemap-infobubble.js":"",
        jqueryUiWidget:        (false)? "/scripts/jquery.ui.widget.js":"",
        iframeTransport:       (false)? "/scripts/jquery.iframe-transport.js":"",
        fileupload:            (false)? "/scripts/jquery.fileupload.js":"",
        Jcrop:                 (false)? "/scripts/jquery.Jcrop.min.js" :"",
        timelineJS:            (false)? "/scripts/jquery.timeline.js":"",
        qtipJS:                (false)? "/scripts/jquery.qtip.min.js":"",
        customFormImageUpload: (false)? "/scripts/customForm_imageUpload.js":"",
        customFormMediaUpload: (false)? "/scripts/customForm_mediaUpload.js":"",
        customFormFileUpload:  (false)? "/scripts/customForm_fileUpload.js":"",
        fullcalendar:          (false)? "/scripts/fullcalendar.min.js":""
    };

    //console.log("loading thirdPriorityJS");
    for(var key in thirdPriorityJS){
        if(thirdPriorityJS[key] !== ""){

            if(key === "googleMapInitiation"){
                if(typeof google === 'undefined'){
                    //console.log("load "+key+" in 4 seconds");
                    var src = thirdPriorityJS[key];
                    setTimeout(function(){
                        //console.log("loading " + src);
                        loadJS(src, true);
                    }, 4000);

                }else{
                    //console.log("loading " + key);
                    loadJS(thirdPriorityJS[key], true);
                }
            }else{
                //console.log("loading " + key);
                loadJS(thirdPriorityJS[key], true);
            }

        }
    }
}

function loadJS(src, defer){
    var script = document.createElement('script');
    if(defer){
        script.defer = true;
    }else{
        script.async = true;
    }
    script.src = src;
    document.body.appendChild(script);
}


function lessPriorityCSSHandling(){
    // learned from https://developers.google.com/speed/docs/insights/OptimizeCSSDelivery#example
    /*
    var raf = requestAnimationFrame || mozRequestAnimationFrame ||
          webkitRequestAnimationFrame || msRequestAnimationFrame;
    */
    var raf = (function(){
        return  window.requestAnimationFrame       ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame    ||
                window.oRequestAnimationFrame      ||
                window.msRequestAnimationFrame     ||
                function(/* function */ callback, /* DOMElement */ element){
                    window.setTimeout(callback, 1000 / 60);
                };
      })();

    if (raf){
        //console.log("in raf");
        raf(loadLessPriorityCSS);
    }else{
        //console.log("no raf");
        window.addEventListener('load', loadLessPriorityCSS);
    }

}

function loadLessPriorityCSS(){
    var lessPriorityCSS = {
        jqueryUiCSS:  "/scripts/jquery-ui.css",
        widgetsCSS: "/scripts/widgets.css",
        JcropCSS:        (g_controller_id === "vendorportal")?"/scripts/jquery.Jcrop.min.css":"",
        timelineCSS:     (g_controller_id === "vendorportal")?"/scripts/jquery.timeline.css":"",
        qtipCSS:         (g_controller_id === "vendorportal")?"/scripts/jquery.qtip.min.css":"",
        fullcalendarCSS: (g_controller_id === "vendorportal")?"/scripts/fullcalendar.min.css":""
    };

    if(g_is_mobile){

    }else{
        lessPriorityCSS["mCustomScrollbarCSS"] = "/scripts/jquery.mCustomScrollbar.css";
    }
    //console.log("ready to load less priority CSS");
    $(document).ready(function(){
        //console.log("download less priority CSS");
        loadCSS(lessPriorityCSS);
    });

}

function loadCSS(href){
    if(typeof href === "string"){
        if(href !== ""){
            var l = document.createElement('link');
            l.rel = 'stylesheet';
            l.href = href;
            document.head.appendChild(l);
        }
    }else{
        for(var key in href){
            if(href[key] !== ""){
                var l = document.createElement('link');
                l.rel = 'stylesheet';
                l.href = href[key];
                document.head.appendChild(l);
            }
        }
    }
}


// ********************************   Assets Loading Prioritizing  Codes   ********************************** //


// ********************************  some help functions and variables **********************************/

function get_mobile_url_prefix(){
    if(g_is_mobile){
        return '/m/'; ;
    }else{
        return '/';
    }

}

var ifonly_service_prefix = '/services/';
if(g_is_mobile){
    ifonly_service_prefix = '/m/services/';
}
var g_url_get_category_products_and_collections = ifonly_service_prefix + 'category/GetCategoryProductsAndCollections';
var g_url_get_category_celebrities_html  = ifonly_service_prefix + 'category/GetCategoryCelebritiesHtml';

var g_url_get_mobile_home_experiences  = ifonly_service_prefix + 'common/GetMobileHomeExperiences';

// all the urls for the web services
var g_url_get_communication_list   = ifonly_service_prefix +  'communications/GetVendorCommunicationsList';
var g_url_get_payout_list   = ifonly_service_prefix +  'payout/GetPayout';
var g_url_get_conversation_details = ifonly_service_prefix + 'communications/GetConversationDetails';
var g_url_reply_conversation = ifonly_service_prefix + 'communications/ReplyConversation';
var g_url_start_conversation = ifonly_service_prefix + 'communications/startConversation';
var g_url_fulfillment_user_data_save  = '/vendorportal/fulfillmentUserDataSave';
var g_url_send_negotiation_notifications  = ifonly_service_prefix + 'communications/SendNegotiationNotifications';



var g_url_get_order_list_page = get_mobile_url_prefix() +'vendorportal/orderlistpage';
var g_url_order_list_submit_details = ifonly_service_prefix + 'order/orderListSubmitDetails';


var g_url_get_redemption_info_html = get_mobile_url_prefix() + 'redemption/GetRedemptionInfoHtml';
var g_url_get_pickone_info_html = get_mobile_url_prefix() + 'redemption/getPickoneInfoHtml';

var g_url_infobox_edit_mode_submit = ifonly_service_prefix + 'infobox/EditModeSubmit';
var g_url_infobox_exe_mode_submit = ifonly_service_prefix + 'infobox/ConfirmRequests';

var g_url_infobox_get_request_history_html = ifonly_service_prefix + 'infobox/GetRequestHistoryHtml';

var g_url_crowd_buy_data_save = ifonly_service_prefix + 'vendorportal/CrowdBuyDataSave';

var g_url_bwf_setup = ifonly_service_prefix + 'invitecampaign/crowdBuyCampaignDataHandling';
var g_url_bwf_get_price_text = ifonly_service_prefix + 'invitecampaign/GetPriceTextForCampaign';
var g_url_bwf_get_deadlines = ifonly_service_prefix + 'invitecampaign/GetGrouByDateInfoForCampaign';
var g_url_bwf_add_invitees = ifonly_service_prefix + 'invitecampaign/AddInvitees';
var g_url_bwf_send_reminders = ifonly_service_prefix + 'invitecampaign/SendReminderEmails';
var g_url_bwf_update_invitee_status = ifonly_service_prefix + 'invitecampaign/UpdateInviteeStatus';



// service result flag
var g_result_sucess = 1;
var g_result_err = 0;

// error_code
var g_err_not_logged_in = 1;
var g_err_not_authorized = 2;
var g_err_resource_not_found = 3;
var g_err_wrong_input = 4;


//************* Utility Helper Functions ***** START ************************************
function addCommas(nStr)
{
	nStr += '';
	x = nStr.split('.');
	x1 = x[0];
	//x2 = x.length > 1 ? '.' + x[1] : ''; Decimals
	var rgx = /(\d+)(\d{3})/;
	while (rgx.test(x1)) {
		x1 = x1.replace(rgx, '$1' + ',' + '$2');
	}
	//return x1 + x2; with decimals
    return x1;
}

function getPageName(){
    if($('#pageName').length>0 ){
        return $('#pageName').val();
    }
    return ''
}


//************* Utility Helper Functions ***** END ************************************

// Product Info Box Function
function infoBoxLayOutPreparing(){
    $(".p-form .one-row").each(function(){
        if($(this).children(".preCheckOutField").length === 1){
            $(this).children(".preCheckOutField").css("width", "100%");
        }
    });

    $(".attr-row").each(function(){
        if($(this).find(".attr-field").length === 1){
            $(this).find(".attr-field").children("div").css("display","block");
        }
    });

    $(".attr-field.loc p").each(function(){
        if($(this).height() < 22){
            // $(this).css("margin-top","12px");
        }
    });

    $(".widget-row:visible").each(function(){
        if($(this).height() < 15){
            $(this).hide();
        }
    });

    // when height less than 15, mean empty
    $(".info-box:visible").each(function(){
        if($(this).height() < 15 && !$(this).hasClass("js-is-gift-certificate")){
            $(this).hide();
            if($(this).hasClass("js-cart")){
                $(this).closest(".p-block").hide();
            }
        }
    });


}


function highlightTopNavigation(catId) {
    $("#top-left-menu ul li").removeClass('active');
    $("#top-left-menu ul li").each(function() {
        if ($(this).attr('catid') == catId) {
            $(this).addClass('active');
        }
    });
}

//***************** Function used mobile PDP price CSS ************************
function mobilePriceTextCssClearing(){
    $(".buyBox #totalPrice").css("margin-top", "0px");
    $(".buyBox .priceText").css("margin-top", "0px");
    $(".buyBox .price .soldout").css("margin-top", "10px");
    $(".buyBox .totalPriceText").css("margin-top", "0px");
}

function mobilePriceTextCssAdjusting(){
    if ($(".buyBox .priceText").text().trim() === "" || $(".buyBox .priceText:hidden").length === 1 ) {
        if($(".buyBox #totalPrice").text().trim() !== "" ){
            $(".buyBox .totalPriceText").css("margin-top", "10px");
        }else if($(".buyBox .price .soldout").text().trim() !== ""){
            $(".buyBox .price .soldout").css("margin-top", "10px");
        }
    }
}
//***************** Function used mobile PDP price CSS ************************

function markWishlistedProducts(wishlistProducts){
    var startTimeTest = new Date().getTime();
    if(!g_is_guest){
        if(wishlistProducts !== undefined && wishlistProducts !== ""){
            var $obj;

            if(g_controller_id === "search"){
                 $obj = $('#filterPage a.tile_product');
            }else{
                if(g_is_mobile || $('#main .pageframe_div').length){
                    $obj = $('#main .tile_product');
                } else {
                    $obj = $('.main-vertical-list .productTile');
                }
            }

            $obj.each(function(){
                var thisPid = $(this).attr('pid');
                var $wishlist = $(this).find('.wishlist');
                if(wishlistProducts.indexOf(thisPid) > -1){
                    if($wishlist.hasClass('listed')){
                        //Do Nothing wishlisted product is marked as green
                    } else {
                        $wishlist.addClass('listed');
                        //$wishlist.css('background-image', 'url("/images/io/icon_heart_on_green.png")');
                    }
                } else {
                    //Product Not in wishlist, check for listed class if yes remove or do nothing
                    if($wishlist.hasClass('listed')){
                        $wishlist.removeClass('listed');
                        //$wishlist.css('background-image', 'url("/images/io/icon_heart_off_FFF.png")');
                    }
                }
            });
        }
    }
    var startTimeTestEnd = new Date().getTime();
    console.log("mark wishlist time: "+ (startTimeTestEnd - startTimeTest)/1000 +" seconds");

}

function getPopupLeftToCenter(popupId) {
    var left = ($(window).width() - $("#"+popupId).width())/2;

    if(!g_is_responsive && navigator.userAgent.match(/iPad/i) != null) {
        left = (1200 - $("#"+popupId).width())/2;
    }

    if(left < 0){
        left = 10;
    }

    return left;
}


function isHandheld(ipad) {
    var agent = navigator.userAgent.toLowerCase();
    if (ipad === undefined) {
        return (
            agent.match(/iphone/) ||
            agent.match(/ipod/) ||
            agent.match(/android/)
        );
    }
    return (
        agent.match(/iphone/) ||
        agent.match(/ipod/) ||
        agent.match(/android/)
    );
}



function refreshNotifications() {
    if(g_is_guest){
        return;
    }

    $.ajax({
        type: "GET",
        url: "/services/common/getNotifications",
        headers: { "Cache-Control": "no-cache" },
        dataType: 'json',
        success: function(data) {
            populateNotificationHtml(data);
        }
    });
}
function populateNotificationHtml(data){
    $('#acct-popup li span.bubble, #top-welcome .myaccount .bubble, #vendor-menu .menu-li .bubble').css({visibility:'hidden'}).html('');
                                    // need cleanup later
    $('.bubble.notification.sum').css({visibility:'hidden'});
    $('.bubble.notification.todo').css({visibility:'hidden'});
    $('.bubble.notification.unread').css({visibility:'hidden'});

    var width_css;
    if (data.sum > 0) {
        width_css = _getNotificationBubbleWidth(data.sum, $('.bubble.notification.sum').html(data.sum).css("width"));
        $('.bubble.notification.sum').html(data.sum).css({visibility:'visible', width: width_css});
    }
    if (data.todo > 0) {
        width_css = _getNotificationBubbleWidth(data.todo, $('.bubble.notification.todo').html(data.todo).css("width"));
        $('.bubble.notification.todo').html(data.todo).css({visibility:'visible', width: width_css});
    }
    if (data.unread > 0) {
        width_css = _getNotificationBubbleWidth(data.unread, $('.bubble.notification.unread').html(data.unread).css("width"));
        $('.bubble.notification.unread').html(data.unread).css({visibility:'visible', width: width_css});
    }
}


var digit_three = "27px";
var digit_four  = "36px";
function _getNotificationBubbleWidth(num, defaultWidth){
    var width_css = defaultWidth;

    if( num > 999){
        width_css = digit_four;
    }
    else if( num > 99){
        width_css = digit_three;
    }

    return width_css;
}

function getCartPopupHtml(added, show) {
    ga('send', 'pageview', 'Shopping Bag Popup');
    $.ajax({
        type: "POST",
        cache : false,
        url: "/services/common/getPopup",
        headers: { "Cache-Control": "no-cache" },
        dataType: 'html',
        data: {from:1},
        success: function(data) {

            populateCartPopupHtml(data);

            if (added) {
                showCartPopupHtml(added);
            } else {
                if (show !== false) {
                    $("#cart-popup-wrapper").fadeIn(250);
                }
            }
            // $("#cart-popup-items").mCustomScrollbar();
        }
    });
}
function populateCartPopupHtml(html){
    $("#cart-popup-content").html(html);

    if ($('#cart-popup-item-count').length > 0){
        $("#cart-item-count").html($('#cart-popup-item-count').html());
    } else {
        $("#cart-item-count").html('');
        $("#cart-item-count").siblings("img").attr("src",$("#cart-item-count").siblings("img").attr("data-empty-bag"));
    }
}
function showCartPopupHtml(added) {
    var left = $("#top-welcome .shopping").position().left - 310;
    //$("#cart-popup-wrapper").css({"left":left + "px"});
    if (added) {
        $("#cart-popup-added-block .added-icon").removeClass('cancel');
        $("#cart-popup-added-block .added-text").html('ITEM ADDED TO BAG');
    } else {
        $("#cart-popup-added-block .added-icon").addClass('cancel');
        $("#cart-popup-added-block .added-text").html('REQUESTED QUANTITY IS NOT AVAILABLE');
    }
    $("#cart-popup-added-block").fadeIn(250);
    setTimeout("$('#cart-popup-added-block').fadeOut();", 3000);
    setTimeout("hideCartPopup();", 8000);
    $("#cart-popup-wrapper").fadeIn(250);
    if ( ! $("#cart-popup-items").hasClass("mCustomScrollbar")){
        $("#cart-popup-items").mCustomScrollbar();
    }
    adjustTextLength($("#cart-popup #cart-popup-items li.item div.name p.pName"));
    $.post('/website/logPageView',{'pageId':'cart-popup-wrapper'},function(data){},'json');
}

function hideCartPopup() {
    if (!mouseIn) {
        $("#cart-popup-wrapper").fadeOut(200);
    }
}


function getWishlistPopupHtml(showAddHint, showPopUp) {
    if(showPopUp === undefined){
        showPopUp = true;
    }

    //return; // we don't use this popup anymore

    ga('send', 'pageview', 'Wishlist Popup');
    $.ajax({
        type: "POST",
        url: "/services/common/getWishlistPopup",
        headers: { "Cache-Control": "no-cache" },
        dataType: 'json',
        data: {'pageId': 'wish-popup-wrapper'},
        success: function(data) {
            $("#wish-popup-content").html(data.html);

            var $wishlistImg = $("#top-welcome a.wishlist img");
            if(data.hasWishlist == 1){
                $wishlistImg.attr("src", $wishlistImg.attr("data-has-wishlist"));
            }else{
                $wishlistImg.attr("src", $wishlistImg.attr("data-no-wishlist"));
            }
            //if (show !== false) {
            showWishlistPopupHtml(showAddHint, showPopUp);
            //$("#wish-popup-wrapper").fadeIn(250);
            //}
            // $("#wish-popup-items").mCustomScrollbar();
        }
    });
}

function showWishlistPopupHtml(showAddHint, showPopUp) {
    var left = 800;
    if ($("#top-welcome .wishlist").length > 0) {
        left = $("#top-welcome .wishlist").position().left - 247;
    }
    $("#wish-popup-wrapper").css({"left":left + "px"});
    if(showAddHint){
        $("#wish-popup-added-block").fadeIn(250);
        setTimeout("$('#wish-popup-added-block').fadeOut();", 2000);
    }

    if(showPopUp){
        setTimeout("hideWishlistPopup();", 4000);
        $("#wish-popup-wrapper").fadeIn(250);
        if ( ! $("#wish-popup-items").hasClass("mCustomScrollbar")){
            $("#wish-popup-items").mCustomScrollbar();
        }
    }


}
function hideWishlistPopup() {
    if (!mouseIn) {
        $("#wish-popup-wrapper").fadeOut(200);
    }
}



function g_postRequestQuote(pid) {
    ga('send', 'event', 'PDP', 'Request Quote button clicked');
    $("#pid").val(pid);
    if(g_is_guest){
        $("#signUp-dialog-called-from").val("requestQuote");
        signupDialog();
    } else {
        $("#request-confirm-dialog").overlay().load();
    }
    return false;
}

function g_postWaitList(pid) {
    ga('send', 'event', 'PDP', 'Waitlist button clicked');
    $("#pid").val(pid);
    if(g_is_guest){
        $("#signUp-dialog-called-from").val("waitlist");
        signupDialog();
    } else {
        $("#waitlist-confirm-dialog").overlay().load();
    }
    return false;
}




/*
 *
 * Google SingUp
 */
function loadProfile(){
    gapi.client.setApiKey(); //set your API KEY
    gapi.client.load('plus', 'v1',function(){});//Load Google + API
}
/*
 *
 * Used in vendor profile to adjust the media block width
 */
function AdjustMediaBlockSize() {
    if($(".media-block").attr("maxnumperrow") !== undefined){
        var maxNumPerRow = parseInt($(".media-block").attr("maxnumperrow"));
    }else{
        var maxNumPerRow = 3;
    }
    if($(".media-block .img-square-wrapper").not(".hidden").length > maxNumPerRow ){
        $(".media-block").parents(".edit-block").css("width", "100%");
    }else{

        var squareForWidthCnt = $(".media-block .img-square-wrapper").not(".hidden").length % maxNumPerRow;
        if(squareForWidthCnt === 0){
            $(".media-block").parents(".edit-block").css("width", "100%");
        }else{
            if($(".media-block .img-square-wrapper").not(".hidden") <= maxNumPerRow){
                $(".media-block").parents(".edit-block").css("width", squareForWidthCnt * 374 + "px");
            }
        }

        if(($(".media-block .img-square-wrapper").length - 2) > 0 ){
            if($(".img-square-wrapper .hasVideo").val() == 0 ){  // was 0 before
                if(g_vendorProfile !== ""){   // called from vendor profile page - adjust the progress bar
                    var percentNum = parseInt($(".form-row .prof-prg-block font").text());
                    if($("#vendorProfile input.category").val() === "corporate speaking"){
                        percentNum += 20;
                    }else{
                        percentNum += 20;
                    }

                    $(".form-row .prof-prg-block font").text(percentNum);
                    $(".form-row .prof-prg-block .prof-prg-bar .complete-bar").css("width", percentNum+"%");
                }
                $(".img-square-wrapper .hasVideo").val(1);       // make it as 1
            }
        }else{
            if($(".img-square-wrapper .hasVideo").val() == 1 ){  // was 1 before
                if(g_vendorProfile !== ""){   // called from vendor profile page - adjust the progress bar
                    var percentNum = parseInt($(".form-row .prof-prg-block font").text());
                    if($("#vendorProfile input.category").val() === "corporate speaking"){
                        percentNum -= 20;
                    }else{
                        percentNum -= 20;
                    }

                    $(".form-row .prof-prg-block font").text(percentNum);
                    $(".form-row .prof-prg-block .prof-prg-bar .complete-bar").css("width", percentNum+"%");
                }
                $(".img-square-wrapper .hasVideo").val(0);      // make it as 0
            }
        }
    }
}

function adjustFileUploadWidgetMargin() {
    if($(".img-square-wrapper.add-new-box.js-adjust-block").length === 1){
        var $uploadWidget = $(".img-square-wrapper.add-new-box.js-adjust-block");
        var imageCount = $uploadWidget.siblings(".img-square-wrapper:not(.hidden)").length;
        if($uploadWidget.closest("form").attr("id") === "mediaUpload"){ //For Media Library
            //Do Nothing
        } else if($uploadWidget.closest(".form-row").attr("formid") !== "demonstration") {
            if(imageCount % 2 === 0) {       // imageCount % 2 = 0 means even number of medias uploaded
                $uploadWidget.css("margin-left", "215px");
            } else if( imageCount % 2 === 1) {
                $uploadWidget.css("margin-left", "24px");
            }
        }
    }
}


var pos = !isHandheld();



// config of lazySizes
window.lazySizesConfig = window.lazySizesConfig || {};
// use .lazy instead of .lazyload
window.lazySizesConfig.lazyClass = 'js-lazyload';
window.lazySizesConfig.loadMode = 1; // only load visible elements when page loaded
                                     // default is 2

function userAccessHide(){
        $('#exposeMask').css("height", "100%");
        $('#container').css({height:"auto", "max-height":"none", overflow:"auto"});
        $('#body').css('overflow','auto');
        $('#exposeMask').fadeOut();
        $("#"+g_active_popup).fadeOut();
        if (g_active_popup === 'accesscode-add-dialog') {
            $("#accesscode-add-dialog .update-access-code-close .btn-w").html('Join Our Membership Waitlist'); // can be changed at bottom_js
        }
        g_active_popup = "";
        $("#page-member-signup-dialog-overlay").hide();
        $("#page-member-signup-dialog-loading").hide();
    return false;
}

function displayOverlay(popupId, type){
    //var webkitExist = (typeof window.webkit == "undefined")? false: true;
    if (g_isMobileApp === 1 && g_is_guest &&
        popupId !== "accesscode-add-dialog" &&
        popupId !== "conciergeOverlay-dialog"  &&
        popupId !== "sweepstake-share-dialog" &&
        popupId !== "sweepstake-email-share-dialog")
    {
        if(g_uaType == 4) {
            window.webkit.messageHandlers.shownativelogin.postMessage(JSON.stringify({url:window.location.href}));
        } else {
            Android.showSignup(window.location.href);
        }
        return false;
    }

    ga('send', 'pageview', popupId);
    $('.overlayDialog').hide();
    centerWindowResponsive(popupId);

    g_active_popup  = popupId;
    var action      = $("#signUp-dialog-called-from").val();
    var lockedPopup = ["member-signup-dialog", "streamline-signup-dialog", "first-signin-dialog", "email-signup-dialog"];

    if (action === 'session-expired' || (g_forceSignup && ($.inArray(popupId, lockedPopup) !== -1))) {
        $("#"+popupId).find('div.close').hide();
    }

    switch (popupId) {
        case "productImageList":
        case "profileImageList":
            $("#body").css("overflow","hidden");
            break;
        case "member-signup-dialog":
        case "streamline-signup-dialog":
            var arr      = ['addToBag','buynow-button','add-to-bag'];
            var headerId = "#signInHeader";
                        // reset popup text and button wording
            $('#signup-submit-button > .title').text('Sign Up');
            $(headerId).html(g_welcomeString);
            $("#"+popupId+" .accesscodeTitle").html(g_accesscodeTitle);

            if(g_sessionAccessCode !== "" && action === ""){
                if (g_sessionAccessCode === 'AMEXWOW' || g_sessionAccessCode === 'PLATINUM') {
                    g_welcomeString   = "Welcome to IfOnly";
                    g_accesscodeTitle = "Redeem your credit now for bespoke gifts and one-of-a-kind experiences.";
                } else if (g_sessionAccessCode === "TIERONEART"){
                    $('.social_icons,.continue-with').show();
                }
                $(headerId).html(g_welcomeString);
                $("#"+popupId+" .accesscodeTitle").html(g_accesscodeTitle);
            } else if(g_sessionAccessCode === "TIERONEART" && $.inArray(action,arr) !== -1){
                $(headerId).html("To redeem your Tier One art print,<br /> please continue below");
                $('#signup-submit-button > .title').text('Redeem');
                $('.social_icons, .continue-with').hide();
            } else {
                $("#signUp-dialog-called-from").val("");
                if( $.inArray(action,arr) !== -1)       { $(headerId).html("To add this item to your bag,<br /> please continue below");}
                else if( action === "add-under-500" )   { $(headerId).html("To redeem your offer and complete the checkout process, please continue below");}
                else if( action === "suggestion" )      { $(headerId).html("To suggest a dream,<br /> please continue below"); }
                else if( action === "celebrityMessage" ){ $(headerId).html("To send a message,<br /> please continue below"); }
                else if( action === "requestQuote" )    { $(headerId).html("To request a quote,<br /> please continue below"); }
                else if( action === "waitlist" )        { $(headerId).html("To waitlist for this item,<br /> please continue below"); }
                else if( action === "wishlist" )        { $(headerId).html("To add this item to your wishlist,<br /> please continue below"); }
                else if( action === "following" )       { $(headerId).html("To follow this luminary,<br /> please continue below"); }
                else if( action === "watchlist" )       { $(headerId).html("To watchlist this item,<br /> please continue below"); }
                else if( action === "placeBid" )        { $(headerId).html("To place a bid, please continue below"); }
                else if( action === "sweepstake-share" ){ $(headerId).html("To share this sweepstake, please continue below"); }
                else if( action === "crowdBuy-share" )  { $(headerId).html("To share this event, please continue below"); }
                else if( action === "memberAccess" )    { $(headerId).html("You must be a Member to view this"); }
                else if( action === "shopping-bag" )    { $(headerId).html("To view your shopping bag, please continue below"); }
                else if( action === "partialLogin")     { $(headerId).html("Welcome Back!");}
                else if( action === "session-expired")  { $(headerId).html("Welcome Back!"); $('#signInHeader_sub').html("Please login again. Your session has expired.");}
                //else if( action === "redemption")       { $(headerId).html("Redemption Signup mobile");  }
                else {
                    $(headerId).html(g_welcomeString);
                    $("#"+popupId+" .accesscodeTitle").html(g_accesscodeTitle);
                }
            }
            break;
        default:
            // ?
    }

    var opaqueMask = ["preview-dialog", "swap-image-dialog"];
    if ($.inArray(popupId, opaqueMask) !== -1) {
        var styles = {backgroundColor: "rgb(255, 255, 255)",opacity: ""};
        $('#exposeMask').css(styles);
    }

    $.post('/website/logPageView',{pageId:popupId},function(data){},'json');

    $('#exposeMask').fadeIn();
    //$('html,body').scrollTop(0);
    $('#'+popupId).fadeIn("200",function(){
        _fixMaskHeight();
    });
    _fixMaskHeight();

    return false;
}

//***************************** Filter codes ********************************

// used in filter to get the filter options

function getFilterOptions(trigger){
    var options = getFilterOptionsObj();

    if (trigger === undefined){
        trigger = "";
    }
    options['get'] = "";
    options['mobileMenu'] = (g_filter_from_mobile_menu)?1:0;
    $.ajax({
        type: "GET",
        headers: { "Cache-Control": "no-cache" },
        url: "/m/filter/getFilterOptions",
        dataType: 'json',
        data: options
    })
    .done(function(data) {
        if(data.result === 1) {
            // location filter section refresh
            if(g_is_mobile || g_filter_from_mobile_menu){
                //$("#filter .js-options-location").html(data.location);
                //priceSectionRefresh(data, true);
            }else{

                if(trigger !== "location"){
                    $("#filterPage .js-widget-popup.location div.js-widget-popup-content").html(data.location);
                }
                priceSectionRefresh(data);
            }
            //$(".price-ul").html(data.tpp);
            //markWishlistedProducts(wishlistProducts);
        }
    })
    .fail(function() {
        //window.location = link;
        console.log("error");
    });
}

function priceSectionRefresh(data, mobileViewOnly){
    if(mobileViewOnly === undefined ){
        mobileViewOnly = false;
    }

    if(mobileViewOnly){
        var preSelector = "#filter ";
    }else{
        var preSelector = "";
    }
    /*
    if( !g_is_mobile ){                                                  // only for desktop
        if($(preSelector+".price-toggle.price-total").hasClass("price-selected")){
            $(preSelector+".bottom-box .perPersonPrice").hide();
            $(preSelector+".bottom-box .price").show();
        }else{
            $(preSelector+".bottom-box .price").hide();
            $(preSelector+".bottom-box .perPersonPrice").show();
        }

        $(preSelector+".perPersonPrice").each(function(){
            $(this).addClass("no-prod");
        });
        var pppArray = $.parseJSON(data.ppp);
        for (index = 0; index < pppArray.length; ++index) {
            $obj = $(preSelector+".perPersonPrice[price='"+ pppArray[index] +"']");

            $obj.removeClass("no-prod");
        }
    }
    */

    /*
    $(preSelector+".totalPrice").each(function(){
        $(this).addClass("no-prod");
    });

    var tppArray = $.parseJSON(data.tpp);
    //console.log(data.tpp);
    for (index = 0; index < tppArray.length; ++index) {
        $obj = $(preSelector+".totalPrice[price='"+ tppArray[index] +"']");
        //console.log($obj.attr("price"));
        $obj.removeClass("no-prod");
    }
    */

    $(preSelector+".js-filter-people").each(function(){
        $(this).addClass("no-prod");
    });

    var ppiArray = $.parseJSON(data.ppi);
    //console.log(data.tpp);
    for (index = 0; index < ppiArray.length; ++index) {
        $obj = $(preSelector+".js-filter-people[data-value='"+ ppiArray[index] +"']");
        //console.log($obj.attr("price"));
        $obj.removeClass("no-prod");
    }
}


function selectOptionsBasedOnURL(getProductBasedOnOptions){

    if(getProductBasedOnOptions === undefined){
        getProductBasedOnOptions = false;
    }


    var url = window.location.pathname;
    var $current = $(".js-tiles-sec");
    var indexPos = url.indexOf("/options");
    var fromBackBtn = false;

    if (indexPos !== -1 ){  // load data from back button
        $current.html("");
        if(retrieveLocalStorage()){     // if can get g_category_products_and_collections from localStorage use it
            initiateFilterProducts($current, false, g_renderedTileIndex);
            backBtnFilterOptionsPreparing(url);
            fromBackBtn = true;
        }else if( (url.length > indexPos + 10) ){                          // otherwise ajax to get data
            if(g_is_mobile){
                $("#filter-overlay").show();
                $(".filterLoading").show();
            }else{
                $("#page-overlay").show();
                $("#loading").show();
            }

            var options = backBtnFilterOptionsPreparing(url);
            if(getProductBasedOnOptions){
                var optionsFromDom = getFilterOptionsObj();

                // kind of hard codes for now,
                // need to make it more modules
                if(optionsFromDom.pdzMasterPid !== undefined){
                    options['pdzMasterPid'] = optionsFromDom.pdzMasterPid;
                }

            }
            getFilteredProducts(options, "", false);
            fromBackBtn = true;
        }
    }
    if(!fromBackBtn) {    // not from back button

        if(getProductBasedOnOptions){
            var options = getFilterOptionsObj();
            getFilteredProducts(options);
        }else{
            initiateFilterProducts($current);
            populateLocalStorage();

            addIdentifierStrIntoUrlForBackBtn(url);
        }

    }else{
        if(getProductBasedOnOptions){
            getFilterOptions();
        }

    }

    filterSelectedHandling();

    if(!g_is_mobile && url.indexOf("/filter/l/") !== -1){
        getFilterOptions("");
    }
}




// Trigger changeUrlWhenClickOption function in different parameters
function choseBasedOnType($obj, urlObj){

    if(urlObj === undefined){
        urlObj = "";
    }

    // Change URL for back button
    if($obj.hasClass("js-filter-location")){
        changeUrlWhenClickOption($obj.attr("data-name"), $obj.attr("data-value"), "", urlObj);
    }else if($obj.hasClass("js-filter-collection")){
        changeUrlWhenClickOption($obj.attr("data-name"), $obj.attr("data-value"), "", urlObj);
    }else if($obj.hasClass("totalPrice")){
        changeUrlWhenClickOption("totalPrice", $obj.attr("price"), "", urlObj);
    }else if($obj.hasClass("js-filter-price")){
        changeUrlWhenClickOption("perPersonPrice", $obj.attr("data-value"), "", urlObj);
    }else if($obj.hasClass("selected-luminary")){
        changeUrlWhenClickOption("selected-luminary", $obj.attr("celebid"), "", urlObj);
    }else if($obj.hasClass("selected-charity")){
        changeUrlWhenClickOption("selected-charity", $obj.attr("charityid"), "", urlObj);
    }else if($obj.hasClass("js-filter-people")){
        changeUrlWhenClickOption($obj.attr("data-name"), $obj.attr("data-value"), "", urlObj);
    }else if($obj.hasClass("js-useObj")){
        changeUrlWhenClickOption($obj.attr("data-name"), "useObj", $obj, urlObj);
    }

}


function changeUrlWhenClickOption(name, value, $obj, urlObj){
    var returnUrl = false;
    var url = window.location.pathname;

    if(urlObj === undefined || urlObj === ""){
        // use default
    } else {
        returnUrl = true;
        url = urlObj.url;
    }


    if(value === "useObj" && $obj.hasClass("js-availability-type")){
        var re = new RegExp("notIncludeUnSure"+"\/(.*?)\/", 'i');
        url = url.replace(re,"");
    }

    if(value === "useObj" && $obj.hasClass("js-filter-keyword")){
        if(url.indexOf("/keywordUrl/") !== -1){
            var re = new RegExp("keywordUrl"+"\/(.*?)\/", 'i');
            url = url.replace(re,"");
        }
        if(url.indexOf("/noKeyword/") !== -1){
            var re = new RegExp("noKeyword"+"\/(.*?)\/", 'i');
            url = url.replace(re,"");
        }
    }

    if (url.indexOf("options") === -1){
        if(url.slice(-1) === "/"){
            url = url.slice(0,-1);
        }
        url = url + "/options/";
    }

    if (url.indexOf("/"+name) !== -1){
        var re = new RegExp(name+"\/(.*?)\/", 'i');
        var strObj = {str:""};
        if(value === "useObj"){
            formUrlPath($obj, strObj);
        } else{

            if(g_filter_from_mobile_menu){
                $("#filter ul li[data-name="+name+"].filter-selected").each(function(){
                    formUrlPath($(this), strObj);
                });
            }else{
                $("#filterPage ul li[data-name="+name+"].filter-selected").each(function(){
                    formUrlPath($(this), strObj);
                });
            }
        }
        if(strObj.str === "_"){
            strObj.str = "";
        }
        if(strObj.str !== ""){
            strObj.str = strObj.str.substring(0, strObj.str.length - 1);
            strObj.str = name + "/" + strObj.str + "/";
        }
        url = url.replace(re,strObj.str);
    }else{
        if(value === "useObj"){
            value = "";
            if($obj.hasClass("js-filter-keyword") && !$obj.hasClass("filter-selected")){
                name  = "noKeyword";
                value = "true";
            }else{
                value = $obj.attr("data-value");
            }
        }
        if(value !== "" && value !== undefined){
            url = url + name + "/" + value + "/";
        }
    }

    // If select totalPrice option, perPersonPrice options will be clear
    if(name === "totalPrice"){
        var re = new RegExp("perPersonPrice"+"\/(.*?)\/", 'i');
        url = url.replace(re,"");
    }else if(name === "perPersonPrice"){
        var re = new RegExp("totalPrice"+"\/(.*?)\/", 'i');
        url = url.replace(re,"");
    }

    g_link = url;

    if (returnUrl) {
        urlObj.url = url;
    } else {
        if ( ! $.browser.msie) {
            window.history.pushState({page:url}, "page title",url);
        }
    }


}

function addIdentifierStrIntoUrlForBackBtn(url){


    // append options when page loaded to utilize the localStorage for back btn
    if (url.indexOf("options") === -1 && $.browser == undefined){
        setTimeout(function(){
            addIdentifierStrIntoUrlForBackBtn(url);
        }, 3000);
    } else if (url.indexOf("options") === -1){

        var selector = "#filterPage ";
        if (g_is_mobile || g_filter_from_mobile_menu){
            selector = "#filter ";
        }

        var urlObj = {url:url};

        $(selector+".filter-selected").each(function(){
            choseBasedOnType($(this), urlObj);
        });
        if ( ! $.browser.msie) {
            window.history.pushState({page:urlObj.url}, "page title",urlObj.url);
        }
    }

}


function formUrlPath($obj, strObj){
    if($obj.hasClass("js-filter-disc-item")){
        strObj.str += $obj.attr("data-value") + "_";
    }else if($obj.hasClass("js-filter-location")){
        strObj.str += $obj.attr("data-value") + "_";
    }else if($obj.hasClass("js-filter-collection")){
        strObj.str += $obj.attr("data-value") + "_";
    }else if($obj.hasClass("totalPrice")){
        strObj.str += $obj.attr("price") + "_";
    }else if($obj.hasClass("perPersonPrice")){
        strObj.str += $obj.attr("price") + "_";
    }else if($obj.hasClass("selected-luminary")){
        strObj.str += $obj.attr("celebid") + "_";
    }else if($obj.hasClass("selected-charity")){
        strObj.str += $obj.attr("charityid") + "_";
    }else if($obj.hasClass("keywordUrl")){
        strObj.str += $obj.attr("keyword") + "_";
    }else if($obj.hasClass("js-filter-people")){
        strObj.str += $obj.attr("data-value") + "_";
    }else if($obj.hasClass("js-filter-availability")){
        strObj.str += $obj.attr("data-value") + "_";
    }else if($obj.hasClass("toDate")){
        strObj.str += $obj.val()+ "_";//console.log("111");
    }else if($obj.hasClass("js-sortBy")){
        if($obj.val() !== ""){
            strObj.str = $obj.val()+ "_";//console.log("111");
        }
    }else{
        strObj.str += $obj.attr("data-value") + "_";
    }
    /*else if($obj.hasClass("js-availability-type")){
        if(!$obj.prop("checked")){
            strObj.str = "1"+ "_";//console.log("111");
        }
    }
    */
    //console.log(strObj.str);
}

function getSlideValueBasedOnPriceValue(price){
    var slideValue = 1;
    if(price == 5){
        slideValue = 2;
    }else if(price > 5 && price <= 400){
        slideValue = 2 + price/20;
    }else if(price > 400 && price <= 1000 ){
        slideValue = 20 + (price - 400) / 50;
    }else if(price > 1000 && price <= 2000){
        slideValue = 32 + (price - 1000) / 100;
    }else if(price > 2000 && price <= 10000){
        slideValue = 42 + (price - 2000) / 500;
    }else if(price > 10000){
        slideValue = 60;
    }

    return slideValue;
}

function backBtnFilterOptionsPreparing(url){

    var $obj;
    var options = { catString:"", geoString:"", ttpString:"", pppString:"",
                    shpString:"",
                    ppiString:"", lumString:"", chaString:"", keyword:"", date:"",
                    notIncludeUnSure:0, sortBy:""};
    var selector = "#filterPage ";
    if (g_is_mobile || g_filter_from_mobile_menu){
        selector = "#filter ";
    }

    if (url.indexOf("/category") !== -1){
        $(selector+".js-filter-disc-item.filter-selected").removeClass("filter-selected");
        var re = new RegExp("category\/(.*?)\/", 'i');
        var str = url.match(re)[1];
        options.catString = str;
        $obj = $(selector+".js-filter-disc-item[data-value='"+ str +"']");

        if($obj.length > 0){
            $obj.addClass("filter-selected");
        }

        if(g_is_mobile || g_filter_from_mobile_menu){
            filterMenuCatIdHandling(str, false, false);

            // mobile disc widget populating
            mobileDiscWidgetPreparing();
        }
    }else{
        $(selector+".js-filter-disc-item.filter-selected").removeClass("filter-selected");
    }

    if (url.indexOf("/collection") !== -1){
        $(selector+".js-filter-collection .js-io-checkBox.select").removeClass("select");
        $(selector+".js-filter-collection.filter-selected").removeClass("filter-selected");
        var re = new RegExp("collection\/(.*?)\/", 'i');
        var str = url.match(re)[1];
        options.shpString = str.replace(/_/gi,",");
        var arr = str.split("_");
        for (index = 0; index < arr.length; ++index) {
            $obj = $(selector+".js-filter-collection[data-value='"+ arr[index] +"']");
            //console.log($obj.attr("price"));
            if($obj.length > 0){
                $obj.addClass("filter-selected");
                $obj.find(".js-io-checkBox").addClass("select");
            }
        }
    }else{
        $(selector+".js-filter-collection .js-io-checkBox.select").removeClass("select");
        $(selector+".js-filter-collection.filter-selected").removeClass("filter-selected");
    }

    if (url.indexOf("/location") !== -1){
        var re = new RegExp("location\/(.*?)\/", 'i');
        var str = url.match(re)[1];
        options.geoString = str.replace(/_/gi,",");
        var arr = str.split("_");
        for (index = 0; index < arr.length; ++index) {
            $obj = $(selector+".js-filter-location[data-value='"+ arr[index] +"']");
            $(selector+".js-checkbox-options li.js-filter-location.js-all-location").removeClass("filter-selected");
            $(selector+".js-filter-location.js-all-location input.js-io-checkBox").removeClass("select");
            geoSelectedArray.push(arr[index]);
            //console.log($obj.attr("price"));
            if($obj.length > 0){
                $obj.addClass("filter-selected");
                $obj.find(".js-io-checkBox").addClass("select");
            }else{

            }
        }
    }else{
        $(selector+".js-filter-location.filter-selected input.js-io-checkBox").removeClass("select");
        $(selector+".js-checkbox-options li.js-filter-location.filter-selected").removeClass("filter-selected");
        $(selector+".js-checkbox-options li.js-filter-location.js-all-location").addClass("filter-selected");
        $(selector+".js-filter-location.js-all-location input.js-io-checkBox").addClass("select");
    }



    if (url.indexOf("/totalPrice") !== -1){
        var re = new RegExp("totalPrice\/(.*?)\/", 'i');
        var str = url.match(re)[1];
        options.ttpString = decodeURI(str.replace(/_/gi,","));
        var arr = str.split("_");
        for (index = 0; index < arr.length; ++index) {
            $obj = $(selector+".totalPrice[price='"+ decodeURI(arr[index]) +"']");
            if($obj.length > 0){
                $obj.addClass("filter-selected");
            }
        }
    }

    if (url.indexOf("/perPersonPrice") !== -1){
        //$(".total-perPerson .price-perPerson").click();
        var re = new RegExp("perPersonPrice\/(.*?)\/", 'i');
        var str = url.match(re)[1];
        str = str.replace("%3E", ">");
        options.pppString = str;
        $obj = $(selector+".js-filter-price");
        $obj.attr("data-value",str);
        if(str.indexOf(">") !== -1){
            var arr = [];
            arr[0] = parseInt(str.slice(0, -1));
            arr[1] = parseInt($obj.attr("data-range-max"));
        } else if(str.indexOf("%3E") !== -1){
            var arr = [];
            arr[0] = parseInt(str.slice(0, -3));
            arr[1] = parseInt($obj.attr("data-range-max"));
        }else{
            var arr = str.split("-");
            arr[0] = parseInt(arr[0]);
            arr[1] = parseInt(arr[1]);

        }

    }else{
        $obj = $(selector+".js-filter-price");
        $obj.attr("data-value","1>");
        var arr = [];
        arr[0] = 1;
        arr[1] = 10001;
    }
    var minSlideValue = getSlideValueBasedOnPriceValue(arr[0]);
    var maxSlideValue = getSlideValueBasedOnPriceValue(arr[1]);

    $obj.attr("data-min",minSlideValue);
    $obj.attr("data-max",maxSlideValue);
    var $sibling = $obj.siblings(".js-price-attr");
    $sibling.find(".js-min-price").attr("data-value", arr[0]);
    //$sibling.find(".js-min-price").text("$"+ui.values[0]);
    $sibling.find(".js-min-price").text("$"+addCommas(arr[0]));
    if(arr[1] > parseInt($sibling.attr("data-show-max"))){
        $sibling.find(".js-max-price").attr("data-value", $sibling.attr("data-show-max")+"+");
        //$sibling.find(".js-max-price").text("$"+$sibling.attr("data-show-max")+"+");
        $sibling.find(".js-max-price").text("$"+addCommas($sibling.attr("data-show-max"))+"+");
    }else{
        $sibling.find(".js-max-price").attr("data-value", arr[1]);
        //$sibling.find(".js-max-price").text("$"+ui.values[1]);
        $sibling.find(".js-max-price").text("$"+addCommas(arr[1]));
    }

    $obj.attr("data-text", $sibling.find(".js-min-price").text()+" - "+$sibling.find(".js-max-price").text());
    //$obj.slider("values", [parseInt(arr[0]), parseInt(arr[1])]);
    //$obj.slider("option", "slide").call($obj, null, { values: $obj.slider("values") });
    $obj.addClass("filter-selected");




    if (url.indexOf("/keywordUrl") !== -1){
        var re = new RegExp("keywordUrl/(.*?)\/", 'i');
        var str = url.match(re)[1];
        options.keyword = str.replace(/_/gi,",");
        var arr = str.split("_");
        $obj = $(selector+".keywordUrl[keyword='"+ options.keyword +"']");
        //console.log($obj.attr("price"));
        if($obj.length > 0){
            $obj.addClass("filter-selected");
        }
    }else{
        $obj = $(selector+".js-filter-keyword");
        //console.log($obj.attr("price"));
        if($obj.length > 0){
            $obj.removeClass("filter-selected");
        }
        $obj = $("#filterPage .js-filter-hint[data-mapping=keyword]");
        if($obj.length > 0){
            $obj.remove();
        }
    }
    if (url.indexOf("/noKeyword") !== -1){
        $obj = $(selector+".js-filter-keyword");
        //console.log($obj.attr("price"));
        if($obj.length > 0){
            $obj.removeClass("filter-selected");
        }
        $obj = $("#filterPage .js-filter-hint[data-mapping=keyword]");
        if($obj.length > 0){
            $obj.remove();
        }
    }


    if (url.indexOf("/peoplePerItem") !== -1){
        var re = new RegExp("peoplePerItem\/(.*?)\/", 'i');
        var str = url.match(re)[1];
        options.ppiString = decodeURI(str.replace(/_/gi,","));
        var arr = str.split("_");
        for (index = 0; index < arr.length; ++index) {
            $obj = $(selector+".js-filter-people[data-value='"+ decodeURI(arr[index]) +"']");
            if($obj.length > 0){
                $obj.addClass("filter-selected");
            }
        }
    }else{
        $(selector+".js-filter-people.filter-selected").removeClass("filter-selected");
    }


    if (url.indexOf("/date") !== -1){
        $(selector+".js-filter-availability.filter-selected").removeClass("filter-selected");
        var re = new RegExp("date\/(.*?)\/", 'i');
        var str = url.match(re)[1];
        options.date = str;
        if(str.indexOf("_") !== -1){
            $obj = $(selector+".js-filter-date-range");
            var arr = str.split("_");
            var fromDate = new Date(arr[0]);
            var toDate   = new Date(arr[1]);
            $obj.attr("data-value",str);
            $obj.attr("data-filter-from", short_monthNames[fromDate.getMonth()]+ " "+fromDate.getDate());
            $obj.attr("data-filter-to", short_monthNames[toDate.getMonth()]+ " "+toDate.getDate());
        }else{
            if(g_is_mobile || g_filter_from_mobile_menu){
                $obj = $(selector+".js-filter-preset");
                $obj.attr("data-value",str);
                var text = "";
                switch(str){
                    case "weekdays":
                        text = "Weekdays Only";
                        break;
                    case "weekends":
                        text = "Weekends Only";
                        break;
                    case "nexttwoweeks":
                        text = "Next 2 weeks";
                        break;
                    case "nextthreemonths":
                        text = "Next 3 Months";
                        break;
                    case "nextmonth":
                        text = "Next Month";
                        break;
                    case "nextsixmonths":
                        text = "Next 6 Months";
                        break;
                }
                $obj.text(text);
            }else{
                $obj = $(selector+".js-filter-availability[data-value='"+ str +"']");
            }

        }

        if($obj.length > 0){
            $obj.addClass("filter-selected");
        }
    }else{
        $(selector+".js-filter-availability.filter-selected").removeClass("filter-selected");
    }

    if (url.indexOf("/sortBy") !== -1 ){
        var re = new RegExp("sortBy\/(.*?)\/", 'i');
        var str = url.match(re)[1];
        options.sortBy = str;
        $(selector+".js-filter-sort[data-value='"+ str +"']").addClass("filter-selected");

    }else{
        $(selector+".js-filter-sort.filter-selected").addClass("filter-selected");
    }
    return options;
}


function isLocalStorageAvailable(){
    if( Storage !== undefined ){
        try {
            sessionStorage.setItem("test", '1' );
            sessionStorage.removeItem("test");
            g_localStorage_available = true;
        } catch (error){
            g_localStorage_available = false;
        }
    }else{
        g_localStorage_available = false;
    }
}
isLocalStorageAvailable();


function populateLocalStorage(params){
    if( g_localStorage_available ){
        if(params !== undefined){
            if(params.tileIndexOnly){
                sessionStorage.setItem("renderedTileIndex", g_cat_pro_col_index );
            }
        }else{
            sessionStorage.setItem("filterTiles", JSON.stringify(g_category_products_and_collections) );
            sessionStorage.setItem("filterTilesTotalCnt", $("#totalCnt").val() );
            sessionStorage.setItem("loadedBCnt", $("#loadedBCnt").val() );
            sessionStorage.setItem("loadedPCnt", $("#loadedPCnt").val() );
            sessionStorage.setItem("listType", g_currentListType);

        }

        return true;
    }else{
        return false;
    }
}


function retrieveLocalStorage(){
    if( g_localStorage_available ){
        var oldListType = sessionStorage.getItem("listType");
        if(oldListType != g_currentListType){
            return false;
        }
        var temp = JSON.parse(sessionStorage.getItem("filterTiles"));
        if(temp){
            g_category_products_and_collections = temp;
            if(g_category_products_and_collections){    // can get filterTiles from sessionStorage
                $("#totalCnt").val(sessionStorage.getItem("filterTilesTotalCnt"));
                $(".js-totalTilesCnt").text($("#totalCnt").val());
                $("#filterProductsCnt").text(": "+$("#totalCnt").val()+" Listings");
                $("#loadedBCnt").val(sessionStorage.getItem("loadedBCnt"));
                $("#loadedPCnt").val(sessionStorage.getItem("loadedPCnt"));
                if($("#totalCnt").val() > g_category_products_and_collections.length){
                    $("#needMoreTiles").val(1);
                }else{
                    $("#needMoreTiles").val(0);
                }
                g_renderedTileIndex = sessionStorage.getItem("renderedTileIndex");

                return true;
            }else{
                return false;
            }
        }

    }else{
        return false;
    }

}


function isImgCache(url){
    var test = document.createElement("img");
    test.src = url;
    return test.complete || test.width+test.height > 0;
}



function filterDesktopWidgetTextHandling($obj){
    if(!g_filter_from_mobile_menu){
        var $text = $obj.closest(".js-d-filter-widget").find(".js-widget-text");

        var html = "";
        if($obj.hasClass("js-filter-disc-item")){
            if($obj.hasClass("filter-selected")){
                html = $obj.children("p").html();
            }else{
                html = $text.attr("data-original-text");
            }

        }else if($obj.hasClass("js-filter-location")){
            var length = $obj.closest(".js-checkbox-options").find(".js-filter-location.filter-selected").length;
            if(length > 1){
                html = "LOCATION ("+length+")";
            }else if(length === 1){
                html = $obj.closest(".js-checkbox-options").find(".js-filter-location.filter-selected .js-label").text();
                if(html.indexOf(' (') !== -1){
                    html = html.substr(0, html.indexOf(' ('));
                }
            }else{
                html = $text.attr("data-original-text");
            }
        }else if($obj.hasClass("totalPrice")){

        }else if($obj.hasClass("js-filter-price")){
            if($obj.attr("data-value") === "1>"){
                html = $text.attr("data-original-text");
            }else{
                html = $obj.attr("data-text");
            }

        }else if($obj.hasClass("selected-luminary")){

        }else if($obj.hasClass("selected-charity")){

        }else if($obj.hasClass("js-filter-people")){
            if($obj.hasClass("filter-selected")){
                html = $obj.find("span").text();
            }else{
                html = $text.attr("data-original-text");
            }
        }else if($obj.hasClass("js-filter-availability")){
            if($obj.hasClass("filter-selected")){
                if($obj.hasClass("js-filter-date-range")){
                    html = $obj.attr("data-filter-from") + " - "+ $obj.attr("data-filter-to") ;
                }else{
                    html = $obj.text();
                }

            }else{
                html = $text.attr("data-original-text");
            }

        }else if($obj.hasClass("js-filter-sort")){
            if($obj.hasClass("filter-selected")){
                html = $obj.find("span").text();
            }else{
                html = $text.attr("data-original-text");
            }

        }

        if(html !== ""){
            $obj.closest(".js-d-filter-widget").find(".js-filter-text-row .js-widget-text").html(html);
        }
    }
}

function filterSelectedHandling(){
    if(g_is_mobile || g_filter_from_mobile_menu){
        var filterMenu = true;
        var selector = "#filter .filter-selected";
    }else{
        var filterMenu = false;
        var selector = "#filterPage .filter-selected";
    }
    $(selector).each(function(){
        if( filterMenu && $(this).hasClass("js-filter-disc-item") ){
           if($("#js-filter-menu-discId .js-filter-disc-item").length === 1
            && $("#js-filter-menu-discId .js-filter-disc-item").attr("data-value") !== $(this).attr("data-value")){
               filterHintAdd($(this));
           }else{
               // do nothing
           }
        }else{
            //console.log($(this));
            filterHintAdd($(this));
        }

        if(!filterMenu){
            filterDesktopWidgetTextHandling($(this));
        }

    });

    if(filterMenu){

        // hint text clearing
        if($("#filterPage .js-filter-hint:visible").length > 0){
            if($("#filterPage .js-disc-hints .js-filter-hint").length > 0){
                if($("#filterPage .js-hint-clear .js-filter-hint:visible").length > 0){
                    $("#filterPage .js-disc-hints .js-filter-hint").show();
                    $("#filterPage .js-hint-clear .js-filter-hint:visible:first").find(".js-comma").css("visibility", "hidden");
                }else{
                    $("#filterPage .js-disc-hints .js-filter-hint").hide();
                }
            }else{
                if($("#filterPage .js-hint-clear .js-filter-hint:visible").length > 0){
                    $("#filterPage .js-hint-clear .js-filter-hint:visible:first").find(".js-comma").hide();
                }
            }
        }

    }
}

function desktopFilterShowBlocksForBackBtn(){
    // back button handling for show blocks
    var idx = 0;                                // increase when view more button is clicked
    if (g_link.indexOf("/block/") !== -1) {
        var re = new RegExp("/block"+"\/(.*?)\/", 'i');
        idx = parseInt(g_link.match(re)[1]);
    }
    if(idx > 0 && idx < 3){
        $("#wall_0 .pages > div").each(function(){
            if ($(this).attr('idx') <= idx && $(this).attr('idx') != 0 ) {
                showBlock_0($(this));
            }
        });
    }
}

function initiateFilterProducts($obj, data, renderNumber){
    if(data === undefined){
        data = false;
    }

    if(data){
        lazyLoadCleaning(g_currentListType, true);
        lazyLoadDataHandling(g_currentListType, data);
    }

    var params = {};
    if(renderNumber !== undefined ){
        params['renderNumber'] = renderNumber;
    }
    populate_product_collection_tiles(0, "", $obj, true, params);

}

//*******************************************
// *  When from back button, geoSelectedArray is somehow reSet to empty
// *  Need to reGet based on selected Geo li
//*******************************************
function reGetGeoSelectedArray($obj, filter){
    if(geoSelectedArray.length === 0){
        if(g_filter_from_mobile_menu){
            var selector = "#filter ";
        }else{
            var selector = "#filterPage ";
        }
        $(selector+".location-ul li.filter-selected").each(function(){
            geoSelectedArray.push($(this).attr("data-value"));
        });
    }

}

function filterSectionUpdate(data){
    if(!g_catId){ // from search result page - both desktop and mobile filter result page
                  // not refesh price option in mobile category page ( filter on top of mobile category page )

        // price filter section refresh
        priceSectionRefresh(data);
    }

    // refresh collection section - only for desktop for now - 10/20/2014
    // may include collection in mobile filter latter
    if(!g_is_mobile){
       $(".collection-ul").html(data.collections);
    }
    // location filter section refresh
    $(".location-ul").html(data.location);
}

function filterSelect(){
    var preSelector = (g_is_mobile)? "#filter ":"#filterPage ";
    //console.log(geoSelectedArray);
    /*
    for (index = 0; index < tppSelectedArray.length; ++index) {
        $obj = $(preSelector+".totalPrice[price='"+ tppSelectedArray[index] +"']");
        if($obj.length > 0){
            $obj.addClass("filter-selected");
            $obj.children(".filter-close").show();
        }
    }
    */
    /*
    if(!g_is_mobile){
        for (index = 0; index < pppSelectedArray.length; ++index) {
            $obj = $(preSelector+".perPersonPrice[price='"+ pppSelectedArray[index] +"']");
            if($obj.length > 0){
                $obj.addClass("filter-selected");
                $obj.children(".filter-close").show();
            }
        }
    }
    */
    if(ppiSelectedArray){
        for (index = 0; index < ppiSelectedArray.length; ++index) {
            $obj = $(preSelector+".js-filter-people[data-value='"+ ppiSelectedArray[index] +"']");
            if($obj.length > 0){
                $obj.addClass("filter-selected");
            }
        }
    }

    if(geoSelectedArray){
        for (index = 0; index < geoSelectedArray.length; ++index) {
            $obj = $(preSelector+".js-filter-location[data-value='"+ geoSelectedArray[index] +"']");
            if($obj.length > 0){
                $obj.addClass("filter-selected");
                //$obj.children(".filter-close").show();
            }
        }
    }

}

function loadingStart(){
    $("#page-overlay").show();
    $("#loading").show();
}

function loadingEnd(){
    $("#page-overlay").hide();
    $("#loading").hide();
}


function ajaxFilterProducts(options, triger){
    console.log("ajax to get ps");
    var thisTrigger = triger;
    loadingStart();
    var $current    = $("#filterPage .js-tiles-sec");
    var filterUrl   = "/filter/getProductsForFilterPage";


    options['filterOnlyType']       = g_filter_only_type;
    options['request_data_only']    = 1;
    options['mobileMenu']           = (g_filter_from_mobile_menu)?1:0;

    g_filter_get_products_ajax = $.ajax({
        type: "GET",
        url: filterUrl,
        dataType: 'json',
        cache: false,
        data: options,
        success: function(data) {
            $current.html('');
            if($.isEmptyObject(g_filter_get_products_ajax_data)){

                if(data.result === 1) {
                    $("#totalCnt").val(data.totalCnt);
                    initiateFilterProducts($current, data.data);
                    $(".js-totalTilesCnt").html(data.totalCnt);

                    //$("#totalCnt").val(data.totalCnt);

                    /*
                    if($(".hide-or-show.loc").html() == "hide"){
                        $(".js-filter-location.closed span").css("visibility","visible");
                        $(".js-filter-location.closed").slideDown("slow");
                    }
                    */

                    // change productTotalCnt and displayCnt



                    if(g_is_mobile || g_filter_from_mobile_menu){
                        $("#filterProductsCnt").text(": "+data.totalCnt + " Listings");
                        $("#filterProductsCnt").attr("data-value",data.totalCnt);
                    }

                    if(thisTrigger !== "sortBy"){
                        getFilterOptions(thisTrigger);
                    }


                    if(data.totalCnt == 0){

                        $(".js-filter-no-results").show();

                    }else{
                        $(".js-filter-no-results").hide();

                    }


                }
                loadingEnd();
                populateLocalStorage();
            }else{


                console.log("ajax to get queue filter products ");
                ajaxFilterProducts(g_filter_get_products_ajax_data, thisTrigger);
                g_filter_get_products_ajax_data = {};
            }


        },
        error: function(msg) {
            //window.location = link;
            console.log("error");
            loadingEnd();
        }
    });
}


function getFilteredProducts(options, trigger, pCntOnly){
    if(pCntOnly === undefined){
        pCntOnly = false;
    }

    if(trigger === undefined){
        trigger = "";
    }

    if(pCntOnly){
        var filterUrl      = "/m/filter/getProductsForFilterPage";
        $("#filter .js-apply").addClass("disabled");
        options['filterOnlyType'] = g_filter_only_type;
        options['cntOnly']        = 1;
        options['mobileMenu']     = (g_filter_from_mobile_menu)?1:0;
        $.ajax({
            type: "GET",
            url: filterUrl,
            dataType: 'json',
            cache: false,
            data: options,
            success: function(data) {

                if(data.result === 1){
                    $("#filter .filter-result-cnt").slideDown();
                    $("#filterProductsCnt").text(": "+data.totalCnt + " Listings");
                    $("#filterProductsCnt").attr("data-value",data.totalCnt);
                }

                if(data.totalCnt > 0){
                    $("#filter .js-apply").removeClass("disabled");
                }
                hideLoading();

            },
            error: function(msg) {
                $("#filter .js-apply").removeClass("disabled");
                hideLoading();
            }
        });
    }else{

        if(g_filter_get_products_ajax != ""
            && g_filter_get_products_ajax.readyState !== undefined
            && g_filter_get_products_ajax.readyState !== 4
        ){
            console.log("queue the ajax requests");
            g_filter_get_products_ajax_data = options;
            return false;
        }else{
            ajaxFilterProducts(options, trigger);
        }

    }
}
//***************************** Filter codes ********************************

//*******************************************
// get the jquery object for a product
//*******************************************
function get_product_dom(product, template_obj, show_celebrity, urlAppended){

    if ( typeof(show_celebrity) === "undefined") {    show_celebrity = false;  }
    if ( urlAppended === undefined ) { urlAppended = ""; }
    if(g_renderedTileIndex != 0 && g_renderedTileIndex >= g_cat_pro_col_index){
        var mayNotNeedLazyLoad = true;
    }else{
        var mayNotNeedLazyLoad = false;
    }

    //var product_html = template_obj.html();
    var product_dom = template_obj.clone();

    product_dom.find(".js-product-title").attr('href', (g_is_mobile && !g_isTablet ? '/m' : '') + product.productUrl + urlAppended);
    product_dom.find(".js-product-title").attr('pid', product.productId);

    if(g_cat_pro_col_index < g_no_lazysize_img_cnt || (mayNotNeedLazyLoad && isImgCache(product.productThumbImgSrc))){
        product_dom.find('.product_img').removeClass("js-lazyload");
        product_dom.find('.product_img').attr('src', product.productThumbImgSrc);   //   '/media/celebrities/971/products/santana_record_302x246.jpg'
    }else{
        product_dom.find('.product_img').attr('data-src', product.productThumbImgSrc);   //   '/media/celebrities/971/products/santana_record_302x246.jpg'

    }
    product_dom.find('.celeb_img').attr('data-src', product.celebImgSrc ).css('display', (show_celebrity?'block':'none'));  //  '/media/celebrities/998/j_cole_ifonly_177x177.jpg'

    product_dom.find('.heart_img').attr('pid', product.productId);
    if(product.wishlistStatus==true){
        product_dom.find('.heart_img').addClass('listed');
    }
    else{
        product_dom.find('.heart_img').removeClass('listed');
    }

    if(product.buyType!=undefined && product.buyType!=''){
        product_dom.find('.buy_type').css('display', 'block');
        product_dom.find('.buy_type_text span').html(product.buyType);
    }

    product_dom.find('.product_celeb_name').html(product.displayName);          // display name is celebrity name

    product_dom.find('.product_location').html(product.geographicName );

    product_dom.find('.product_title p').html( product.pDisplayName);

    product_dom.find('.product_price').html( product.displayPrice );

    return product_dom.html();

}


//get_productization_product_dom

function get_productization_product_dom(product, template_obj){



    //var product_html = template_obj.html();
    var product_dom = template_obj.clone();

    product_dom.find(".luminary_img").attr("data-src", product.celebImgSrc);
    product_dom.find("a.luminary_img_box").attr("href", product.celebrityUrl).attr('celebId',  product.celebId);
    product_dom.find(".luminary_name").html(product.displayName).attr('data-celebId', product.celebId);
    product_dom.find(".charity_name").html(product.charityName).attr('data-charityId', product.charityId);
    product_dom.find(".bio_row").html(product.celebDescription);
    product_dom.find(".quote_row").html(product.vendorSalesPitch);

    if(product.geographicName!=='' || product.locationCity!==''){
        //var location_array = [];
        //if($.trim(product.geographicName)!=''){location_array.push($.trim(product.geographicName));}
        //if($.trim(product.locationCity)!=''){location_array.push($.trim(product.locationCity));}
        //var location_str = location_array.join(',');

        var location_str = '';
        if($.trim(product.geographicName)!==''){
            location_str=$.trim(product.geographicName);
        }
        else if($.trim(product.locationCity)!==''){
            location_str=$.trim(product.locationCity);
        }

        if(location_str!==''){
            product_dom.find('.location_td span').html(location_str);
            product_dom.find('.location_td').show();
        }
    }


    if(product.peoplePerItemMax!='' && product.peoplePerItemMax!=null){
        var guest_str = 'Up to ' + product.peoplePerItemMax + ' ' + (product.peoplePerItemMax>1?'people':'person');
        product_dom.find('.guests_td span').html(guest_str);
        product_dom.find('.guests_td').show();
    }


    var duration = '';
    if(product['durationMinutesMin_display']!='' || product['durationMinutesMax_display']!=''){
        var duration_array = [];
        if($.trim(product['durationMinutesMin_display'])!=''){
            duration_array.push($.trim(product['durationMinutesMin_display'])) ;
        }
        if($.trim(product['durationMinutesMax_display'])!='' && $.trim(product['durationMinutesMax_display'])!= $.trim(product['durationMinutesMin_display']) ){
            duration_array.push($.trim(product['durationMinutesMax_display']));
        }
        duration = duration_array.join(' - ');


    }
    else if($.trim(product['durationMinutes_display'])!=''){
        duration = $.tirm(product['durationMinutes_display']);
    }
    if(duration!=''){
        product_dom.find('.duration_td span').html(duration);
        product_dom.find('.duration_td').show();
    }



    product_dom.find('.price_text').html(product.displayPrice);

    product_dom.find('.js-productId-to-add').val(product.productId);

    //update following button:
    var follow_btn = product_dom.find('.button.follow')
    follow_btn.attr('data-id', product.celebId);
    var following = false;
    for(var i=0; i<g_followingCelebIds.length; i++){
        if(product.celebId == g_followingCelebIds[i] ){
            following = true;
            break;
        }
    }

    if(following){
        follow_btn.addClass('following').removeClass('primaryButton').addClass('secondaryButton');
        follow_btn.find('.greenCheck').show();
        follow_btn.find('.following-text').html('FOLLOWING');
    }
    else{
        follow_btn.addClass('following').addClass('primaryButton').removeClass('secondaryButton');
        follow_btn.find('.greenCheck').hide();
        follow_btn.find('.following-text').html('FOLLOW');
    }



    return product_dom.html();

}


// get the jquery object for a collection
function get_collection_dom(collection, template_obj){

    var collection_html = template_obj.html();
    var collection_dom = $(collection_html );

    collection_dom.attr('href', (g_is_mobile ? '/m' : '') + collection.collectionUrl);
    collection_dom.find('.collection_img').attr('data-src', collection.collectionImageSrc);   // collection.collectionImageSrc '/media/celebrities/971/products/santana_record_302x246.jpg'

    collection_dom.find('.collection_title').html( collection.title );         // collection.catDisplayName 'SAN FRANCISCO is really a beautiful city. do you believe it? come and have a visit!'
    collection_dom.find('.collection_description').html( collection.subtitle );    //    'Inspired Experiences with Local Luminaries'

    return collection_dom.html();

}

function get_ad_dom(ad, template_obj){
    var ad_html = template_obj.html();
    var ad_dom = $(ad_html );

    if(ad.itemTargetUrl!=''){
        ad_dom.attr('href', ad.itemTargetUrl);
    }
    ad_dom.find('.tile_img').attr('data-src', ad.imgSource);   //

    return ad_dom.html();
}

// event handler for the 'add to bag' button on Productized PDP page
function add_productized_product_to_cart(add_btn_dom){
    var $add_btn = $(add_btn_dom);
    var pid_str = $.trim($add_btn.siblings(".js-productId-to-add").val());
    if(g_is_guest){
        if(pid_str!=''){
            $("#signUp-dialog-called-from").val("buynow-button");
            g_guest_productId = pid_str;
        }
        signupDialog(1, false, {login:true});
    }else{
        if(pid_str!=""){
            $add_btn.parents(".js-productization-add-to-bag").submit();
        }
    }
}

function getFilterOptionsObj(){
    var options = {catString:"", geoString:"", ttpString:"", pppString:"",
                   ppiString:"", lumString:"", chaString:"", keyword:"", fromDate:"",
                   shpString:"", pdzMasterPid:"",
                   toDate:"", weekDays:"", weekNights:"", weekends:"", notIncludeUnSure:"",  sortBy:""};

    if(g_is_mobile || g_filter_from_mobile_menu){
        var selector = "#filter ";
    }else{
        var selector = "#filterPage ";
    }

    if($(selector+".js-price-slider.filter-selected").length === 1 && $(selector+".js-price-slider.filter-selected").attr("data-value") !== "1>"){
        options.pppString += $(selector+".js-price-slider.filter-selected").attr("data-value");
    }

    if($(selector+".js-filter-disc-item.filter-selected").length === 1){
        options.catString += $(selector+".js-filter-disc-item.filter-selected").attr("data-value");
    }

    if($(selector+".js-filter-keyword.filter-selected").length === 1){
        options.keyword    = $(selector+".js-filter-keyword.filter-selected").attr("data-value");
    }

    /*
    if($(selector+".js-filter-collection.filter-selected").length == 1){
        options.shpString    = $(selector+".js-filter-collection.filter-selected").attr("data-value");
    }
    */

    if($(selector+".js-filter-sort.filter-selected").length === 1){
        options.sortBy    = $(selector+".js-filter-sort.filter-selected").attr("data-value");
    }

    $(selector+"ul li.filter-selected").each(function(){
        if($(this).hasClass("js-filter-location") && $(this).attr("data-value")){
            if(options.geoString.indexOf($(this).attr("data-value") + ",") === -1){
                options.geoString += $(this).attr("data-value") + ",";
            }
        }else if($(this).hasClass("js-filter-people")){
            if(options.ppiString.indexOf($(this).attr("data-value") + ",") === -1){
                options.ppiString += $(this).attr("data-value") + ",";
            }
        }else if($(this).hasClass("js-filter-collection")){
            if(options.shpString.indexOf($(this).attr("data-value") + ",") === -1){
                options.shpString += $(this).attr("data-value") + ",";
            }
        }
    });


    if($(selector+".js-filter-from").attr("selectedTime") === undefined){
        options.fromDate = "";
        options.toDate   = "";
    }else{
        options.fromDate = $(selector+".js-filter-from").attr("selectedTime").trim();
        options.toDate   = $(selector+".js-filter-to").attr("selectedTime").trim();
    }

    if($(selector+".js-filter-availability.filter-selected").length === 1){
        options.date = $(selector+".js-filter-availability.filter-selected").attr("data-value");
    }else{
        options.date = "";
    }


    if($(selector+".js-filter-productization-master-pid.filter-selected").length === 1){
        options.pdzMasterPid = $(selector+".js-filter-productization-master-pid.filter-selected").attr("data-value");
    }else{
        options.pdzMasterPid = "";
    }

    //options.notIncludeUnSure    = ($(selector+".js-availability-type").prop("checked"))?0:1;
    //options.catString = options.catString.slice(0,-1);
    options.geoString = options.geoString.slice(0,-1);
    //options.pppString = options.pppString.slice(0,-1);
    options.ttpString = options.ttpString.slice(0,-1);
    options.ppiString = options.ppiString.slice(0,-1);
    options.lumString = options.lumString.slice(0,-1);
    options.chaString = options.chaString.slice(0,-1);

    return options;
}


//*******************************************
function popUpOpen($obj){
    $obj.animate({opacity: 'show', height: 'show'}, 150);
}
//*******************************************
function popUpClose($obj){
    $obj.animate({opacity: 'hide', height: 'hide'}, 150);
}

//*******************************************
// *  action: (1) check
// *          (2) remove
//*******************************************
function actionBtnClickHandling($obj, action){
    if(action === undefined){
        action = "check";
    }

    if(action === "check"){
        if($obj.hasClass("disabled")){
            return false;
        }else{
            $obj.addClass("disabled");
            if(g_is_mobile){
                if($obj.find(".btn-b").length > 0){
                    $obj.find(".btn-b").addClass("disabled");
                }
            }
            return true;
        }
    } else if (action === "remove"){
        $obj.removeClass("disabled");
        if(g_is_mobile){
            if($obj.find(".btn-b").length > 0){
                $obj.find(".btn-b").removeClass("disabled");
            }
        }
    }
}


//*******************************************
//*  Initiate calendar
//*******************************************
function draw_calendar_general($obj, timeSelectedCallBack, getCalendarCallBack) {

    var y = $obj.attr("data-y");
    var m = $obj.attr("data-m");
    var cid = ($obj.attr("data-vid") === undefined) ? '0' :$obj.attr("data-vid");
    var pid = ($obj.attr("data-pid") === undefined) ? '0' :$obj.attr("data-pid");
    var needFirstAvailableDay   = ($obj.attr("data-nfad") === undefined) ? '1' : $obj.attr("data-nfad");
    var duration                = ($obj.attr("data-dm")   === "")? 60: $obj.attr("data-dm");
    var bookingLeadTime         = ($obj.attr("data-blm")  === "")? 0: (parseInt($obj.attr("data-blm"))/1440);
    var maximumBookingLeadTime  = ($obj.attr("data-mbld") === "")? 365: $obj.attr("data-mbld");
    var minutesBeforeBuffer     = ($obj.attr("data-mbb")  === undefined || $obj.attr("data-mbb") === "")? 0: $obj.attr("data-mbb");
    var doubleCal               = ($obj.attr("data-double-calendar") === undefined || $obj.attr("data-double-calendar") === "")?0:$obj.attr("data-double-calendar");
    $obj.attr("data-mbb",minutesBeforeBuffer);
    var startYear    = ($obj.attr("data-start-year")    === undefined) ?"":$obj.attr("data-start-year");
    var startMonth   = ($obj.attr("data-start-month")   === undefined) ?"":$obj.attr("data-start-month");
    var seriesEvents = ($obj.attr("data-series-events") === undefined) ?0:$obj.attr("data-series-events");

    if(timeSelectedCallBack === undefined || typeof(timeSelectedCallBack) !== typeof(Function)){
        timeSelectedCallBack = function(){
            console.log("You can add a callback function :)");
        };
    }

    $.ajax({
        type: "POST",
        url: "/common/getCalendar",
        dataType: 'json',
        data: {year:y,month:m, celebId:cid, productId:pid, bookingLeadTime: bookingLeadTime, minutesBeforeBuffer:minutesBeforeBuffer,
               maximumBookingLeadTime:maximumBookingLeadTime, duration: duration, getFirstAvailableDay: needFirstAvailableDay,
               doubleCal: doubleCal, startYear:startYear, startMonth:startMonth,
               seriesEvents:seriesEvents, userId:g_userId
           },
        success: function(data) {
            if (data.result < 1) {
                alertEx(data.msg);
                return false;
            }

            if(needFirstAvailableDay === '1'){
                $obj.attr("data-nfad","0");
                $obj.find(".cal-body").html(data.html);
                $obj.find(".cal-nav .month").html(data.displayMonth);
                $obj.find(".cal-nav .year").html("&nbsp;&nbsp;"+data.displayYear);
                $obj.attr("data-y", data.year);
                $obj.attr("data-year", data.firstAvailableYear);
                $obj.attr("data-m", data.month);
                $obj.attr("data-month", data.firstAvailableMonth);

                if(data.firstAvailableYear < data.year
                || data.firstAvailableMonth < data.month
                ){
                    $obj.find(".cal-nav .left img").css("visibility","visible");
                }

            }else{

                if(doubleCal == 1){
                    $obj.find(".js-cal-one .cal-body").html(data.html1);
                    $obj.find(".js-cal-one .month").html(data.displayMonth1);
                    $obj.find(".js-cal-one .year").html(data.displayYear1);
                    $obj.find(".js-cal-two .cal-body").html(data.html2);
                    $obj.find(".js-cal-two .month").html(data.displayMonth2);
                    $obj.find(".js-cal-two .year").html(data.displayYear2);
                }else{
                    $obj.find(".cal-body").html(data.html);
                }

            }

            //if(timeSelectedCallBack )
            $obj.bind("timeselected", function() {
                timeSelectedCallBack();
            });

            // selcted the selected date
            // if the selected date is in next month or previous month, we need to reload the calendar
            // and selected that date when new calendar is loaded
            if($obj.attr("data-click-date") !== undefined && $obj.attr("data-click-date") !== ""){
                $obj.find(".cal-body .day[data-date="+$obj.attr("data-click-date")+"]").addClass("selected");
                $obj.attr("data-click-date","");
            }
            setSelectedDay();

            if(getCalendarCallBack !== undefined && typeof(getCalendarCallBack) === typeof(Function)){

                getCalendarCallBack();
            }
        }
    });
}

function setSelectedDay() {
    if($("#calendar-popUp .scheduledDatetimeDisplay_0").length > 1 || $("#calendar-popUp .scheduledDatetimeDisplay_1").length > 1){
        var date0 = $("#calendar-popUp .scheduledDatetimeDisplay_0").attr("data-date");
        var date1 = $("#calendar-popUp .scheduledDatetimeDisplay_1").attr("data-date");
        $("#calendar-popUp .cal-body .day").each(function() {
            if($(this).attr("data-date") === date0 || $(this).attr("data-date") === date1){
                $(this).addClass("selected");
            }else{
                $(this).removeClass("selected");
            }
        });
    }
}



//*******************************************
//*  Used in Mobile
//*******************************************
function lazyLoadCleaning(type, forceClean){
    if(forceClean === undefined){
        forceClean = false;
    }
    if(g_currentListType != type || forceClean){  // starting a lazy load for a new type
        g_currentListType = type;
        $("#loadedPCnt").val(0);
        $("#loadedACnt").val(0);
        $("#loadedSCnt").val(0);
        $("#loadedBCnt").val(0);
        $("#needMoreTiles").val(1);
        g_category_products_and_collections = []; // re-initiate
        g_cat_pro_col_index                 = 0;
    }
}

//******************************************** Lazy Load Tiles  ****************************************************

//*******************************************
//*  Lazy Load Tiles
//*******************************************
function lazyLoadDataHandling(type, data){
    if(type == g_list_type.category){
        $("#loadedPCnt").val(parseInt($("#loadedPCnt").val())+parseInt(data.pCnt));
        $("#loadedACnt").val(parseInt($("#loadedACnt").val())+parseInt(data.aCnt));
        $("#loadedSCnt").val(parseInt($("#loadedSCnt").val())+parseInt(data.sCnt));
        $("#loadedBCnt").val(parseInt($("#loadedBCnt").val())+parseInt(data.bCnt));
        g_category_products_and_collections = g_category_products_and_collections.concat(data.data);
    } else {
        g_category_products_and_collections = g_category_products_and_collections.concat(data);
    }
    // add tiles in to queue

}
/****************************************************************************
 *
 * Used in mobile for lazy loading the remaining products
 * (1) Filter Page
 *
 ***************************************************************************/
function loadMoreTilesForFilter(){
    if( !g_downloading_new_tiles ){
        var params = getFilterOptionsObj();
        params.loadedBCnt   = g_category_products_and_collections.length / g_block_pCnt;
        params.totalTileCnt = $("#totalCnt").val();
        jQuery.ajax({
            type: "GET",
            url:  "/services/search/getNextBlocksProducts",
            dataType: 'json',
            cache: false,
            data: params,
            success: function (data) {
                if(data.result == 1){
                    lazyLoadDataHandling(g_list_type.filter, data.data);

                    if(data.data.length < g_block_pCnt * 2){
                        $("#needMoreTiles").val(0);
                    }else{
                        $(".js-view-more-box").show();
                    }

                    populate_product_collection_tiles(0, "", $('.js-tiles-sec'), true);
                    //markWishlistedProducts(wishlistProducts);
                    g_downloading_new_tiles = false;
                    populateLocalStorage();
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
            },

        });
        g_downloading_new_tiles = true;
    }
}

// data is an array of items which can be used for views: _tile_product, _tile_collection, _tile_ad
// this function is used to paint the tile
// paint g_block_pCnt tiles
function populate_product_collection_tiles(catId, getVar, tiles_div, show_celebrity, params){

    if ( typeof(show_celebrity) === "undefined") {    show_celebrity = true;  }

    // url parameters appending
    // pass parrameter to PDP page/Productization PDP to narrow down the result sets
    var url      = window.location.pathname;
    var indexPos = url.indexOf("/options");
    var urlAppended = "";
    if(indexPos !== -1){
        //urlAppended = "/options/";
        var url = url.substring(indexPos);
        var re = new RegExp("perPersonPrice"+"\/([^\/]*)\/", 'i');
        var m  = url.match(re);
        if(m !== null){
            urlAppended += m[0];
        }
        re = new RegExp("location"+"\/([^\/]*)\/", 'i');
        m  = url.match(re);
        if(m !== null){
            urlAppended += m[0];
        }
        re = new RegExp("date"+"\/([^\/]*)\/", 'i');
        m  = url.match(re);
        if(m !== null){
            urlAppended += m[0];
        }

        if(urlAppended !== ""){
            urlAppended = "/options/" + urlAppended;
        }
    }


    // ajax to load more tiles
    // loadTilesFromAjax is defined in
    // (1) category  standalone
    // (2) filter
    if($("#needMoreTiles").val() == 1 && g_category_products_and_collections.length < ( parseInt(g_cat_pro_col_index) + parseInt(g_block_pCnt)*2 ) ){

        if(g_currentListType == g_list_type.category){
            loadTilesForCat(catId, getVar);
        }else if(g_category_products_and_collections.length < $("#totalCnt").val()){
            loadMoreTilesForFilter();
        }
    }

    var startTimeTest = new Date().getTime();
    var appendHtml = "";

    var forNumber = (params !== undefined && params.renderNumber !== undefined)? params.renderNumber:g_block_pCnt;
    for(var i=0; i<forNumber; i++){

        if(typeof g_category_products_and_collections[g_cat_pro_col_index] === 'undefined'){
            $('.view-more-box').hide();
            break;
        }else{
            if(g_currentListType == g_list_type.category){
                var item = g_category_products_and_collections[g_cat_pro_col_index];
            }else{
                var item = {type: g_category_products_and_collections[g_cat_pro_col_index]['type'], data: g_category_products_and_collections[g_cat_pro_col_index]};
            }
            if(item.type==='product'){
                var product = item.data;
                appendHtml += get_product_dom(product, $('#product_template'), show_celebrity, urlAppended);

                //tiles_div.append(product_dom);
            }else if(item.type==='collection'){
                var collection = item.data;
                appendHtml += get_collection_dom(collection, $('#collection_template'));
                //tiles_div.append(collection_dom);
            }else if(item.type==='ads'){
                var ad = item.data;
                appendHtml += get_ad_dom(ad, $('#ad_template'));
                //tiles_div.append(ad_dom);
            }else if(item.type==='productization_product'){
                var product = item.data;
                appendHtml += get_productization_product_dom(product, $('#productization_product_template'));

            }else{
                var product = item.data;
                appendHtml += get_product_dom(product, $('#product_template'), show_celebrity, urlAppended);
                //tiles_div.append(product_dom);
            }
            g_cat_pro_col_index++;
        }

    }
    if(appendHtml !== ""){
        tiles_div.append(appendHtml);
        populateLocalStorage({tileIndexOnly:true});

        // mark wishlist prosucts 4 seconds later
        setTimeout(function(){ markWishlistedProducts(wishlistProducts); }, 5000);
    }

    var startTimeTestEnd = new Date().getTime();
    console.log("client render "+g_block_pCnt+ " titiles "+ (startTimeTestEnd - startTimeTest)/1000 +" seconds");


}
//*******************************************
// *
// * Used in mobile for lazy loading the remaining tiles
// * (1) Home Page
// * (2) Category Page
// *
//*******************************************
function loadTilesForCat(catId, getVar, pageId){

    lazyLoadCleaning(g_list_type.category);

    if(pageId === undefined){
        pageId = 0;
    }
    if( !g_downloading_new_tiles ){
        jQuery.ajax({
            type: "POST",
            url:  g_url_get_category_products_and_collections,
            dataType: 'json',
            data: {'catId': catId, 'get':getVar,
                   'loadedACnt':$("#loadedACnt").val(), 'loadedPCnt':$("#loadedPCnt").val(), 'loadedSCnt':$("#loadedSCnt").val(),
                   'loadedBCnt':$("#loadedBCnt").val(),
                   'pageId'    : pageId
            },
            success: function (data) {
                loadTilesDataHandling(data, catId);

            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                //alert('Unknow Error. Please refresh and try again');
            }
        });
        g_downloading_new_tiles = true;
    }

}

function loadTilesDataHandling(data, catId, getVar){
    g_downloading_new_tiles = false;
    lazyLoadDataHandling(g_list_type.category, data);

    if(catId == g_homepage_catId){
        $('.collection_tiles').removeClass('loading');
    }else{
        $('.collection_tiles').closest(".tab").removeClass('loading');
    }


    if(data.data.length < g_block_pCnt * 2){
        $("#needMoreTiles").val(0);
    }else{
        $(".view-more-box").show();
    }


    if(data.trackProductList){
        setTimeout(function(){
            eval(data.trackProductList);
        }, 2000);
    }

    populate_product_collection_tiles(catId, getVar, $('.collection_tiles'), true);
    //markWishlistedProducts(wishlistProducts);
    $('.collection_tiles').closest(".tab").attr('data-loaded', '1');
    $('.collection_tiles').closest(".tab").attr('data-showing-serach', '0');
}
/******************************************** Lazy Load Tiles  ****************************************************/


$(document).ready(function(){

    //opens member sign up

    $('#sign-bar,  #nav,  .bag, #top-welcome, #member-signup-dialog, #bespokeForm, #modal-container, #vendor-signup-dialog').on('click', '.js-signUp', function(event){
        event.preventDefault();

        if(g_forVendorSignUp && !$(this).hasClass('js-ignore-vendor-signup')){
            displayOverlay('vendor-signup-dialog');
            g_forVendorSignUp = false;
            return false;
        }

        $("#signUp-dialog-called-from").val(""); // clear action
        //clearTimeout(autoPopupTimer);console.log("here");
        if($("#login-email").val() !== ""){
            $("#User_emailAddress").val($("#login-email").val());
        }
        if($(this).hasClass('js-shopping-bag')){
            $("#signUp-dialog-called-from").val('shopping-bag');
        }
        signupDialog(1,1,{'button': $(this)});
        return false;
    });

//    $(".js-login").click(function(){
//        signupDialog(1,1,$(this));
//        return false;
//    });

    $('#sign-bar, #signup-dialog, #nav, .modal-container, #bespoke, #top-welcome, #vendorSignUp').on('click', '.js-login', function(event){
        event.preventDefault();
        //clearTimeout(autoPopupTimer);
        if($(this).hasClass("bespokePage")){
            if($.trim($("#bespoke .willingToPay").val()) === ""){
                $("#bespoke .budget").show();
                return false;
            }
        }
        signupDialog(1,1,{'button': $(this)});
        return false;
    });

    $("body, #nav, #header, #header-nav").on( 'click', ".js-member-access",function(){
        displayOverlay('closed-accessCode-dialog');
        return false;
    });

    $("body, #closed-accessCode-dialog").on( 'click', ".update-access-code",function(){
        var input = $("#closed-accessCode-dialog .access-code");
        if(input.val() === '' || input.val() === input.attr('default')) {
            displayError("#closed-accessCode-dialog .error-general", "Please enter an access code.");
            return false;
        }
        var accessCode = input.val();
        if(accessCode != ""){
            accessCodeUpdate(accessCode);
        }
        return false;
    });

    function accessCodeUpdate(accessCode){
        $.post( '/website/updateUserAccessCode',
            {'accessCode':accessCode},
            function (data){
                ga('send', 'pageview', 'Access Code Signup Attempted by Registered User');
                if (data.result === 1) {
                    if(data.conciergeAccess == 1){
                        //load verify emailAddress dialog
                        var phone = ((data.isAmex == 1)? '415-376-4646':'(415)754-8167');
                        var header = "Almost done! <br/><br/>";
                        var message = 'We have sent an email to your address (please check your spam folder).<br/><br/>To finish setting up your account, please press the “CONFIRM EMAIL” button in the email to gain access. <br/><br/>If you do not receive an email within 5 minutes, please call '+phone+' and our Guest Experiences Team will assist you.';
                        g_readyFor_cart = false;
                        userAccessHide();
                        alertEx(message, header);
                        return false;
                    } else {
                        var header = " "+data.firstName;
                        var message = "Thank you for the update.";
                                                                        userAccessHide();
                        alertEx(message, header);
                    }
                    if(g_readyFor_cart === true ){
                        if( !addRegisteredUserProductToCart() ){
                            setTimeout("location.reload();", 6000);
                        }
                    }else{
                        setTimeout("location.reload();", 6000);
                    }

                } else if(data.result === 2){ //On using accescode that cannot be applied to current email
                    userAccessHide();
                    //addEmailIframe.postMessage('{"accessCode":"'+accessCode+'"}', 'https://' + g_thisHost + '.ifonly.com');
                    $("#User_add_accesscode").val(accessCode);
                    $("#add-email-dialog").overlay().load();
                } else {
                    displayError("#closed-accessCode-dialog .error-general", data.msg);
                }
            },'json');
        return false;
    }

    $("#exposeMask").click(function(){
        if(g_active_popup !== "" && !g_forceSignup){
            $('#exposeMask').css("height", "100%");
            $('#container').css({height:"auto", overflow:"auto"});
            $('#body').css('overflow','visible');
            $('#exposeMask').fadeOut();
            $("#"+g_active_popup).fadeOut();
            if (g_active_popup === 'accesscode-add-dialog') {
                $("#accesscode-add-dialog .update-access-code-close .btn-w").html('Join Our Membership Waitlist'); // can be changed at bottom_js
            }
        }
        return false;
    });

    $('.modal-container').on('click', '.close, .js-close', function(){
        userAccessHide();
        return false;
    });

   $("body, .custom-form").on("click",".loginWithFacebookButton", function(e){
        e.stopImmediatePropagation();
        if (g_isMobileApp === 1 && g_vendorProfile === ""){
            if(g_uaType === 4) {
                window.webkit.messageHandlers.loginThroughFacebook.postMessage(JSON.stringify({url:window.location.href}));
            } else {
                Android.facebookLogin(window.location.href);
            }

            return false;
        }
        if($(this).hasClass("bespokePage")){
            if($.trim($("#bespoke .willingToPay").val()) === ""){
                $("#bespoke .budget").show();
                return false;
            }
        }
        if(g_chrome_iOS){
            var type = $(this).attr('type');
            if(type === "signin"){
                $("#buttonByClickSource").html("<a href='#' class='new-signIn'>Log In with Email</a>.");
            } else {
                $("#buttonByClickSource").html("<a href='#' class='email-signup'>Sign Up with Email</a>.");
            }
            userAccessHide();
            displayOverlay("chrome-exempt-dialog");
            return false;
        }
        var redirectUrl = decodeURIComponent($("#facebookReturnURL").val()); // $("#facebookReturnURL").val();
        var fbLogin = $(this).attr('fbLogin');


        $('*').css('cursor','wait');

        FB.login(function(response) {
            if (response.authResponse) {
                var accessToken   = response.authResponse.accessToken;
                var signedRequest = response.authResponse.signedRequest;
                console.log(response);
                FB.api('/me', 'get', {fields:"significant_other, family, id, email, location, hometown, birthday"}, function(response) {console.log(response);
                    response.signedRequest = signedRequest;
                    response.accessToken   = accessToken;
                    response.fbLogin = fbLogin; //pass the info that this is a facebook login and not facebook sign up
                    var fbUrl = "/website/LoginWithFacebook";
                    if(g_vendorSignUp == 1){
                        fbUrl = "/website/LoginWithFacebook/from/vendorSignUp";
                    }
                    var postData = {'response': response};
                    if (g_is_pickonePromo) {
                        postData['social_emailOptedIn'] = $("#social_emailOptedIn").attr('checked') ? 1 : 0;
                    }
                    $.ajax({
                        type:  "POST",
                        url:   fbUrl,
                        data:  postData,
                        async: true,
                        dataType: 'json'
                    }).done(function ( data ) {
                        if ( data.result == 1 ) {
                            if (data.newUser == 1) {
                                ga('send', 'event', 'MemberActivity', 'Facebook Signup');
                                fb_p('track', 'CompleteRegistration');
                                g_userId = data.userId;
                                callSignupTrackingCode();

                                if (addGuestProductToCart()) return false; // if need to add a guest product (main.js)
                                googleAnalyticsImage = new Image();
                                googleAnalyticsImage.src = 'https://www.googleadservices.com/pagead/conversion/995223985/?value=0&amp;label=VrOnCNe_ogQQsdPH2gM&amp;guid=ON&amp;script=0';
                                // $("#google-tracking").html('<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/995223985/?value=0&amp;label=VrOnCNe_ogQQsdPH2gM&amp;guid=ON&amp;script=0" onload = "location.reload();" />');
                                if(g_bespoke === '1'){
                                    slideToNextQuestion(6, 7);
                                    submitBespokeForm();
                                }else{
                                    setTimeout('window.location.reload();', g_signup_timer);
                                }
                            } else {
                                ga('send', 'event', 'MemberActivity', 'Facebook Login');
                                if (addGuestProductToCart()) return false; // if need to add a guest product (main.js)
                                // If from vendor portal sign up and vendor email is verified, redirect to vendor profile page
                                if(data.vendorVerified === 1) {
                                    setTimeout('location.href = "/m/vendorportal/edit";', g_login_timer);
                                }
                                else if(g_bespoke === '1'){
                                    slideToNextQuestion(6, 7);
                                    submitBespokeForm();
                                } else if(g_vendorProfile !== ""){ // in vendor profile page
                                    $(".form-row .edit-block .facebook.defaultBox").hide();
                                    $(".form-row .edit-block .facebook.linkedBox").fadeIn();
                                    if($(".page-left-col").length === 1) {
                                        if($(".prg-block font").length > 0){
                                            $(".prg-block .prg-bar .complete-bar").css("width", data.percentNumber+"%");
                                            $(".prg-block font").text(data.percentNumber);
                                        }
                                        $(".page-left-col").find(".menu-social").removeClass("un-complete");
                                        $(".page-left-col").find(".menu-social").addClass("complete");
                                    }
                                } else if (redirectUrl !== '' && redirectUrl !== '#') {
                                    setTimeout('location.href = "' + redirectUrl + '";', g_login_timer);
                                } else {
                                    setTimeout('location.reload();', g_login_timer);
                                }
                            }
                        } else {

                        }
                        $('*').css('cursor','default');
                    });
                });
            } else {
                $('*').css('cursor','default');
            }
        }, {scope:'email, user_birthday, public_profile, user_location, user_hometown, user_relationships'});
        return false;
    });
    $("body, .custom-form").on("click",".google-signinButton, .googleSigninButton", function(e){
//    $('.google-signinButton').unbind('click').click(function() {
        if(g_isMobileApp === 1 ){
            if(g_uaType == 4)
            {
                window.webkit.messageHandlers.loginThroughGoogle.postMessage(JSON.stringify({url:window.location.href}));
            }
            else
            {
                Android.googleLogin(window.location.href);
            }

            return false;
        }

        g_call_from = $(this).attr('type');
        if($(this).hasClass("bespokePage")){
            if($.trim($("#bespoke .willingToPay").val()) === ""){
                $("#bespoke .budget").show();
                return false;
            }
        }


//        if(g_call_from === "signup"){
//            $("#page-member-signup-dialog-overlay").show();
//            $("#page-member-signup-dialog-loading").show();
//        } else {
//            $("#page-login-dialog-overlay").show();
//            $("#page-login-dialog-loading").show();
//        }
        var myParams = {
            'clientid' : g_googleClientKey, //You need to set client id
            'cookiepolicy' : 'single_host_origin',
            'callback' : signinCallback, //callback function
            'approvalprompt':'auto',
            'scope' : 'https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.profile.emails.read'
          };
          gapi.auth.signIn(myParams);
        return false;
    });

//    $('#complete-signup-submit').click(function() {
//            var url = $("#redirectURL").val();
//            input = $("#complete-signup-password");
//            if(input.val() === '' || input.val() === input.attr('default-value')) {
//                displayError("#complete-signup-error","Please enter a password");
//                return false;
//            } else if(input.val().length < 7){
//                displayError("#complete-signup-error","Password must be at least 7 characters long");
//                return false;
//            }
//
//            $.post( '/m/website/completeSignUp',
//                $("#complete-signup-form").serialize(),
//                function (data){
//                    if (data.result === 1) {
//                        ga('send', 'event', 'Member Activity', 'Member Activity - Complete Sign Up for emailAddress Users');
//                        if (url !== '' && url !== '#') {
//                            setTimeout('location.href = "' + url + '";', 1000);
//                        } else {
//                            setTimeout('location.reload();', 1000);
//                        }
//                    } else {
//                        displayError("#complete-signup-error",data.msg);
//                    }
//                },'json');
//
//            return false;
//        });

});



</script>
<script defer="" type="text/javascript" onload="coreJSLoadingHandling('jqueryUI');" src="/scripts/jquery-ui.min.js?2"></script>
    <script defer="" type="text/javascript" onload="coreJSLoadingHandling('jqueryTOOL');" src="/scripts/jquery.tools.min.fix.js?8"></script>
    
<script defer="" type="text/javascript" onload="coreJSLoadingHandling('jqueryCookie');" src="/scripts/jquery.cookie.js"></script>
<script defer="" type="text/javascript" onload="coreJSLoadingHandling('globalJs');" src="/scripts/global.js"></script>
<script defer="" type="text/javascript" onload="coreJSLoadingHandling('commonJs');" src="/scripts/common.js?28"></script>
<script defer="" type="text/javascript" onload="coreJSLoadingHandling('mainJs');" src="/assets/3292c487/main.js"></script>
<script>
    //var headTime05 = new Date().getTime();
    //console.log("headTime05 "+ (headTime05 - startTime)/1000 +" seconds");
</script>
        <div id="header" class="">
            <div id="header-fixed" style="top:0;">
                <div id="header-wrap">
                    <div id="header-nav">
                            <div id="top-logo">
        <a href="/" class="logo">
            <img style="height:40px;" alt="IfOnly delivers extraordinary experiences with top talents in sports, music, entertainment, food, wine, golf, tennis and more, all while benefiting deserving non-profits." src="/images/IfOnly_logo_white.png">
        </a>
    </div>
    

<div id="top-welcome" class="search_result_container">
            <a href="#" class="white-bd-btn js-d-how-ifonly-works"><p>HOW IT WORKS</p></a>
        
                <a href="javascript:void();" class="white-bd-btn js-login" id="logInBtn"><p>Log in</p></a>
                            <a href="javascript:void();" class="access-join allowAllUsers green-btn js-signUp" id="signUpBtn"><p>SIGN UP</p></a>
                        <div class="top-search">
            <input id="top-nav-search" data-appendto="#top-welcome" style="display: none;" placeholder="Search people, categories, charities &amp; more" class="search-input ui-autocomplete-input top-nav-search" section="original" idvalue="0" type="text" value="" name="top-nav-search" autocomplete="off">
            <img class="search-icon" src="/images/icon_search_FFF.png">
            <div class="top-nav-search-disc js-top-nav-search-disc">
                <style>

                </style>
                

<div class="discovery-popup js-discovery-popup desktop">
    <div class="disc-header fo-16-n-g co-gr js-disc-header">Explore By</div>
    <div class="disc-all-ex">
        <div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj js-filter-all " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="">
            <p class="fo-14-n-s4 disc-item-text">
                All Experiences
            </p>
        </div>
    </div>
    <div class="disc-column inline-top js-disc-col">     <div class="col-title js-col-title fo-11-n-m ">categories</div><a lvl="1" href="/filter/c/culinary"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="147" data-catname="culinary" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Culinary</p></div></a><a lvl="1" href="/filter/c/beer-wine-and-spirits"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="313" data-catname="beer-wine-and-spirits" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Beer, Wine, &amp; Spirits</p></div></a><a lvl="1" href="/filter/c/adventure"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="88" data-catname="adventure" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Adventure</p></div></a><a lvl="1" href="/filter/c/music"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="6" data-catname="music" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Music</p></div></a><a lvl="1" href="/filter/c/entertainment"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="36" data-catname="entertainment" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Film &amp; TV</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-more js-view-more" onclick="discoveryViewMore($(this))"><p class="fo-14-n-s4 disc-item-text">More...</p></div><div class="more-items js-more-items"><a lvl="1" href="/filter/c/sport"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="35" data-catname="sport" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Sports</p></div></a><a lvl="1" href="/filter/c/health-and-wellness"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="214" data-catname="health-and-wellness" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Health &amp; Wellness</p></div></a><a lvl="1" href="/filter/c/fashion"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="109" data-catname="fashion" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Fashion &amp; Style</p></div></a><a lvl="1" href="/filter/c/performing-arts"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="269" data-catname="performing-arts" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Performing Arts</p></div></a><a lvl="1" href="/filter/c/art"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="92" data-catname="art" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Fine Art</p></div></a><a lvl="1" href="/filter/c/photography"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="282" data-catname="photography" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Photography</p></div></a><a lvl="1" href="/filter/c/artisans"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="262" data-catname="artisans" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Artisans</p></div></a><a lvl="1" href="/filter/c/home-decor"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="297" data-catname="home-decor" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Home Decor</p></div></a><a lvl="1" href="/filter/c/authors"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="146" data-catname="authors" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Literature</p></div></a><a lvl="1" href="/filter/c/poker"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="128" data-catname="poker" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Games &amp; Hobbies</p></div></a><a lvl="1" href="/filter/c/speakers"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="177" data-catname="speakers" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Speakers &amp; Events</p></div></a><a lvl="3" href="#"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="9" data-catname="cult-wine" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Cult Wine</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-less js-view-less" onclick="discoveryShowLess($(this))"><p class="fo-14-n-s4 disc-item-text">Less...</p></div></div></div><div class="disc-column inline-top js-disc-col">     <div class="col-title js-col-title fo-11-n-m ">activities</div><a lvl="1" href="/filter/c/outdoors"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="397" data-catname="outdoors" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Outdoors</p></div></a><a lvl="1" href="/filter/c/lessons"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="75" data-catname="lessons" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Lessons</p></div></a><a lvl="1" href="/filter/c/local-tours"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="290" data-catname="local-tours" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Local Tours</p></div></a><a lvl="1" href="/filter/c/travel-and-destinations"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="89" data-catname="travel-and-destinations" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Travel &amp; Destinations</p></div></a><a lvl="1" href="/filter/c/concerts"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="289" data-catname="concerts" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Concerts &amp; Backstage Access</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-more js-view-more" onclick="discoveryViewMore($(this))"><p class="fo-14-n-s4 disc-item-text">More...</p></div><div class="more-items js-more-items"><a lvl="1" href="/filter/c/instruction-and-clinics"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="57" data-catname="instruction-and-clinics" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Instruction &amp; Clinics</p></div></a><a lvl="1" href="/filter/c/once-in-a-lifetime"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="264" data-catname="once-in-a-lifetime" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Once-in-a-Lifetime Experiences</p></div></a><a lvl="1" href="/filter/c/activities-for-kids"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="278" data-catname="activities-for-kids" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Activities for Kids</p></div></a><a lvl="1" href="/filter/c/team-activities"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="135" data-catname="team-activities" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Team Activities</p></div></a><a lvl="1" href="/filter/c/corporate-speakers-and-events"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="31" data-catname="corporate-speakers-and-events" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Corporate Events</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-less js-view-less" onclick="discoveryShowLess($(this))"><p class="fo-14-n-s4 disc-item-text">Less...</p></div></div></div><div class="disc-column inline-top js-disc-col">     <div class="col-title js-col-title fo-11-n-m ">occasions</div><a lvl="1" href="/filter/c/anniversary"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="245" data-catname="anniversary" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Anniversary</p></div></a><a lvl="1" href="/filter/c/gifts-for-him"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="257" data-catname="gifts-for-him" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Gifts for Him</p></div></a><a lvl="1" href="/filter/c/gifts-for-her"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="261" data-catname="gifts-for-her" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Gifts for Her</p></div></a><a lvl="1" href="/filter/c/couples"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="263" data-catname="couples" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Date Night</p></div></a><a lvl="1" href="/filter/c/wedding"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="266" data-catname="wedding" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Weddings</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-more js-view-more" onclick="discoveryViewMore($(this))"><p class="fo-14-n-s4 disc-item-text">More...</p></div><div class="more-items js-more-items"><a lvl="1" href="/filter/c/groups"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="19" data-catname="groups" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Group Events</p></div></a><a lvl="1" href="/filter/c/kids-parties"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="246" data-catname="kids-parties" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Kids' Parties</p></div></a><a lvl="1" href="/filter/c/gifts"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="12" data-catname="gifts" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Gifts</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-less js-view-less" onclick="discoveryShowLess($(this))"><p class="fo-14-n-s4 disc-item-text">Less...</p></div></div></div><div class="disc-column inline-top js-disc-col">     <div class="col-title js-col-title fo-11-n-m ">locations</div><a lvl="1" href="/filter/l/san-francisco-bay-area"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="223" data-catname="san-francisco-things-to-do" data-location="san-francisco-bay-area"><p class="fo-14-n-s4 disc-item-text js-disc-item-text">San Francisco</p></div></a><a lvl="1" href="/filter/l/new-york"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="250" data-catname="local-new-york" data-location="new-york"><p class="fo-14-n-s4 disc-item-text js-disc-item-text">New York City</p></div></a><a lvl="1" href="/filter/l/los-angeles"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="251" data-catname="local-los-angeles" data-location="los-angeles"><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Los Angeles</p></div></a><a lvl="1" href="/filter/l/napa"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="232" data-catname="local-napa-sonoma" data-location="napa"><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Napa &amp; Sonoma</p></div></a><a lvl="1" href="/filter/l/boston"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="378" data-catname="local-boston" data-location="boston"><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Boston</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-more js-view-more" onclick="discoveryViewMore($(this))"><p class="fo-14-n-s4 disc-item-text">More...</p></div><div class="more-items js-more-items"><a lvl="1" href="/filter/c/local"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="231" data-catname="local" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Chicago</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-less js-view-less" onclick="discoveryShowLess($(this))"><p class="fo-14-n-s4 disc-item-text">Less...</p></div></div></div><div class="disc-column inline-top js-disc-col">     <div class="col-title js-col-title fo-11-n-m ">trending</div><a lvl="1" href="/filter/c/hotlist"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="126" data-catname="hotlist" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Popular</p></div></a><a lvl="1" href="/filter/c/"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="" data-catname="" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Experiences Ending Soon</p></div></a><a lvl="1" href="/filter/c/auctions"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="195" data-catname="auctions" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Auctions</p></div></a><a lvl="1" href="/filter/c/what-is-new"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="106" data-catname="what-is-new" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">New &amp; Notable</p></div></a><a lvl="1" href="/filter/c/"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="" data-catname="" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Experiences Under $150</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-more js-view-more" onclick="discoveryViewMore($(this))"><p class="fo-14-n-s4 disc-item-text">More...</p></div><div class="more-items js-more-items"><a lvl="1" href="/filter/c/"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="" data-catname="" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Experiences Under $250</p></div></a></div></div>    <div class="disc-footer">
        <a href="/filter/" class="fo-11-n-m  co-gr le-14">ADVANCED SEARCH</a>
        <div class="clearAll"></div>
    </div>
</div>

            </div>
        </div>
                <a href="javascript:void();" class="shopping access-join js-shopping-bag js-signUp">
            <img src="/images/io/icon_cart_FFF-mbpng.png">
        </a>
                    <div>
            <style>
                .how-ifonly-works{
                    display: none;
                    position: fixed;
                    left: 0px;
                    top: 80px;
                    min-height: 300px;
                    width: 100%;
                    z-index: 999;
                    background-color: #fff;
                    overflow-y: auto;
                    box-shadow: 0 4px 8px -5px rgb(119, 119, 119);
                }
                .mobile .how-ifonly-works{
                    top: 50px;
                    height: 600px;
                    height: calc(100vh - 50px);
                }

                .how-ifonly-works .inner-sec{position: relative;}
                .how-ifonly-works .close{width: 55px; position: absolute; top: -30px; right: 0px; cursor: pointer;}
                .how-ifonly-works .header-row{margin-top: 30px;text-align: center;margin-bottom: 30px;}

                .how-ifonly-works table{width: 100%; margin-top: 30px; margin-bottom: 40px;}
                .how-ifonly-works table td{
                    text-align: center;
                    width: 100px;
                    vertical-align: top;
                }
                .mobile .how-ifonly-works table td{
                    float: left; margin-bottom: 15px; width: 100%;
                }
                .how-ifonly-works table .img-block{
                    width: 80px; height: 80px;
                    display: inline-block;
                    border-radius: 40px;
                    background-color: #000;
                    text-align: center;
                    overflow: hidden;
                }
                .how-ifonly-works table td img{width: 65px; margin-top: 8px;}
                .how-ifonly-works table td p{line-height: 22px; width: 55%; margin: 0 auto; }
                .how-ifonly-works table td p.middle{margin:10px 0px; width: auto;}
            </style>
            <div class="how-ifonly-works">
                <div class="inner-sec">
                    <img class="close js-close" src="/images/icon_close_000.png">
                    <p class="fo-28-n-g header-row">How IfOnly Works</p>
                    <table class="elements-list">
                        <tbody><tr>
                                                <td>
                            <div class="img-block">
                                <img class="inline-middle" src="/media/frames/132/icon_shiparrow_fff-mbpng.jpg">
                            </div>

                            <p class="fo-14-n-m middle">
                                ACCESS                            </p>
                            <p class="fo-16-n-s4">
                                Discover thousands of experiences with top luminaries for any occasions.                              </p>
                        </td>
                                                <td>
                            <div class="img-block">
                                <img class="inline-middle" src="/media/frames/132/icon_cal_fff-mbpng.jpg">
                            </div>

                            <p class="fo-14-n-m middle">
                                SCHEDULE                            </p>
                            <p class="fo-16-n-s4">
                                Connect directly with our luminaries to book your experiences  on your own schedules.                            </p>
                        </td>
                                                <td>
                            <div class="img-block">
                                <img class="inline-middle" src="/media/frames/132/icon_heart_fff-mbpng.jpg">
                            </div>

                            <p class="fo-14-n-m middle">
                                ENJOY                            </p>
                            <p class="fo-16-n-s4">
                                Embark on your adventure and leave us a review of your experience.                             </p>
                        </td>
                                                </tr>
                    </tbody></table>
                </div>
            </div>
            <script>
                ioReady(function() {
                    $(".how-ifonly-works .js-close").click(function() {
                        $(this).closest(".how-ifonly-works").fadeOut();
                    });
                });
            </script>
        </div>
        <ul class="ui-autocomplete ui-front ui-menu ui-widget ui-widget-content" id="ui-id-1" tabindex="0" style="display: none;"></ul></div>



<script type="text/javascript">
    $(document).ready(function(){
        $("#marketplace").hover(function () {
            $(this).css('color', '#00a94f');
            $("#marketArrow").attr("src", $("#marketArrow").attr("src").replace("/images/arrow_right_999.png", "/images/arrow_right_green.png"));
        }, function () {
            $(this).css('color', '');
            $("#marketArrow").attr("src", $("#marketArrow").attr("src").replace("/images/arrow_right_green.png", "/images/arrow_right_999.png"));
        });
    });
</script>                    </div>
                                            <div id="header-menu">
                            <div class="level-menu">
            <div class="l-menu js-menu" data-navmenuid="1">
            <a href="#" style="cursor: default;" class="label js-tab-featrue js-show-dropdown">
                <p class="fo-11-n-m le-14">CATEGORIES</p>
            </a>
            <div class="highlight-bar"></div>
            <div class="drop-down">
                <div class="level-2"></div>
                <div class="level-3"></div>
            </div>
        </div>
                <div class="l-menu js-menu" data-navmenuid="2">
            <a href="#" style="cursor: default;" class="label js-tab-featrue js-show-dropdown">
                <p class="fo-11-n-m le-14">ACTIVITIES &amp; OCCASIONS</p>
            </a>
            <div class="highlight-bar"></div>
            <div class="drop-down">
                <div class="level-2"></div>
                <div class="level-3"></div>
            </div>
        </div>
                <div class="l-menu js-menu" data-navmenuid="3">
            <a href="#" style="cursor: default;" class="label js-tab-featrue js-show-dropdown">
                <p class="fo-11-n-m le-14">LOCATIONS</p>
            </a>
            <div class="highlight-bar"></div>
            <div class="drop-down">
                <div class="level-2"></div>
                <div class="level-3"></div>
            </div>
        </div>
                <div class="l-menu js-menu" data-navmenuid="122">
            <a href="#" style="cursor: default;" class="label js-tab-featrue js-show-dropdown">
                <p class="fo-11-n-m le-14">TRENDING</p>
            </a>
            <div class="highlight-bar"></div>
            <div class="drop-down">
                <div class="level-2"></div>
                <div class="level-3"></div>
            </div>
        </div>
        </div>
<style>
    .level-menu{ position: absolute;bottom: 0px; left: 110px; height: 60px;}
    .level-menu .l-menu{float: left; min-height: 60px; position: relative; background-color: #000;}
    .level-menu .l-menu .highlight-bar{width: 100%;background-color: #00a94f;z-index: 12;height: 6px; display: none; position: absolute; bottom: 0px;}
    .level-menu .l-menu .drop-down{ position: absolute; z-index: 10; left: 0px; top: 60px; background-color: #fff; display: none; box-shadow: 0 4px 8px -5px rgb(119, 119, 119);}
    .level-menu .drop-down .level-2{background-color: #282828; height:40px; float: left; }
    .level-menu .level-2 .col p{ line-height: 40px;}
    .level-menu .drop-down .level-3{float: left; padding: 8px 0px;}
    .level-menu .drop-down .col{width:160px; float: left; padding-left: 15px; box-sizing: border-box; min-height: 10px;}
    .level-menu .drop-down .col .topNavCat{width: 160px; float: left;}
    .level-menu .l-menu .label p{color: #fff; padding: 12px 15px 0px 15px; transition: color 200ms; text-transform: uppercase;}
    .level-menu .l-menu .label p:hover{color:#00a94f;}
    .level-menu .l-menu .level-link{padding: 8px 0px; float: left; width: 80%;}
    .level-menu .l-menu .topNavCat img{width: 16px; float: left; margin-top: 8px;}
    .level-menu .l-menu .greyOut .level-link{color: #888;}
</style>
<script>
    $(document).ready(function(){

        // layout css preparing
        $(".level-menu .drop-down").each(function(){
            var numOfcol = $(this).find(".level-2 .col").length;
            $(this).find(".level-2 .col").css("max-width",1/numOfcol*100+"%");
        });

        $(".level-menu .l-menu").mouseover(function(){
            var thisLeft = $(this).position().left;
            $(this).siblings(".l-menu").children(".highlight-bar").hide();
            $(this).siblings(".l-menu").children(".drop-down").hide();
            $(this).children(".highlight-bar").show();
            // set the proper left
            //$(this).children(".drop-down").css("left", thisLeft+"px");
            // give enough width firstly
            $(this).children(".drop-down").width(900);
            $(this).children(".drop-down").show();
            // adjust to the proper width
            var colLength = $(this).children(".drop-down").find(".level-3 .col").length;
            if(colLength == 1){
                var itemsCnt = $(this).children(".drop-down").find(".level-3 .topNavCat").length;
                if(itemsCnt > 9){
                    $(this).children(".drop-down").find(".level-3 .col").width(320);
                    $(this).children(".drop-down").width(320);
                }else{
                    $(this).children(".drop-down").width(colLength * 160);
                }
            }else{
                $(this).children(".drop-down").width(colLength * 160);
            }
            //$(this).children(".drop-down").css("max-width","calc(100% - "+(thisLeft+5)+"px)");
        });

        $(".level-menu .l-menu").on("mouseleave", ".drop-down", function(){
            $(this).fadeOut(200);
            $(this).siblings(".highlight-bar").fadeOut(200);
            //$(this).children(".drop-down").css("max-width","calc(100% - "+(thisLeft+5)+"px)");
        });
    });
</script>
                        </div>
                                        </div>
                
                
                            </div>
            
            
        </div>
        <div id="mobile-header" class="" style="">
    <div id="header-m">
    
    <div id="top">
        
        <div class="icon trigger menu">
            <img src="/m/images/icon_hamburger_FFF.png">
        </div>
            <div class="logo"><a href="/" alt="IfOnly delivers extraordinary experiences with top talents in sports, music, entertainment, food, wine, golf, tennis and more, all while benefiting deserving non-profits."><img src="/m/images/logo_mainnavmobile.png"></a></div>
                    <div class="icon bag " style="">
                <a class="js-bag-link js-signUp js-shopping-bag" href="/cart">
                    <img class="js-bag-img" src="/images/io/icon_cart_FFF-mbpng.png">
                    <div class="bag-item"><p class="heavy" id="js-cart-item-cnt"></p></div>
                </a>
            </div>
                    <!--
            <div class="icon filter" style="">
                <img src="/m/images/Icons_filter_fff.png" />
                <img style="display:none;" src="/images/icon_filter_green.png" />
            </div>
        -->
                    <div class="icon search" style="">
                <img src="/images/icon_search_FFF.png">
            </div>
                </div>
        <div id="wish-popup-wrapper-m" style="display: none;">
        <img class="close js-close" src="/images/icon_close_000.png">
        <div class="popup-content"></div>
    </div>
    

    <script>
        ioReady(function(){
            $(".js-wishlist").click(function(){
                if($("#wish-popup-wrapper-m .popup-content").html() == ""){
                    getMobileWishlistPopupHtml();
                }else{
                     $("#wish-popup-wrapper-m").fadeIn();
                }
            });
            
            $("#wish-popup-wrapper-m .js-close").click(function(){
                $("#wish-popup-wrapper-m").fadeOut();
                if(g_controller_id == "search"){
                    $("#header-m").css("z-index","2");
                }
            });
        });
    </script>
    </div>

<img src="/images/icon_plus_FFF.png" style="display:none">
<img src="/images/icon_minus_FFF.png" style="display:none">
<div id="search" class="search_result_container">
    <div stysle="position: relative;">
        <div style="position: absolute; left:0px; width: 15%; height:100%; text-align: left; " id="search-back">
            <img src="/images/arrow_left.png" style="width:15px; margin-left: 5px; margin-top: 12px;">
        </div>
        <input id="m-search" class="m-search ui-autocomplete-input top-nav-search" data-appendto="#search" type="text" value="" name="searchKey" placeholder="Search people, categories, charities &amp; more" autocomplete="off">
        <div style="position: absolute; right: 0px; width: 6%; height:100%; text-align: center; background-color: #252525;" id="search-clear">
            <img src="/images/io/x-button-grey.png" style="width:15px; margin-top: 16px;">
        </div>
    </div>

<ul class="ui-autocomplete ui-front ui-menu ui-widget ui-widget-content" id="ui-id-2" tabindex="0" style="display: none;"></ul></div>
<div id="nav" style="left: -1351px;">
        <div class="nav-menu consumer current">
        <div class="section identity">
                            <div class="nav-item">
                    <div class="content" style="height:55px; background-color: #00a94f;">
                        <div class="tw-col login-button js-login">
                            <span>LOGIN</span>
                        </div>
                        <div class="tw-col email-signup member-signup-btn js-signUp">
                            <span>SIGN UP</span>
                        </div>
                    </div>

                </div>
                            <div class="clearAll"></div>
            <div class="menu-gap" style="margin: 0px; width: 100%;"></div>
        </div>
        <div class="section level-menus">
            <span class="fo-15-i-g title" style="margin-left">Browse</span>
                            <div class="nav-item js-hasChild" data-navmenuid="1">
                    <div class="content">
                        <a href="#">
                            <span>CATEGORIES</span>
                            <img class="right" src="/images/icon_arrow_right_000.png">
                        </a>

                    </div>
                </div>
                                <div class="nav-item js-hasChild" data-navmenuid="2">
                    <div class="content">
                        <a href="#">
                            <span>ACTIVITIES &amp; OCCASIONS</span>
                            <img class="right" src="/images/icon_arrow_right_000.png">
                        </a>

                    </div>
                </div>
                                <div class="nav-item js-hasChild" data-navmenuid="3">
                    <div class="content">
                        <a href="#">
                            <span>LOCATIONS</span>
                            <img class="right" src="/images/icon_arrow_right_000.png">
                        </a>

                    </div>
                </div>
                                <div class="nav-item js-hasChild" data-navmenuid="122">
                    <div class="content">
                        <a href="#">
                            <span>TRENDING</span>
                            <img class="right" src="/images/icon_arrow_right_000.png">
                        </a>

                    </div>
                </div>
                            <div class="clearAll"></div>
            <div class="menu-gap"></div>
        </div>

        <div class="section account">
                                            <div class="nav-item account js-m-how-ifonly-works">
                    <a>
                        <div class="content">
                            <span>HOW IFONLY WORKS</span>
                        </div>
                    </a>
                </div>
                                <div class="nav-item account">
                    <a href="//support.ifonly.com">
                        <div class="content">
                            <span>HELP</span>
                        </div>
                    </a>
                </div>
                            <div class="nav-item help-number">
                <a href="tel:// 415  376 4640">
                    <div class="content">
                        <span style="width: 80%;">CALL US: (415) 376-4640</span>
                    </div>
                </a>
            </div>
        </div>
                <div class="menu-end" style="width: 200px; height:20px;"></div>
    </div>

    
    <div class="nav-menu level-details">
        <div class="menu-end" style="width: 200px; height:20px; margin-top: 300px;"></div>
    </div>


        <div class="menu-stick-bottom">
                    <div class="marketpalce">
                <a href="/marketplace/" data-caption="SELL EXPERIENCES">
                    <p class="text">
                        SELL EXPERIENCES                    </p>
                    <p class="img">
                        <img src="/images/arrow_right_ccc.png" style="width: 15px;">
                    </p>
                </a>
            </div>
                </div>
</div>
<div id="search-disc-menu" style="display: none;">
    

<div class="discovery-popup js-discovery-popup ">
    <div class="disc-header fo-16-n-g co-gr js-disc-header">Explore By</div>
    <div class="disc-all-ex">
        <div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj js-filter-all " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="">
            <p class="fo-14-n-s4 disc-item-text">
                All Experiences
            </p>
        </div>
    </div>
    <div class="disc-column inline-top js-disc-col">     <div class="col-title js-col-title fo-11-n-m ">categories</div><a lvl="1" href="/filter/c/culinary"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="147" data-catname="culinary" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Culinary</p></div></a><a lvl="1" href="/filter/c/beer-wine-and-spirits"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="313" data-catname="beer-wine-and-spirits" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Beer, Wine, &amp; Spirits</p></div></a><a lvl="1" href="/filter/c/adventure"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="88" data-catname="adventure" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Adventure</p></div></a><a lvl="1" href="/filter/c/music"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="6" data-catname="music" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Music</p></div></a><a lvl="1" href="/filter/c/entertainment"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="36" data-catname="entertainment" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Film &amp; TV</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-more js-view-more" onclick="discoveryViewMore($(this))"><p class="fo-14-n-s4 disc-item-text">More...</p></div><div class="more-items js-more-items"><a lvl="1" href="/filter/c/sport"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="35" data-catname="sport" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Sports</p></div></a><a lvl="1" href="/filter/c/health-and-wellness"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="214" data-catname="health-and-wellness" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Health &amp; Wellness</p></div></a><a lvl="1" href="/filter/c/fashion"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="109" data-catname="fashion" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Fashion &amp; Style</p></div></a><a lvl="1" href="/filter/c/performing-arts"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="269" data-catname="performing-arts" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Performing Arts</p></div></a><a lvl="1" href="/filter/c/art"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="92" data-catname="art" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Fine Art</p></div></a><a lvl="1" href="/filter/c/photography"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="282" data-catname="photography" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Photography</p></div></a><a lvl="1" href="/filter/c/artisans"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="262" data-catname="artisans" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Artisans</p></div></a><a lvl="1" href="/filter/c/home-decor"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="297" data-catname="home-decor" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Home Decor</p></div></a><a lvl="1" href="/filter/c/authors"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="146" data-catname="authors" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Literature</p></div></a><a lvl="1" href="/filter/c/poker"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="128" data-catname="poker" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Games &amp; Hobbies</p></div></a><a lvl="1" href="/filter/c/speakers"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="177" data-catname="speakers" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Speakers &amp; Events</p></div></a><a lvl="3" href="#"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="9" data-catname="cult-wine" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Cult Wine</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-less js-view-less" onclick="discoveryShowLess($(this))"><p class="fo-14-n-s4 disc-item-text">Less...</p></div></div></div><div class="disc-column inline-top js-disc-col">     <div class="col-title js-col-title fo-11-n-m ">activities</div><a lvl="1" href="/filter/c/outdoors"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="397" data-catname="outdoors" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Outdoors</p></div></a><a lvl="1" href="/filter/c/lessons"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="75" data-catname="lessons" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Lessons</p></div></a><a lvl="1" href="/filter/c/local-tours"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="290" data-catname="local-tours" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Local Tours</p></div></a><a lvl="1" href="/filter/c/travel-and-destinations"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="89" data-catname="travel-and-destinations" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Travel &amp; Destinations</p></div></a><a lvl="1" href="/filter/c/concerts"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="289" data-catname="concerts" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Concerts &amp; Backstage Access</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-more js-view-more" onclick="discoveryViewMore($(this))"><p class="fo-14-n-s4 disc-item-text">More...</p></div><div class="more-items js-more-items"><a lvl="1" href="/filter/c/instruction-and-clinics"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="57" data-catname="instruction-and-clinics" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Instruction &amp; Clinics</p></div></a><a lvl="1" href="/filter/c/once-in-a-lifetime"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="264" data-catname="once-in-a-lifetime" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Once-in-a-Lifetime Experiences</p></div></a><a lvl="1" href="/filter/c/activities-for-kids"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="278" data-catname="activities-for-kids" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Activities for Kids</p></div></a><a lvl="1" href="/filter/c/team-activities"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="135" data-catname="team-activities" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Team Activities</p></div></a><a lvl="1" href="/filter/c/corporate-speakers-and-events"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="31" data-catname="corporate-speakers-and-events" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Corporate Events</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-less js-view-less" onclick="discoveryShowLess($(this))"><p class="fo-14-n-s4 disc-item-text">Less...</p></div></div></div><div class="disc-column inline-top js-disc-col">     <div class="col-title js-col-title fo-11-n-m ">occasions</div><a lvl="1" href="/filter/c/anniversary"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="245" data-catname="anniversary" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Anniversary</p></div></a><a lvl="1" href="/filter/c/gifts-for-him"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="257" data-catname="gifts-for-him" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Gifts for Him</p></div></a><a lvl="1" href="/filter/c/gifts-for-her"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="261" data-catname="gifts-for-her" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Gifts for Her</p></div></a><a lvl="1" href="/filter/c/couples"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="263" data-catname="couples" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Date Night</p></div></a><a lvl="1" href="/filter/c/wedding"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="266" data-catname="wedding" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Weddings</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-more js-view-more" onclick="discoveryViewMore($(this))"><p class="fo-14-n-s4 disc-item-text">More...</p></div><div class="more-items js-more-items"><a lvl="1" href="/filter/c/groups"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="19" data-catname="groups" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Group Events</p></div></a><a lvl="1" href="/filter/c/kids-parties"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="246" data-catname="kids-parties" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Kids' Parties</p></div></a><a lvl="1" href="/filter/c/gifts"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="12" data-catname="gifts" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Gifts</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-less js-view-less" onclick="discoveryShowLess($(this))"><p class="fo-14-n-s4 disc-item-text">Less...</p></div></div></div><div class="disc-column inline-top js-disc-col">     <div class="col-title js-col-title fo-11-n-m ">locations</div><a lvl="1" href="/filter/l/san-francisco-bay-area"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="223" data-catname="san-francisco-things-to-do" data-location="san-francisco-bay-area"><p class="fo-14-n-s4 disc-item-text js-disc-item-text">San Francisco</p></div></a><a lvl="1" href="/filter/l/new-york"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="250" data-catname="local-new-york" data-location="new-york"><p class="fo-14-n-s4 disc-item-text js-disc-item-text">New York City</p></div></a><a lvl="1" href="/filter/l/los-angeles"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="251" data-catname="local-los-angeles" data-location="los-angeles"><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Los Angeles</p></div></a><a lvl="1" href="/filter/l/napa"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="232" data-catname="local-napa-sonoma" data-location="napa"><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Napa &amp; Sonoma</p></div></a><a lvl="1" href="/filter/l/boston"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="378" data-catname="local-boston" data-location="boston"><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Boston</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-more js-view-more" onclick="discoveryViewMore($(this))"><p class="fo-14-n-s4 disc-item-text">More...</p></div><div class="more-items js-more-items"><a lvl="1" href="/filter/c/local"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="231" data-catname="local" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Chicago</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-less js-view-less" onclick="discoveryShowLess($(this))"><p class="fo-14-n-s4 disc-item-text">Less...</p></div></div></div><div class="disc-column inline-top js-disc-col">     <div class="col-title js-col-title fo-11-n-m ">trending</div><a lvl="1" href="/filter/c/hotlist"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="126" data-catname="hotlist" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Popular</p></div></a><a lvl="1" href="/filter/c/"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="" data-catname="" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Experiences Ending Soon</p></div></a><a lvl="1" href="/filter/c/auctions"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="195" data-catname="auctions" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Auctions</p></div></a><a lvl="1" href="/filter/c/what-is-new"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="106" data-catname="what-is-new" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">New &amp; Notable</p></div></a><a lvl="1" href="/filter/c/"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="" data-catname="" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Experiences Under $150</p></div></a><div class="disc-item fo-14-n-s4 co-gr disc-view-more js-view-more" onclick="discoveryViewMore($(this))"><p class="fo-14-n-s4 disc-item-text">More...</p></div><div class="more-items js-more-items"><a lvl="1" href="/filter/c/"><div class="disc-item js-disc-item js-filter-disc-item js-filter-op js-useObj " data-type="radio" data-closest=".js-discovery-popup" data-name="category" data-value="" data-catname="" data-location=""><p class="fo-14-n-s4 disc-item-text js-disc-item-text">Experiences Under $250</p></div></a></div></div>    <div class="disc-footer">
        <a href="/filter/" class="fo-11-n-m  co-gr le-14">ADVANCED SEARCH</a>
        <div class="clearAll"></div>
    </div>
</div>

</div>
<div id="m-how-ifonly-works">
            <div>
            <style>
                .how-ifonly-works{
                    display: none;
                    position: fixed;
                    left: 0px;
                    top: 80px;
                    min-height: 300px;
                    width: 100%;
                    z-index: 999;
                    background-color: #fff;
                    overflow-y: auto;
                    box-shadow: 0 4px 8px -5px rgb(119, 119, 119);
                }
                .mobile .how-ifonly-works{
                    top: 50px;
                    height: 600px;
                    height: calc(100vh - 50px);
                }

                .how-ifonly-works .inner-sec{position: relative;}
                .how-ifonly-works .close{width: 55px; position: absolute; top: -30px; right: 0px; cursor: pointer;}
                .how-ifonly-works .header-row{margin-top: 30px;text-align: center;margin-bottom: 30px;}

                .how-ifonly-works table{width: 100%; margin-top: 30px; margin-bottom: 40px;}
                .how-ifonly-works table td{
                    text-align: center;
                    width: 100px;
                    vertical-align: top;
                }
                .mobile .how-ifonly-works table td{
                    float: left; margin-bottom: 15px; width: 100%;
                }
                .how-ifonly-works table .img-block{
                    width: 80px; height: 80px;
                    display: inline-block;
                    border-radius: 40px;
                    background-color: #000;
                    text-align: center;
                    overflow: hidden;
                }
                .how-ifonly-works table td img{width: 65px; margin-top: 8px;}
                .how-ifonly-works table td p{line-height: 22px; width: 55%; margin: 0 auto; }
                .how-ifonly-works table td p.middle{margin:10px 0px; width: auto;}
            </style>
            <div class="how-ifonly-works">
                <div class="inner-sec">
                    <img class="close js-close" src="/images/icon_close_000.png">
                    <p class="fo-28-n-g header-row">How IfOnly Works</p>
                    <table class="elements-list">
                        <tbody><tr>
                                                <td>
                            <div class="img-block">
                                <img class="inline-middle" src="/media/frames/132/icon_shiparrow_fff-mbpng.jpg">
                            </div>

                            <p class="fo-14-n-m middle">
                                ACCESS                            </p>
                            <p class="fo-16-n-s4">
                                Discover thousands of experiences with top luminaries for any occasions.                              </p>
                        </td>
                                                <td>
                            <div class="img-block">
                                <img class="inline-middle" src="/media/frames/132/icon_cal_fff-mbpng.jpg">
                            </div>

                            <p class="fo-14-n-m middle">
                                SCHEDULE                            </p>
                            <p class="fo-16-n-s4">
                                Connect directly with our luminaries to book your experiences  on your own schedules.                            </p>
                        </td>
                                                <td>
                            <div class="img-block">
                                <img class="inline-middle" src="/media/frames/132/icon_heart_fff-mbpng.jpg">
                            </div>

                            <p class="fo-14-n-m middle">
                                ENJOY                            </p>
                            <p class="fo-16-n-s4">
                                Embark on your adventure and leave us a review of your experience.                             </p>
                        </td>
                                                </tr>
                    </tbody></table>
                </div>
            </div>
            <script>
                ioReady(function() {
                    $(".how-ifonly-works .js-close").click(function() {
                        $(this).closest(".how-ifonly-works").fadeOut();
                    });
                });
            </script>
        </div>
        </div>

<div id="nav-overlay" style="position: fixed; top: 0px; left: 0px; width: 100%; height: 768px; display: none; opacity: 0.5; z-index: 999; background-color: rgb(0, 0, 0);"></div>

<script type="text/javascript">
    var topOff = 0;
    var windowHeight = $(window).height();

    // hide the menu-stick-bottom
    if($(".hide-menu-stick-bottom").length > 0 ){
        $("#nav .menu-stick-bottom").hide();
    }


    $(document).ready(function() {
        $("#nav").animate({left:'-'+($("#nav").width()+1)+"px"},{duration:10});

        $("#nav .expand-trggier").click(function(){
            if($(this).hasClass("expended")){
                //$(this).removeClass("black-bg");
                //$(this).next(".sub-menu").removeClass("black-bg");
                $(this).find(".plus-minus").attr("src", $(this).find(".plus-minus").attr("data-plus"));
                $(this).next(".sub-menu").slideUp(400, "linear");
                $(this).removeClass("expended");
            }else{
                $(this).find(".plus-minus").attr("src", $(this).find(".plus-minus").attr("data-minus"));
                $(this).next(".sub-menu").slideDown(400, "linear");
                $(this).addClass("expended");
                //$(this).addClass("black-bg");
                //$(this).next(".sub-menu").addClass("black-bg");
            }

            return false;
        });

        $("#nav .nav-item a").click(function(){
            if($(this).attr("href") != "#"){
                $('#nav-overlay').click();
            }
        });

        /*
        $("#nav .sub-menu.category .nav-item").click(function(){
            if($(this).hasClass("hasChild")){
                $("#nav .nav-menu.category-details .cat-detail").hide();
                $("#nav .nav-menu.category-details .cat-detail[data-catid="+$(this).attr("data-catid")+"]").show();
                $("#nav .nav-menu.consumer").animate({left:'-100%'},function(){
                    var scrollTo = $("#nav").offset().top;
                    $('html, body').animate({scrollTop:scrollTo}, 0,function(){});
                    $("#nav .nav-menu.consumer").removeClass("current");
                    $("#nav .nav-menu.category-details").animate({left:'0px'});
                    $("#nav .nav-menu.category-details").addClass("current");
                });

                return false;
            }
        });
        */
       $("#nav .section.level-menus .nav-item").click(function(){
            if($(this).hasClass("js-hasChild")){
                $("#nav .nav-menu.level-details .level-detail").hide();
                $("#nav .nav-menu.level-details .level-detail[data-navmenuid="+$(this).attr("data-navmenuid")+"]").show();
                $("#nav .nav-menu.consumer").animate({left:'-100%'},function(){
                    var scrollTo = $("#nav").offset().top;
                    $('html, body').animate({scrollTop:scrollTo}, 0,function(){});
                    $("#nav .nav-menu.consumer").removeClass("current");
                    $("#nav .nav-menu.level-details").animate({left:'0px'});
                    $("#nav .nav-menu.level-details").addClass("current");
                });

                return false;
            }
        });

        $("#nav .nav-menu.level-details").on("click", "img.backToMain", function(){
            $("#nav .nav-menu.level-details").animate({left:'-100%'},function(){
                $("#nav .nav-menu.level-details").removeClass("current");
                $("#nav .nav-menu.consumer").animate({left:'0px'});
                $("#nav .nav-menu.consumer").addClass("current");
            });
        });

        $("#nav").on("click", ".nav-item.js-moreOrLess", function(){
            moreOrLess($(this));
        });

        $("#nav").on("click", ".level-sec .level-title", function(){
            moreOrLess($(this).siblings(".level-content").find(".nav-item.js-moreOrLess"));
        });

        $("#nav .menu-stick-bottom .swtich-account").click(function(){
            if($("#nav .menu-stick-bottom .swtich-account .status").text() === "LUMINARY"){

                $("#nav .nav-menu.current").animate({left:'-100%'},function(){
                    var scrollTo = $("#nav").offset().top;
                    $('html, body').animate({scrollTop:scrollTo}, 0,function(){});
                    $("#nav .nav-menu.current").addClass("previous");
                    $("#nav .nav-menu.current").removeClass("current");
                    $("#nav .nav-menu.venndor").animate({left:'0px'});
                    //$("#nav").addClass("bg-black");
                    $("#nav .nav-menu.venndor").addClass("current");
                });
                $("#nav .menu-stick-bottom .swtich-account .status").text("CONSUMER");
                $("#nav .menu-stick-bottom").addClass("bg-white");
                $(this).find("img").attr("src",$(this).find("img").attr("data-c-img"));
            }else{

                $("#nav .nav-menu.current").animate({left:'-100%'},function(){
                    var scrollTo = $("#nav").offset().top;
                    $('html, body').animate({scrollTop:scrollTo}, 0,function(){});
                    $("#nav .nav-menu.previous").animate({left:'0px'});
                    //$("#nav").removeClass("bg-black");
                    $("#nav .nav-menu.previous").addClass("current");
                    $("#nav .nav-menu.previous").removeClass("previous");
                    $("#nav .nav-menu.venndor").removeClass("current");
                });
                $("#nav .menu-stick-bottom .swtich-account .status").text("LUMINARY");
                $("#nav .menu-stick-bottom").removeClass("bg-white");
                $(this).find("img").attr("src",$(this).find("img").attr("data-l-img"));
            }

        });

        
        //Search
        $('#m-search').click(function(){
            $('#m-search').focus();
        });
        
        $("#m-search").focus(function(){
            $("#search-disc-menu").fadeOut("fast");
        });

        $("#top .search").click(function(){
            $("#search").animate({right:'0px'},{
                duration:300,
                complete:function(){
                    $("#search").css("width", "100%");
                    $("#search-disc-menu").fadeIn("fast");
                }
            });
        });

        $("#search-clear").click(function(){
             $('#m-search').val("");
             $("#search-disc-menu").fadeIn("fast");
        });

        $("#search-back").click(function(){
            $("#search-disc-menu").fadeOut("fast");
            $("#search").animate({right:"-100%"},{
                duration:300,
                complete:function(){
                }
            });
        });








        //$("#nav-overlay").width($( window ).width() - 240);
        $("#nav-overlay").height($( window ).height());
        //$("#container a").attr("rel","external");  // Remove ajax call from regular links with jQuery Mobile


        $("#body .icon.back, #top .icon.back").click(function(e){
            window.history.back();
            return false;
        });


        $("#body .menu, #top .menu").click(function(e){

            if ($("#top .menu").length > 0) {
                var $button = $("#top .menu");
            } else {
                var $button = $("#body .menu");
            }

            if ( ! $button.hasClass("slided")){
                e.stopImmediatePropagation();

                if ($(window).width() < 360) {
                    $("#top .logo").hide();
                }
                $("#cat-title").hide();
                $("#subcat-title").hide();
                //$("#nav").css("top",$("#header-m").offset().top+"px");
                $("#nav-overlay").height($("#nav").height());
                //$("#nav-overlay").width($( window ).width() - 240);
                $("#nav-overlay").fadeIn();

                if($("#body .bag").length === 1){
                    $("#body .bag, #body .icon.wishlist, #body .search").fadeOut(200);
                }
                $button.animate({marginLeft:'255px'},{
                    speed :300,
                    easing: "linear",
                    complete:function(){
                        //$("#nav").css("top",$("#header-m").offset().top+"px");
                        $button.addClass("slided");

                    }
                });

                $("#nav").show().animate({left:0},{speed:300, easing:"linear"});
                $("#nav .menu-stick-bottom").animate({left:0},{speed:300, easing:"linear"});
            } else {
                $('#nav-overlay').click();
            }
        });

        $(".nav-item ul").hide();
        $(".nav-item.account ul").show();

        $(".nav-item .parent").click(function(e) {
            var $navItem = $(this).parent();

            if ($navItem.hasClass('open')) {
                $navItem.find("ul").slideToggle('fast', function() {
                    $navItem.removeClass('open');
                    $navItem.find('img.up').hide();
                    $navItem.find('img.down').show();
                });
            } else {
                $navItem.addClass('open');
                $navItem.find('img.down').hide();
                $navItem.find('img.up').show();
                $navItem.find("ul").slideToggle('fast');
            }
            return false;
        });

        if( ! g_is_guest ){
            $('#nav').on('click', '.new-signup', function(){
                displayOverlay('accesscode-add-dialog');
                return false;
            });
        }




        $('#nav-overlay').click(function(e) {
            //if the top section has slide out, slide back when click
            //
            e.stopImmediatePropagation();

            $("#top .logo").show();
            $("#cat-title").show();
            $("#subcat-title").show();


            // scroll user back to original position
            /*
            if(topOff > 0){
                $('html, body').animate({scrollTop:topOff}, 0,function(){});
            }
            */
            //
            $("#body .menu, #top .menu").animate({marginLeft:'0px'},{'speed': 300, 'easing':"linear",
                                                complete:function(){
                                                    if($("#body .bag").length === 1){
                                                        $("#body .bag, #body .icon.wishlist, #body .search").fadeIn(200);
                                                    }
                                                }
            });

            $("#nav-overlay").fadeOut(200);
            $("#nav .menu-stick-bottom").animate({left:'-'+($("#nav").width()+1)+"px"},{'speed': 300, 'easing':"linear"});
            $("#nav").animate({left:'-'+($("#nav").width()+1)+"px"},{
                                speed :300,
                                easing: "linear",
                                complete:function(){
                                    if($("#top .bag").length == 1){
                                        $("#top .bag, #top .icon.wishlist, #top .search").fadeIn();
                                    }
                                    $("#nav").hide();
                                }
            });


            $("#body .menu, #top .menu").removeClass("slided");
            //$("#nav").css("position","fixed");
        });

        //Code to handle rotate
        jQuery(window).on('orientationchange', function(e) {
            switch ( window.orientation ) {
                case 0:
                    if( $("#top .menu").hasClass('slided') ){
                        //$("#nav-overlay").width($( window ).width() - 240);
                        $("#nav-overlay").height($("#nav").height());
                    }
                    //alert($("#experience-tiles").css("margin-top"));
                break;
                case 90:
                    if( $("#top .menu").hasClass('slided') ){
                        //$("#nav-overlay").width($( window ).width() - 240);
                        $("#nav-overlay").height($("#nav").height());
                    }
                    //alert($("#experience-tiles").css("margin-top"));
                break;
                case -90:
                    if( $("#top .menu").hasClass('slided') ){
                        //$("#nav-overlay").width($( window ).width() - 240);
                        $("#nav-overlay").height($("#nav").height());
                    }
                    //alert($("#experience-tiles").css("margin-top"));
                break;
            }
        });


        // javascript to stop parent div scrolling when scroll to the bottom of the #nav or the top of the #nav
        var stuff = {};
        $('#nav').on('touchstart',stuff,function(e){
          e.data.max = this.scrollHeight - this.offsetHeight;
          e.data.y = e.originalEvent.pageY;
        }).on('touchmove',stuff,function(e){
          var dy = e.data.y - e.originalEvent.pageY;
          // if scrolling up and at the top, or down and at the bottom
          if((dy < 0 && this.scrollTop < 1)||(dy > 0 && this.scrollTop >= e.data.max)){
            e.preventDefault();
          };
        });
        // Lock
        //$('#nav').scrollLock();
        // javascript to stop parent div scrolling when scroll to the bottom of the #nav or the top of the #nav
        /*
        $('#nav').on( 'mousewheel', function ( e ) {
            var event = e.originalEvent,
                d = event.wheelDelta || -event.detail;

            this.scrollTop += ( d < 0 ? 1 : -1 ) * 30;
            e.preventDefault();
        });
        */

        // javascript to stop parent div scrolling when scroll to the bottom of the .how-ifonly-works or the top of the .how-ifonly-works
        var stuffHowItWorks = {};
        $('#m-how-ifonly-works .how-ifonly-works').on('touchstart',stuffHowItWorks,function(e){
          e.data.max = this.scrollHeight - this.offsetHeight;
          e.data.y = e.originalEvent.pageY;
        }).on('touchmove',stuffHowItWorks,function(e){
          var dy = e.data.y - e.originalEvent.pageY;
          // if scrolling up and at the top, or down and at the bottom
          if((dy < 0 && this.scrollTop < 1)||(dy > 0 && this.scrollTop >= e.data.max)){
            e.preventDefault();
          };
        });
        
        // javascript to stop parent div scrolling when scroll to the bottom of the .how-ifonly-works or the top of the .how-ifonly-works
        var stuffSearchDisv = {};
        $('#search-disc-menu').on('touchstart',stuffSearchDisv,function(e){
          e.data.max = this.scrollHeight - this.offsetHeight;
          e.data.y = e.originalEvent.pageY;
        }).on('touchmove',stuffSearchDisv,function(e){
          var dy = e.data.y - e.originalEvent.pageY;
          // if scrolling up and at the top, or down and at the bottom
          if((dy < 0 && this.scrollTop < 1)||(dy > 0 && this.scrollTop >= e.data.max)){
            e.preventDefault();
          };
        });
        
        

        $(".js-m-how-ifonly-works").click(function(){
            $('html, body').animate({scrollTop:0}, 0,function(){});
            $("#m-how-ifonly-works").find(".how-ifonly-works").fadeIn();
            sawHowItWorks();
        });
    });



    function moreOrLess($obj){
        if($obj.hasClass("js-more")){
            $("#nav .level-sec:visible .nav-item.js-moreOrLess.js-less").each(function(){
                $(this).siblings(".default-hidden").slideUp();
                $(this).removeClass("js-less");
                $(this).addClass("js-more");
                $(this).find("span").text("MORE +");
                $(this).closest(".js-lc").removeClass("bg-co-e1");
            });
            $obj.siblings(".default-hidden").slideDown();
            $obj.removeClass("js-more");
            $obj.addClass("js-less");
            $obj.find("span").text("LESS -");
            $obj.closest(".js-lc").addClass("bg-co-e1");
        }else{
            $obj.siblings(".default-hidden").slideUp();
            $obj.removeClass("js-less");
            $obj.addClass("js-more");
            $obj.find("span").text("MORE +");
            $obj.closest(".js-lc").removeClass("bg-co-e1");
        }
    }

    function closeAllTopPopUp(){
        $("#wish-popup-wrapper-m").fadeOut();
        $("#m-how-ifonly-works").find(".how-ifonly-works").fadeIn();
    }
</script>

</div>









<!--General thank you dialog-->
<div id="thank-dialog" class="overlayBlack overlay small thanksDialog"><a class="close"></a>
    <div class="rightVertical">
        <div class="header" style="margin-top: 60px;margin-bottom: 30px;">
            <p class="header-text" style="text-align:center;">Welcome<span class="header-text" id="thank-dialog-firstName"></span>,</p>
        </div>
        <div class="body" style="margin-bottom:80px">
            <div class="content" style="text-align: center;margin-bottom: 20px;">
                <p class="message" id="thank-dialog-message" style="text-align:center;">We look forward to delighting you.</p>
            </div>

            <div style="margin: 0 37%;">
                 <div class="allowAllUsers close-overlay primaryButton button " closepopupid="thank-dialog" style="float:left;"><span class="title">Close</span></div>            </div>
        </div>
    </div>
</div>

<div id="signup-thank-dialog" class="overlayBlack overlay small"><a class="close"></a>
    <div class="rightVertical">
        <div class="header" style="margin-top:120px;">
            <p class="header-text" style="color: #000; font-size: 32px; font-style: italic;">Thank you!</p>
        </div>
        <div class="body" style="margin:20px 0 100px">
            <div class="content" style="text-align: center;">
                <p class="message" style="color: #000; font-size: 18px; padding: 0 72px; letter-spacing: 0.2px;">
                    Please check your inbox for your welcome email and your unique promo code
                </p>
            </div>
        </div>
    </div>
</div>

<!--Concierge Incorrect Sign Up dialog-->
<div id="incorrect-concierge-dialog" class="overlay medium foyer thanksDialog"><a class="close"></a>
    <div class="overlayContent">
        <div class="dialog_body">
            <div class="dialog_content" style="text-align: center">
                <p class="message">
                    Sorry, your email does not match our records.  Please use your <span id="conciergeName">Amex</span> Concierge email to sign-up for an IfOnly Concierge account.
                </p>
            </div>
        </div>
        <div class="dialog_footer">
            <div class="footer_content">
                 <div class="allowAllUsers primaryButton button " id="incorrect-concierge-tryagain" closepopupid="thank-dialog" style="float:left; margin-top: 28px; margin-left: 35%;"><span class="title">Try Again</span></div>            </div>
        </div>
    </div>
</div>

<!--Unverified Email Sign Up dialog-->
<div id="unverified-concierge-dialog" class="overlay medium foyer thanksDialog"><a class="close"></a>
    <div class="overlayContent">
        <div class="dialog_body">
            <div class="dialog_content" style="text-align: center">
                <p class="message">
                    Your email is already in our system, but has not yet been verified.  We previously sent you an email - finish setting up your account by pressing the “CONFIRM EMAIL” button.
                    <br><br>
                    If you need us to send you another email, please press below.
                    <br><br>
                    If you do not receive an email within 5 minutes, please call <span id="conciergePhone">415-376-4646</span> and our Guest Experiences Team will assist you.
                </p>
            </div>
        </div>
        <div class="dialog_footer">
            <div class="footer_content">
                 <div class="allowAllUsers primaryButton button " id="resend-email" style="float:left; margin-top: 28px; margin-left: 35%;"><span class="title">Resend Email</span></div>            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
$(window).load(function(){
    var pos = !isHandheld();

    $("#thank-dialog").overlay({
        top: 60, left: getPopupLeftToCenter("thank-dialog"), fixed: pos, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 },
        onLoad: function() {
            ga('send', 'event', 'Member Activity', 'Sign Up Confirmation Dialog');
            if(g_thisHost === 'www') {facebooktrack("'0.00'","'6011685149285'");}
        },
        onClose: function(){ location.reload(); }
    });
    $("#signup-thank-dialog").overlay({
        top: 100, left: getPopupLeftToCenter("signup-thank-dialog"), fixed: pos, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 },
        onLoad: function() {
            ga('send', 'event', 'Member Activity', 'Sign Up Confirmation Dialog');
            if(g_thisHost === 'www') {facebooktrack("'0.00'","'6011685149285'");}
        },
        onClose: function(){ location.reload(); }
    });
    $("#incorrect-concierge-dialog").overlay({
        top: 60, left: getPopupLeftToCenter("incorrect-concierge-dialog"), fixed: pos, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 }
    });
    $("#unverified-concierge-dialog").overlay({
        top: 60, left: getPopupLeftToCenter("unverified-concierge-dialog"), fixed: pos, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 }
    });

//    $("#closed-signup-dialog").overlay({
//        top: 60, left: getPopupLeftToCenter("closed-signup-dialog"), fixed: pos, closeOnClick: true,
//        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 },
//        onLoad: function(){
//            ga('send', 'pageview', 'Closed signup dialog');
//            $.post('/website/logPageView',{'pageId':this.getOverlay().attr('id')},function(data){},'json');
//            $(".default-focus").focus();
//        }
//    });

    $("#access-code-signup-dialog .help").mouseover(function(){
        $("#access-code-signup-dialog .hlep-popup").show();
        return false;
    });
    $("#access-code-signup-dialog .help").mouseleave(function(){
        $("#access-code-signup-dialog .hlep-popup").hide();
        return false;
    });

    $("#invitation-pwd-reset-dialog").overlay({
        top: 100, left: getPopupLeftToCenter("invitation-pwd-reset-dialog"), fixed: false, closeOnClick: false,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 },
        onLoad: function(){
            ga('send', 'pageview', 'Invitation password reset dialog');
            $.post('/website/logPageView',{'pageId':this.getOverlay().attr('id')},function(data){},'json');
        }
    });
});

$(document).ready(function(){


    $("#invitaion-submit").click(function(){
        $.post( "/website/inviteSignup", $("#invitaion-pwd-reset-form").serialize(),
        function (data){
            if (data.result === 1) {
                $("#thank-dialog-firstName").html(" "+data.firstName);
                $('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://d.adx.io/conversions?xb=35BD0380&xnojs=1" />');$('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://www.googleadservices.com/pagead/conversion/976272921/?label=hFCrCI_UpwgQmfzC0QM&amp;guid=ON&amp;script=0" />');$('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/offsite_event.php?id=6011685149285&amp;value=0&amp;currency=USD" />');$('#trackingImage').append('<img src="https://shareasale.com/sale.cfm?amount=0.00&tracking='+g_userId+'&transtype=LEAD&merchantID=50745" width="1" height="1" />');$('#trackingImage').append('<img height="1" width="1" style="display:none;" alt="" src="https://analytics.twitter.com/i/adsct?txn_id=l4753&p_id=Twitter" />');$('#trackingImage').append('<img src="http://pixel.quantserve.com/pixel/p-SswRnXTcs-q48.gif?labels=_fp.event.Sign+Up+Confirmation" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>');$('#trackingImage').append('<img src="https://p.liadm.com/p?c=11775" />');$('#trackingImage').append('<img src="https://bat.bing.com/action/0?ti=4001812&Ver=2" height="0" width="0" style="display:none; visibility: hidden;" />');$('#trackingImage').append('<img src="https://pubads.g.doubleclick.net/activity;xsp=130022;ord=33035925?" height="0" width="0" style="display:none; visibility: hidden;" />');                

        var _qevents = _qevents || [];

        (function() {
            var elem = document.createElement('script');
            elem.src = (document.location.protocol == 'https:' ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
            elem.async = true;
            elem.type = 'text/javascript';
            var scpt = document.getElementsByTagName('script')[0];
            scpt.parentNode.insertBefore(elem, scpt);

            //Tracking for silverpop
            var selem = document.createElement('script');
            selem.src = (document.location.protocol == 'https:' ? 'https://www.sc.pages03.net/lp/static/js/iMAWebCookie.js?2edcd082-1461604bde3-943e27de0c8b91cc3fcf1475c3e5d726&h=www.pages03.net' : 'http://contentz.mkt932.com/lp/static/js/iMAWebCookie.js?2edcd082-1461604bde3-943e27de0c8b91cc3fcf1475c3e5d726&h=www.pages03.net');
            selem.async = true;
            selem.type = 'text/javascript';
            var sscpt = document.getElementsByTagName('script')[0];
            sscpt.parentNode.insertBefore(selem, sscpt);
        })();

        _qevents.push(
            {qacct:'p-SswRnXTcs-q48',labels:'_fp.event.Sign Up Confirmation'}
        );

        var _adx = {};
        _adx.xb  = '35BD0380';
        _adx.xt  = 'conversion';
        _adx.xgid  = '6AMDU1';
        (function(d){
            var x = d.createElement('script');
            x.async = true;
            x.src = ('https:' == d.location.protocol ? 'https://d1adj61x0fgvmc.cloudfront.net' : 'http://s.adx.io') + '/dxjet.js';
            var s = d.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(x, s);
        })(document);

        (function(w,d,t,r,u){
            var f,n,i;w[u]=w[u]||[],f=function(){var o={ti:'4001812'};
            o.q=w[u],w[u]=new UET(o),w[u].push('pageLoad')},
            n=d.createElement(t),n.src=r,n.async=1,
            n.onload=n.onreadystatechange=function(){var s=this.readyState;s&&s!=='loaded'&&s!=='complete'||(f(),n.onload=n.onreadystatechange=null)},
            i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i)
        })(window,document,'script','https://bat.bing.com/bat.js','uetq');


                        $("#thank-dialog").overlay().load();
                var url = $('#redirectURL').val();
                if(url !== '' && url !== '#') {
                    setTimeout('location.href = "' + url + '";', g_signup_timer);
                } else {
                    setTimeout('$("#thank-dialog").overlay().close();', g_signup_timer);
                }
            } else{
                displayError("#invitation-pwd-reset-dialog .errorSummary",data.msg);
            }
            return false;
        },'json');
    });

    $("#resend-email").click(function(){
        var userId = $(this).attr("uId");
        $.post( '/website/conciergeConfirmationEmail', {userId: userId},
            function (data){
                if (data.result === 1) {
                    $("#unverified-concierge-dialog").overlay().close();
                }
            },'json');
        return false;
    });
    $("#incorrect-concierge-tryagain").click(function(){
        $("#incorrect-concierge-dialog").overlay().close();
        $("#access-code-signup-dialog").overlay().load();
    });

});
</script>
<div id="alert-dialog" class="overlay commonDialog" style="width:398px;z-index:10002"><a class="close"></a>
    <div class="rightVertical" style="margin: 100px 0;">
        <div class="header">
            <p class="header-text" style="text-align: center;"></p>
        </div>
        <div class="body">
            <div class="content" style="margin-bottom: 75px; padding: 0 20px;">
                <p class="message" style="text-align: center;"></p>
            </div>
        </div>
        <div class="footer" style="margin:0 auto;max-width:300px;">
             <div id="alert-dialog-close" class="close-overlay primaryButton button " closepopupid="alert-dialog" style="width:100%;"><span class="title">Close</span></div>        </div>
    </div>
</div>



<div id="conciergeOverlay-dialog" class="overlay medium foyer commonDialog"><a class="close"></a>
    <div class="overlayContent">
        <div class="form">
            <div class="dialog_header" style="margin: 0px;">
                <p class="header-text" style="width: auto; text-align: center; font-size: 24px;">Questions?</p>
            </div>
            <div class="dialog_body" style="margin: 0 60px; width: 300px;">
                <div class="dialog_content" style="text-align: center; width: 300px;">
                    <div class="row" style=" margin-top: 36px; text-align: left;">
                                                <img src="/media/frames/61/elizabeth.jpg" alt="concierge-img" style="width:44px; height: 44px; float: left; border-radius: 22px;">
                        <font style="font-family: 'source-sans-pro-n4',sans-serif; font-size: 14px; color: #888; width: 235px; display: block; margin-top: 3px; padding-left: 56px; line-height: 18px;">Elizabeth and our concierge team would be delighted to assist you.</font>
                    </div>
                    <div class="row liveChatBtn">
                         <div class="concierge-chat-button primaryButton button " style="width: 300px;color: #fff;"><span class="title">Live Chat</span></div>                    </div>
                    <div style="border-bottom: 1px solid #e1e1e1; width: 100%; float: left; margin-top: 10px;"></div>
                    <div class="row" style=" margin-top: 36px;">
                        <p style="font-family: 'source-sans-pro-n4',sans-serif; font-size: 18px; color: #000; margin: 0px; margin-bottom: 5px;">Call</p>
                        <p style="font-family: 'source-sans-pro-n3',sans-serif; font-size: 14px; color: #888; margin: 0px;">
                            <font style="font-family: 'source-sans-pro-n3',sans-serif; font-size: 18px; color: #00a94f;">(415) 376-4640</font><br>
                            Monday through Friday, 9am–6pm PT                        </p>
                    </div>
                    <div class="row" style=" margin-top: 28px; margin-bottom: 36px;">
                        <p style="font-family: 'source-sans-pro-n4',sans-serif; font-size: 18px; color: #000; margin-bottom: 5px;">Send a Message</p>
                        <form class="concierge-overlay" style="position: relative;">
                            <input type="hidden" name="request" value="1">
                            <input type="hidden" name="Suggestion[productId]" attr="productId" value="">
                            <input type="hidden" name="Suggestion[requestTypeId]" value="5">
                            <input type="hidden" name="Suggestion[pageController]" value="website">
                            <input type="hidden" name="Suggestion[pageAction]" value="privacy">
                            <input class="js-email" attr="email" placeholder="Your email address" style="width: 288px; font-family: source-sans-pro-n3,sans-serif; font-size: 15px; color: #888; box-shadow: none; border: 1px solid #e1e1e1;" id="email" type="text" value="" name="email">                            <input type="text" class="js-phone" name="Suggestion[phoneNumber]" attr="phone" placeholder="Your phone (optional)" style="width: 288px; font-family: 'source-sans-pro-n3',sans-serif; font-size: 15px; color: #888; box-shadow: none; border: 1px solid #e1e1e1;">
                            <textarea class="js-suggestion" name="Suggestion[request]" attr="request" style="height: 70px; width: 288px; resize: none; color: black; font-family: 'source-sans-pro-n3',sans-serif; font-size: 15px; ; margin-top: 3px; border: 1px solid #e1e1e1; " placeholder="How can we help you?"></textarea>
                            <p class="errorSummary" style="margin-bottom: 0; float: left;"></p>
                            <div class="row">
                                 <div id="send-question" class=" primaryButton button " style="width: 100%; color: #fff;"><span class="title">Save</span></div>                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="result" style="display: none; height: 180px;">
            <div class="thank-youu-section">
                <div class="section-title" style="margin-top: 20px; width: 100%;">
                    <h3 style="border-bottom: none; display: block; margin-bottom: 40px;">Thank you for your message</h3>
                    <p style="text-align: center; margin-right: 0; letter-spacing: 0.02px; font-size: 18px; color:#888; text-align: center; line-height: 40px;">
                        We will be in touch with you soon!
                    </p>
                </div>
            </div>
        </div>

    </div>
</div>


<style>
    #conversationOverlay-dialog .dialog_header { margin: 0px;}
    #conversationOverlay-dialog .header-text { width: auto; text-align: center; font-size: 24px; margin-left:15px; margin-right:15px;}
    #conversationOverlay-dialog .dialog_body { margin: 0 60px; width: 300px;}
    #conversationOverlay-dialog .dialog_content{text-align: center; width: 300px;}
    #conversationOverlay-dialog .dialog_content .first_row{margin-top: 36px; text-align: left;}
    #conversationOverlay-dialog .dialog_content .second_row{margin-top: 28px; margin-bottom: 36px;}
    #conversationOverlay-dialog .celebrity-img {width:44px; height: 44px; float: left; border-radius: 22px;}
    #conversationOverlay-dialog .first_row span{font-family: 'source-sans-pro-n4',sans-serif; font-size: 15px; color: #888; line-height: 18px; font-weight:bold; word-wrap: break-word;}
    #conversationOverlay-dialog .first_row span.message-text{width: 235px; display: block; margin-top: 3px; padding-left: 56px;}
    #conversationOverlay-dialog .first_row span.celebrity-name{}
    #conversationOverlay-dialog .concierge-overlay{position: relative;}
    #conversationOverlay-dialog #sc-subject-txt{width: 286px; font-family: 'source-sans-pro-n3',sans-serif; font-size: 15px; color: #888; box-shadow: none; border: 1px solid #e1e1e1;}
    #conversationOverlay-dialog #sc-message-txt{height: 70px; width: 288px; resize: none; color: black; font-family: 'source-sans-pro-n3',sans-serif; font-size: 15px; ; margin-top: 3px; border: 1px solid #e1e1e1; }
    #conversationOverlay-dialog .errorSummary{margin-bottom: 0; float: left;}
    #conversationOverlay-dialog  #start-conversation-btn{width: 100%;}
    #conversationOverlay-dialog #sc-conversation-feedback{display: none; height: 180px;}
    #conversationOverlay-dialog .section-title{margin-top: 20px; width: 100%;}
    #conversationOverlay-dialog .section-title .thank_u_text { border-bottom: none; display: block; margin-bottom: 40px;}
    #conversationOverlay-dialog .section-title .see_u_text{text-align: center; margin-right: 0; letter-spacing: 0.02px; font-size: 18px; color:#888; text-align: center; line-height: 40px;}
    
    
    #conversationOverlay-dialog.mobile .dialog_body {float: none; width: 90%; margin: 0 auto;}
    #conversationOverlay-dialog.mobile  .dialog_content{text-align:left; width:auto;}
    #conversationOverlay-dialog.mobile .message-text{width: 215px;}
    #conversationOverlay-dialog.mobile #sc-subject-txt {width:100%;}
    #conversationOverlay-dialog.mobile #sc-message-txt {width:100%; padding: 6px 8px;}
    #conversationOverlay-dialog.mobile #start-conversation-btn { width:100%;}
    #conversationOverlay-dialog .section-title{text-align: center;}
    #conversationOverlay-dialog.mobile #sc-conversation-form .dialog_content {width:100%;}
    
</style>

<div id="conversationOverlay-dialog" class="overlay medium foyer commonDialog desktop" style="display:none;">
    <div class="overlayContent">
        <div id="sc-conversation-form" class="form">
            <div class="dialog_header">
                <p class="header-text">Questions?</p>
            </div>
            <div class="dialog_body">
                <div class="dialog_content">
                    <div class="row first_row">
                        
                        <input type="hidden" class="p_origin">
                        <input type="hidden" class="p_type">
                        <input type="hidden" class="p_id">
                        
                        
                        <img src="" alt="celebrity-img" class="celebrity-img">
                        <span class="message-text" style="   ">
                            Start a Conversation <br> with
                            <span class="celebrity-name" style=" "></span>
                        </span>
                    </div>

                    <div class="row second_row">
                        <form class="concierge-overlay">
                            <input type="text" id="sc-subject-txt" class="subject-txt" placeholder="Title" maxlength="100" style="">
                            <textarea id="sc-message-txt" placeholder="Please enter your question"></textarea>
                            <p class="errorSummary"></p>
                            <div class="row sent_btn_row" style="">
                                 <div name="save" id="start-conversation-btn" class="primaryButton button"><span class="title">SEND</span></div> 
<!--                                <div class="button-wrap" style="">
                                    <div class="button-outer">
                                        <input type="button" class="celeb-button button-wide" id="start-conversation-btn" name="save" value="SEND"
                                               style="" />
                                    </div>
                                </div>-->
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="sc-conversation-feedback" class="result" style="">
            <div class="thank-you-section">
                <div class="section-title" style="">
                    <h3 class="thank_u_text" style="">Thank you for your question</h3>
                    <p class="see_u_text" style="">
                        We will be in touch with you soon!
                    </p>
                </div>
            </div>
        </div>

    </div>
</div>

<script type="text/javascript">
    
    // to use:
    // click link event defined in common.js,  seach .phone
    // sample link in:  _section_product_description.php
    // basic usage
    //    if(g_is_mobile){
    //        displayOverlay('conversationOverlay-dialog');
    //    }else{
    //        $('#conversationOverlay-dialog').overlay().load();
    //    }
    //
    //     $('#conversationOverlay-dialog').overlay().close(); 
    
    ioReady(function(){
        var pos = !isHandheld();
        $("#conversationOverlay-dialog").overlay({
            top: 60, left: getPopupLeftToCenter("conversationOverlay-dialog"), fixed: pos, closeOnClick: true,
            mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 },

            onLoad: function(){           
                $.post('/website/logPageView',{
                    'pageId': this.getOverlay().attr('id'),
                },function(data){},'json');

            },
            onClose : function(){


                var feedback_visible =  $('#sc-conversation-feedback').css('display') ;
                
                //console.info('feedback visibale:' + fee )
                if(feedback_visible!='none'){
                    $('#sc-conversation-feedback').css('display', 'none');
                    $('#sc-conversation-form').css('display', 'block');
                    $('#sc-message-txt').val('')
                    $("#send-message .errorSummary").html('')
                }
                else{
                    //$('#sc-conversation-feedback').css('display', 'block');
                    //$('#sc-conversation-form').css('display', 'none');
                }

            }
        });


        $("#conversationOverlay-dialog #start-conversation-btn").click(function(e){

            var origin = $("#conversationOverlay-dialog .p_origin").val();
            var type = $("#conversationOverlay-dialog .p_type").val();
            var id = $("#conversationOverlay-dialog .p_id").val();

            var subject = $.trim($('#sc-subject-txt').val())
            if(subject==''){

                displayError("#sc-conversation-form .errorSummary", "Please enter a subject.");
                return;
            }

            var msg =$.trim($('#sc-message-txt').val())
            if(msg==''){

                displayError("#sc-conversation-form .errorSummary", "Please enter your message.");
                return;
            }

            jQuery.ajax({
                type: "POST",
                url: g_url_start_conversation,
                data: {type:type, id:id, subject:subject,  msg:msg, origin: origin},
                success: function(data){

                    if (data.result == g_result_sucess ) {

                        $('#sc-conversation-form').css('display', 'none');
                        $('#sc-conversation-feedback').css('display', 'block');
                        $('#sc-subject-txt').val('');
                        $('#sc-message-txt').val('');

                        resetError("#send-message .errorSummary")

                    } else {
                        if (data.error_code == g_err_not_logged_in ) {
                            $("#signUp-dialog-called-from").val("ProductConversation");
                            signupDialog();
                            return false;
                        }
                        //window.alert(getErrorMessage(data));
                        displayError("#sc-conversation-form .errorSummary", 'Error: ' + data.msg);
                    }

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    //displayError("#sc-conversation-form .errorSummary", "Error in starting conversation.");
                    alert_error("error in starting conversation <br />status:" + textStatus + " <br />error:" + errorThrown + " <br /><br />" +XMLHttpRequest.responseText);
                
                }
            });
        });

    });
</script>



<script type="text/javascript">
$(document).ready(function(){
    $("#conciergeOverlay-dialog input[attr=phone]").keypress(function(){
        $("#conciergeOverlay-dialog .optional").hide();
    });
    $("#conciergeOverlay-dialog .optional").click(function(){
        $("#conciergeOverlay-dialog input[attr=phone]").focus();
    });
});

$(window).load(function(){
    var pos = !isHandheld();
    $("#alert-dialog").overlay({
        top: 'center', left: getPopupLeftToCenter("alert-dialog"), fixed: pos, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 400, closeSpeed:0, opacity: 0.5 },
    });
    $("#confirm-dialog").overlay({
        top: 60, left: getPopupLeftToCenter("confirm-dialog"), fixed: pos, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 }
    });
    $("#conciergeOverlay-dialog").overlay({
        top: 0, left: getPopupLeftToCenter("conciergeOverlay-dialog"), fixed: pos, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 },
        onClose : function(){

            var feedback_visible =  $('#conciergeOverlay-dialog .result').css('display') ;

            //console.info('feedback visibale:' + fee )
            if (feedback_visible !== 'none') {
                $('#conciergeOverlay-dialog .result').css('display', 'none');
                $('#conciergeOverlay-dialog .form').css('display', 'block');
                //$('#conciergeOverlay-dialog .js-email').val('');
                $('#conciergeOverlay-dialog .js-phone').val('');
                $('#conciergeOverlay-dialog .js-suggestion').val('');
                $("#conciergeOverlay-dialog .errorSummary").html('');
            }
            else{
                //$('#sc-conversation-feedback').css('display', 'block');
                //$('#sc-conversation-form').css('display', 'none');
            }

        }
    });
});
</script>
<style type="text/css">
#tour-overlay {width:100%; height:100%; text-align:center; display:table; background: transparent; }
#tour-overlay .arrowBox {position:relative; float:none; display:table-cell; vertical-align: middle; width:45px; height:100%;}
#tour-overlay .rightArrow{cursor:pointer; padding:40px 0 40px 40px}
#tour-overlay .leftArrow{cursor:pointer; padding:40px 40px 40px 0}
#tour-overlay .cover {background:#fff; opacity:.95; height:100%; width:100%; position:absolute;}
#tour-overlay .scroll {height:100%; position:relative; overflow:hidden; vertical-align:middle; display:table-cell; margin-left: 2px; margin-bottom: 2px; float:none;
    /* Firefox */
    width: -moz-calc(100% - 100px);
    /* WebKit */
    width: -webkit-calc(100% - 100px);
    /* Opera */
    width: -o-calc(100% - 100px);
    /* Standard */
    width: calc(100% - 100px);
}
#tour-overlay a.close {padding:40px; top:0; right:0;}
#tour-overlay .wishlist{ -webkit-transition: 0.2s ease-in-out;
                        -moz-transition: 0.2s ease-in-out;
                        -o-transition: 0.2s ease-in-out;
                        transition: 0.2s ease-in-out;}
#tour-overlay .pics div.inactive {display:none;}
#tour-overlay .pics div.active {display:inline-block;}
#tour-overlay .pics div img {text-align:center;}
#tour-overlay .scroll .pics div .table {display:table;}
#tour-overlay .scroll .pics div .tourImage {max-height: 700px; max-width:930px; min-height:400px; min-width: 500px; }
#tour-overlay .scroll .pics div p.pageNumber{letter-spacing: 0.02em; font-size:17px; font-family:Georgia; border:1px solid #e1e1e1; width:86px; height:44px; color:#000;
          background-color:#fff; position:absolute; margin-top:-46px; line-height:44px; vertical-align:middle;}
#tour-overlay .scroll .pics div .content{display:table-caption; caption-side:bottom; background:#333; color:#fff; padding:30px; text-align:left; position:relative; }
#tour-overlay .scroll .pics div .content .title{font-size:18px; font-family:Georgia; padding-bottom:15px; letter-spacing: 0.02em;}
#tour-overlay .scroll .pics div .content .description{font-family:"source-sans-pro-n3",sans-serif; font-size:16px; letter-spacing: 0.02em;}

#tour-overlay .scroll .pics div .pageNumber{font-family:Georgia;}
#tour-overlay .scroll .pics div .pageNumber em{font-family:Georgia; font-size:17px;}

@media (max-height: 900px) {
    #tour-overlay .scroll .pics div .tourImage {max-height: 500px; max-width:880px; min-height:400px; min-width: 500px; }
}
</style>

<div id="tour-overlay" class="overlay" style="display:none;"><a class="close"></a>
    <div class="cover"></div>
    <div class="arrowBox">
        <img class="leftArrow" src="/images/marquee_scroll_arrow-left_big.png">
    </div>
    <div class="scroll">
        <div class="pics"></div>
    </div>
    <div class="arrowBox">
        <img class="rightArrow" src="/images/marquee_scroll_arrow-right_big.png">
    </div>
</div>

<script type="text/javascript">
 $(window).load(function(){
    var pos = !isHandheld();
    var tour = '';
    var slide = '';
    var size  = 0;
    var originalUrl = window.location.href;
    var imageTypeId = '34'; //frameAltImage
    var width       = $(window).width();

    $("#tour-overlay").overlay({
        top:0, left: 0, fixed: pos, closeOnClick: true, mousewheel: false,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0 },
        onLoad: function(){
            $('body').addClass('noscroll');
            if(typeof adjustTourIpad !== 'undefined'){             // only runs on Ipad
                $("#tour-overlay").css({top:'0px'});
                adjustTourIpad();
            }
        },
        onClose: function(){
            //$("#tour-overlay .pics").empty();
            //remove events from scroller because no method to removeItem or reinitialize
            //var clone = $("#tour-overlay .scroll").clone();
            //$("#tour-overlay .scroll").replaceWith(clone);
            $('body').removeClass('noscroll');
                        //    history.replaceState(null, null, "/");
            //                //history.pushState(null, null, originalUrl);
        },
    });

    $("#pdp, .js-show-tour").on('click', '.showTour, .tourContainer .resizableImage', function(){
        if ($(this).hasClass('disabled')) {
            return false;
        }
        imageTypeId = $(this).attr("imageTypeId");

        if ($("#tour-overlay .pics").html() !== '') {
            $("#tour-overlay").overlay().load();
            return false;
        }

        $(this).addClass('disabled');

        var primaryKeyId = $(this).attr("primaryKeyId");
        var celebId      = $(this).attr("celebId");
        var slideIndex   = $(this).attr("slide");
        var videoUrl     = $(this).attr('data-url');
        var _this        = this;
        $.post('/website/tourui',
            { primaryKeyId: primaryKeyId, imageTypeId: imageTypeId, celebId: celebId, videoUrl:videoUrl},
            function(data){
                if (data.result === 1) {
                    if(data['html'].length >0){
                        $("#tour-overlay .pics").append(data['html']);
                        size = data['size'];

                        initScroller();
                        if(slideIndex){
                            $(".scroll").scrollable().seekTo(slideIndex-1);
                        }else{
                            var slash = window.location.href.lastIndexOf("/") === window.location.href.length-1 ? "" : "/";
                            //history.pushState(null, null, window.location + slash + 'tour/'+imageTypeId+primaryKeyId+'/slide/1');
                        }

                        var firstChild = $("#tour-overlay .pics div:nth-child(2)");
                        firstChild.removeClass("inactive");
                        firstChild.addClass("active");
                        //delay seekTo in scrollable so it doesnt flash
                        $("#tour-overlay").overlay().load();
                    }
                } else {
                    console.log(data);
                }
                $(_this).removeClass('disabled');
            }, 'json'
        );


    });

    if (tour !== ''){
        $("#tour"+tour).attr("slide", slide);
        $("#tour"+tour).trigger("click");

    }

    $("#tour-overlay .leftArrow").click(function(){
        $(".share-box").fadeOut();
        var index      = parseInt($(".scroll .active .pageNumber").attr("number")) - 1;
        if(index <= 0)  index = size;
        updateUrl(index);
    });

    $("#tour-overlay .rightArrow").click(function(){
        $(".share-box").fadeOut();
        var index      = parseInt($(".scroll .active .pageNumber").attr("number"))%size + 1;
        updateUrl(index);
    });

    $("#tour-overlay").on("click", ".wishlist .white", function() {
        if(!g_is_guest){
            if(imageTypeId === '34'){ //only change wishlist for current item
                $(this).hide();
                $(this).siblings(".green").fadeIn();
            }else{ //product tourUI
                $("#tour-overlay .wishlist .white").hide();
                $("#tour-overlay .wishlist .green").fadeIn();
            }
        }
    });

    $("#tour-overlay").on("mouseenter", ".share", function(){
        $(this).siblings(".share-box").fadeIn();
    });
    $("#tour-overlay").on("click", ".share", function(){
        $("#tour-overlay .share-box").fadeIn();
    });

    $("#tour-overlay").on("click", ".share-box .close", function(){
        $(".share-box").fadeOut();
        return false;
    });

    $("#tour-overlay").on("click", ".share-box", function(event){
        event.stopPropagation();
    });

    $("#tour-overlay").click(function(){
        $(".share-box").fadeOut();
    });

    jQuery(window).on('orientationchange', function(e) {
        width  = $(window).width();
        $("#tour-overlay").css({"width": width+"px"});
    });

    function updateUrl(index){
        //var url        = window.location.href;
        //var slideIndex = url.indexOf("slide");
        //history.pushState(null, null, url.substring(0, slideIndex)+"slide/"+index);
    }

    function initScroller(){
        $("#tour-overlay .scroll").scrollable({
            circular: true,
            prev: '#tour-overlay .leftArrow',
            next: '#tour-overlay .rightArrow',
            speed: 100,
            onSeek: function(event, index) {
                hideOtherTourItems(index);
            }
        });
    }


    // Hide other scroll celebrity items to avoid ctrl+F5 issue
    function hideOtherTourItems(index){
        var nth     = index + 2; /* index starts 0, nth-child starts 1, need to add 1 for cloned */
        var $select = $("#tour-overlay .pics > div:nth-child(" + nth + ")");
        $select.siblings().removeClass("active");
        $select.siblings().addClass("inactive");
        $select.removeClass("inactive");
        $select.css("opacity", 0);
        $select.animate({opacity: '1.0'}, 300);
        $select.addClass("active");
    }

    function stopWheel(e){
        if(!e){ /* IE7, IE8, Chrome, Safari */
            e = window.event;
        }
        if(e.preventDefault) { /* Chrome, Safari, Firefox */
            e.preventDefault();
        }
        e.returnValue = false; /* IE7, IE8 */
    }
 });
</script>
    <script>
        //var midTime1 = new Date().getTime();
        //console.log("midTime1 "+ (midTime1 - startTime)/1000 +" seconds");
    </script>
    <div id="trackingImage" style="height:1px;display: none;position: absolute;"><img height="1" width="1" alt="" style="display:none" src="https://pubads.g.doubleclick.net/activity;dc_iu=/72241422/DFPAudiencePixel;dc_seg=65565610?"></div>
    <div id="wrapper">
                    <div id="content" class="   " style="min-height: 388px;">
                <div class="callOut" style="display:none; ">
    <div class="following-callOut" style="display:none;">
            <div class="following-container">
                <p class="following-new">NEW</p>
                <p class="following-h">You can now follow this luminary</p>
                <div class="following-points"><img style="width:12px; float: left; margin-top:5px;" src="/images/io/icon_checkmark_green.png"><p style="float:left; width:170px">Be the first to hear about their new offerings</p></div>
                <div class="following-points"><img style="width:12px; float: left; margin-top:5px;" src="/images/io/icon_checkmark_green.png"><p style="float:left; width:170px; margin-top: 0px;">Receive news &amp; updates</p></div>
            </div>
    </div>
</div>
                                    <div id="main" class="">
                        <div id="left-main" style="left:-140px; position:relative;"></div>
                        <div id="main-detail">
    <div class="celeb-band celeb-bgcolor"></div>
    <div class="content-wrapper return-wrapper">
        <div class="content-header celeb-color">
            <h2>Traina Interactive Privacy Policy</h2>
        </div>
        <div class="left-pane celeb-color-anchor">
            <p class="p1"><strong>IfOnly Privacy Policy</strong></p>
<p class="p1"><strong>Last Updated: September 28, 2015</strong></p>

<p class="p3">Your privacy is important to us. Accordingly, we’re providing this Privacy Policy to explain our practices regarding the collection, use and disclosure of information that we receive when you use our Services. This Privacy Policy does not apply to any third-party websites, services or applications.&nbsp; Any information that we collect is subject to the privacy policy in effect at the time that information is collected.&nbsp; We may, however, modify and revise this Privacy Policy from time to time.&nbsp; If we make any material changes to this Privacy Policy, we’ll notify you of those changes by posting them on the Services or by sending you an email or other notification, and we’ll indicate when those changes will become effective.&nbsp; Also, please note that, unless we define a term in this Privacy Policy, all capitalized words used in this Privacy Policy have the same meanings as in our Terms of Service.</p>

<p class="p5"><strong>How do we collect and use information?</strong></p>
<p class="p6">Our primary goals in collecting information are to provide and improve our Services, to administer your use of the Services (including your Account, if you are a Member), to provide you with more relevant Experiences recommendations and otherwise improve the Services, and to enable you to easily offer, browse and purchase Experiences.&nbsp;</p>
<p class="p3"><span class="s1">Account Information</span>. If you create an Account, we’ll collect certain information that can be used to identify you, such as your name, email address, postal address and phone number (“<strong>PII</strong>”). If you create an Account using your login credentials from one of your SNS Accounts, we’ll be able to access and collect your name and email address and other PII that your privacy settings on the SNS Account permit us to access. When you make purchases on our Site, we may store your billing information, purchase history and your credit card information.</p>

<p class="p3"><span class="s1">Information Collected Using Log Files, Cookies and other Web Technologies</span>.&nbsp; Like many website owners, we use automated data collection tools such as Cookies to collect certain information. “<strong>Cookies</strong>” are small text files that are placed on your hard drive by a Web server when you access our Services. We may use both session Cookies and persistent Cookies to identify that you’ve logged in to the Services and to tell us how and when you interact with our Services. We may also use Cookies to monitor aggregate usage and web traffic routing on our Services and to customize and improve our Services. Unlike persistent Cookies, session Cookies are deleted when you log off from the Services and close your browser. Although most browsers automatically accept Cookies, you can change your browser options to stop automatically accepting Cookies or to prompt you before accepting Cookies. Please note, however, that if you don’t accept Cookies, you may not be able to access all portions or features of the Services. Some third-party services providers that we engage (including third-party advertisers) may also place their own Cookies on your hard drive. Note that this Privacy Policy covers only our use of Cookies and does not include use of Cookies by such third parties.<span class="s2">&nbsp;</span></p>

<p class="p3"><span class="s1">Information Related to Use of the Services</span>. Our servers automatically record certain information about how a person uses our Services (we refer to this information as “<strong>Log Data</strong>”), including both Account holders and non-Account holders (either, a “<strong>User</strong>”). Log Data may include information such as a User’s Internet Protocol (IP) address, browser type, operating system, the web page that a User was visiting before accessing our Services, the pages or features of our Services to which a User browsed and the time spent on those pages or features, search terms, the links on our Services that a User clicked on and other statistics. We use this information to administer the Services and we analyze (and may engage third parties to analyze) this information to improve and enhance the Services by expanding their features and functionality and tailoring them to our Users’ needs and preferences.</p>

<p class="p7"><strong>What Information Do We Share With Third Parties?</strong></p>

<p class="p3">We will not share any PII that we have collected from you except as described below:</p>

<p class="p3"><span class="s1">Information Shared when Using the Services</span>.&nbsp; There are various ways Members can make their PII publicly available through the Services or ways in which they can supply such information to Traina Interactive and other Members. Proving your PII and any other data through the Services, in connection with Experiences or to Traina Interactive whether you are Member or otherwise, is voluntary and should correlate with the degree of interaction you want to have with other users and Traina Interactive.&nbsp;</p>

<p class="p3">When you apply to become a Luminary you will submit certain PII to us to complete your application.&nbsp; If you are approved and become a Luminary, the PII you provide in your Experience Listing will be publicly available for viewing via the Services.&nbsp; In connection with fulfilling in-person Experiences, as a Luminary, the contact information you provide for use on the day of the Experience will be shared with the purchasing End User.&nbsp; As an End User, the PII that is shared with the Luminary depends on the type of Experience and information about you that is necessary to process your request. For example, when you purchase a physical Product your name and billing address, and the name, shipping address and phone number for the recipient of the Product, will be shared with the Luminary; and when you request to schedule an Experience, your name and any other required information indicated in the Experience Listing like the names of any other participants, the location address and other details necessary to schedule the Experience will be shared with the Luminary to process your request.&nbsp; Luminaries are obligated to use your PII solely to fulfill the Experience and administer your related requests.&nbsp; Luminaries and End Users also have the opportunity to communicate with each other one-to-one via our Services in connection with the purchase, scheduling and participation in Experiences.</p>

<p class="p3"><span class="s1">Information Shared with Our Services Providers</span>.&nbsp; We may engage third party service providers to work with us to administer, provide and improve the Services. These third-party services providers have access to your PII only for the purpose of performing services on our behalf.</p>

<p class="p3"><span class="s1">Information Shared with Third Parties</span>. We may share aggregated information and non-identifying information with third parties for industry research and analysis, demographic profiling and other similar purposes.</p>

<p class="p3"><span class="s1">Information Disclosed in Connection with Business Transactions</span>. Information that we collect from our users, including PII, is considered to be a business asset. As a result, if we go out of business or enter bankruptcy or if we are acquired as a result of a transaction such as a merger, acquisition or asset sale, your PII may be disclosed or transferred to the third-party acquirer in connection with the transaction.</p>

<p class="p3"><span class="s1">Information Disclosed for Our Protection and the Protection of Others</span>. We cooperate with government and law enforcement officials or private parties to enforce and comply with the law. We may disclose any information about you to government or law enforcement officials or private parties as we, in our sole discretion, believe necessary or appropriate: (i) to respond to claims, legal process (including subpoenas); (ii) to protect our property, rights and safety and the property, rights and safety of a third party or the public in general; and (iii) to stop any activity that we consider illegal, unethical or legally actionable activity.</p>

<p class="p3"><span class="s1">Information We Disclose With Your Consent or at Your Request</span>. We will share your information when you give us your consent to do so. For example, if you expressly request that we do so, we will share your PII with third-party sites or platforms, such as social networking sites.</p>

<p class="p7"><strong>The Security of Your Information</strong></p>
<p class="p3">We take reasonable measures to protect the information that we collect from or about you (including your PII) from unauthorized access, use or disclosure. Please be aware, however, that no method of transmitting information over the Internet or storing information is completely secure. Accordingly, we cannot guarantee the absolute security of any information.</p>

<p class="p7"><strong>Links to Other Sites</strong></p>
<p class="p3">Our Services may contain links to other websites and services. Any information that you provide on or to a third-party website or service is provided directly to the owner of the website or service and is subject to that party's privacy policy. Our Privacy Policy does not apply to such websites or services and we’re not responsible for the content, privacy or security practices and policies of those websites or services. To protect your information we recommend that you carefully review the privacy policies of other websites and services that you access.</p>

<p class="p7"><strong>Modifying Your Information</strong></p>
<p class="p3">You can access and modify the PII associated with your Account by emailing terms@ifonly.com. If you want us to delete your PII and your Account, please contact us at concierge@ifonly.com with your request. We’ll take steps to delete your information as soon as is practicable, but some information may remain in archived/backup copies for our records or as otherwise required by law.</p>

<p class="p7"><strong>International Transfer</strong></p>
<p class="p3">Your PII may be transferred to, and maintained on, computers located outside of your state, province, country or other governmental jurisdiction where the privacy laws may not be as protective as those in your jurisdiction. If you’re located outside the United States and choose to provide your PII to us, we may transfer your PII to the United States and process it there.&nbsp;</p>

<p class="p7"><strong>Our Policy Toward Children</strong></p>
<p class="p3">Our Services are not directed to children under 13 and we do not knowingly collect PII from children under 13. If we learn that we have collected PII of a child under 13 we will take steps to delete such information from our files as soon as possible.</p>

<p class="p7"><strong>Questions?</strong></p>
<p class="p3">Please contact us at terms@ifonly.com if you have any questions about our Privacy Policy.</p>
        </div>
        <div class="right-pane">
            <div class="helpBox">
    <div class="container">
        <p class="subheader">CONCIERGE</p>
        <p>If you have any questions, </p>
        <p>Please email us at</p>
        <p class="celeb-color" style="font-weight: bold;"><a href="mailto:concierge@ifonly.com">concierge@ifonly.com</a></p>
        <p>OR call (415) 376-4640</p>
    </div>
</div>        </div>

    </div>
</div>

<style type="text/css">
    ul.list-disc,ul.list-disc,ul.list-roman, ul.list-numbered, ul.list-alpha{
        margin-left: 2em;
    }
</style>                    </div>
                                </div>
            <!-- _mobile  -->
<div id="footer" class="mobile  ">
        <div id="footer-contact">
            <div class="center" style="width:340px">
                <div class="row" style="margin: 15px auto 0; float: none; text-align: center;">
                    <p style="margin-bottom:15px">We would be delighted to help you!</p>
                     <div class="btn-m call whiteButton button " style="width:136px" onclick="javascript: window.location.href='tel://1-415-754-8167';"><span class="title"><img style="vertical-align: middle;width: 12px;padding: 0 6px 4px 0;" src="/m/images/icon_phone.png">
                                                <span class="title">CALL</span></span></div>                     <div class="btn-m whiteButton button " style="width:136px" onclick="javascript: window.location.href='mailto:concierge@ifonly.com';"><span class="title"><img style="vertical-align: middle;width: 12px;padding: 0 6px 4px 0;" src="/m/images/icon_email.png"><span class="title">EMAIL</span></span></div>                </div>

                <div style="clear:both;"></div>
            </div>
        </div>

        
    <div id="footer-menu" class="mobile  ">
                    <div class="center">
                <div class="row" style="margin: 20px auto;">
                    <p style="margin-bottom:8px">Visit Us</p>
                    <ul id="stay-connected">
                        <li><a href="https://www.facebook.com/IfOnlycom" target="_blank" class="allowAllUsers"><img src="/images/IFO_Social_Icon_Facebook.png"></a></li>
                        <li><a href="https://twitter.com/ifonly" target="_blank" class="allowAllUsers"><img src="/images/IFO_Social_Icon_Twitter.png"></a></li>
                        <li><a href="https://instagram.com/ifonly/" target="_blank" class="allowAllUsers"><img src="/images/IFO_Social_Icon_Instagram.png"></a></li>
                        <li><a href="https://www.pinterest.com/ifonlydotcom/" target="_blank" class="allowAllUsers"><img src="/images/IFO_Social_Icon_Pinterest.png"></a></li>
                    </ul>
                    <ul id="site-link">
                        <li><a href="/m/aboutus" class="allowAllUsers">About Us</a></li>
                        <li class="separator">|</li>
                        <li><a href="/m/website/privacy" class="allowAllUsers">Privacy</a></li>
                        <li class="separator">|</li>
                        <li><a href="/m/website/terms" class="allowAllUsers">Terms Of Use</a></li>
                        <li class="separator">|</li>
                        <li><a href="/m/sitemap" class="allowAllUsers">Sitemap</a></li>
                        <li class="separator">|</li>
                        <li><a href="/m/website/viewDesktop" style="text-decoration: underline" class="allowAllUsers">Full Site</a></li>
                    </ul>
                </div>

                <div style="clear:both;"></div>
            </div>
            
        <div>
                    <div id="hidden-info" class="responsive  hidden-info-desktop">
            <p>www04-SI1-SE33035925-SO0-U0-V-H0-mA0-uA1-auto0-0.041<cachetime></cachetime></p>        </div>
                </div>
    </div>

    <div style="clear:both;"></div>

</div>



<div id="footer" class="desktop responsive ">
    <div id="footer-center" style="width:100%; margin:0 auto;" class="responsive  ">
        <div id="footer-logo">
            <img src="/images/IfOnly-key-white.png">
        </div>
        <div id="footer-menu" class="responsive  ">
                            <ul class="footer-menu-item">
                    <p>Company</p>
                    <li><a href="/aboutus" class="allowAllUsers">About Us</a></li>
                    <li><a href="#" class="js-d-how-ifonly-works allowAllUsers">How It Works</a></li>
                    <li><a href="/careers" class="allowAllUsers">Careers</a></li>
                    <li><a href="/press" class="allowAllUsers">Press</a></li>
                    <li><a href="/blog" class="allowAllUsers">Blog</a></li>

                    <li><a href="/past-events" class="allowAllUsers">Past Events &amp; Products</a></li>
                </ul>
                <ul class="footer-menu-item">
                    <p>Customer Care</p>
                    <li><div id="email-us">Email Us</div><div>1 (415) 376-4640</div></li>
                    <li><a href="/website/customerCare#return" class="allowAllUsers">Returns &amp; Shipping</a></li>
                    <li><a href="//support.ifonly.com" class="allowAllUsers">FAQs</a></li>
                                        <li><a href="/sitemap" class="allowAllUsers">Sitemap</a></li>
                    <li><a href="/allCelebrities" class="allowAllUsers">All Luminaries</a></li>
                </ul>
                <ul class="footer-menu-item">
                    <p>Working with Us</p>
                    <li><a href="/website/workingWithUs" class="allowAllUsers">Charities</a></li>
                    <li><a href="/website/workingWithUs#partnerships" class="allowAllUsers">Luminaries</a></li>
                    <li><a href="/website/partner" class="allowAllUsers">Our Partners</a></li>
                    <li><a href="/corporate" class="allowAllUsers">Corporate Services</a></li>
                    <li><a href="/charity/charityList/" class="allowAllUsers">Our Charities (A-Z)</a></li>
                </ul>
                <ul class="footer-menu-item">
                    <p>Policies</p>
                    <li><a href="/website/privacy" class="allowAllUsers">Privacy</a></li>
                    <li><a href="/website/terms" class="allowAllUsers">Customer Terms Of Use</a></li>
                    <li><a href="/website/termsVendor" class="allowAllUsers">Luminary Terms Of Use</a></li>
                </ul>
                <ul id="stay-connected" class="footer-menu-item">
                    <p>Stay Connected</p>
                    <li><a href="https://www.facebook.com/IfOnlycom" target="_blank" class="allowAllUsers"><img class="social-media-icons" src="/images/IFO_Social_Icon_Facebook.png"></a></li>
                    <li><a href="https://twitter.com/ifonly" target="_blank" class="allowAllUsers"><img class="social-media-icons" src="/images/IFO_Social_Icon_Twitter.png"></a></li>
                    <li><a href="https://instagram.com/ifonly/" target="_blank" class="allowAllUsers"><img class="social-media-icons" src="/images/IFO_Social_Icon_Instagram.png"></a></li>
                    <li><a href="https://www.pinterest.com/ifonlydotcom/" target="_blank" class="allowAllUsers"><img class="social-media-icons" src="/images/IFO_Social_Icon_Pinterest.png"></a></li>
                </ul>
                                    <a href="/marketplace/" class="footer-marketplace responsive   allowAllUsers">SELL EXPERIENCES</a>
                        </div>
                <div id="hidden-info" class="responsive  hidden-info-desktop">
            <p>www04-SI1-SE33035925-SO0-U0-V-H0-mA0-uA1-auto0-0.042<cachetime></cachetime></p>        </div>
                <!--For Google Analytics-->
        <div id="google-tracking" from=""></div>
    </div>
</div>

<script type="text/javascript">
$(function(){
    $("#footer-menu a").addClass("allowAllUsers");
});
$(document).ready(function(){
    $('#email-us').click(function(){
        $("#conciergeOverlay-dialog").overlay().load();
        return false;
    });
});
</script>

<style>
    #footer-menu { position:relative; z-index: 2;}
</style>

<script type="text/javascript">
$(window).load(function(){
    $('#concierge-email-button').click(function(){
        $("#concierge-right").click();
        showConciergeEmailPopup();
        return false;
    });

    $("#concierge-email-dialog").appendTo("body");
	$("#concierge-email-dialog").overlay({
        top: 100, left:getPopupLeftToCenter("concierge-email-dialog"), fixed: false, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, opacity: 0.5 },
        onLoad: function(){
            $('.errorSummary').hide();
            ga('send', 'pageview', 'Concierge email dialog');
            $.post('/website/logPageView',{'pageId':this.getOverlay().attr('id')},function(data){},'json');
        }
    });
});

$(document).ready(function(){

    $("#concierge-email-submit-button").unbind("click").click(function(){
        var name    = $("#concierge-email-name");
        var email   = $("#concierge-email-address");
        var message = $("#concierge-email-message");

        if ($.trim(name.val()) === '' || name.val() === name.attr('default-value')) {
            displayError("#concierge-email-dialog .errorSummary", 'Please enter your name.');
            return false;
        }
        if ($.trim(email.val()) === '' || email.val() === email.attr('default-value') || !validateEmail(email.val())) {
            displayError("#concierge-email-dialog .errorSummary", 'Please enter a valid email address.');
            return false;
        }
        if ($.trim(message.val()) === '' || message.val() === message.attr('default-value')) {
            displayError("#concierge-email-dialog .errorSummary", 'Please enter your message.');
            return false;
        }
        $.post('/website/question', {'name':name.val(),'email':email.val(),'Suggestion[request]':message.val(),'Suggestion[requestTypeId]':5},
        function(data){
            //console.log(data);
            $("#concierge-email-dialog").overlay().close();
            alertEx("We will contact you soon. Thank you!");

        }, 'json');

        return false;
    });
});

function showConciergeEmailPopup() {
    $("#conciergeOverlay-dialog").overlay().load();
}
</script>
<div id="chat-div">
</div>
<style type="text/css">
    
    .ui-chatbox {display: none; z-index: 99999;}
    .ui-chatbox .ui-widget-header a:nth-of-type(even){margin-right: 20px;}
    .ui-chatbox .ui-chatbox-input{position: relative;}
    .ui-chatbox .ui-chatbox-input textarea.ui-chatbox-input-box {border: 1px solid #e2e2e2; resize: none; outline: none; margin-top: 12px; margin-bottom: 12px; font-family: "source-sans-pro-n3",sans-serif;}
    .ui-chatbox .ui-chatbox-input p.typing{position: absolute; font-family:Georgia; font-style: italic; font-size: 13px; color: #888; display: none; right: 2px; bottom: -1px;}
    .ui-chatbox .ui-chatbox-titlebar > span{line-height: 40px;
                                            font-family: georgia;
                                            font-size: 20px;
                                            margin-left: 6px;
                                            color: #fff;}
    
    #chat-div p.chatRecord{text-align: left; font-size: 15px; letter-spacing: 0.014em; line-height: 18px; margin: 5px 5px; color: #888;}
    #chat-div p.chatRecord.infoText{color:#00a94f;}
    #chat-div p.chatRecord.operatorText{color: #000;}
    .ui-chatbox-log{border: 1px solid #e2e2e2; }
    .ui-chatbox-titlebar.ui-widget-header{ 
        background: #333;
        border: 1px solid #333;
        height: 40px;
        border-radius: 0px;
        cursor: default;
    }
    .ui-chatbox .ui-chatbox-input{ border: none;}
    .ui-chatbox.ui-widget{padding: 1px; background: #333; border-radius: 0px;}
    .ui-widget-header.ui-chatbox-titlebar .ui-icon { background-size: 100%; margin-top: 12px; background-position: 0px;}
    .ui-widget-header.ui-chatbox-titlebar .ui-icon.ui-icon-minusthick{ background-image: url(/images/icon_minimize_FFF.png);}
    .ui-widget-header.ui-chatbox-titlebar .ui-icon.ui-icon-closethick{ background-image: url(/images/icon_close_FFF.png); margin-right: 10px;}
    .ui-widget-header.ui-chatbox-titlebar .ui-chatbox-icon.ui-state-hover{ border: none; background: #333;}
</style>

<script type="text/javascript">
$(document).ready(function(){
    $('.concierge-chat-button').click(function(){
        if($("#concierge-right").length >0){
            $("#concierge-right").click();
        }
        if($("#conciergeOverlay-dialog").length > 0){
            $("#conciergeOverlay-dialog").overlay().close();
        }
        $("#chat-div").chatbox(
                {   id:"chat-div", 
                    user:{key : "value"},
                    title : "Live Chat with IfOnly",
                    offset: "60px",
                    hidden: false, // show or hide the chatbox
                    width: 300, // width of the chatbox
                    messageSent : function(id, user, msg) {
                        if(sendText()){
                            
                        }
                    },
                    boxClosed: function(id) {
                        if(typeof(lpc)!='undefined'){ 
                            if(chatStart){ // if chat already be settUp
                                chatStart = false; 
                                lpc.endChat();     
                            }
                        }
                        $('#chat-div').html("");
                    }, // called when the close icon is clicked
                }
        );
        if(typeof(lpc)=='undefined'){   // script not load on time 
            $('#chat-div').html("<p class='chatRecord infoText'>Loading...</p>");
            setTimeout(function(){
                if(typeof(lpc)=='undefined'){   // lpc is still undefined after 1 second, unknow error, close chat window
                    //$("#concierge-chat-dialog").overlay().close();
                    alertEx("Live chat is not available now, please call (415) 376-4640. We will be be delighted to help you.");
                }else{
                    console.log("set up chat session");
                    $('#chat-div').html("");
                    lpc.requestChat();  // lpc defined in main.js
                    if(!g_is_guest){
                      var userName = "Guest";
                      lpc.setVisitorName(userName+"("+g_userId+")");
                    } 
                }
                
            } , 1000);
        }else{
            $('#chat-div').html("<p class='chatRecord infoText'><span>Connecting...</span></p>");
            lpc.requestChat();        // lpc defined in main.js
            if(!g_is_guest){
              var userName = "Guest";
              lpc.setVisitorName(userName+"("+g_userId+")");
            }
        }
        
        $(".ui-chatbox-input textarea.ui-chatbox-input-box").focus();
        $(".ui-chatbox-input").append("<p class='typing'>Agent is typing...</p>");
        return false;
    });
});
</script>



    </div>

    <script>
        //var midTime2 = new Date().getTime();
        //console.log("midTime2 "+ (midTime2 - startTime)/1000 +" seconds");
    </script>
    <div class="modal-container">
        <script type="text/javascript">
            //$(document).ready(function(){
            //    $('#User_firstName, #User_lastName, #User_emailAddress, #User_password').keypress(function (e) {
            //        if (e.which == 13) {
            //            $("#submit").click();
            //            return false;    //<---- Add this line
            //        }
            //    });
            //});
        </script>
        <!-- Member sign up / Log In -->
<div id="member-signup-dialog" class="overlayBlack overlay ">
    <div id="page-member-signup-dialog-overlay" style="position: absolute; width: 100%; height: 100%; display: none; opacity: 0.9; z-index: 99999; background-color: white;max-height:700px"></div>
    <div id="page-member-signup-dialog-loading" style="display: none; position: fixed; margin-top: 34%; margin-left:48%; z-index: 99999;">
        <img src="/images/loading_product.gif">
    </div>
    <div class="close mobile" popupid="member-signup-dialog" style=""></div>

    <div class="rightVertical no-bg" style="height:auto;float:none;position:relative; ">
        <div class="border-box" style="width:420px;background:#fff;">
            <div class="header">
                <img src="/images/IfOnly_brandmark_black.png" style="height:40px;">
                <h5 class="section-header" id="signInHeader" style="color:#000; margin-top:20px; font-size:16px; line-height:22px;">Gain access to incredible experiences with top talent.</h5>
                <h6 class="section-header accesscodeTitle" id="signInHeader_sub" style="margin-bottom:4px;color:#000"><p>Sign up now and receive </p> <p class="big">10% off</p> <p>your first purchase</p></h6>
            </div>
            <div class="body" style="float:none;">
                <div class="content" style="width:282px; margin:0 auto; position:relative;">
                    <ul>
                        <li>
                            <div class="content" style="max-width:280px;margin:0 auto;">
                                <div id="back-arrow"><img style="width:22px;vertical-align: middle;" src="/images/icon_bigarrowleft_000.png"></div>
                                <div id="signup-container" class=" formBlock">
                                    

<form name="registerForm" id="registerForm" method="post" class="form">
    <ul>
        <li>
            <input type="hidden" name="redirectURL" id="User_redirectURL" value="">
            <input type="hidden" name="User[instantAccessCode]" id="User_instantAccessCode" value="">
            <input type="hidden" name="User[registerEmail]" id="User_registerEmail" value="1">
            <input type="hidden" name="userId" id="userId" value="">
            <input type="hidden" name="User[emailOptedIn]" id="User_emailOptedIn" value="1">
        </li>
        <li>
            <input type="email" name="User[emailAddress]" id="User_emailAddress" value="" placeholder="Email">
        </li>
        <li>
            <input type="password" name="User[password]" id="User_password" placeholder="Choose a Password" value="" class="password" autocomplete="off">
        </li>
        <li>
            <p class="passwordInformational" style="color:#000">
                At least 8 characters with two of: uppercase, lowercase, numbers or special characters
            </p>
        </li>
        <li>
            <p id="signup_error" class="error-general" style="display:none;float:left; text-align:left;  width: -webkit-calc(100% + 5px); width: -moz-calc(100% + 5px); width: calc(100% + 5px);"></p>
        </li>

        <li>
             <div id="signup-submit-button" class="allowAllUsers signup-submit primaryButton button " style="width: 100%;"><span class="title">Sign Up</span></div>             <div id="signup-next" class="allowAllUsers signup-next primaryButton button " style="width: 100%;"><span class="title">Next</span></div>        </li>
        <li>
            <div class="swapper" style="float:left;">
                <a href="#" class="js-login fo-13-n-s3 co-777">
                    Already have an account? Log in here
                </a>
            </div>
        </li>
    </ul>
</form>


<style type="text/css">
    #signup-submit-button{-webkit-appearance: none;}
    #signup-error {float:left; width:100%; text-align:center;}
    #User_password, .signup-submit{display:none;}
</style>

<script type="text/javascript">
$(document).ready(function(){

    $(".swapper").click(function(){
        resetError("#signup_error");
        resetError("#login_error");
    });

    $("#back-arrow img").click(function(){
        $(".signup-submit").hide();
        $("#User_password").hide();
        $(".signup-next").css('display', 'inline-block');
        $("#User_emailAddress").show();
        $(".passwordInformational").hide();
        $("#signup_error").hide();
        $("#back-arrow img").hide();
        return false;
    });

    $("#User_emailAddress").keypress(function(e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code === 13) {
            $(".signup-next").click();
        }
    });

    $("#User_password").keypress(function(e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code === 13) {
            $("#registerForm").submit();
        }
    });

    $("body").on('click', '#signup-submit-button', function(){
        if($("#User_password").val() !== ""){
            $("#signup-iframe").find(".passwordInformational").hide();
            $("#registerForm").submit();
        } else {
            displayError("#signup_error", 'Please enter a password');
        }
    });

    $("#User_password").focusin(function() {
        $("#signup_error").hide();
        $(this).parent().parent().find(".passwordInformational").show();
        if(g_is_mobile){
            $('.userAccess-ifonlyLogo').hide();
        }
    });

    $(".signup-next").click(function(){
        if($("#User_emailAddress").val() !== ""){
            if(validateEmail($.trim($("#User_emailAddress").val()))){
                $("#registerForm #User_password").val("");
                //Save Email
                $.post( '/website/register', $("#registerForm").serialize(),
                    function (data){
                        if(data.result === 0 || data.result === 5){
                            displayError("#signup_error", data.msg);
                        } else if(data.result === 7 || data.result === 6 || data.result === 11) {
                            $("#userId").val(data.userId);
                            $("#signup_error").hide();
                            $("#User_emailAddress").hide();
                            $(".signup-next").hide();
                            $(".signup-submit").css('display', 'inline-block');
                            $("#registerForm #User_password").show();
                            $("#back-arrow img").show();
                            ga('send', 'event', 'MemberActivity', 'Successful SignUp');
                            fb_p('track', 'CompleteRegistration');
                        } else if(data.result == 20){
                            alertEx(data.msg);
                            userAccessHide();
                            ga('send', 'event', 'MemberActivity', 'Successful SignUp');
                            fb_p('track', 'CompleteRegistration');
                        }

                },'json');

                return false;
            } else {
               displayError("#signup_error", 'Please enter a valid email');
            }
        } else {
           displayError("#signup_error", 'Please enter your email');
        }
    });

    $("#registerForm").submit(function(e) {
//        var passwordStrength = passwordStrengthCheck($("#User_password").val());

//        if(passwordStrength == true){
//            //Do Nothing Password is strong
//        } else {
//            displayError("#signup_error", passwordStrength);
//            return false;
//        }

        if ($("#signup-submit-button").hasClass('disabled')) {
            return false;
        }

        var email    = $.trim($("#User_emailAddress").val());
        var password = $.trim($("#User_password").val());

        $("#User_emailAddress").val(email);
        $("#User_password").val(password);

        if (email === '') {
            displayError("#signup_error", 'Please enter your email address');
            return false;
        } else if(!validateEmail(email)){
            displayError("#signup_error", "Please enter valid email address");
            return false;
        }

        var password = $("#User_password").val();
        if(password === ''){
            displayError("#signup_error", 'Please enter a password');
            return false;
        }

//        if(password.length < g_password_length){
//            displayError("#signup_error", "Password must be at least "+g_password_length+" characters long");
//            return false;
//        }

        $("#registerForm").find(".passwordInformational").hide();

        $("#registerForm").css('cursor','wait');
        $("#signup-submit-button").addClass('disabled');

        loadingAnimation("show");

        $.post( '/website/register',
            $("#registerForm").serialize()+ "&registerEmailPwdSet=1",
            function (data){
                var url = $("#redirectURL").val();

                $("#signup-submit-button").removeClass('disabled');
                if(data.result === 0 || data.result === 5){
                    $("#registerForm").css('cursor','auto');
                    $("#signup-submit-button").removeClass('disabled');
                    displayError("#signup_error", data.msg);
                } else if (data.result === 1 || data.result === 2) {
                    if (addGuestProductToCart()) return false; // if need to add a guest product (main.js)
                    if (data.result === 1) {
                        //$("#signup-dialog").overlay().close();
                        ga('send', 'event', 'MemberActivity', 'Successful SignUp');
                        fb_p('track', 'CompleteRegistration');
                        if ($("#google-tracking").attr('from') === 'newsletter') {
                            $("#google-tracking").html('<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/995223985/?value=0&amp;label=KihOCN--ogQQsdPH2gM&amp;guid=ON&amp;script=0"/>');
                        } else {
                            $("#google-tracking").html('<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/995223985/?value=0&amp;label=VV6JCP-6ogQQsdPH2gM&amp;guid=ON&amp;script=0"/>');
                        }
                        //$("#thank-dialog-firstName").html(" "+data.firstName);
                        $('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://d.adx.io/conversions?xb=35BD0380&xnojs=1" />');$('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://www.googleadservices.com/pagead/conversion/976272921/?label=hFCrCI_UpwgQmfzC0QM&amp;guid=ON&amp;script=0" />');$('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/offsite_event.php?id=6011685149285&amp;value=0&amp;currency=USD" />');$('#trackingImage').append('<img src="https://shareasale.com/sale.cfm?amount=0.00&tracking='+g_userId+'&transtype=LEAD&merchantID=50745" width="1" height="1" />');$('#trackingImage').append('<img height="1" width="1" style="display:none;" alt="" src="https://analytics.twitter.com/i/adsct?txn_id=l4753&p_id=Twitter" />');$('#trackingImage').append('<img src="http://pixel.quantserve.com/pixel/p-SswRnXTcs-q48.gif?labels=_fp.event.Sign+Up+Confirmation" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>');$('#trackingImage').append('<img src="https://p.liadm.com/p?c=11775" />');$('#trackingImage').append('<img src="https://bat.bing.com/action/0?ti=4001812&Ver=2" height="0" width="0" style="display:none; visibility: hidden;" />');$('#trackingImage').append('<img src="https://pubads.g.doubleclick.net/activity;xsp=130022;ord=33035925?" height="0" width="0" style="display:none; visibility: hidden;" />');                        //$("#thank-dialog").overlay().load();
                    }
                    if(g_bespoke === '1'){
                       //bespoke page go to Question 7
                       g_bespoke = "";
                       slideToNextQuestion(6, 7);
                       submitBespokeForm();
                    } else if(url !== '' && url !== '#') {
                        location.href = url;
                    } else {
                        location.reload();
                    }
                    userAccessHide();
                } else {
                    $("*").css('cursor','auto');
                    var phone = ((data.isAmex == 1)? '415-376-4646':'(415)754-8167');
                    if (data.result === 3){
                        var message = 'Almost done! <br/><br/>We have sent an email to your address (please check your spam folder).<br/><br/>To finish setting up your account, please press the “CONFIRM EMAIL” button in the email to gain access. <br/><br/>If you do not receive an email within 5 minutes, please call '+phone+' and our Guest Experiences Team will assist you.';
                        alertEx(message);
                        userAccessHide();
                    } else if(data.result === 4){
                        userAccessHide();
                        $("#resend-email").attr("uid", data.userId);
                        $("#unverified-concierge-dialog #conciergePhone").text(phone);
                        $("#unverified-concierge-dialog").overlay().load();
                    } else if(data.result === 6){  //visible user
                        userAccessHide();
                        var message = 'Thank You for signing up.';
                        alertEx(message);
                    } else if(data.result === 12){
                        location.href = data.redirectUrl;
                    } else if(data.result === 13) {
                        displayError("#signup_error", data.msg);
                    }
                }
                loadingAnimation("hide");
                return false;
            },'json');
        return false;
    });

    $(".js-login").click(function(){
        $(".signup-next").css('display', 'inline-block');
        $("#User_emailAddress").show();
        $(".signup-submit").hide();
        $("#User_password").hide();
        resetError("#signup_error");
   });
});

</script>                                </div>
                                <div id="login-container" class=" formBlock">
                                    <style type="text/css">
   #login-submit {-webkit-appearance: none;}
   #login-box-dialog .dialog_content label {top: 9px;}
   #login-box-dialog .dialog_content label.passwordLabel {position:absolute; left:8px; padding-left:0; text-align: left; color:#ccc;}
</style>

<form id="loginForm" name="loginForm" method="post" class="form">
    <ul id="loginformUl">
        <input type="hidden" name="LoginForm[emailOptedIn]" id="LoginForm_emailOptedIn" value="1">
        <li>
            <input type="email" name="LoginForm[username]" id="login-email" value="" placeholder="Email" class="default-focus">
        </li>
        <li>
            <input type="password" name="LoginForm[password]" id="login-pass" value="" placeholder="Password" class="password">
        </li>
        <li>
            <p id="login_error" class="error-msg error-general" style="width:100%;text-align:left;display:none;"></p>
        </li>
        <li><p style="height:2px;width:100%;">&nbsp;</p></li>
        <li>

             <div id="login-submit" class="allowAllUsers primaryButton button " style="width: 100%;"><span class="title">Log In</span></div>        </li>
        <li>
            <div class="swapper" style="float:left;" id="js-hideCreateAccount">
                <a href="#" class="js-signUp fo-13-n-s3">
                    Create Account
                </a>
            </div>
            <div class="swapper" style="float:right;">
                <a href="#" id="forgot-password" class="fo-13-n-s3">Forgot Password?</a>
            </div>
        </li>
    </ul>
</form>

<script type="text/javascript">
$(document).ready(function(){

    $("#LoginForm_emailOptedIn").val("1");

    $(".swapper").click(function(){
        resetError("#signup_error");
        resetError("#login_error");
        resetError("#streamlineSignup_error");
    });

    $("#loginForm input").keypress(function(e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code === 13) {
            $("#loginForm").submit();
        }
    });

    $("#login-submit").click(function() {
        $("#loginForm").submit();
    });

    $("#login-pass").focusin(function() {
        if(g_is_mobile){
            $('.userAccess-ifonlyLogo').hide();
        }
        $(this).parent().parent().find(".passwordInformational").show();
    });

    $("#loginForm").submit(function(e) {

        var email = $("#login-email").val();
        if ($("#login-submit").hasClass('disabled')) {
            return false;
        }

        if ($.trim(email) === '') {
            displayError("#login_error", "Please enter your email address");
            return false;
        } else if(!validateEmail($.trim(email))){
            displayError("#login_error", "Please enter valid email address");
            return false;
        }

        var password = $("#login-pass").val();
        if ( password === '') {
            displayError("#login_error", "Please enter a password");
            return false;
        }

        $("#loginForm").find(".passwordInformational").hide();

        $("#loginForm").css('cursor','wait');
        $("#login-submit").addClass('disabled');

        loadingAnimation("show");

        $.post( '/website/login', $("#loginForm").serialize(),
            function(data){
                if (data.result === 1 && $("#redirectURL").val() === 'do-not-refresh') {
                    $("#redirectURL").val('');
                    $("#login-pass").val('');
                    $("#loginForm").css('cursor','auto');
                    loadingAnimation("hide");
                    $("#member-signup-dialog").fadeOut();
                    $('#exposeMask').fadeOut();
                    if (g_controller_id === 'vendorportal') {
                        vendorHideLoading();
                    }
                }
                else if (data.result === 1 && g_bespoke === '1'){
                    //bespoke page go to Question 7
                    g_bespoke = "";
                    $("*").css('cursor','auto');
                    userAccessHide();
                    //$("#login-box-dialog").overlay().close();
                    slideToNextQuestion(6, 7);
                    submitBespokeForm();
                }
                else if (data.result === 1) {
                    // success
                    if (addGuestProductToCart()) return false; // if need to add a guest product (main.js)
                    var url = $("#redirectURL").val().trim();
                    if (url === '') {
                        if (data.url !== undefined) {
                            url = data.url;
                        }
                    }

                    if (url !== '' && url !== '/' && url !== '#') {
                        setTimeout('location.href = "' + url + '";', g_login_timer);
                    } else {
                        setTimeout('location.reload();', g_login_timer);
                    }
                }
                else {
                    $("#loginForm").css('cursor','auto');
                    if (data.result === 0) {
                        ga('send', 'pageview', 'Login Attempted');
                        displayError("#login_error",data.msg);
                    } else if(data.result === 3){
                        data.msg = data.msg + " <a class='error-general' style='text-decoration:underline' href='#' id='streamline-complete-signup'>Set Password Here</a>";
                        displayError("#login_error",data.msg);
                    } else if(data.result === 4){
                        userAccessHide();
                        var phone = ((data.isAmex == 1)? '415-376-4646':'(415)754-8167');
                        $("#resend-email").attr("uid", data.userId);
                        $("#unverified-concierge-dialog #conciergePhone").text(phone);
                        $("#unverified-concierge-dialog").overlay().load();
                    } else if(data.result === 6){
                        displayError("#login_error",data.msg);
                    } else if(data.result === 7){
                        location.href = data.redirectUrl;
                    }
                    //window.top.postMessage('{"action":"showLoader", "showLoader":false}',"*");
                    loadingAnimation("hide");
                }
                $("#login-submit").removeClass('disabled');
            }, 'json');
        return false;
    });

    $("#forgot-password").click(function(){
        var inputEmail = $("#loginForm input[name='LoginForm[username]']");
        if(inputEmail.val() === '' || inputEmail.val() === inputEmail.attr('default-value')) {
            displayError("#login_error", "Please enter your email address");
            return false;
        }
        var email = $("#login-email").val();
        $.post( '/website/ForgotPassword',
            {'email':inputEmail.val()},
            function(data){
                if(data.result === 1){
                    userAccessHide();
                    alertEx(data.msg, "Thank You");
                } else if(data.result !== 1){
                    displayError("#login_error", data.msg);
                }
            }, 'json');
       return false;
   });


   $("#member-signup-dialog").on('click', '#streamline-complete-signup',function(){
       var inputEmail = $("#loginForm input[name='LoginForm[username]']");
       if(inputEmail.val() === '' || inputEmail.val() === inputEmail.attr('default-value')) {
           displayError("#login_error", "Please enter your email address.");
           return false;
       }

       $.post( '/website/ForgotPassword', {
        'email'          : inputEmail.val(),
        'signupComplete' : true
       },
       function(data){
           //window.alert(data.msg);
           if(data.result === 1 || data.result === 2){
               if(data.result === 1){
                    alertEx(data.msg, "Thank You");
                } else if(data.result === 2){
                    alertEx(data.msg);
                }
                userAccessHide();
           }
           else{
               displayError("#login_error", data.msg);
           }
       }, 'json');
       return false;
   });

});
</script>
                                </div>
                                <div id="streamlineSignup-container" class=" formBlock">
                                    
    <form name="streamlineSignupForm" id="streamlineSignupForm" method="POST">
        <ul>
            <li>
                <div style="float:left;width:100%;">
                    <input type="email" id="User_email_emailAddress" name="User[emailAddress]" value="" placeholder="Email">
                </div>
            </li>
            <li><p id="streamlineSignup_error" class="error-general" style="margin-bottom: 0;display:none;"></p></li>
            <li>
                 <div id="signup-email-submit-button" class="allowAllUsers primaryButton button " style="width: 100%;"><span class="title">Sign Up</span></div>            </li>
            <li>
                <div class="swapper">
                    <a href="#" class="js-login fo-13-n-s3">
                        Already have an account? Log In here
                    </a>
                </div>
            </li>
        </ul>
    </form>


<script type="text/javascript">
$(document).ready(function(){
    $("#streamlineSignup input").keypress(function(e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code === 13) {
            $("#streamlineSignupForm").submit();
        }
    });

    $(".swapper").click(function(){
        resetError("#login_error");
        resetError("#streamlineSignup_error");
    });


    $("#member-signup-dialog").on('click', '#signup-email-submit-button',function(e){
        $("#streamlineSignupForm").submit();
    });

    $("#streamlineSignupForm").submit(function(e) {
        if ($("#signup-email-submit-button").hasClass('disabled')) {
            return false;
        }

        var email = $("#User_email_emailAddress").val().trim();

        if (email === '' || email === $("#User_email_emailAddress").attr("default-value")) {
            displayError("#streamlineSignup_error",'Please enter your email address');
            return false;
        } else if (! validateEmail(email)) {
            displayError("#streamlineSignup_error", "Please enter valid email address");
            return false;
        }

        $("#User_email_emailAddress").val(email);

        $("#streamlineSignupForm").css('cursor','wait');
        $("#signup-email-submit-button").addClass('disabled');

        loadingAnimation("show");

        $.post( '/website/registerEmail', $("#streamlineSignupForm").serialize(),
            function (data){
                $("#streamlineSignupForm").css('cursor','auto');

                var url = $("#redirectURL").val();
                if (data.result === 3) {
                    $(".js-login").click();
                    $("#login-email").val(email).show();
                    $("#login-pass").focus();
                    $("#login_error").html(data.msg).show();
                } else if (data.result > 0) {
                    if (addGuestProductToCart()) return false; // if need to add a guest product (main.js)
                    userAccessHide(); // close popup
                    if (g_sourceId === 0 && data.result === 1) { // display thank you when it's new user
                        g_signup_timer = 5000; // need more time to read message
                        $("#signup-thank-dialog").overlay().load();
                        if (g_thisHost === 'w01') { return false; }
                    }
                    $('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://d.adx.io/conversions?xb=35BD0380&xnojs=1" />');$('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://www.googleadservices.com/pagead/conversion/976272921/?label=hFCrCI_UpwgQmfzC0QM&amp;guid=ON&amp;script=0" />');$('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/offsite_event.php?id=6011685149285&amp;value=0&amp;currency=USD" />');$('#trackingImage').append('<img src="https://shareasale.com/sale.cfm?amount=0.00&tracking='+g_userId+'&transtype=LEAD&merchantID=50745" width="1" height="1" />');$('#trackingImage').append('<img height="1" width="1" style="display:none;" alt="" src="https://analytics.twitter.com/i/adsct?txn_id=l4753&p_id=Twitter" />');$('#trackingImage').append('<img src="http://pixel.quantserve.com/pixel/p-SswRnXTcs-q48.gif?labels=_fp.event.Sign+Up+Confirmation" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>');$('#trackingImage').append('<img src="https://p.liadm.com/p?c=11775" />');$('#trackingImage').append('<img src="https://bat.bing.com/action/0?ti=4001812&Ver=2" height="0" width="0" style="display:none; visibility: hidden;" />');$('#trackingImage').append('<img src="https://pubads.g.doubleclick.net/activity;xsp=130022;ord=33035925?" height="0" width="0" style="display:none; visibility: hidden;" />');                    

        var _qevents = _qevents || [];

        (function() {
            var elem = document.createElement('script');
            elem.src = (document.location.protocol == 'https:' ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
            elem.async = true;
            elem.type = 'text/javascript';
            var scpt = document.getElementsByTagName('script')[0];
            scpt.parentNode.insertBefore(elem, scpt);

            //Tracking for silverpop
            var selem = document.createElement('script');
            selem.src = (document.location.protocol == 'https:' ? 'https://www.sc.pages03.net/lp/static/js/iMAWebCookie.js?2edcd082-1461604bde3-943e27de0c8b91cc3fcf1475c3e5d726&h=www.pages03.net' : 'http://contentz.mkt932.com/lp/static/js/iMAWebCookie.js?2edcd082-1461604bde3-943e27de0c8b91cc3fcf1475c3e5d726&h=www.pages03.net');
            selem.async = true;
            selem.type = 'text/javascript';
            var sscpt = document.getElementsByTagName('script')[0];
            sscpt.parentNode.insertBefore(selem, sscpt);
        })();

        _qevents.push(
            {qacct:'p-SswRnXTcs-q48',labels:'_fp.event.Sign Up Confirmation'}
        );

        var _adx = {};
        _adx.xb  = '35BD0380';
        _adx.xt  = 'conversion';
        _adx.xgid  = '6AMDU1';
        (function(d){
            var x = d.createElement('script');
            x.async = true;
            x.src = ('https:' == d.location.protocol ? 'https://d1adj61x0fgvmc.cloudfront.net' : 'http://s.adx.io') + '/dxjet.js';
            var s = d.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(x, s);
        })(document);

        (function(w,d,t,r,u){
            var f,n,i;w[u]=w[u]||[],f=function(){var o={ti:'4001812'};
            o.q=w[u],w[u]=new UET(o),w[u].push('pageLoad')},
            n=d.createElement(t),n.src=r,n.async=1,
            n.onload=n.onreadystatechange=function(){var s=this.readyState;s&&s!=='loaded'&&s!=='complete'||(f(),n.onload=n.onreadystatechange=null)},
            i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i)
        })(window,document,'script','https://bat.bing.com/bat.js','uetq');


        
                    if (url !== '' && url !== '#') {
                        setTimeout('location.href = "' + url + '";', g_signup_timer);
                    } else {
                        setTimeout('location.reload();', g_signup_timer);
                    }
                } else {
                    displayError("#streamlineSignup_error",data.msg);
                }
                loadingAnimation("hide");
                $("#signup-email-submit-button").removeClass('disabled');
                return false;
            },'json');
        return false;
    });

});
</script>
                                </div>
                            </div>
                        </li>
                        <li><p class="sub-header fo-15-n-s4 continue-with" style="color:#000">Or continue with</p></li>
                        <li>
                            <div class="social_icons" style="float:left;" data-name="FACEBOOK">
                                <input id="facebookReturnURL" type="hidden" value="%2Fwebsite%2Fprivacy" name="">                                <div class="box" style="background-color: #000;">
                                    <a href="#" class="loginWithFacebookButton" url="%2Fwebsite%2Fprivacy" type="" style="display:inline;">
                                        <img src="/images/icon_fb_bg_fff.png" alt="login with facebook">
                                        <p style="color:#fff">FACEBOOK</p>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="social_icons" style="float:left;" data-name="GOOGLE">
                                <div class="box" style="background-color: #000;">
                                    <a href="#" class="google-signinButton" url="%2Fwebsite%2Fprivacy" type="" style="display:inline;">
                                        <img src="/images/icon_g_fff.png" alt="login with google">
                                        <p style="color:#fff">GOOGLE</p>
                                    </a>
                                </div>
                            </div>
                        </li>
                                                <li>
                            <p class="fo-13-n-s3 co-777" style="text-align:center; letter-spacing: 0.2px;">
                                We will never post to your account without asking
                            </p>
                        </li>
                    </ul>
                    <div style="clear:both"></div>
                </div>
            </div>
        </div>
        <div id="registrationTerms" style="position:absolute;bottom: 9px;width:100%;">
             <p class="terms bottom fo-13-n-s3 co-777" style="text-align:center;">
                 By signing up you agree to our <a class="fo-13-n-s3 co-777" href="/website/terms">Terms of Use</a>
             </p>
        </div>
    </div>
</div>


<div id="vendor-signup-dialog" class="overlayBlack overlay overlayDialog ">
    <div class="close mobile" popupid="member-signup-dialog"></div>

    <div class="rightVertical" style="height:auto;float:none;position:relative; ">
        <div class="header" style="margin-bottom:0;">
            <img class="userAccess-ifonlyLogo" src="/images/IfOnly_brandmark_black.png">
            <h5 class="section-header" style="color:#000">Welcome to IfOnly</h5>
            <h6 class="section-header" style="margin-bottom:4px;color:#000">Would you like to sign-up as a customer or luminary on our site?</h6>
        </div>
        <div class="body" style="margin-bottom: 30px;">
            <div class="content" style="max-width:282px; margin:0 auto; position:relative; margin-top: 40px; margin-bottom: 10px;">
                <ul>
                    <li>
                        <div class="content" style="max-width:280px;margin:0 auto;">
                            <ul>
                                <li>
                                     <div class="allowAllUsers js-signUp js-ignore-vendor-signup blackButton button " style="width: 100%;"><span class="title">I am a customer</span></div>                                    <a href="/marketplace/signup">
                                         <div class="allowAllUsers blackButton button " style="width: 100%;"><span class="title">I wish to be a luminary</span></div>                                    </a>

                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
                <div style="clear:both"></div>
            </div>
        </div>
    </div>
</div>


<!--Closed Category/products pop up for loggedIn users who are NOT members - asks for access code-->
<div id="closed-accessCode-dialog" class="overlayBlack overlay  ">
    <div class="close mobile" popupid="closed-accessCode-dialog"></div>
    <div class="rightVertical" style="height:100%;">
        <div class="header">
            <img class="userAccess-ifonlyLogo" src="/images/IfOnly_brandmark_black.png">
            <h5 class="section-header" style="">Member Access</h5>
            <h6 class="section-header">Due to their limited nature, select items &amp; categories are reserved for Members <!--<br /> (existing customers or invited partners)--></h6>
        </div>
        <div class="body" style="width:calc(100% - 20px);margin:10px;">
            <div class="content">
                <div class="row">
                    <div style="margin: 0 auto; max-width: 300px;">
                        <form>
                            <ul>
                                <li>
                                    <div style="float:left;width:100%;margin: 0 auto;">
                                        <div style="margin:0 auto; text-align:center;">
                                            <p class="sub-header" style="">If you have received a member access code, please enter it below:</p>
                                            <input class="default-value default-focus access-code" default="default" placeholder="Access Code (Optional)" style="" id="" type="text" value="" name="">                                             <div class="update-access-code allowAllUsers enter-btn primaryButton button " style="width:100%;"><span class="title">Enter</span></div>
                                            <p class="error-general" style="margin: 5px 10px 0 0px; font-size: 14px; display: none;"></p>
                                        </div>
                                    </div>
                                    <div style="clear:both;"></div>
                                </li>
                                <li>
                                    <div class="separation-div">

                                        <div class="mid-line"></div>
                                        <div class="or-text">or</div>
                                        <div style="clear:both;"></div>
                                    </div>

                                </li>
                                <li>
                                    <div style="float:left;width:100%;margin: 4px auto 50px auto;">
                                        <div style="width:296px;margin:0 auto;">
                                             <div class="allowAllUsers close-closed-accessCode-dialog js-close skip-btn secondaryButton button " style="width:100%;" popupid="closed-accessCode-dialog"><span class="title">Skip This Step</span></div>                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<div id="complete-signup-dialog" class="overlayDialog overlay ">
    <div class="close mobile" popupid="complete-signup-dialog"></div>
    <div class="rightVertical" style="height:100%;">
        <div class="header" style="text-align:center;margin-top:10px;">
            <img style="width:100px;" src="/images/IfOnly_logo_black.png" alt="IfOnly">
        </div>
        <div class="body" style="float: left; width: 100%;">
            <div class="content" style="margin: 0 auto; max-width: 300px;">
                <div>
                    <div class="row">
                        <p style="margin: 10px;text-align: center;"> </p>
                        <p class="title" style="margin: 10px;text-align: center;">Please enter password below:</p>
                    </div>
                    <div>
                        <div id="completeSignup-container">
                            <form id="complete-signup-form" name="completeSignUpForm" method="post" class="form formBlock">
                                <ul>
                                    <li class="row">
                                        <input type="password" name="User[password]" value="" class="password" id="complete-signup-password">
                                    </li>
                                    <li class="row" style="margin-top: 5px;">
                                        <p id="complete-signup-error" class="error-general" style="margin-bottom: 0;"></p>
                                    </li>
                                    <li class="row">
                                         <div class="js-partialLogin primaryButton button " id="complete-signup-submit" style="width: 100%;"><span class="title">Set Password</span></div>
                                    </li>
                                </ul>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style type="text/css">
   #login-container, #signup-container, #streamlineSignup-container {margin-bottom:20px;}
   #member-signup-dialog, #closed-accessCode-dialog{transform: translateZ(0); -webkit-transform: translateZ(0);min-height:400px;}

   #member-signup-dialog .border-box {border:5px solid #fff; margin: 60px auto 60px; background: rgba(0,0,0,0.3)}
   #member-signup-dialog .no-bg .border-box {border:5px solid #000; background: none;}
   #member-signup-dialog.mobile .border-box {border:none; margin: 30px auto; background: none;}

   #member-signup-dialog .rightVertical .header { text-align: center; margin: 30px 20px 10px;}
   #member-signup-dialog .rightVertical .body {margin-bottom:30px;}
   #member-signup-dialog.mobile .rightVertical .body {margin-bottom:60px;}

   #back-arrow {height:20px;}
   #back-arrow img{display:none; cursor: pointer;}
   #login_error {height:17px;}

   .formBlock { width: 100%; float: left; border: 0; display:none;}
   .formBlock ul input:not([type="submit"]):not([type="checkbox"]) { width: 100%; box-sizing: border-box; height:44px; margin: 5px 0;}

   .social-title p {color:#888; font-family: "source-sans-pro-n3", sans-serif; margin: 0; font-size:14px;}
   .social_icons {margin:3px 0 0 0; width:100%;}
   .social_icons div.box {display: inline-block; width:278px; padding:4px 0; background-color: #000; margin-left: 2px;}
   .social_icons div p {color:#fff; text-align:center; float:left; margin:0 auto;width:220px; padding-top:5px; font-size:11px; font-family:montserrat, sans-serif; letter-spacing: 0.14em; line-height:20px;}
   .social_icons div a img {float:left; display:block; width:28px; margin-left: 4px;}

   #completeSignup-container .formBlock {display: block; margin-bottom: 20px; max-width: none;}
   #completeSignup-container .formBlock ul {width: 100%;}

   .passwordInformational{display:none;}

   #signInHeader_sub p {font-size:24px; line-height:130%;}
   #signInHeader_sub p.big {font-size:36px;}
</style>

<script type="text/javascript">
    var g_welcomeString   = "Gain access to incredible experiences with top talent.";
    var g_accesscodeTitle = "<p>Sign up now and receive <\/p> <p class=\"big\">10% off<\/p> <p>your first purchase<\/p>";

    $(document).ready(function(){

        $("#social_emailOptedIn_row").change(function(){
            if($("#social_emailOptedIn_row").prop("checked")){
                $("#User_emailOptedIn").val(1);
                $("#LoginForm_emailOptedIn").val(1);
            } else{
                $("#User_emailOptedIn").val(0);
                $("#LoginForm_emailOptedIn").val(0);
            }

        });

        $("#complete-signup-button").click(function() {
            displayOverlay('complete-signup-dialog');
        });

        $("#complete-signup-form input").keypress(function(e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code === 13) {
                $("#complete-signup-form").submit();
            }
        });

        $("#complete-signup-submit").click(function() {
            $("#complete-signup-form").submit();
        });

        $("#complete-signup-form").submit(function(e) {
            if ($("#complete-signup-submit").hasClass('disabled')) {
                return false;
            }
            $("#complete-signup-error").hide();
            $("#complete-signup-form").css('cursor','wait');
            $("#complete-signup-submit").addClass('disabled');

            $.post( '/website/completeSignUp',
                $("#complete-signup-form").serialize(),
                function (data){
                    if (data.result === 1) {
                        var url = $("#redirectURL").val();
                        //$("#complete-signup-dialog").overlay().close();
                        ga('send', 'event', 'Member Activity', 'Member Activity - Complete Sign Up for emailAddress Users');

                        if(url !== '' && url !== '#') {
                            setTimeout('location.href = "' + url + '";', g_signup_timer);
                        } else {
                            setTimeout('location.reload();', g_signup_timer);
                        }
                    } else {
                        $("#complete-signup-submit").removeClass('disabled');
                        $("#complete-signup-form").css('cursor','auto');
                        displayError("#complete-signup-error",data.msg);
                    }
                },'json');

            return false;
        });


    });

    function loadingAnimation(show){

        if (show === 'show') {
            $("#page-member-signup-dialog-overlay").show();
            $("#page-member-signup-dialog-loading").show();
        } else {
            $("#page-member-signup-dialog-overlay").hide();
            $("#page-member-signup-dialog-loading").hide();
        }

    }

    function renderpopup(type) {

        if ($("#member-signup-dialog .rightVertical").css('background-image') === 'none') {
            $("#member-signup-dialog .swapper a").css('color', '#777');
        } else {
            $("#member-signup-dialog .swapper a").css('color', '#fff');
        }
        $(".google-signinButton").attr("type", "signup");
        $(".loginWithFacebookButton").attr("type", "signup");
        $(".google-signinButton").attr("fbLogin", "0");
        $(".loginWithFacebookButton").attr("fbLogin", "0");

        //Hide error messages
        $(".error-msg").hide();

        //$(".signup-banner").hide();

        if (type === "login") {
            $("#member-signup-dialog #login-container").show();
            $("#member-signup-dialog #streamlineSignup-container").hide();
            $("#member-signup-dialog #signup-container").hide();

            $(".social_icons").each(function() {
                $(this).find("p").html('LOG IN WITH ' + $(this).attr("data-name"));
            });

            $("#signInHeader_sub").hide(); // g_accesscodeTitle

            $(".google-signinButton").attr("type", "login");
            $(".loginWithFacebookButton").attr("type", "login");
            $(".google-signinButton").attr("fbLogin", "1");
            $(".loginWithFacebookButton").attr("fbLogin", "1");
        }
        else {
            $("#signInHeader_sub").show(); // g_accesscodeTitle
            $(".social_icons").each(function() {
                $(this).find("p").html('SIGN UP WITH ' + $(this).attr("data-name"));
            });

            if (type === "streamline"){
                $("#member-signup-dialog #streamlineSignup-container").show();
                $("#member-signup-dialog #login-container").hide();
                $("#member-signup-dialog #signup-container").hide();
            } else {
                $("#member-signup-dialog #signup-container").show();
                $("#member-signup-dialog #login-container").hide();
                $("#member-signup-dialog #streamlineSignup-container").hide();
            }
        }
        displayOverlay('member-signup-dialog', type);
        return false;
    }


    function signupDialog(lvl, premiumLvl, $obj) {
        var login   = false;
        var $button = undefined;
        if (lvl === undefined) {
            lvl = 1;
        }
        if (premiumLvl === undefined) {
            premiumLvl = false;
        }
        if ($obj !== undefined) {
            if ('login' in $obj) {
                login = true;
            }

            if ('button' in $obj) {
                $button = $obj['button'];
            }
        }

        clearTimeout(autoPopupTimer);

        if (g_is_guest) {
            if(($button !== undefined && $button.hasClass("js-login")) || login){
                renderpopup("login");
                return false;
            }

            if (g_stream_lined_sign_up){
                renderpopup("streamline");
            } else if (g_sessionAccessCode) {
                if (g_sessionAccessCode === 'AMEXWOW' && $button !== undefined ) {
                    if ($button.hasClass('add-to-bag') || $button.attr('id') === 'buynow-button' ) {
                        if ($button.attr('price') !== undefined && parseFloat($button.attr('price')) <= 500) {
                            $("#signUp-dialog-called-from").val('add-under-500');
                        }
                    }
                }
                renderpopup();
            } else if (lvl > 2) {
                $("#signUp-dialog-called-from").val("lockedLink");
                renderpopup();
            } else {
                renderpopup();
            }
            return false;
        } else {
            if (($button !== undefined && $button.hasClass('js-partialLogin')) || login) {
                if ($("#signUp-dialog-called-from").val() === '') {
                    $("#signUp-dialog-called-from").val("partialLogin");
                }
                renderpopup("login");
            } else if (g_user_lvl < lvl || premiumLvl) {
                if (g_user_lvl < 2) {       //already a member?
                    $("#update-member-accessCode-dialog").overlay().load();
                } else {
                    displayOverlay('closed-accessCode-dialog');
                    return false;
                }
            } else {
                return false;
            }
        }
        return true;
    }
</script>
<div id="wine-acceptance-overlay" class="overlayDialog overlay foyer" style="display:none; position: fixed; z-index: 9999;">
    <div class="close mobile" popupid="wine-acceptance-overlay"></div>
    <div class="rightVertical">
        <div class="body" style="">
            <div class="content" style="margin: 0 auto;max-width: 90%;position: relative;">
                
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function(){
        var wine_clicked = false;
        
        $('#wine-acceptance-overlay').on('click', '#bulk-approve-btn' , function(){
            
            if(!wine_clicked){
                wine_clicked = true;
                oiis = $(this).attr('data-oiis');
            
                $.ajax({
                    type: 'POST',
                    url : '/services/payout/ApproveWineAcceptance',
                    data: {oiis: oiis},
                    success: function(_response){
                        if(_response.code !== 1){
                            wine_clicked = false;
                            alertEx(_response.msg);
                        }else{
                            location.reload();
                        }
                    },
                    error:function(){

                    },
                    dataType:'json'
                });
            }
            
        });
        
//        $('#wine-acceptance-overlay .close').click(function(){
//            userAccessHide();
//            return false;
//        });
        
        $('#vendor-admin').on('click', '#bulk-approve-overlay-btn',function(){
            $.ajax({
                type: 'GET',
                url : '/services/payout/getWineAcceptance',
                success: function(_response){
                    if(_response.code !== 1){
                        alertEx(_response.msg);
                    }else{
                        $('#wine-acceptance-overlay .content').html(_response.html);
                    }
                },
                error:function(){

                },
                dataType:'json'
            });
            displayOverlay('wine-acceptance-overlay');
            return false;
        });
    });        
</script>
<style>
    #wine-acceptance-overlay{
        height: 500px !important;
        overflow-y: scroll;
    }
    
    </style>        <div id="trackingImage" style="height:1px;display: none;position: absolute;"></div>
    </div>
    <script>
        //var midTime3 = new Date().getTime();
        //console.log("midTime3 "+ (midTime3 - startTime)/1000 +" seconds");
    </script>
    <input type="hidden" name="redirectURL" id="redirectURL" value="/website/privacy">
    <input type="hidden" name="signUp-dialog-called-from" id="signUp-dialog-called-from" value="">
    <input type="hidden" name="displayLogin" id="js-displayLogin" value="">
    <script type="text/javascript">

$(document).ready(function(){
            $("#redirectURL").val('/website/privacy');
        $("#body, #category-list-nav-scroll").on("click", "a", function(e){
            clearTimeout(autoPopupTimer);
            if( $(this).hasClass('close') ||
                $(this).hasClass('date-list') ||
                $(this).hasClass('corporate-request') ||
                $(this).hasClass('to-top') ||
                $(this).hasClass('backward') ||
                $(this).hasClass('forward') ||
                $(this).hasClass('allowAllUsers') ||
                $(this).hasClass('signup-button') ||
                $(this).hasClass('login-button') ||
                $(this).hasClass('add-to-bag') ||
                $(this).hasClass('buynow-button') ||
                $(this).closest('.product-content .product-desc').length > 0 ||
                $(this).hasClass('loginWithFacebookButton') ||
                $(this).hasClass('google-signinButton') ||
                $(this).hasClass('loginWithLinkedIn') ||
                $(this).hasClass('waitlist-button') ||
                $(this).hasClass('request-button') ||
                $(this).hasClass('scroll-arrow') ||
                $(this).parent().hasClass('marqueeNav') ||
                $(this).attr('to') ||
                $(this).attr('lvl')==='1' ||
                $(this).attr('id') ==='buynow-button' ||
                $(this).attr('id') ==='forgot-password' ||
                $(this).attr('id') ==='concierge-email-button' ||
                $(this).attr('id') ==='signin-warning-button' ||
                $(this).attr('id') ==='top-nav-story' ||
                $(this).attr('href') ===undefined ||
                $(this).attr('href') ==='/' ||
                $(this).attr('href') ==='/holiday'
                )
            {                           // allowed links - do default behaviour
                if ( $(this).parent().attr('id') === 'top-welcome' ) {
                    g_guest_productId        = ''; // prevent to add a product
                    g_guest_parent_productId = '';
                }

            } else {                    // restricted links
                $("#redirectURL").val($(this).attr('href'));
                var lvl = $(this).attr('lvl');
                if( lvl > g_user_lvl || $(this).attr('href') === '#') {  // id no link (i.e #) the open sign up pop up
                    if($(this).attr('class')){
                        var $button = $(this);

                        if($button.hasClass('wishlist')){
                            $("#signUp-dialog-called-from").val('wishlist');
                        } else if($button.hasClass('following')){
                            $("#signUp-dialog-called-from").val('following');
                        } else if($button.hasClass('watchlist')){
                            $("#signUp-dialog-called-from").val('watchlist');
                        } else if($button.hasClass('js-shopping-bag')){
                            $("#signUp-dialog-called-from").val('js-shopping-bag');
                        }
                    }

                    if($(this).attr('instantAccessCode')){
                        g_instantAccessCode = $(this).attr('instantAccessCode');
                    }
                    signupDialog(lvl, false, {'button': $(this)});
                    return false;
                }
            }
        });
           adroll_adv_id = 'YV7OETC6DZAVTAVHR6EIYM';
                  adroll_pix_id = 'JSADBKKRAJG53DPWHGF4DP';
                 (function () {
                  var _onload = function(){
                   if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
                   if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
                   var scr = document.createElement('script');
                   var host = (('https:' == document.location.protocol) ? 'https://s.adroll.com' : 'http://a.adroll.com');
                   scr.setAttribute('async', 'true');
                   scr.type = 'text/javascript';
                   scr.src = host + '/j/roundtrip.js';
                   ((document.getElementsByTagName('head') || [null])[0] ||
                    document.getElementsByTagName('script')[0].parentNode).appendChild(scr);};
                  if (window.addEventListener) {window.addEventListener('load', _onload, false);}
                  else {window.attachEvent('onload', _onload)}}());});

function callSignupTrackingCode(){
   $('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://d.adx.io/conversions?xb=35BD0380&xnojs=1" />');$('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://www.googleadservices.com/pagead/conversion/976272921/?label=hFCrCI_UpwgQmfzC0QM&amp;guid=ON&amp;script=0" />');$('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/offsite_event.php?id=6011685149285&amp;value=0&amp;currency=USD" />');$('#trackingImage').append('<img src="https://shareasale.com/sale.cfm?amount=0.00&tracking='+g_userId+'&transtype=LEAD&merchantID=50745" width="1" height="1" />');$('#trackingImage').append('<img height="1" width="1" style="display:none;" alt="" src="https://analytics.twitter.com/i/adsct?txn_id=l4753&p_id=Twitter" />');$('#trackingImage').append('<img src="http://pixel.quantserve.com/pixel/p-SswRnXTcs-q48.gif?labels=_fp.event.Sign+Up+Confirmation" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>');$('#trackingImage').append('<img src="https://p.liadm.com/p?c=11775" />');$('#trackingImage').append('<img src="https://bat.bing.com/action/0?ti=4001812&Ver=2" height="0" width="0" style="display:none; visibility: hidden;" />');$('#trackingImage').append('<img src="https://pubads.g.doubleclick.net/activity;xsp=130022;ord=33035925?" height="0" width="0" style="display:none; visibility: hidden;" />');}

ioReady(function(){
    
});
</script>
<script type="text/javascript">

$(document).ready(function(){
            $.post('/website/javascriptActive',{from:1},function(data){},'json');
        });
</script>

                  
                 <script type="text/javascript">
                 
                 function footerTrackingScript() {
                 
                    (function() {
                        var tk = document.createElement('script');
                        tk.src = 'https://platform.twitter.com/oct.js';
                        tk.type = 'text/javascript';
                        tk.async = 'true';
                        tk.onload = tk.onreadystatechange = function() {
                          twttr.conversion.trackPid('l4km8');
                        };
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(tk, s);
                    })();                    
                    (function() {
                        var imaxw = document.createElement('script');
                        imaxw.src = 'https://www.sc.pages03.net/lp/static/js/iMAWebCookie.js?2edcd082-1461604bde3-943e27de0c8b91cc3fcf1475c3e5d726&h=www.pages03.net';
                        imaxw.type = 'text/javascript';
                        imaxw.async = 'true';
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(imaxw, s);
                    })();
                    
                    <!--SteelHouse Tracking Pixel-->                    
                    (function(){'use strict';var e=null,b='4.0.0',
                                n='12260',
                                additional='',
                                t,r,i;
                                try{t=top.document.referer!==''?encodeURIComponent(top.document.referrer.substring(0,2048)):''}
                                catch(o){t=document.referrer!==null?document.referrer.toString().substring(0,2048):''}
                                try{r=window&&window.top&&document.location&&window.top.location===document.location?document.location:window&&window.top&&window.top.location&&''!==window.top.location?window.top.location:document.location}
                                catch(u){r=document.location}
                                try{i=parent.location.href!==''?encodeURIComponent(parent.location.href.toString().substring(0,2048)):''}
                                catch(a){try{i=r!==null?encodeURIComponent(r.toString().substring(0,2048)):''}catch(f){i=''}}
                                var l,c=document.createElement('script'),h=null,p=document.getElementsByTagName('script'),
                                d=Number(p.length)-1,v=document.getElementsByTagName('script')[d];
                                if(typeof l==='undefined'){l=Math.floor(Math.random()*1e17)}
                                h='dx.steelhousemedia.com/spx?'+'dxver='+b+'&shaid='+n+'&tdr='+t+'&plh='+i+'&cb='+l+additional;
                                c.type='text/javascript';c.src=('https:'===document.location.protocol?'https://':'http://')+h;
                                v.parentNode.insertBefore(c,v)
                    })();

                    <!-- Qualaroo for ifonly.com -->
                    <!-- Paste this code right after the <body> tag on every page of your site. -->
                    
                    var _kiq = _kiq || [];
                    (function(){
                        setTimeout(function()
                        { var d = document, f = d.getElementsByTagName('script')[0], s = d.createElement('script'); 
                        s.type = 'text/javascript'; 
                        s.async = true; 
                        s.src = 'https://s3.amazonaws.com/ki.js/62193/eb8.js'; 
                        f.parentNode.insertBefore(s, f); }
                        , 1);
                    })();
                    
                    $('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://pubads.g.doubleclick.net/activity;dc_iu=/72241422/DFPAudiencePixel;dc_seg=65565610?" />');                    
                    
                 }
                 $(window).load(function() { footerTrackingScript(); }); </script>
<script type="text/javascript">
    var google_tag_params = {
    ecomm_prodid: '',
    ecomm_pagetype: 'other',
    ecomm_totalvalue: '0'
};
</script>
<script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 976272921;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
</script>
<script type="text/javascript">
    
    $(window).load(function() {
        (function() {
            var conversion = document.createElement('script');
            conversion.src = '//www.googleadservices.com/pagead/conversion.js';
            conversion.type = 'text/javascript';
            conversion.async = 'true';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(conversion, s);
        })();
    });   
    
</script>
<noscript>
<div style="display:inline;">
<img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/976272921/?value=0&amp;guid=ON&amp;script=0"/>
</div>
</noscript>
<style>
.signup-banner { width:100%; height:90px; background: #000; display: block; position: fixed; bottom:0; z-index: 990; }
.sb-container { width:1170px; margin: 0 auto; margin-top:17px; }
.sb-container > div { display: inline-block; }
.sb-container p { line-height: 120%; }

#signup-banner-div .logo {width:28px; margin-top:3px;}
#signup-banner-div .phrase {width:780px; text-align:center;}
#signup-banner-div .phrase p { color: #fff; font-family: georgia; font-size: 24px; font-style:italic; display: inline-block;}
#signup-banner-div .phrase p.big { font-size: 46px; margin: 0 10px;}
#signup-banner-div .su-form {float:right;}

#signup-banner-div input {width:230px;}
#signup-banner-div .tou {width:244px; text-align: center; color: #e1e1e1; font-size: 11px; letter-spacing:0.2px; margin-top: 2px;}
#signup-banner-div .tou > a { color: #e1e1e1; text-decoration: underline;}

#signup-banner-thankyou {bottom:-90px;}
#signup-banner-thankyou .thankyou-msg {width:100%; text-align:center;}
#signup-banner-thankyou .thankyou-msg p { color: #fff; font-family: source-sans-pro-n4; font-size: 18px; display: inline-block;}
#signup-banner-thankyou .thankyou-msg p.big { font-family: georgia; font-size: 32px; margin-right: 50px; font-style:italic; }
#signup-banner-thankyou .close-button {position:absolute; right: 10px; top: 7px;}

.mobile .signup-banner { top:50px; height:116px; }
.mobile .sb-container  { width:100%; margin-top: 10px; text-align: center;}
.mobile #signup-banner-div .logo { display:none; }
.mobile #signup-banner-div .phrase {width:100%; text-align:center; margin-bottom: 10px;}
.mobile #signup-banner-div .phrase p {font-size: 12px;}
.mobile #signup-banner-div .phrase p.big {font-size: 20px;margin: 0 5px;}
.mobile #signup-banner-div .su-form {float:none; width: 290px;}

.mobile #signup-banner-div input {width:180px;}
.mobile #signup-banner-div .tou {width:100%;}

.mobile #signup-banner-thankyou {top:-66px;}
.mobile #signup-banner-thankyou .thankyou-msg {margin-top: 10px;}
.mobile #signup-banner-thankyou .thankyou-msg p {font-size: 14px; padding: 0 30px;}
.mobile #signup-banner-thankyou .thankyou-msg p.big { font-size: 24px; margin-right: 0px; margin-bottom: 10px;}

#launcher {bottom:90px ! important;} /* zendesk help button shoud go 90px up */
</style>

<div id="signup-banner-div" class="signup-banner" style="">
    <form name="registerForm" id="signupBannerForm" class="registerForm form" method="post">
        <div class="sb-container">
            <div class="logo"><img src="/images/io/ifonly_icon_ffffff.png" alt="IfOnly" style="height:48.5px;"></div>
            <div class="phrase">
                <p>Sign up now and receive </p> <p class="big">10% off</p> <p>your first purchase</p>            </div>
            <div class="su-form">
                <input type="text" id="signup-banner-email" name="User[emailAddress]">
                 <div id="signup-banner-submit-button" class="allowAllUsers primaryButton button " style="width: 100px; margin-left: 7px;"><span class="title">Sign Up</span></div>                <p class="tou">By signing up, you agree to our <a href="/website/terms">Terms of Use</a></p>
            </div>
        </div>
    </form>
</div>

<div id="signup-banner-thankyou" class="signup-banner" style="display:none;">
    <div class="sb-container">
        <div class="thankyou-msg">
            <p class="big">Thank you!</p>
            <p>Please check your inbox for your welcome email and your unique promo code</p>
        </div>
    </div>
    <div class="close-button">
        <a href="#" class="close"><img src="/images/io/x_button.png" alt="close"></a>
    </div>
</div>

<script type="text/javascript">
$(document).ready(function(){
    $('#signup-banner-thankyou .close-button').click(function(){
        if (g_is_mobile) {
            $("#signup-banner-thankyou").animate({top: '-=116'}, 500, function() {
                location.reload();
            });
        } else {
            $("#signup-banner-thankyou").animate({bottom: '-=90'}, 500, function() {
                location.reload();
            });
        }
    });

    $("#signup-banner-div input").keypress(function(e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code === 13) {
            $("#signupBannerForm").submit();
        }
    });

    $("#signup-banner-div").on('click', '#signup-banner-submit-button',function(e){
        $("#signupBannerForm").submit();
    });

    $("#signupBannerForm").submit(function(e) {
        if ($("#signup-banner-submit-button").hasClass('disabled')) {
            return false;
        }

        var email = $("#signup-banner-email").val().trim();

        if (email === '') {
            alertEx('Please enter your email address', 'Sign Up Error');
            return false;
        } else if (! validateEmail(email)) {
            alertEx('Please enter a valid email address', 'Sign Up Error');
            return false;
        }

        $("#signup-banner-email").val(email);

        $("#signupBannerForm").css('cursor','wait');
        $("#signup-banner-submit-button").addClass('disabled');

        $.post( '/website/registerEmail', $("#signupBannerForm").serialize(),
            function (data){
                $("#signupBannerForm").css('cursor','auto');

                var url = $("#redirectURL").val();
                if (data.result === 3) {
                    $(".js-login").click();
                    $("#login-email").val(email).show();
                    $("#login-pass").focus();
                    $("#login_error").html(data.msg).show();
                } else if (data.result > 0) {
                    if (addGuestProductToCart()) return false; // if need to add a guest product (main.js)
                    if (g_is_mobile) {
                        $("#signup-banner-div").animate({top: '-=116'}, 500, function() {
                            $("#signup-banner-thankyou").show().animate({top: '+=116'}, 500, function() {$("#signup-banner-div").hide();});
                        });
                    } else {
                        $("#signup-banner-div").animate({bottom: '-=90'}, 500, function() {
                            $("#signup-banner-thankyou").show().animate({bottom: '+=90'}, 500, function() {$("#signup-banner-div").hide();});
                        });
                    }
                    g_signup_timer = 5000; // need more time to read message

                    $('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://d.adx.io/conversions?xb=35BD0380&xnojs=1" />');$('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://www.googleadservices.com/pagead/conversion/976272921/?label=hFCrCI_UpwgQmfzC0QM&amp;guid=ON&amp;script=0" />');$('#trackingImage').append('<img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/offsite_event.php?id=6011685149285&amp;value=0&amp;currency=USD" />');$('#trackingImage').append('<img src="https://shareasale.com/sale.cfm?amount=0.00&tracking='+g_userId+'&transtype=LEAD&merchantID=50745" width="1" height="1" />');$('#trackingImage').append('<img height="1" width="1" style="display:none;" alt="" src="https://analytics.twitter.com/i/adsct?txn_id=l4753&p_id=Twitter" />');$('#trackingImage').append('<img src="http://pixel.quantserve.com/pixel/p-SswRnXTcs-q48.gif?labels=_fp.event.Sign+Up+Confirmation" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>');$('#trackingImage').append('<img src="https://p.liadm.com/p?c=11775" />');$('#trackingImage').append('<img src="https://bat.bing.com/action/0?ti=4001812&Ver=2" height="0" width="0" style="display:none; visibility: hidden;" />');$('#trackingImage').append('<img src="https://pubads.g.doubleclick.net/activity;xsp=130022;ord=33035925?" height="0" width="0" style="display:none; visibility: hidden;" />');                    

        var _qevents = _qevents || [];

        (function() {
            var elem = document.createElement('script');
            elem.src = (document.location.protocol == 'https:' ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
            elem.async = true;
            elem.type = 'text/javascript';
            var scpt = document.getElementsByTagName('script')[0];
            scpt.parentNode.insertBefore(elem, scpt);

            //Tracking for silverpop
            var selem = document.createElement('script');
            selem.src = (document.location.protocol == 'https:' ? 'https://www.sc.pages03.net/lp/static/js/iMAWebCookie.js?2edcd082-1461604bde3-943e27de0c8b91cc3fcf1475c3e5d726&h=www.pages03.net' : 'http://contentz.mkt932.com/lp/static/js/iMAWebCookie.js?2edcd082-1461604bde3-943e27de0c8b91cc3fcf1475c3e5d726&h=www.pages03.net');
            selem.async = true;
            selem.type = 'text/javascript';
            var sscpt = document.getElementsByTagName('script')[0];
            sscpt.parentNode.insertBefore(selem, sscpt);
        })();

        _qevents.push(
            {qacct:'p-SswRnXTcs-q48',labels:'_fp.event.Sign Up Confirmation'}
        );

        var _adx = {};
        _adx.xb  = '35BD0380';
        _adx.xt  = 'conversion';
        _adx.xgid  = '6AMDU1';
        (function(d){
            var x = d.createElement('script');
            x.async = true;
            x.src = ('https:' == d.location.protocol ? 'https://d1adj61x0fgvmc.cloudfront.net' : 'http://s.adx.io') + '/dxjet.js';
            var s = d.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(x, s);
        })(document);

        (function(w,d,t,r,u){
            var f,n,i;w[u]=w[u]||[],f=function(){var o={ti:'4001812'};
            o.q=w[u],w[u]=new UET(o),w[u].push('pageLoad')},
            n=d.createElement(t),n.src=r,n.async=1,
            n.onload=n.onreadystatechange=function(){var s=this.readyState;s&&s!=='loaded'&&s!=='complete'||(f(),n.onload=n.onreadystatechange=null)},
            i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i)
        })(window,document,'script','https://bat.bing.com/bat.js','uetq');


        
                    if (url !== '' && url !== '#') {
                        setTimeout('location.href = "' + url + '";', g_signup_timer);
                    } else {
                        setTimeout('location.reload();', g_signup_timer);
                    }
                } else {
                    alertEx(data.msg, 'Sign Up Error');
                }
                $("#signup-banner-submit-button").removeClass('disabled');
                return false;
            },'json');
        return false;
    });

});
</script>



<style>
    #address-scheduling-dialog-googlemaps {max-width:100%; max-height: 100%; width: 335px; min-height: 500px; overflow-y: auto; overflow-x: hidden;}
    #address-scheduling-dialog-googlemaps.mobile{width: 100%; height: 100%; overflow-y: auto;}
    #address-scheduling-dialog-googlemaps.mobile div{ max-width: 100%;}
    #address-scheduling-dialog-googlemaps.overlay .dialog_body{margin: 0px;}
    #address-scheduling-dialog-googlemaps .save-update-address-google,
    #address-scheduling-dialog-googlemaps .save-original-address-google{float:left;}
    .overlay .dialog_content .address-form{
        padding: 20px;
        width: 80%;
        width: -webkit-calc(100% - 40px);
        width: -moz-calc(100% - 40px);
        width: calc(100% - 40px);
    }
    .overlay .dialog_content .address-wrapper .edit-label{
        font-family: "Georgia";
        font-style: italic;
        font-size: 13px;
        color: #777;
        margin: 0px;
        margin-top: 10px;
        margin-bottom: 3px;
        text-align: left;
    }
    .overlay .dialog_content .address-wrapper select{
        padding: 10px 2px;
    }
    .overlay .dialog_content .address-wrapper input{
        width: 100%;
        width: -webkit-calc(100% - 14px);
        width: -moz-calc(100% - 14px);
        width: calc(100% - 14px);

    }
    .overlay .dialog_content .address-wrapper .state-box{ width: 120px; float: left;}
    .overlay .dialog_content .address-wrapper .zip-box {
        width: 60%;
        width: -webkit-calc(100% - 120px);
        width: -moz-calc(100% - 120px);
        width: calc(100% - 120px);
        float: left;
    }

    .overlay .dialog_content { width: 100%;}
    .overlay .dialog_content p.error-general{margin: 0px; text-align: left;}
    #address-suggestion-dialog-googlemaps {display:none; width: 700px; height: 500px; max-width:80%; max-height:90%;}
    #address-suggestion-dialog-googlemaps .dialog_header {float:left; margin: 0 5% 5% 5%; width: auto;}
    #address-suggestion-dialog-googlemaps .dialog_body {float:left; margin: 3% 0 0 5%; width: 92%;}
    .address-suggestion-footer { float:left; margin: 15% 0 0 5%; }
    .mobile .address-suggestion-footer { float:none; margin: 0;}
    .address-wrapper-outter { float:left; font-size:15px; letter-spacing: 0.04em; width:245px; max-width: 100%; height: 190px;}
    #address-suggestion-dialog-googlemaps .address-wrapper { margin:5% 0 0 10%;height:84px;}
    #address-suggestion-dialog-googlemaps.mobile .address-wrapper{height:auto;}
    #address-suggestion-dialog-googlemaps.mobile .address-section-divide {display: none;}

    .address-form-submit{margin-left: -3px; margin-top: 16px;}
    .mobile .address-form-submit{margin-left: 0px; color: #fff}
    .address-form-submit .address-submit{
        width: 293px;
    }
    .mobile .address-form-submit .address-submit{
        width: 100%;
        width: -webkit-calc(100% + 3px);
        width: -moz-calc(100% + 3px);
        width: calc(100% + 3px);
    }

    #address-suggestion-dialog-googlemaps.mobile .dialog_header{float: none;}
    #address-suggestion-dialog-googlemaps.mobile .dialog_body{float: none; margin: 0; width: 100%;}
    .mobile .address-wrapper-outter{float: none; height: auto; margin: 0 auto;}
    #address-suggestion-dialog-googlemaps.mobile .address-wrapper{margin: 0;}
    .mobile .button-x-wide{float: none;}
    .mobile .sub-header{text-align: center;}


    /* autocomplete map*/
    .overlay .controls {
        margin-top: 10px;
        border: 1px solid transparent;
        border-radius: 2px 0 0 2px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        height: 32px;
        outline: none;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      }

      #pac-input {
        background-color: #fff;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        margin-left: 12px;
        padding: 0 11px 0 13px;
        text-overflow: ellipsis;
        width: 300px;
      }

      #pac-input:focus {
        border-color: #4d90fe;
      }

        .pac-container {
            background-color: #FFF;
            z-index: 10001;
            position: fixed !important;
            display: inline-block;
            float: left;
            top: 72px !important;
        }
        .pac-item{
           z-index: 10000;
        }

      #type-selector {
        color: #fff;
        background-color: #4d90fe;
        padding: 5px 11px 0px 11px;
      }

      #type-selector label {
        font-family: Roboto;
        font-size: 13px;
        font-weight: 300;
      }
      #target {
        width: 345px;
      }

</style>

<div id="address-scheduling-dialog-googlemaps" class="overlayBlack overlay small ipadCalendarCenter">
    <div class="overlayContent" style="margin-top: 10px;">
        <div class="dialog_body">
            <div class="dialog_content">

                <div class="address-form">
                    <input type="hidden" class="address-productId" name="productId">
                    <input type="hidden" class="address-number" name="number">
                    <input type="hidden" class="address-oii">

                    <p class="js-addr-req-header" style="text-align: left;">
                        Provide your address to determine if this experience is available in your region
                    </p>
                    <span class="js-addr-change-header fo-18-n-g hidden" style="text-align: center; margin-bottom: 20px; ">
                        Propose Alternative Address
                    </span>
                    <p id="invalid-address" class="error-general" style="display:none;">We are unable to verify your address.  Please check it and try again. </p>
                    <input type="hidden" class="address-productId" name="productId">
                    <div class="address-wrapper">
                                        <div class="js-err-con">
                    <p class="edit-label">
                        Street Address
                    </p>
                    <input class="address address1 js-req" hiddeninpid="address1" fieldname="address" id="CartItemSocialInfo_address" type="text" value="" name="CartItemSocialInfo[address]">                    <div class="clearAll"></div>
                </div>

                <p class="edit-label">
                    Apt/Ste/Bldg (i.e. apt 210)
                </p>
                <input class="address2 notForValidation" hiddeninpid="address2" fieldname="address" id="CartItemSocialInfo_address2" type="text" value="" name="CartItemSocialInfo[address2]">                <div class="clearAll"></div>
                <div class="js-err-con">
                    <p class="edit-label">
                        City
                    </p>
                    <input class="city js-req" hiddeninpid="city" fieldname="city" id="CartItemSocialInfo_city" type="text" value="" name="CartItemSocialInfo[city]">                    <div class="clearAll"></div>
                </div>
                <div class="state-box">
                    <p class="edit-label">
                        State
                    </p>
        <select class="state" hiddeninpid="state" style="margin-right:5px;background-color: white;width:115px;" name="CartItemSocialInfo[state]" id="CartItemSocialInfo_state">
<option value="AK">AK</option>
<option value="AL">AL</option>
<option value="AR">AR</option>
<option value="AZ">AZ</option>
<option value="CA" selected="selected">CA</option>
<option value="CO">CO</option>
<option value="CT">CT</option>
<option value="DC">DC</option>
<option value="DE">DE</option>
<option value="FL">FL</option>
<option value="GA">GA</option>
<option value="HI">HI</option>
<option value="IA">IA</option>
<option value="ID">ID</option>
<option value="IL">IL</option>
<option value="IN">IN</option>
<option value="KS">KS</option>
<option value="KY">KY</option>
<option value="LA">LA</option>
<option value="MA">MA</option>
<option value="MD">MD</option>
<option value="ME">ME</option>
<option value="MI">MI</option>
<option value="MN">MN</option>
<option value="MO">MO</option>
<option value="MS">MS</option>
<option value="MT">MT</option>
<option value="NC">NC</option>
<option value="ND">ND</option>
<option value="NE">NE</option>
<option value="NH">NH</option>
<option value="NJ">NJ</option>
<option value="NM">NM</option>
<option value="NV">NV</option>
<option value="NY">NY</option>
<option value="OH">OH</option>
<option value="OK">OK</option>
<option value="OR">OR</option>
<option value="PA">PA</option>
<option value="PR">PR</option>
<option value="RI">RI</option>
<option value="SC">SC</option>
<option value="SD">SD</option>
<option value="TN">TN</option>
<option value="TX">TX</option>
<option value="UT">UT</option>
<option value="VA">VA</option>
<option value="VT">VT</option>
<option value="WA">WA</option>
<option value="WI">WI</option>
<option value="WV">WV</option>
<option value="WY">WY</option>
</select>        <div class="clearAll"></div>
                </div>
                <div class="zip-box js-err-con">
                    <p class="edit-label">
                        Zip Code
                    </p>
                    <input class="zipCode js-req" hiddeninpid="zip" fieldname="a valid zip" maxlength="10" id="CartItemSocialInfo_zip" type="text" value="" name="CartItemSocialInfo[zip]">                    <div class="clearAll"></div>
                </div>
                            <div class="clearAll"></div>
                    </div>
                    <div class="address-form-submit">
                        <div class="js-address-save-btns">
                             <div class="allowAllUsers address-submit address-submit-wrapper primaryButton button " style="float:left;width:100%;"><span class="title">SAVE</span></div>                        </div>


                        <div class="js-address-action-btns hidden">
                            <div class="js-no-propose">
                                 <div style="float:left; width:48%; padding:0px; display:none;" class="secondaryButton button"><span class="title">Let them pick</span></div>                            </div>
                            <div class="js-propose">
                                 <div style="float:right; width:100%; padding:0px;" class="primaryButton button"><span class="title">Submit</span></div>                            </div>
                            <div style="clear:both;"></div>
                        </div>
                    </div>
                    <div class="clearAll"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="address-scheduling-dialog-googlemaps-autocomplete" class="overlayBlack overlay small ipadCalendarCenter">
    <input id="pac-input" class="controls" type="text" placeholder="New Address...">
    <div class="map" style="margin-top: 45px;">        <div class="map-row" style="height: 250px; width: 100%; position: relative;">
            <div class="radiusBox" style="display:none;"><span>radius: </span><span class="radiusValue"></span> miles</div>
            <div id="map-canvas1" class="map-canvas" address="150 Green St, San Francisco, CA" radius="0" style="height: 100%; width: 100%;">

            </div>
            <div class="clearAll"></div>

            
        </div>
        <div class="clearAll"></div>
        
    </div>


    <div class="overlayContent" style="margin-top: 10px;">
        <div class="dialog_body">
            <div class="dialog_content">

                <div class="address-form">
                    <input type="hidden" class="address-productId" name="productId">
                    <input type="hidden" class="address-number" name="number">
                    <input type="hidden" class="address-oii">

                    <p class="js-addr-req-header" style="text-align: left;">
                        Provide your address to determine if this experience is available in your region
                    </p>
                    <span class="js-addr-change-header hidden" style="text-align: center; margin-bottom: 20px;">
                        Propose Alternative Address
                    </span>
                    <p id="invalid-address" class="error-general" style="display:none;">We are unable to verify your address.  Please check it and try again. </p>
                    <input type="hidden" class="address-productId" name="productId">
                    <div class="address-wrapper">
                                        <div class="js-err-con">
                    <p class="edit-label">
                        Street Address
                    </p>
                    <input class="address address1 js-req" hiddeninpid="address1" fieldname="address" id="CartItemSocialInfo_address" type="text" value="" name="CartItemSocialInfo[address]">                    <div class="clearAll"></div>
                </div>

                <p class="edit-label">
                    Apt/Ste/Bldg (i.e. apt 210)
                </p>
                <input class="address2 notForValidation" hiddeninpid="address2" fieldname="address" id="CartItemSocialInfo_address2" type="text" value="" name="CartItemSocialInfo[address2]">                <div class="clearAll"></div>
                <div class="js-err-con">
                    <p class="edit-label">
                        City
                    </p>
                    <input class="city js-req" hiddeninpid="city" fieldname="city" id="CartItemSocialInfo_city" type="text" value="" name="CartItemSocialInfo[city]">                    <div class="clearAll"></div>
                </div>
                <div class="state-box">
                    <p class="edit-label">
                        State
                    </p>
        <select class="state" hiddeninpid="state" style="margin-right:5px;background-color: white;width:115px;" name="CartItemSocialInfo[state]" id="CartItemSocialInfo_state">
<option value="AK">AK</option>
<option value="AL">AL</option>
<option value="AR">AR</option>
<option value="AZ">AZ</option>
<option value="CA" selected="selected">CA</option>
<option value="CO">CO</option>
<option value="CT">CT</option>
<option value="DC">DC</option>
<option value="DE">DE</option>
<option value="FL">FL</option>
<option value="GA">GA</option>
<option value="HI">HI</option>
<option value="IA">IA</option>
<option value="ID">ID</option>
<option value="IL">IL</option>
<option value="IN">IN</option>
<option value="KS">KS</option>
<option value="KY">KY</option>
<option value="LA">LA</option>
<option value="MA">MA</option>
<option value="MD">MD</option>
<option value="ME">ME</option>
<option value="MI">MI</option>
<option value="MN">MN</option>
<option value="MO">MO</option>
<option value="MS">MS</option>
<option value="MT">MT</option>
<option value="NC">NC</option>
<option value="ND">ND</option>
<option value="NE">NE</option>
<option value="NH">NH</option>
<option value="NJ">NJ</option>
<option value="NM">NM</option>
<option value="NV">NV</option>
<option value="NY">NY</option>
<option value="OH">OH</option>
<option value="OK">OK</option>
<option value="OR">OR</option>
<option value="PA">PA</option>
<option value="PR">PR</option>
<option value="RI">RI</option>
<option value="SC">SC</option>
<option value="SD">SD</option>
<option value="TN">TN</option>
<option value="TX">TX</option>
<option value="UT">UT</option>
<option value="VA">VA</option>
<option value="VT">VT</option>
<option value="WA">WA</option>
<option value="WI">WI</option>
<option value="WV">WV</option>
<option value="WY">WY</option>
</select>        <div class="clearAll"></div>
                </div>
                <div class="zip-box js-err-con">
                    <p class="edit-label">
                        Zip Code
                    </p>
                    <input class="zipCode js-req" hiddeninpid="zip" fieldname="a valid zip" maxlength="10" id="CartItemSocialInfo_zip" type="text" value="" name="CartItemSocialInfo[zip]">                    <div class="clearAll"></div>
                </div>
                            <div class="clearAll"></div>
                    </div>
                    <div class="address-form-submit">
                         <div class="allowAllUsers address-submit address-submit-wrapper primaryButton button " style="float:left;width:100%;"><span class="title">SAVE</span></div>


                    </div>
                    <div class="clearAll"></div>
                </div>
            </div>
        </div>
    </div>
</div>


<div id="address-suggestion-dialog-googlemaps" class="overlay foyer">
    <div class="overlayContent">
        <div class="dialog_header">
            <p style="font-family: georgia; font-size:24px;">Address Verification</p>
        </div>

        <div class="dialog_body">
            <p class="sub-header" style="font-size: 15px; margin: 0 0 20px 0;">We've validated your address according to Google Maps</p>

            <div class="address-wrapper-outter">
                <div class="address-wrapper update-address">
                    <p class="suggested-place"></p>
                    <p class="suggested-street"></p>
                    <p class="suggested-city"></p>
                    <p class="suggested-state"></p>
                </div>
                 <div class="address-suggestion-footer">
<!--                    <div class="button-wrap" style="margin-top:15px;"><div class="button-outer"><a href="#" lvl="1" class="button-x-wide save-update-address-google" style="width:210px;">SAVE UPDATED ADDRESS</a></div></div>-->
                     <div lvl="1" class="save-update-address-google primaryButton button " style="width:210px;margin-top:15px;"><span class="title">SAVE UPDATED ADDRESS</span></div>                </div>
            </div>
            <div class="address-section-divide" style="float:left;margin-top:10%; width:50px;border-right: 0px #ccc solid;">
                <p style="font-family: 'Montserrat';font-style: normal;font-weight: 400; font-size: 14px;">OR</p>
            </div>
            <div class="address-wrapper-outter">
                <div class="address-wrapper orignal-address">
                    <p class="original-street1"></p>
                    <p class="original-street2"></p>
                    <p class="original-city"></p>
                    <p class="original-state"></p>
                </div>
                <div class="address-suggestion-footer">
<!--                    <div class="button-wrap grey" style="margin-top:15px;"><div class="button-outer"><a href="#" lvl="1"  class="button-x-wide-grey save-original-address-google">USE ORIGINAL ADDRESS</a></div></div>-->
                     <div lvl="1" class="allowAllUsers address-submit save-original-address-google secondaryButton button " style="width:210px;margin-top:15px;"><span class="title">USE ORIGINAL ADDRESS</span></div>                </div>
            </div>






        </div>
    </div>
</div>

<script type="text/javascript">

// common_address_callFrom            1
//                            default 2 - cart, checkout
//                                    3 - order history
//                                    4 - product builder
//                                    5 - product admin
var common_address_callFrom = 2;
var common_address_mode     = g_infobox_modes.edit;

// common_address_header       default 1
//                                     2 - address changes
var common_address_header   = 1;

var newMarkerObj = {'marker':'', 'infoBubble':''};

ioReady(function(){

    $("#address-suggestion-dialog-googlemaps").overlay({
        top: 'center',  fixed: true, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed: 0, opacity: 0.5 },
        onClose: function() {

		},

    });


    var fixed = true;

    $("#address-scheduling-dialog-googlemaps").overlay({
        top: 'center',  fixed:fixed , closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 },
        onClose: function() {

		},
        onBeforeClose: function(){
            if(g_is_mobile){
                releaseBodyHeight();
                $('html, body').animate({scrollTop:g_currentPosTop}, 0, function(){
                    console.log(g_currentPosTop);
                });
            }
        },
        onBeforeLoad:function(){
           if(g_is_mobile){
                $("#exposeMask").hide();
                g_currentPosTop = $(window).scrollTop();
                $('html, body').animate({scrollTop:0}, 0, function(){
                    fixBodyHeightToScreenHeight();
                });

            }

            if(common_address_mode == g_infobox_modes.exe ){
                $("#address-scheduling-dialog-googlemaps .js-address-action-btns").show();
                $("#address-scheduling-dialog-googlemaps .js-address-save-btns").hide();
            }else{
                $("#address-scheduling-dialog-googlemaps .js-address-action-btns").hide();
                $("#address-scheduling-dialog-googlemaps .js-address-save-btns").show();
            }

            if(common_address_header == 1){
                $("#address-scheduling-dialog-googlemaps .js-addr-req-header").show();
                $("#address-scheduling-dialog-googlemaps .js-addr-change-header").hide();
            }else{
                $("#address-scheduling-dialog-googlemaps .js-addr-req-header").hide();
                $("#address-scheduling-dialog-googlemaps .js-addr-change-header").show();
            }
        },
        onLoad: function() {
            if(g_is_mobile){
                $("#exposeMask").hide();

            }
        }
    });

    $("#address-scheduling-dialog-googlemaps-autocomplete").overlay({
        top: 'center',  fixed:fixed , closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 },
        onClose: function() {

		},
        onBeforeClose: function(){
            if(g_is_mobile){
                releaseBodyHeight();
                $('html, body').animate({scrollTop:g_currentPosTop}, 0, function(){
                    console.log(g_currentPosTop);
                });
            }
        },
        onBeforeLoad:function(){
           if(g_is_mobile){
                $("#exposeMask").hide();
                g_currentPosTop = $(window).scrollTop();
                $('html, body').animate({scrollTop:0}, 0, function(){
                    fixBodyHeightToScreenHeight();
                });

            }

            if(common_address_header == 1){
                $("#address-scheduling-dialog-googlemaps-autocomplete .js-addr-req-header").show();
                $("#address-scheduling-dialog-googlemaps-autocomplete .js-addr-change-header").hide();
            }else{
                $("#address-scheduling-dialog-googlemaps-autocomplete .js-addr-req-header").hide();
                $("#address-scheduling-dialog-googlemaps-autocomplete .js-addr-change-header").show();
            }
        },
        onLoad: function() {
            if(g_is_mobile){
                $("#exposeMask").hide();

            }
        }
    });
});




$(document).ready(function(){
var autoComplete = false;
    $("#main, .js-gift-schedule-by-gifter").on("click",".loc-button.preCheckOutField, .decline.LocationPicker",function(e){

        if($(this).hasClass("decline")){
            common_address_mode = g_infobox_modes.exe;
            common_address_header = 2;
        }else{
            common_address_mode = g_infobox_modes.edit;

            if($(this).hasClass("js-addr-header-2")){
                common_address_header = 2;
            }else{
                common_address_header = 1;
            }
        }



        if(autoComplete === true){
            var element = $("#address-scheduling-dialog-googlemaps-autocomplete");
            $("#address-scheduling-dialog-googlemaps-autocomplete .address-productId").val($(this).closest('.p-form').attr("data-pid"));
            $("#address-scheduling-dialog-googlemaps-autocomplete .address-number").val($(this).closest('.p-form').attr("data-num"));
            $("#address-scheduling-dialog-googlemaps-autocomplete .address-oii").val($(this).closest('.p-form').attr("data-oii"));
        }
        else{
            $("#address-scheduling-dialog-googlemaps .address-productId").val($(this).closest('.p-form').attr("data-pid"));
            $("#address-scheduling-dialog-googlemaps .address-number").val($(this).closest('.p-form').attr("data-num"));
            $("#address-scheduling-dialog-googlemaps .address-oii").val($(this).closest('.p-form').attr("data-oii"));
        }

        if(common_address_callFrom != 1){ // not in PDP
            $("#address-scheduling-dialog-googlemaps").attr('celeblocation', $(this).closest('.p-form').attr("data-cl"));
            $("#address-scheduling-dialog-googlemaps").attr('celebName', $(this).closest('.p-form').attr("data-cbn"));
            $("#address-scheduling-dialog-googlemaps").attr('localRadiusMiles', $(this).closest('.p-form').attr("data-lrm"));
            $("#address-scheduling-dialog-googlemaps").attr('localTravelFee', $(this).closest('.p-form').attr("data-ltf"));
            $("#address-scheduling-dialog-googlemaps").attr('regionalRadiusMiles', $(this).closest('.p-form').attr("data-rrm"));
            $("#address-scheduling-dialog-googlemaps").attr('regionalTravelFee', $(this).closest('.p-form').attr("data-rtf"));
            $("#address-scheduling-dialog-googlemaps").attr('nationalTravelFee', $(this).closest('.p-form').attr("data-ntf"));
            $("#address-scheduling-dialog-googlemaps").attr('willingToTravelDistance', $(this).closest('.p-form').attr("data-wtd"));
            $("#address-scheduling-dialog-googlemaps").attr('maxLocalityTypeId', $(this).closest('.p-form').attr("data-maxltid"));
            $("#address-scheduling-dialog-googlemaps").attr('travelCost', "0");
            $("#address-scheduling-dialog-googlemaps").attr('localityTypeId', "0");
            if($(this).closest('.p-form').attr("data-callFrom") !== undefined){
                common_address_callFrom = $(this).closest('.p-form').attr("data-callFrom");
            }
        }

        if( autoComplete === true){
            $("#address-scheduling-dialog-googlemaps-autocomplete").overlay().load();
            var params = {'showAutocomplete': true};
            initiateCustomMap("map-canvas1", "150 green st, san francisco, ca", params );
        }
        else{
            $("#address-scheduling-dialog-googlemaps").overlay().load();
        }
        return false;
    });


    $(".address-form-submit .address-submit, .address-form-submit .js-propose").on('click', function(e){
        $("#invalid-address").hide();
        var address1 = $('#address-scheduling-dialog-googlemaps .address').val();
        var address2 = $('#address-scheduling-dialog-googlemaps .address2').val();
        var city     = $('#address-scheduling-dialog-googlemaps .city').val();
        var state    = $('#address-scheduling-dialog-googlemaps .state option:selected').text();
        var zip      = $('#address-scheduling-dialog-googlemaps .zipCode').val();

        if( address2 !== ''){
            address2 = ', '+address2;
        }
        var address = address1+address2+', '+city+', '+state+' '+zip + ' USA';
        var addrObj = {'address':address, 'address1':address1, 'address2':address2, 'city':city, 'state':state, 'zip':zip};

        // input validation before submit.
        $(".address-wrapper").find(".error-general").remove();
        $('#address-scheduling-dialog-googlemaps input, #address-scheduling-dialog-googlemaps select').removeClass("inputBoxError");
        var error_inputIds = new Array();
        var error = false;

        if (address1 === ''){ error = true; error_inputIds.push('.address'); showGeneralErrorMsgs($('#address-scheduling-dialog-googlemaps  .address'));}
        if (city     === ''){ error = true; error_inputIds.push('.city'); showGeneralErrorMsgs($('#address-scheduling-dialog-googlemaps  .city'));}

        //var zipExp = new RegExp("^[0-9]{5}$|^[0-9]{5}\-[0-9]{4}$"); // US zip
        if (zip      === '' || !isZipcodeFormatValid(zip)){ error = true; error_inputIds.push('.zipCode'); showGeneralErrorMsgs($('#address-scheduling-dialog-googlemaps .zipCode'));}


        if(error){
            $(error_inputIds.join(",")).addClass("inputBoxError");
            return false;
        }

        addressVerification(addrObj);



        return false;
    });

    $(".address-form-submit .js-no-propose").click(function(){
        $dest = $(".p-form[data-pid="+ $("#address-scheduling-dialog-googlemaps .address-productId").val() +"]"
            + "[data-num=" + $("#address-scheduling-dialog-googlemaps .address-number").val() +"]"
            + "[data-oii=" + $("#address-scheduling-dialog-googlemaps .address-oii").val() +"]")


        $dest = $dest.find(".infobox_mode_div.exe .js-infobox-widget-decision-div.LocationPicker:visible");
        $dest.attr("data-value", "");
        $dest.attr("data-address", "");
        $dest.attr("data-address2", "");
        $dest.attr("data-city", "");
        $dest.attr("data-state", "");
        $dest.attr("data-zipCode", "");
        $dest.attr("data-travelCost", "");
        // trigger change event
        $dest.trigger("change");

        $dest.find('.infobox_widget_decision_btn.decline').addClass('selected');
        infobox_populate_suggested_values($dest);
        infobox_update_exe_mode_decision_btn_status($dest.parents('.infobox_mode_div.exe'))

        $("#address-scheduling-dialog-googlemaps").overlay().close();
    });


    $(".save-update-address-google").on('click', function(){
        if ($(this).attr("data-place") !== '') {
            $('#address-scheduling-dialog-googlemaps  .address').val($(this).attr("data-place"));
            $('#address-scheduling-dialog-googlemaps  .address2').val($(this).attr("data-street"));
        } else {
            var g_suggested = $(this).attr("data-street").split(", ");
            $('#address-scheduling-dialog-googlemaps  .address').val(g_suggested[0]);
            if( g_suggested.length > 1){
                $('#address-scheduling-dialog-googlemaps  .address2').val(g_suggested[1]);
            }else{
                $('#address-scheduling-dialog-googlemaps  .address2').val('');
            }
        }
        $('#address-scheduling-dialog-googlemaps  .city').val($(this).attr("data-city"));
        $('#address-scheduling-dialog-googlemaps  .state').val($(this).attr("data-state")); // this needs to be a 2 letter abbv
        $('#address-scheduling-dialog-googlemaps  .zipCode').val($(this).attr("data-zipcode"));


        addressPopUpCloseHandling();
        $("#address-suggestion-dialog-googlemaps").overlay().close();
        return false;
    });

    $(".save-original-address-google").on('click', function(){
       addressPopUpCloseHandling();
       $("#address-suggestion-dialog-googlemaps").overlay().close();
       return false;
    });
    
    $(".overlay .close").click(function() {
        $(this).closest('.overlay').overlay().close();
    });
});



function addressPopUpCloseHandling(triggeredByCallBack){

    if( typeof triggeredByCallBack === "undefined"){
        triggeredByCallBack = false;
    }
    
    // calculate distance
    if(common_address_callFrom == 1){ // in PDP
        if($(".js-userAddress").attr('celeblocation') != ""){
            var location = {loc1: $("#address-scheduling-dialog-googlemaps .zipCode").val(), loc2: $(".js-userAddress").attr('celeblocation')};
            calculateDistance(location, function(){addressHandling();});
        }else{
            if($("#travelCost").length === 1){
                $("#travelCost").val("0");
            }
            addressHandling();
        }
    } else if(common_address_callFrom == 4) { // Product builder
        if($('.form-sec[secid=pSetup]').is(':visible')) {
            $('.form-sec[secid=pSetup] .address1').val($.trim($('#address-scheduling-dialog-googlemaps .address').val()));
            $('.form-sec[secid=pSetup] .address2').val($.trim($('#address-scheduling-dialog-googlemaps .address2').val()));
            $('.form-sec[secid=pSetup] .city').val($.trim($('#address-scheduling-dialog-googlemaps .city').val()));
            $('.form-sec[secid=pSetup] .state').val($.trim($('#address-scheduling-dialog-googlemaps .state').val()));
            $('.form-sec[secid=pSetup] .zipCode').val($.trim($('#address-scheduling-dialog-googlemaps .zipCode').val()));
        } else if($('.form-sec[secid=pProductization]').is(':visible')) {
            $('.form-sec[secid=pProductization] .address1').val($.trim($('#address-scheduling-dialog-googlemaps .address').val()));
            $('.form-sec[secid=pProductization] .address2').val($.trim($('#address-scheduling-dialog-googlemaps .address2').val()));
            $('.form-sec[secid=pProductization] .city').val($.trim($('#address-scheduling-dialog-googlemaps .city').val()));
            $('.form-sec[secid=pProductization] .state').val($.trim($('#address-scheduling-dialog-googlemaps .state').val()));
            $('.form-sec[secid=pProductization] .zipCode').val($.trim($('#address-scheduling-dialog-googlemaps .zipCode').val()));
        }
        
        
        if(triggeredByCallBack === false){
            if($('.form-sec[secid=pPreview]').is(":visible") && pb_pActive) {
                $("#custom-product-submit-dialog").overlay().load();
            } else {
                vendorShowLoading();
                if(pb_saveTypePressed === 'saveAndContinue') {
                    saveForm('', $('.js-product-form .product-save:visible'));
                } else {
                    saveForm('manualSave');
                }
            }
        }
        
        // May need to scroll to certain address section if necessary
        //$('html, body').animate({scrollTop:$('.form-sec[secid=pSetup] .form-row[formid=pSetLocationOrTravel] .subQuesBox-setLocation').offset().top - 150}, 800);
    } else if(common_address_callFrom == 5) { // Product Admin
        $('#Product_locationAddress1').val($.trim($('#address-scheduling-dialog-googlemaps .address').val()));
        $('#Product_locationAddress2').val($.trim($('#address-scheduling-dialog-googlemaps .address2').val()));
        $('#Product_locationCity').val($.trim($('#address-scheduling-dialog-googlemaps .city').val()));
        $('#Product_locationState').val($.trim($('#address-scheduling-dialog-googlemaps .state').val()));
        $('#Product_locationZipcode').val($.trim($('#address-scheduling-dialog-googlemaps .zipCode').val()));
    } else{
        if($("#address-scheduling-dialog-googlemaps").attr('celeblocation') != undefined && $("#address-scheduling-dialog-googlemaps").attr('celeblocation') != ""){
            var location = {loc1: $("#address-scheduling-dialog-googlemaps .zipCode").val(), loc2: $("#address-scheduling-dialog-googlemaps").attr('celeblocation')};
            calculateDistanceForGeneral(location, function(){addressHandling();}, true);
        }else{
            addressHandling();
        }
    }

}


function addressHandling(){
    var address = $("#address-scheduling-dialog-googlemaps .address").val() + ", "
                + (($("#address-scheduling-dialog-googlemaps .address2").val() === "") ?  "" : $("#address-scheduling-dialog-googlemaps .address2").val() + ", ")
                + $("#address-scheduling-dialog-googlemaps .city").val() + ", "
                + $("#address-scheduling-dialog-googlemaps .state").val() + " "
                + $("#address-scheduling-dialog-googlemaps .zipCode").val();

    $dest = $(".p-form[data-pid=" + $("#address-scheduling-dialog-googlemaps .address-productId").val() +"]"
                   + "[data-num=" + $("#address-scheduling-dialog-googlemaps .address-number").val() +"]"
                   + "[data-oii=" + $("#address-scheduling-dialog-googlemaps .address-oii").val() +"]");


    if ($dest.find(".infobox_mode_div.exe .js-infobox-widget-decision-div.LocationPicker:visible").length === 1) { // for exe mode
        $dest = $dest.find(".infobox_mode_div.exe .js-infobox-widget-decision-div.LocationPicker:visible");
        $dest.attr("data-address",    $("#address-scheduling-dialog-googlemaps .address").val());
        $dest.attr("data-address2",   $("#address-scheduling-dialog-googlemaps .address2").val());
        $dest.attr("data-city",       $("#address-scheduling-dialog-googlemaps .city").val());
        $dest.attr("data-state",      $("#address-scheduling-dialog-googlemaps .state").val());
        $dest.attr("data-zipCode",    $("#address-scheduling-dialog-googlemaps .zipCode").val());
        $dest.attr("data-travelCost", $("#address-scheduling-dialog-googlemaps").attr("travelCost"));
        // trigger change event
        //$dest.trigger("change");
        $dest.find('.infobox_widget_decision_btn.decline').addClass('selected');
        infobox_populate_suggested_values($dest);
        infobox_update_exe_mode_decision_btn_status($dest.parents('.infobox_mode_div.exe'));
        $("#address-scheduling-dialog-googlemaps").overlay().close();
    } else {                                                                                                              // for edit mode
        $dest = $dest.find(".loc-button .userAddress");
        $dest.val(address);
        $dest.siblings(".address").val($("#address-scheduling-dialog-googlemaps .address").val());
        $dest.siblings(".address2").val($("#address-scheduling-dialog-googlemaps .address2").val());
        $dest.siblings(".city").val($("#address-scheduling-dialog-googlemaps .city").val());
        $dest.siblings(".state").val($("#address-scheduling-dialog-googlemaps .state").val());
        $dest.siblings(".zip").val($("#address-scheduling-dialog-googlemaps .zipCode").val());
        $dest.siblings(".js-travelCost").val($("#address-scheduling-dialog-googlemaps").attr("travelCost"));

        // trigger change event
        $dest.trigger("change");

        $("#address-scheduling-dialog-googlemaps").overlay().close();
        if(common_address_callFrom == 1 ){ // in PDP
            getTravelCost();
            updatePriceDisplay();
        }else{
            $dest.removeClass("required");

            // in order hisotry page, we don't save the address data by here
            // save when user click the SAVE button in order history page
            // ask Fred for more info
            if(common_address_callFrom == 3){
                return false;
            }

            // save address
            $.post( '/cart/addLocationAddress',
                $("#address-scheduling-dialog-googlemaps .address-form :input").serialize()+"&travelCost="+$("#address-scheduling-dialog-googlemaps").attr("travelCost")+"&localityTypeId="+$("#address-scheduling-dialog-googlemaps").attr("localityTypeId"),
                function(data){
                    if(data.result == 1){
                        if (g_controller_id === 'cart' && g_controller_action_id === 'checkout') {
                            if($("#shipping:visible").length > 0 && $("#CheckoutForm_shippingAddressId").val() !== ""){
                                getShippingAndTax('shipping');
                            } else {
                                getShippingAndTax('default');
                            }
                        } else {
                            var $priceInfo = $dest.closest('.body-row').find('.price-info');
                            var price = parseFloat(data.thisProduct.price).formatMoney().split(".");
                            updateCostInfo(data, $priceInfo, price);
                            //updateAmount(data);
                            displayEstimationData(data);
                        }
                    }else{
                        alertEx("Unknown Error. Please contact IfOnly Concierge for help.");
                    }
                },
                'json'
            );
        }
    }




}

function addressVerification(addrObj, addrValidCallBack, addrFailCallBack){
    var g_location = '';
    var g_address = '';
    var logisticsGeocoder    = new google.maps.Geocoder();
    logisticsGeocoder.geocode( { 'address': addrObj.address}, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
            g_location = results[0].geometry.location;
            g_address = results[0].formatted_address;
            var g_address_compare = g_address.toLowerCase().replace(/, [^,]*$/, '');
            if(true === isAddressStrComparable(addrObj.address.toLowerCase(), g_address_compare)){
                // then we skip the address-suggestion-dialog-googlemaps popup
                //console.log('address matched!');
                addressPopUpCloseHandling(true);
                if(typeof addrValidCallBack == "function"){
                    addrValidCallBack();
                }
                return false;
            }
            $("#address-suggestion-dialog-googlemaps .save-update-address-google").attr("data-address",g_address);
            $("#address-scheduling-dialog-googlemaps").overlay().close();

            $("#address-suggestion-dialog-googlemaps .orignal-address .original-street1").html(addrObj.address1);
            $("#address-suggestion-dialog-googlemaps .orignal-address .original-street2").html(addrObj.address2.replace(/^, /g ,''));  // need to remove the extra comma
            $("#address-suggestion-dialog-googlemaps .orignal-address .original-state").html(addrObj.state+' '+addrObj.zip);
            $("#address-suggestion-dialog-googlemaps .orignal-address .original-city").html(addrObj.city);

            /*
            var g_suggested = g_address.split(",");
            var result_len = g_suggested.length;
            if( result_len < 3){
                alertEx('Bad formatted address.  Please check the address and try again.');
                return false;
            }

            // we will parse the address backwards since the first element can be a name of the place, i.e. AT&T Park

            if( result_len >= 5){
                $("#address-suggestion-dialog-googlemaps .update-address .suggested-place").html(g_suggested[result_len - 5]);
            }
            $("#address-suggestion-dialog-googlemaps .update-address .suggested-street").html(g_suggested[result_len - 4]);
            $("#address-suggestion-dialog-googlemaps .update-address .suggested-city").html(g_suggested[result_len - 3]);
            $("#address-suggestion-dialog-googlemaps .update-address .suggested-state").html(g_suggested[result_len - 2]);
            */
            if (results[0].address_components) {
                var tmp_premise       = '';
                var tmp_street_number = '';
                var tmp_route         = '';
                var tmp_subpremise    = '';
                var tmp_locality      = '';
                var tmp_state         = '';
                var tmp_country       = '';
                var tmp_postal_code   = '';

                for (i = 0; i < results[0].address_components.length; i++) {
                    switch(results[0].address_components[i].types[0]) {
                        case 'point_of_interest':
                        case 'establishment':
                        case 'premise':
                            tmp_premise       = results[0].address_components[i].long_name; break;
                        case 'subpremise':
                            tmp_subpremise    = ', #' + results[0].address_components[i].long_name; break;
                        case 'street_number':
                            tmp_street_number = results[0].address_components[i].long_name; break;
                        case 'route':
                            tmp_route         = results[0].address_components[i].long_name; break;
                        case 'locality':
                            tmp_locality      = results[0].address_components[i].long_name; break;
                        case 'administrative_area_level_1':
                            tmp_state         = results[0].address_components[i].short_name; break;
                        case 'country':
                            tmp_country       = results[0].address_components[i].short_name; break;
                        case 'postal_code':
                            tmp_postal_code   = results[0].address_components[i].long_name; break;
                        default:
                    }
                }
                $(".save-update-address-google").attr('data-place',   tmp_premise);
                $(".save-update-address-google").attr('data-street',  tmp_street_number + ' ' + tmp_route + tmp_subpremise);
                $(".save-update-address-google").attr('data-city',    tmp_locality);
                $(".save-update-address-google").attr('data-state',   tmp_state);
                $(".save-update-address-google").attr('data-zipcode', tmp_postal_code);
                $("#address-suggestion-dialog-googlemaps .update-address .suggested-place").html(tmp_premise);
                $("#address-suggestion-dialog-googlemaps .update-address .suggested-street").html(tmp_street_number + ' ' + tmp_route + tmp_subpremise);
                $("#address-suggestion-dialog-googlemaps .update-address .suggested-city").html(tmp_locality);
                $("#address-suggestion-dialog-googlemaps .update-address .suggested-state").html(tmp_state + ' ' + tmp_postal_code);
            }

            //clearErrorMessage($("#CartItemSocialInfo_userAddress"));
            $("#address-suggestion-dialog-googlemaps").overlay().load();
            if(typeof addrFailCallBack == "function"){
                addrFailCallBack();
            }
            return false;
        }
        else {

            $("#invalid-address").show();
            var error_inputIds = new Array();


            error_inputIds.push('.address');
            error_inputIds.push('.city');
            error_inputIds.push('.state');
            error_inputIds.push('.zipCode');
            $(error_inputIds.join(",")).addClass("inputBoxError");


            // notify ifonly admin.
            // google.maps.GeocoderStatus.ZERO_RESULTS
            // google.maps.GeocoderStatus.ERROR
            // google.maps.GeocoderStatus.INVALID_REQUEST
            // google.maps.GeocoderStatus.OVER_QUERY_LIMIT
            // google.maps.GeocoderStatus.REQUEST_DENIED
            // google.maps.GeocoderStatus.UNKNOWN_ERROR
            /*
            var logStatus = "Address Validation Error:";
            var msg = "Google Maps Address Validation Failed, Geocode Status: [" + status+"]";
            var info = "page: [_common_address_popup.php], address: ["+addrObj.address+"], sessionId: ["+33035925+ "], userId: ["+0+"]";
            $.post( '/common/logError',
                {'status': logStatus, 'message': msg, 'info': info, 'notifyAdmin': true},
                function(data){
                   // don't need to do anything here.
                },
                'json'
            );
            */

            if(status == google.maps.GeocoderStatus.ZERO_RESULTS){
                //console.log('*** zero results ***');
            }
            else{
                //console.log('failed to validate.');
            }
            
            if(typeof addrFailCallBack == "function"){
                addrFailCallBack();
            }
            //addressPopUpCloseHandling();
            return false;
        }
    });
}

// quick address string comparison with abbreviated street suffix.
function isAddressStrComparable(originalAddress, matchedAddress){

    var std_street_suffix = { 'avenue': 'ave', 'BOULEVARD': 'blvd', 'CIRCLE': 'cir', 'COURT': 'ct', 'COURTS': 'cts', 'DRIVE': 'dr', 'DRIVES': 'drs', 'ESTATE': 'est', 'ESTATES': 'ests',
                                    'EXPRESSWAY': 'expy', 'EXTENSION': 'ext', 'EXTENSIONS': 'exts', 'FIELD': 'fld', 'FIELDS': 'flds', 'FLAT': 'flt', 'FLATS': 'flts', 'FREEWAY': 'fwy',
                                    'HIGHWAY': 'hwy', 'JUNCTION': 'jct', 'JUNCTIONS': 'jcts', 'LAKE': 'lk', 'LAKES': 'lks', 'LANE': 'ln', 'PARKWAY': 'pkwy', 'PLACE': 'pl', 'ROAD': 'rd', 'ROADS': 'rds',
                                    'ROUTE': 'rte', 'SQUARE': 'sq', 'STREET': 'st', 'TERRACE': 'ter', 'VISTA': 'vis', 'WAY': 'wy'};
    var replaced = false;

    if(originalAddress == matchedAddress){
        return true;
    }

    for (var k in std_street_suffix){
        if( std_street_suffix.hasOwnProperty(k)){
            var regex = new RegExp("\\b"+k.toLowerCase()+"\\b", '');
            originalAddress = originalAddress.replace(regex, function(){
                replaced = true;
                return std_street_suffix[k];
            });

            if( replaced === true){
                break;
            }
        }
    }

    if(originalAddress == matchedAddress){
        return true;
    }
    else{
        return false;
    }
}
</script><script>

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-33825029-2', { 'userId': '0' });    ga('require', 'linkid', 'linkid.js');
    ga('send', 'pageview');
    ga('require', 'ecommerce', 'ecommerce.js');
    //}

    
    
   
</script>
<script>

// common layout ajax
var afterLoadContentUrl = (g_is_mobile ? "/m/services/common/getAfterLoadContent":"/services/common/getAfterLoadContent");
$.ajax({
    type: "POST",
    url: afterLoadContentUrl,
    data: { 'catId':g_catId, controllerId: g_controller_id, currentUrl: '%2Fwebsite%2Fprivacy'},
    dataType: "json",
    success: function(data){
        if(data.result === 1){

            // notification
            populateNotificationHtml(data);


            $("body").append(data.discoveryHtml);
            // mobile level menu
            $("#nav .nav-menu.level-details").prepend(data.mobileMenu.level2.html);

            if(g_is_mobile){

                $("#modal-container").append(data.modalContent);
            }else{

                //mini cart popUp
                populateCartPopupHtml(data.cartPopUp);

                if(!g_is_guest && data.hasCartItem == 1){
                    $("#top-welcome .shopping").addClass("filled");
                    $("#cart-item-count").text(data.cartItemsCnt);
                    $("#cart-item-count").show();
                }

                // desktop navigation menu
                $.each(data.desktopMenu.level2, function(key,value){
                    $.each(value, function(k,val){
                        if(val.displayName.trim() === ""){
                            $(".level-menu .l-menu.js-menu[data-navmenuid="+key+"] .drop-down .level-2").addClass("hidden");
                        }
                        $(".level-menu .l-menu.js-menu[data-navmenuid="+key+"] .drop-down .level-2").append("<div class='col'><p class='fo-13-i-g co-ff'>"+val.displayName+"</p></div>");
                        $(".level-menu .l-menu.js-menu[data-navmenuid="+key+"] .drop-down .level-3").append("<div class='col'>"+val.content+"</div>");
                    });

                    $(".level-menu .l-menu").each(function(){
                        //var thisLeft = $(this).position().left;
                        $(this).siblings(".l-menu").children(".highlight-bar").hide();
                        $(this).siblings(".l-menu").children(".drop-down").hide();
                        //$(this).children(".highlight-bar").show();
                        // set the proper left
                        //$(this).children(".drop-down").css("left", thisLeft+"px");
                        // give enough width firstly
                        $(this).children(".drop-down").width(900);
                        //$(this).children(".drop-down").show();
                        // adjust to the proper width
                        $(this).children(".drop-down").width($(this).children(".drop-down").find(".level-2 .col").length * 160);
                    });

                });

                // mobile filter
                // for responsive
                $("#mobile-header").append(data.mobileFilterHtml);
            }

            //
            if(data.hasWishlist){
                var $dWishlistImg = $("#top-welcome .wishlist img");
                if($dWishlistImg.length > 0){
                    $dWishlistImg.attr("src", $dWishlistImg.attr("data-has-wishlist"));
                }

                var $mWishlistImg = $("#top .wishlist img");
                if($mWishlistImg.length > 0){
                    $mWishlistImg.attr("src", $mWishlistImg.attr("data-has-wishlist"));
                }

            }


            // codes to exec after all common tasks

            if(g_is_mobile){

            }else{
                //getWishlistPopupHtml(false, false);

            }
        }else{

        }


    },error: function(data){

    }
});
// common layout ajax


//**********************************
//
//**********************************
function sawHowItWorks(){
    if (g_show_how_it_works) {
        $.ajax({
            type:  "POST",
            url: "/website/sawHowItWorks",
            data: { userId: g_is_guest ? 0 : g_userId },
            dataType: 'json'
        }).done(function ( data ) {

        });
    }
}

//**********************************
//
//**********************************
function registerDiscoveryWidget($obj, type, css, params){
    if($obj.siblings(".js-discovery-popup").length === 0){
        var $clone = $(".js-discovery-popup-base").clone().removeClass("js-discovery-popup-base discovery-popup-base");
        $obj.after($clone);
        var position = $obj.position();
        if(css !== undefined && css.top !== undefined){
            var top = css.top+"px";
        }else{
            var marginTop = $obj.css("padding-top");
            marginTop = parseFloat(marginTop.substr(0,marginTop.indexOf("px")));
            var marginBottom = $obj.css("padding-bottom");
            marginBottom = parseFloat(marginBottom.substr(0,marginBottom.indexOf("px")));
            var top = (position.top+$obj.height()+marginTop+marginBottom)+"px";
        }
        $clone.css({
            "left":position.left,
            "top":top
        });
        if(css !== undefined && css.width !== undefined){
            $clone.css("width", css.width+"px");
        }

        switch(type){
            case g_discovery_type.desktopNav:
                $clone.find(".js-more-items").hide();
                $clone.find(".js-disc-col").addClass("width-100-p");
                $clone.fadeIn("fast");
                break;
            case g_discovery_type.desktopWidget:
                var colCnt = $clone.find(".js-disc-col").length;
                var tempW  = 120;
                $clone.find(".js-disc-col").each(function(){
                    if($(this).width() > tempW){
                        tempW = $(this).width();
                    }
                });
                $clone.css("width",(colCnt*tempW+25)+"px");
                $clone.find(".js-view-less, .js-view-more, .js-disc-header").hide();
                break;
        }



        if(params !== undefined && params.callback !== undefined){
            params.callback();
        }
    }

}


function discoveryViewMore($obj){
    $obj.hide();
    $obj.siblings(".js-more-items").slideDown();
}

function discoveryShowLess($obj){
    $obj.closest(".js-more-items").slideUp();
    $obj.closest(".js-disc-col").find(".js-view-more").show();
}

</script>
<div id="confirm-dialog" class="overlay medium foyer commonDialog desktop"><a class="close"></a>
    <div class="overlayContent">
        <div class="dialog_header">
            <p class="header-text"></p>
        </div>
        <div class="dialog_body">
            <div class="dialog_content" style="text-align: center">
                <p class="message"></p>
            </div>
        </div>
        <div class="dialog_footer">
            <div class="footer_content" style="">
                 <div id="confirm-dialog-ok" class="close-overlay small primaryButton button " closepopupid="confirm-dialog" style="margin-top: 28px;"><span class="title">Ok</span></div>                 <div id="confirm-dialog-close" class="close-overlay small secondaryButton button " closepopupid="confirm-dialog" style="margin-top: 28px;margin-left:10px;"><span class="title">Close</span></div>            </div>
        </div>
    </div>
</div>

<div id="realTime-notification-dialog" class="overlay medium foyer commonDialog desktop">
    <div class="overlayContent">
        <div class="dialog_header">
            <p class="header-text js-header"></p>
        </div>
        <div class="dialog_body">
            <div class="dialog_content" style="text-align: center">
                <p class="message js-msg">
                    
                </p>
            </div>
        </div>
        <div class="dialog_footer">
            <div class="footer_content" style="">
                 <div id="notification-dialog-ok" class="close-overlay small primaryButton button " closepopupid="confirm-dialog" style="margin-top: 28px;"><span class="title">CHECK NOW</span></div>                 <div id="notification-dialog-close" class="close-overlay small secondaryButton button " closepopupid="confirm-dialog" style="margin-top: 28px;margin-left:10px;"><span class="title">CHECK Latter</span></div>            </div>
        </div>
    </div>
</div>



<script type="text/javascript">

ioReady(function(){
    var pos = !isHandheld();
    
    $("#confirm-dialog").overlay({
        top: 60, left: getPopupLeftToCenter("confirm-dialog"), fixed: pos, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 }
    });
    
    $("#realTime-notification-dialog").overlay({
        top: 60, left: getPopupLeftToCenter("confirm-dialog"), fixed: pos, closeOnClick: true,
        mask: { color: '#000000', loadSpeed: 200, closeSpeed:0, opacity: 0.5 }
    });
});
</script>
    <!-- Start of ifonly Zendesk Widget script -->
    <script>
        $(window).load(function() {
            /*<![CDATA[*/window.zEmbed||function(e,t){var n,o,d,i,s,a=[],r=document.createElement("iframe");window.zEmbed=function(){a.push(arguments)},window.zE=window.zE||window.zEmbed,r.src="javascript:false",r.title="",r.role="presentation",(r.frameElement||r).style.cssText="display: none",d=document.getElementsByTagName("script"),d=d[d.length-1],d.parentNode.insertBefore(r,d),i=r.contentWindow,s=i.document;try{o=s}catch(c){n=document.domain,r.src='javascript:var d=document.open();d.domain="'+n+'";void(0);',o=s}o.open()._l=function(){var o=this.createElement("script");n&&(this.domain=n),o.id="js-iframe-async",o.src=e,this.t=+new Date,this.zendeskHost=t,this.zEQueue=a,this.body.appendChild(o)},o.write('<body onload="document._l();">'),o.close()}("https://assets.zendesk.com/embeddable_framework/main.js","ifonly.zendesk.com");/*]]>*/
        });
    </script>
    <!-- End of ifonly Zendesk Widget script -->

    <div id="exposeMask" style="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; display: none; opacity: 0.5; z-index: 9998; background-color: rgb(0, 0, 0);"></div>
    <script type="text/javascript">
/*<![CDATA[*/
jQuery(function($) {
 var contentHeight = $(window).height() - 140 - 240;  $('#content').css('min-height', contentHeight + 'px'); 
});
/*]]>*/
</script>

    <script type="text/javascript" src="https://dx.steelhousemedia.com/spx?dxver=4.0.0&amp;shaid=12260&amp;tdr=&amp;plh=https%3A%2F%2Fweb.archive.org%2Fweb%2F20161024163153id_%2Fhttps%253A%2F%2Fwww.ifonly.com%2Fwebsite%2Fprivacy&amp;cb=45458965900650376"></script><iframe src="javascript:false" title="" style="display: none;"></iframe><script>
        //var endTime = new Date().getTime();
        //console.log((endTime - startTime)/1000 +" seconds");
    </script>

<div id="concierge-email-dialog" class="overlay foyer medium thanksDialog" style="height: 457px;"><a class="close"></a>
    <div class="overlayContent">
        <div class="dialog_header">
            <p class="header-text">How can we help you?</p>
        </div>
        <div class="dialog_body">
            <div class="dialog_content">
                <input type="hidden" name="Suggestion[requestTypeId]" value="5">
                <div class="row" style="margin-top:20px;">
                    <input id="concierge-email-name" class="default-value" default-value="Your name" type="text" value="Your name" name="">                </div>
                <div class="row" style="margin-top:5px;">
                    <input id="concierge-email-address" class="default-value" default-value="Email" type="text" value="Email" name="">                </div>
                <div class="row" style="margin-top:5px;">
                    <textarea id="concierge-email-message" style="width:322px; height:102px; text-align: left;" default-value="Your questions/comments" class="default-value">Your questions/comments</textarea>
                </div>
                <div><p class="errorSummary"></p></div>
            </div>
        </div>
        <div class="dialog_footer">
            <div class="footer-content" style="margin-top: 35px">
                 <div class="allowAllUsers small primaryButton button " id="concierge-email-submit-button" javascript="window.location('/cart/checkout')" style="margin-left: 34%;"><span class="title">SUBMIT</span></div>            </div>
        </div>
    </div>
</div><span role="status" aria-live="assertive" aria-relevant="additions" class="ui-helper-hidden-accessible"></span><span role="status" aria-live="assertive" aria-relevant="additions" class="ui-helper-hidden-accessible"></span></body></html>