<!--The following is the downloaded HTML source of the weddingmapper.com privacy policy that was archived on 2007-05-20.
 Please check the original snapshot on the Wayback Machine (https://web.archive.org/web/20070520210811id_/http%3A//www.weddingmapper.com/company/policies/privacy) for the most accurate reproduction.-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Policies - Wedding Mapper</title>
    <meta name="description" content="">
  
    
    <style type="text/css" rel="Stylesheet" media="all">


/***************************************** wedding *******************************************/

/***** Generics ******/
.subtle {
  color: #666;  
}

.subtle a {
	font-size: 12px;
	font-style: italic;
	color: #666;
}

.spacer {
	height: 1em;
}

.errorDiv {
  text-align: center;
  margin-bottom: 1em;
}

/*****  Wrapper ******/

body {
	margin: 0;
	padding: 1em;
	min-width: 800px;
}
  	
.wrapper {
	margin: 0 auto;
  width: 800px;
}
  	
h1 {
  display: none;
}

#header {
  width: 100%;
  cursor:pointer;
  border-top: 1px solid white;
  height: 75px;
}

#header #header_image {
  float: left;
  margin: 10px 0 10px 44px;  
}

#header #header_left {
  float: left;
}

#header #header_right {
  float: right;
}

  	
.content_wrapper {
	margin: 0;
}
  	
.content {
	text-align: center;
}
  	
.footer {
  margin-top: 3em;
  background: url(/images/curly_rightbottom.gif) no-repeat bottom right;
  height: 67px;
  width: 100%;
}

.footer div {
  background: url(/images/curly_leftbottom.gif) no-repeat bottom left;
  height: 67px;
  width: 100%;
  text-align: center;
}

.footer a {
  color: #666;
  font-size: 9pt;
  font-family: georgia, times new roman;
}

.footer .divider {
  padding: 0 15px;    
}

.wedding_description {
  width: 90%;
  margin: auto;
  color: #555;
}

/*****  Content Area ******/

#explanation_wrapper {
  font-family: georgia, times new roman;
  font-size: 10pt;
  line-height: 1.5em;
  color: #666;
  width: 48em;
  margin: auto;
  position: relative;
}

#explanation a {
  color: #666;
}

#content_area {
	width: 40em;
	margin: 1.5em auto;
  font-family: georgia, times new roman;
  font-size: 11pt;
}

#content_area a {
  color: #666;
}

#content_area_top {
	width: 100%;
	background: url(/images/wedding_login_area_top_right.gif) no-repeat top right;
}

#content_area_top, #content_area_top div, #content_area_top a {
	height: 68px;
	float: left;
}

#content_area_top.no_tabs {
  background: url(/images/wedding_login_area_top_right_no_tabs.gif) no-repeat top right;
}

#content_area_top.no_tabs, #content_area_top.no_tabs div, #content_area_top.no_tabs a {
  height: 32px;
}

#content_area_top_left {
	width: 26px;
  background: url(/images/wedding_login_area_top_left.gif) no-repeat bottom left;
}

#content_area_top a {
	padding-right: 41px;
	display: block;
	cursor: pointer;
}

#started_tab.selected a, #signup_tab a:hover {
	background: url(/images/wedding_started_selected.gif) no-repeat center;
}

#started_tab a {
	background: url(/images/wedding_started_unselected.gif) no-repeat center;
  padding-left: 140px;
}

#login_tab.selected a, #login_tab a:hover {
	background: url(/images/wedding_login_selected.gif) no-repeat center;
}
	
#login_tab a {
  padding-left: 110px;
  background: url(/images/wedding_login_unselected.gif) no-repeat center;	
}

#search_tab.selected a, #search_tab a:hover {
	background: url(/images/wedding_search_selected.gif) no-repeat center;
}

#search_tab a {
  padding-left: 120px;
	background: url(/images/wedding_search_unselected.gif) no-repeat center;  
}


#welcome_tab.selected a, #welcome_tab a:hover {
	background: url(/images/wedding_started_selected.gif) no-repeat center;
}

#welcome_tab a {
	background: url(/images/wedding_started_unselected.gif) no-repeat center;	
}

#content_area_content_left {
  background: url(/images/wedding_login_area_left.gif) repeat-y left;
}

#content_area_content_right {
	background: url(/images/wedding_login_area_right.gif) repeat-y right;
}

#content_area_content_wrapper_left {
	clear: both;
	background: url(/images/wedding_login_area_bottom_left.gif) no-repeat bottom left;
}

#content_area_content_wrapper_right {
	background: url(/images/wedding_login_area_bottom_right.gif) no-repeat bottom right;
}

#content_area_content {
	background-color: #FFFCF4;
	margin: 0 24px;
	border-top: 2px solid #FFFCF4;
	border-bottom: 2px solid #A6A5A0;
}

#content_area_content form {
  padding: 0;
  margin: 0;
}

.section {
  height: 15em;
  position: relative;
}

.section .next_buttons, .action_button {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
}

.action_button {
  bottom: 15px;
}

.section .next_buttons img {
  cursor: pointer;
}

.instructions {
  font-size: 12pt;
  color: #666;
}


/*****  Content Area Content ******/

h2, .input_line {
	clear: both;
	color: #666;
}

h2 {
  font-size: 19px;
	font-weight: normal;
  margin-top: 0;
  margin-bottom: 0.5em;
}

.input_line h3, input_line div {
	float: left;
	margin: 0.5em 0 1em 0;
	padding: 0;
	font-size: 15px;
	font-weight: normal;
}

.input_line h3 {
	width: 11em;
	text-align: right;	
	margin-right: 1em;	
}

.input_line div {
	text-align: left;	
}

.input_line input, .geocode_input input {
	background: url(/images/styled_input.gif) no-repeat;
	border: 1px solid black;
	width: 15em;
	font-size: 15px;
	padding: 0.3em 0.5em;
  margin-bottom: 5px;
  color: #333;
}

.input_line_text {
  margin-left: 5em;
  float: left;
  width: 6em;
}

.action_link a {
	color: #666;
	margin: 0 1.5em;
	vertical-align: 0.5em;
}

.geocode_input {
	margin-top: -1em;
	color: #666;
}

#results_list {
  text-align: left;
  margin: 0 3em;
  height: 6em;
  overflow: auto;
}

#search_results_container {
  border: 1px solid #ccc;
  width: 100%;
  margin-bottom: 10px;
}

#search_results {
  width: 90%;
  margin: 10px auto;
}

#search_results .search_result {
  font-size: 9pt;
  text-align: left;
  margin-bottom: 10px;
}

/**** Edit Categories ****/
#category_table {
  border-bottom: 1px solid #aaa;
}

#category_table td {
  padding: 5px 10px;
  border-top: 1px solid #aaa;
}

#category_table .handle {
  cursor: move;
}

#category_table .category_icon_top {
  background: url(/images/wedding/icon_selector_top.gif) no-repeat top;
  padding-top: 8px;
}


#category_table .category_icon {
  background: url(/images/wedding/icon_selector_bottom.gif) no-repeat bottom;
  padding-right: 10px;
  padding-bottom: 8px;
}

#category_table .selected {
  background: url(/images/wedding/icon_selector_selected_top.gif) no-repeat top;
}

#category_table .selected .category_icon {
  background: url(/images/wedding/icon_selector_selected_bottom.gif) no-repeat bottom;  
}

#category_table {
  margin: auto;
}

#all_icons {
  width: 18em;
  height: 15em;
  overflow: auto;
  border: 2px solid #D0CFCC;
  position:absolute;
  z-index: 9999;
  background-color: white;
}

#all_icons .title {
  text-align: left;
  font-size: 9pt;
  font-weight: bold;
  color: #666;
  padding-top: 5px;
}

/**** List View ****/
#list_view {
  color: #666;
  position: relative;
  width: 99%;
}

#list_view #group_info {
  text-align: left;
  padding: 10px;
}

#list_view #group_info.no_photo {
  margin: auto;
  width: 25em;
}

#list_view #group_info img {
  float: right;
  border: 1px solid #333;
  margin: 0 0 1.5em 10px;
}

#list_view .category {
  padding: 10px;
  font-size: 16pt;
  color: #6E6799;
  clear: both;
}

#list_view .title {
  font-size: 14pt;
}

#list_view .map_link {
  float:right;
}

#list_view .location {
  position: relative;
  margin: 15px 0;
  padding: 10px;
  text-align: left;
}

#list_view hr {
  clear: both;
}

#list_view .wedding_description {
  font-size: 13pt;
  line-height: 1.25em;
}

#list_view .address, #list_view .photo {
  margin-bottom: 25px;
  font-size: 10pt;
  font-weight: bold;
}

#list_view .photo {
  margin-left: 10px;
}

#list_view .list_ad {
  margin-bottom: 10px;
}


.title {
  color: #666;
  font-size: 13pt;
}

/**** Purchase Page *******/
#purchase_section table.product td {
  padding: 10px;
  border-top: 1px solid #aaa;
  border-bottom: 1px solid #aaa;
  border-left: 1px solid #aaa;
  text-align: left;
}

#purchase_section table.product td.title {
  border-right: 1px solid #aaa;
  border-left: none;
  text-align: center;
}

/***  links ****/
.link_container .link {
  text-align: left;
  border: 1px solid #aaa;
  margin: 5px 0;
}

.link_container .link table td {
  border: 1px solid #aaa;
}

.site .email_field, .site .info_field, .site .file_field,
.email .info_field, .email .site_field, .email .file_field,
.info .email_field, .info .site_field, .info .file_field,
.file .email_field, .file .site_field, .file .info_field {
  display: none;
}

.site .site_field, .email .email_field, .info .info_field, .file .file_field {
  display: inline;
}

.edit_link_container {
  text-align: left;
  border: 1px solid #aaa;
  padding: 5px;
}

/********* Explore Stuff ***********/

.explore .map_result {
  padding: 10px 0;
  margin: 5px 0;
  text-align: left;
}


.explore h3 {
  color: #555;
  font-size: 11pt;
  font-weight: normal;
}

.explore .map_result h3 {
  margin-top: 0;
}

.explore  .subtle {
  font-size: 9pt;
  text-align: left;
}


</style>
    <style type="text/css" rel="Stylesheet" media="print">


/***************************************** print *******************************************/

.tooltip
{
	font-weight: bold;
    border: 1px solid #999;
    background-color: #fff; 
    padding: 0 10px 0 5px;
    color: black;
    position: absolute;
		left: 0px;
    top: 0;
    font-size: 11pt;
    white-space: nowrap;
}

.tooltip_background
{
    position: relative;
}

.fake_text {
	font-weight: bold;
	font-size: 11pt;
	border-top: 18px solid white; 
	padding: 10000px 12px 0 0px;    
	white-space: nowrap;
}

h5 {
	font-size: 12pt;
}

h4 {
	font-size: 12pt;	
	font-weight: normal;
}

h3 {
	font-size: 12pt;
	font-weight: bold;
}

h2 {
	font-size: 14pt;
}

h1 {
	font-size: 14pt;
	font-weight: bold;
}

a {
	text-decoration: none;
	color: black;
}

.nodisplay {
	display: none;
}

.printonly {
	display: block;
}

.screenonly {
  display: none;
}

#right_header, #search_area {
  display: none;
}

#footer {
  display: none;
}

#walk_map_container {
	position: absolute;
	top:0px;
	left:0px;
  margin-top: -60px;
}

#walk_header {
	display: none;
}

#claim_map {
	display: none;
}

#panel_expander {
	display: none;
}

#walk_map_title {
	display: none;
}

#map_comments {
	display: none;
}

#walk_tabs {
	display: none;
}

#walk_ads_container {
	display: none;
}

#walk_controls {
	display: none;
}

#walk_static_controls .control_box {
	display: none;
}

.map_control {
	display: none;
}

#map_control_content_what div {
	float: left;
}

#map_control_content_what .description {
	display: none;
}

#walk_panel {
	position: absolute;
	top: 0px;
	left: 0px;
	width: 200px;
	background-color: white;
	display: none;
}

#walk_panel #map_comments {
	display: none;
}

#walk_panel table {
	display: none;
}

#walk_panel	ul table {
	display: block;
	padding: 0;
	margin: 0;
}

#walk_panel ul { 
	display: inline;
	padding: 0;
	margin: 0;
	background-color: white;
} 

#walk_panel .title, #walk_panel .subtitle {
	padding: 0;
	margin: 0;
	font-weight: bold;
}

#walk_panel li {
	list-style: none;
	padding: 0;
	margin: 0;
}

#path_nav_container {
	display: none;
}

.expansion {
	display: none;
}

.has_photos, .has_directions, .has_comments {
	display: none;
}

.double_digit_marker_icon div, .single_digit_marker_icon div {
	position: absolute;
	top: 0;
	left: 0;
}

.dot_marker_icon div div, .small_marker_icon div div {
	display: none;
}

.single_digit_marker_icon div div, .double_digit_marker_icon div div {
	font-size: 12pt;
	font-weight: bold;	
	width: 100%;
	text-align: center;
	margin-top: 3px;
}

.list_ad {
  display: none;
}

/***** wedding ********/
.wedding .module {
  display: none;
}

.wedding #walk_map_container {
  left: -20em;
  width: 200%;
}

.wedding .wrapper {
  margin-left: -3.6em;
}

</style>
    <!--[if lt IE 7]>
      <style type='text/css' rel='Stylesheet' media='screen'>


/***************************************** ie_overrides *******************************************/

/* Hides from IE-mac \*/
* html .hollyhack {height: 1%;}
/* End hide from IE-mac */

/*** welcome page **/

.right_section {
  margin-top: 10px;
}

.section .ll_corner, .section .lr_corner {
  bottom: -6px;
}

.section .ur_corner, .section .lr_corner {
  right: -1px;
}

.section .content .submit {
  margin-top: 0.5em;
}


/*** map page ***/

#maps_image .tabs
{
  padding-bottom: 1px;
}

v\:* 
{
  behavior:url(#default#VML);
}

#map_control_contents .container
{
  right: 2px;
}

#page #logo
{
  	bottom: 3px;
}

#previous_page_link {
	left: -10em;
}

.tooltip
{
    padding: 0 5px 0 5px;
}

#walk_controls .control_box {
	bottom: 4.5em;
}

#walk_controls .control_box .close_button {
		margin-right: -5px;
}

#walk_static_controls .control_box .close_button {
		margin-right: -0.5em;
}

/*** Path Nav Widget Stuff ****/

#path_nav_container {
	bottom: 5em;
}

.commercial #path_nav_container {
	bottom: 1em;
}

#path_nav_box .guy .midsection div {
	padding-bottom: 2.9em;
}

#path_nav_box .continue_path_guy {
	margin-top: -70px;
}

#path_nav_box.edit .prev_insert_button {
	margin: -10px 0 0 0;
}

#path_nav_box .image_button {
  padding: 2px;
  vertical-align: 2px;
}

/*** Bulk Edit ***/

.bulk_content {
	background-color: transparent;
}

/*** Fast Overlay Markers ***/

.small_marker_icon {
	background: transparent;
	filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/images/s_shadow.png');
}

.single_digit_marker_icon {
	background: transparent;
	filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://www.google.com/mapfiles/shadow50.png');
}

.double_digit_marker_icon {
	background: transparent;
	filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://www.google.com/maplinedraw?width=72&height=40&path=u@c@BAB?BATO?A?AA?K?AABGSFA@K?E?C@C@UN?@B@T?T?FAw@?z@A{@?~@A{@?|@A{@?|@A{@?~@A{@?|@A{@?|@A{@?~@A{@?|@A{@?z@Aw@?h@AS?RAO?NAI?HAE?FAC?}oR&color=0,0,0,191.25&weight=2');
}

/*** Wedding Mapper ***/

/*
.module {
  filter:progid:DXImageTransform.Microsoft.Alpha(opacity=90)
}
*/

#walk_panel .section .location_link {
  height: 1%;
}

#walk_panel .section .content {
  height: 1%;
  position: relative;
}


#tutorial_close {
  right: 5px;
}

/**** Bubbles ****/

#walk_box .basic .long_description {
  height: 100px;
}

</style>
      <style type='text/css' rel='Stylesheet' media='print'>


/***************************************** ie_overrides_print *******************************************/

.tooltip {
    padding: 0 5px 0 5px;
}

#walk_map_container {
  width: 20in;
}

.wedding .wrapper {
  margin-left: -85px;
}


</style>
    <![endif]-->

            <script type="text/javascript">

<!--//--><![CDATA[//><!--


// ***************************************** obfuscated/application ********************************************


var Prototype={
Version:'1.4.0_rc2',
emptyFunction:function(){},
K:function(x){return x}
}
var Class={
create:function(){
return function(){
this.initialize.apply(this,arguments);
}
}
}
var Abstract=new Object();
Object.extend=function(destination,source){
for(property in source){
destination[property]=source[property];
}
return destination;
}
Object.inspect=function(object){
try{
if(object==undefined)return 'undefined';
if(object==null)return 'null';
return object.inspect?object.inspect():object.toString();
}catch(e){
if(e instanceof RangeError)return '...';
throw e;
}
}
Function.prototype.bind=function(object){
var __method=this;
return function(){
return __method.apply(object,arguments);
}
}
Function.prototype.bindAsEventListener=function(object){
var __method=this;
return function(event){
return __method.call(object,event||window.event);
}
}
Object.extend(Number.prototype,{
toColorPart:function(){
var digits=this.toString(16);
if(this<16)return '0'+digits;
return digits;
},
succ:function(){
return this +1;
},
times:function(iterator){
$R(0,this,true).each(iterator);
return this;
}
});
var Try={
these:function(){
var returnValue;
for(var i=0;i<arguments.length;i++){
var lambda=arguments[i];
try{
returnValue=lambda();
break;
}catch(e){}
}
return returnValue;
}
}
var PeriodicalExecuter=Class.create();
PeriodicalExecuter.prototype={
initialize:function(callback,frequency){
this.callback=callback;
this.frequency=frequency;
this.currentlyExecuting=false;
this.registerCallback();
},
registerCallback:function(){
setInterval(this.onTimerEvent.bind(this),this.frequency*1000);
},
onTimerEvent:function(){
if(!this.currentlyExecuting){
try{
this.currentlyExecuting=true;
this.callback();
}finally{
this.currentlyExecuting=false;
}
}
}
}
function $(){
var elements=new Array();
for(var i=0;i<arguments.length;i++){
var element=arguments[i];
if(typeof element=='string')
element=document.getElementById(element);
if(arguments.length==1)
return element;
elements.push(element);
}
return elements;
}
Object.extend(String.prototype,{
stripTags:function(){
return this.replace(/<\/?[^>]+>/gi,'');
},
escapeHTML:function(){
var div=document.createElement('div');
var text=document.createTextNode(this);
div.appendChild(text);
return div.innerHTML;
},
unescapeHTML:function(){
var div=document.createElement('div');
div.innerHTML=this.stripTags();
return div.childNodes[0]?div.childNodes[0].nodeValue:'';
},
toQueryParams:function(){
var pairs=this.match(/^\??(.*)$/)[1].split('&');
return pairs.inject({},function(params,pairString){
var pair=pairString.split('=');
params[pair[0]]=pair[1];
return params;
});
},
toArray:function(){
return this.split('');
},
camelize:function(){
var oStringList=this.split('-');
if(oStringList.length==1)return oStringList[0];
var camelizedString=this.indexOf('-')==0
?oStringList[0].charAt(0).toUpperCase()+oStringList[0].substring(1)
:oStringList[0];
for(var i=1,len=oStringList.length;i<len;i++){
var s=oStringList[i];
camelizedString+=s.charAt(0).toUpperCase()+s.substring(1);
}
return camelizedString;
},
inspect:function(){
return "'"+this.replace('\\','\\\\').replace("'",'\\\'') + "'";
}
});
String.prototype.parseQuery=String.prototype.toQueryParams;
var $break=new Object();
var $continue=new Object();
var Enumerable={
each:function(iterator){
var index=0;
try{
this._each(function(value){
try{
iterator(value,index++);
}catch(e){
if(e!=$continue)throw e;
}
});
}catch(e){
if(e!=$break)throw e;
}
},
all:function(iterator){
var result=true;
this.each(function(value,index){
if(!(result&=(iterator||Prototype.K)(value,index)))
throw $break;
});
return result;
},
any:function(iterator){
var result=true;
this.each(function(value,index){
if(result&=(iterator||Prototype.K)(value,index))
throw $break;
});
return result;
},
collect:function(iterator){
var results=[];
this.each(function(value,index){
results.push(iterator(value,index));
});
return results;
},
detect:function(iterator){
var result;
this.each(function(value,index){
if(iterator(value,index)){
result=value;
throw $break;
}
});
return result;
},
findAll:function(iterator){
var results=[];
this.each(function(value,index){
if(iterator(value,index))
results.push(value);
});
return results;
},
grep:function(pattern,iterator){
var results=[];
this.each(function(value,index){
var stringValue=value.toString();
if(stringValue.match(pattern))
results.push((iterator||Prototype.K)(value,index));
})
return results;
},
include:function(object){
var found=false;
this.each(function(value){
if(value==object){
found=true;
throw $break;
}
});
return found;
},
inject:function(memo,iterator){
this.each(function(value,index){
memo=iterator(memo,value,index);
});
return memo;
},
invoke:function(method){
var args=$A(arguments).slice(1);
return this.collect(function(value){
return value[method].apply(value,args);
});
},
max:function(iterator){
var result;
this.each(function(value,index){
value=(iterator||Prototype.K)(value,index);
if(value>=(result||value))
result=value;
});
return result;
},
min:function(iterator){
var result;
this.each(function(value,index){
value=(iterator||Prototype.K)(value,index);
if(value<=(result||value))
result=value;
});
return result;
},
partition:function(iterator){
var trues=[],falses=[];
this.each(function(value,index){
((iterator||Prototype.K)(value,index)?
trues:falses).push(value);
});
return[trues,falses];
},
pluck:function(property){
var results=[];
this.each(function(value,index){
results.push(value[property]);
});
return results;
},
reject:function(iterator){
var results=[];
this.each(function(value,index){
if(!iterator(value,index))
results.push(value);
});
return results;
},
sortBy:function(iterator){
return this.collect(function(value,index){
return{value:value,criteria:iterator(value,index)};
}).sort(function(left,right){
var a=left.criteria,b=right.criteria;
return a<b?-1:a>b?1:0;
}).pluck('value');
},
toArray:function(){
return this.collect(Prototype.K);
},
zip:function(){
var iterator=Prototype.K,args=$A(arguments);
if(typeof args.last()=='function')
iterator=args.pop();
var collections=[this].concat(args).map($A);
return this.map(function(value,index){
iterator(value=collections.pluck(index));
return value;
});
},
inspect:function(){
return '#<Enumerable:'+this.toArray().inspect()+'>';
}
}
Object.extend(Enumerable,{
map:Enumerable.collect,
find:Enumerable.detect,
select:Enumerable.findAll,
member:Enumerable.include,
entries:Enumerable.toArray
});
var $A=Array.from=function(iterable){
if(iterable.toArray){
return iterable.toArray();
}else{
var results=[];
for(var i=0;i<iterable.length;i++)
results.push(iterable[i]);
return results;
}
}
Object.extend(Array.prototype,Enumerable);
Object.extend(Array.prototype,{
_each:function(iterator){
for(var i=0;i<this.length;i++)
iterator(this[i]);
},
first:function(){
return this[0];
},
last:function(){
return this[this.length-1];
},
compact:function(){
return this.select(function(value){
return value!=undefined||value!=null;
});
},
flatten:function(){
return this.inject([],function(array,value){
return array.concat(value.constructor==Array?
value.flatten():[value]);
});
},
without:function(){
var values=$A(arguments);
return this.select(function(value){
return !values.include(value);
});
},
indexOf:function(object){
for(var i=0;i<this.length;i++)
if(this[i]==object)return i;
return false;
},
reverse:function(){
var result=[];
for(var i=this.length;i>0;i--)
result.push(this[i-1]);
return result;
},
inspect:function(){
return '['+this.map(Object.inspect).join(', ')+']';
}
});
var Hash={
_each:function(iterator){
for(key in this){
var value=this[key];
if(typeof value=='function')continue;
var pair=[key,value];
pair.key=key;
pair.value=value;
iterator(pair);
}
},
keys:function(){
return this.pluck('key');
},
values:function(){
return this.pluck('value');
},
merge:function(hash){
return $H(hash).inject($H(this),function(mergedHash,pair){
mergedHash[pair.key]=pair.value;
return mergedHash;
});
},
toQueryString:function(){
return this.map(function(pair){
return pair.map(encodeURIComponent).join('=');
}).join('&');
},
inspect:function(){
return '#<Hash:{'+this.map(function(pair){
return pair.map(Object.inspect).join(': ');
}).join(', ')+'}>';
}
}
function $H(object){
var hash=Object.extend({},object||{});
Object.extend(hash,Enumerable);
Object.extend(hash,Hash);
return hash;
}
var Range=Class.create();
Object.extend(Range.prototype,Enumerable);
Object.extend(Range.prototype,{
initialize:function(start,end,exclusive){
this.start=start;
this.end=end;
this.exclusive=exclusive;
},
_each:function(iterator){
var value=this.start;
do{
iterator(value);
value=value.succ();
}while(this.include(value));
},
include:function(value){
if(value<this.start)
return false;
if(this.exclusive)
return value<this.end;
return value<=this.end;
}
});
var $R=function(start,end,exclusive){
return new Range(start,end,exclusive);
}
var Ajax={
getTransport:function(){
return Try.these(
function(){return new ActiveXObject('Msxml2.XMLHTTP')},
function(){return new ActiveXObject('Microsoft.XMLHTTP')},
function(){return new XMLHttpRequest()}
)||false;
},
activeRequestCount:0
}
Ajax.Responders={
responders:[],
_each:function(iterator){
this.responders._each(iterator);
},
register:function(responderToAdd){
if(!this.include(responderToAdd))
this.responders.push(responderToAdd);
},
unregister:function(responderToRemove){
this.responders=this.responders.without(responderToRemove);
},
dispatch:function(callback,request,transport,json){
this.each(function(responder){
if(responder[callback]&&typeof responder[callback]=='function'){
try{
responder[callback].apply(responder,[request,transport,json]);
}catch(e){
}
}
});
}
};
Object.extend(Ajax.Responders,Enumerable);
Ajax.Responders.register({
onCreate:function(){
Ajax.activeRequestCount++;
},
onComplete:function(){
Ajax.activeRequestCount--;
}
});
Ajax.Base=function(){};
Ajax.Base.prototype={
setOptions:function(options){
this.options={
method:'post',
asynchronous:true,
parameters:''
}
Object.extend(this.options,options||{});
},
responseIsSuccess:function(){
return this.transport.status==undefined
||this.transport.status==0
||(this.transport.status>=200&&this.transport.status<300);
},
responseIsFailure:function(){
return !this.responseIsSuccess();
}
}
Ajax.Request=Class.create();
Ajax.Request.Events=
['Uninitialized','Loading','Loaded','Interactive','Complete'];
Ajax.Request.prototype=Object.extend(new Ajax.Base(),{
initialize:function(url,options){
this.transport=Ajax.getTransport();
this.setOptions(options);
this.request(url);
},
request:function(url){
var parameters=this.options.parameters||'';
if(parameters.length>0)parameters+='&_=';
try{
this.url=url;
if(this.options.method=='get'&&parameters.length>0)
this.url+=(this.url.match(/\?/)?'&':'?')+parameters;
Ajax.Responders.dispatch('onCreate',this,this.transport);
this.transport.open(this.options.method,this.url,
this.options.asynchronous);
if(this.options.asynchronous){
this.transport.onreadystatechange=this.onStateChange.bind(this);
setTimeout((function(){this.respondToReadyState(1)}).bind(this),10);
}
this.setRequestHeaders();
var body=this.options.postBody?this.options.postBody:parameters;
this.transport.send(this.options.method=='post'?body:null);
}catch(e){
(this.options.onException||Prototype.emptyFunction)(this,e);
Ajax.Responders.dispatch('onException',this,e);
}
},
setRequestHeaders:function(){
var requestHeaders=
['X-Requested-With','XMLHttpRequest',
'X-Prototype-Version',Prototype.Version];
if(this.options.method=='post'){
requestHeaders.push('Content-type',
'application/x-www-form-urlencoded');
if(this.transport.overrideMimeType)
requestHeaders.push('Connection','close');
}
if(this.options.requestHeaders)
requestHeaders.push.apply(requestHeaders,this.options.requestHeaders);
for(var i=0;i<requestHeaders.length;i+=2)
this.transport.setRequestHeader(requestHeaders[i],requestHeaders[i+1]);
},
onStateChange:function(){
var readyState=this.transport.readyState;
if(readyState!=1)
this.respondToReadyState(this.transport.readyState);
},
evalJSON:function(){
try{
var json=this.transport.getResponseHeader('X-JSON'),object;
object=eval(json);
return object;
}catch(e){
}
},
respondToReadyState:function(readyState){
var event=Ajax.Request.Events[readyState];
var transport=this.transport,json=this.evalJSON();
if(event=='Complete')
(this.options['on'+this.transport.status]
||this.options['on'+(this.responseIsSuccess()?'Success':'Failure')]
||Prototype.emptyFunction)(transport,json);
(this.options['on'+event]||Prototype.emptyFunction)(transport,json);
Ajax.Responders.dispatch('on'+event,this,transport,json);
if(event=='Complete')
this.transport.onreadystatechange=Prototype.emptyFunction;
}
});
Ajax.Updater=Class.create();
Ajax.Updater.ScriptFragment='(?:<script.*?>)((\n|.)*?)(?:<\/script>)';
Object.extend(Object.extend(Ajax.Updater.prototype,Ajax.Request.prototype),{
initialize:function(container,url,options){
this.containers={
success:container.success?$(container.success):$(container),
failure:container.failure?$(container.failure):
(container.success?null:$(container))
}
this.transport=Ajax.getTransport();
this.setOptions(options);
var onComplete=this.options.onComplete||Prototype.emptyFunction;
this.options.onComplete=(function(transport,object){
this.updateContent();
onComplete(transport,object);
}).bind(this);
this.request(url);
},
updateContent:function(){
var receiver=this.responseIsSuccess()?
this.containers.success:this.containers.failure;
var match=new RegExp(Ajax.Updater.ScriptFragment,'img');
var response=this.transport.responseText.replace(match,'');
var scripts=this.transport.responseText.match(match);
if(receiver){
if(this.options.insertion){
new this.options.insertion(receiver,response);
}else{
receiver.innerHTML=response;
}
}
if(this.responseIsSuccess()){
if(this.onComplete)
setTimeout(this.onComplete.bind(this),10);
}
if(this.options.evalScripts&&scripts){
match=new RegExp(Ajax.Updater.ScriptFragment,'im');
setTimeout((function(){
for(var i=0;i<scripts.length;i++)
eval(scripts[i].match(match)[1]);
}).bind(this),10);
}
}
});
Ajax.PeriodicalUpdater=Class.create();
Ajax.PeriodicalUpdater.prototype=Object.extend(new Ajax.Base(),{
initialize:function(container,url,options){
this.setOptions(options);
this.onComplete=this.options.onComplete;
this.frequency=(this.options.frequency||2);
this.decay=(this.options.decay||1);
this.updater={};
this.container=container;
this.url=url;
this.start();
},
start:function(){
this.options.onComplete=this.updateComplete.bind(this);
this.onTimerEvent();
},
stop:function(){
this.updater.onComplete=undefined;
clearTimeout(this.timer);
(this.onComplete||Prototype.emptyFunction).apply(this,arguments);
},
updateComplete:function(request){
if(this.options.decay){
this.decay=(request.responseText==this.lastText?
this.decay*this.options.decay:1);
this.lastText=request.responseText;
}
this.timer=setTimeout(this.onTimerEvent.bind(this),
this.decay*this.frequency*1000);
},
onTimerEvent:function(){
this.updater=new Ajax.Updater(this.container,this.url,this.options);
}
});
document.getElementsByClassName=function(className,parentElement){
var children=($(parentElement)||document.body).getElementsByTagName('*');
return $A(children).inject([],function(elements,child){
if(child.className.match(new RegExp("(^|\\s)"+className+"(\\s|$)")))
elements.push(child);
return elements;
});
}
if(!window.Element){
var Element=new Object();
}
Object.extend(Element,{
visible:function(element){
return $(element).style.display!='none';
},
toggle:function(){
for(var i=0;i<arguments.length;i++){
var element=$(arguments[i]);
Element[Element.visible(element)?'hide':'show'](element);
}
},
hide:function(){
for(var i=0;i<arguments.length;i++){
var element=$(arguments[i]);
element.style.display='none';
}
},
show:function(){
for(var i=0;i<arguments.length;i++){
var element=$(arguments[i]);
element.style.display='';
}
},
remove:function(element){
element=$(element);
element.parentNode.removeChild(element);
},
getHeight:function(element){
element=$(element);
return element.offsetHeight;
},
classNames:function(element){
return new Element.ClassNames(element);
},
hasClassName:function(element,className){
if(!(element=$(element)))return;
return Element.classNames(element).include(className);
},
addClassName:function(element,className){
if(!(element=$(element)))return;
return Element.classNames(element).add(className);
},
removeClassName:function(element,className){
if(!(element=$(element)))return;
return Element.classNames(element).remove(className);
},
cleanWhitespace:function(element){
element=$(element);
for(var i=0;i<element.childNodes.length;i++){
var node=element.childNodes[i];
if(node.nodeType==3&&!/\S/.test(node.nodeValue))
Element.remove(node);
}
},
empty:function(element){
return $(element).innerHTML.match(/^\s*$/);
},
scrollTo:function(element){
element=$(element);
var x=element.x?element.x:element.offsetLeft,
y=element.y?element.y:element.offsetTop;
window.scrollTo(x,y);
},
getStyle:function(element,style){
element=$(element);
var value=element.style[style.camelize()];
if(!value){
if(document.defaultView&&document.defaultView.getComputedStyle){
var css=document.defaultView.getComputedStyle(element,null);
value=css?css.getPropertyValue(style):null;
}else if(element.currentStyle){
value=element.currentStyle[style.camelize()];
}
}
if(window.opera&&['left','top','right','bottom'].include(style))
if(Element.getStyle(element,'position')=='static')value='auto';
return value=='auto'?null:value;
},
getDimensions:function(element){
element=$(element);
if(Element.getStyle(element,'display')!='none')
return{width:element.offsetWidth,height:element.offsetHeight};
var els=element.style;
var originalVisibility=els.visibility;
var originalPosition=els.position;
els.visibility='hidden';
els.position='absolute';
els.display='';
var originalWidth=element.clientWidth;
var originalHeight=element.clientHeight;
els.display='none';
els.position=originalPosition;
els.visibility=originalVisibility;
return{width:originalWidth,height:originalHeight};
},
makePositioned:function(element){
element=$(element);
var pos=Element.getStyle(element,'position');
if(pos=='static'||!pos){
element._madePositioned=true;
element.style.position='relative';
if(window.opera){
element.style.top=0;
element.style.left=0;
}
}
},
undoPositioned:function(element){
element=$(element);
if(element._madePositioned){
element._madePositioned=undefined;
element.style.position=
element.style.top=
element.style.left=
element.style.bottom=
element.style.right='';
}
},
makeClipping:function(element){
element=$(element);
if(element._overflow)return;
element._overflow=element.style.overflow;
if((Element.getStyle(element,'overflow')||'visible')!='hidden')
element.style.overflow='hidden';
},
undoClipping:function(element){
element=$(element);
if(element._overflow)return;
element.style.overflow=element._overflow;
element._overflow=undefined;
}
});
var Toggle=new Object();
Toggle.display=Element.toggle;
Abstract.Insertion=function(adjacency){
this.adjacency=adjacency;
}
Abstract.Insertion.prototype={
initialize:function(element,content){
this.element=$(element);
this.content=content;
if(this.adjacency&&this.element.insertAdjacentHTML){
try{
this.element.insertAdjacentHTML(this.adjacency,this.content);
}catch(e){
if(this.element.tagName.toLowerCase()=='tbody'){
this.insertContent(this.contentFromAnonymousTable());
}else{
throw e;
}
}
}else{
this.range=this.element.ownerDocument.createRange();
if(this.initializeRange)this.initializeRange();
this.insertContent([this.range.createContextualFragment(this.content)]);
}
},
contentFromAnonymousTable:function(){
var div=document.createElement('div');
div.innerHTML='<table><tbody>'+this.content+'</tbody></table>';
return $A(div.childNodes[0].childNodes[0].childNodes);
}
}
var Insertion=new Object();
Insertion.Before=Class.create();
Insertion.Before.prototype=Object.extend(new Abstract.Insertion('beforeBegin'),{
initializeRange:function(){
this.range.setStartBefore(this.element);
},
insertContent:function(fragments){
fragments.each((function(fragment){
this.element.parentNode.insertBefore(fragment,this.element);
}).bind(this));
}
});
Insertion.Top=Class.create();
Insertion.Top.prototype=Object.extend(new Abstract.Insertion('afterBegin'),{
initializeRange:function(){
this.range.selectNodeContents(this.element);
this.range.collapse(true);
},
insertContent:function(fragments){
fragments.reverse().each((function(fragment){
this.element.insertBefore(fragment,this.element.firstChild);
}).bind(this));
}
});
Insertion.Bottom=Class.create();
Insertion.Bottom.prototype=Object.extend(new Abstract.Insertion('beforeEnd'),{
initializeRange:function(){
this.range.selectNodeContents(this.element);
this.range.collapse(this.element);
},
insertContent:function(fragments){
fragments.each((function(fragment){
this.element.appendChild(fragment);
}).bind(this));
}
});
Insertion.After=Class.create();
Insertion.After.prototype=Object.extend(new Abstract.Insertion('afterEnd'),{
initializeRange:function(){
this.range.setStartAfter(this.element);
},
insertContent:function(fragments){
fragments.each((function(fragment){
this.element.parentNode.insertBefore(fragment,
this.element.nextSibling);
}).bind(this));
}
});
Element.ClassNames=Class.create();
Element.ClassNames.prototype={
initialize:function(element){
this.element=$(element);
},
_each:function(iterator){
this.element.className.split(/\s+/).select(function(name){
return name.length>0;
})._each(iterator);
},
set:function(className){
this.element.className=className;
},
add:function(classNameToAdd){
if(this.include(classNameToAdd))return;
this.set(this.toArray().concat(classNameToAdd).join(' '));
},
remove:function(classNameToRemove){
if(!this.include(classNameToRemove))return;
this.set(this.select(function(className){
return className!=classNameToRemove;
}));
},
toString:function(){
return this.toArray().join(' ');
}
}
Object.extend(Element.ClassNames.prototype,Enumerable);
var Field={
clear:function(){
for(var i=0;i<arguments.length;i++)
$(arguments[i]).value='';
},
focus:function(element){
$(element).focus();
},
present:function(){
for(var i=0;i<arguments.length;i++)
if($(arguments[i]).value=='')return false;
return true;
},
select:function(element){
$(element).select();
},
activate:function(element){
$(element).focus();
$(element).select();
}
}
var Form={
serialize:function(form){
var elements=Form.getElements($(form));
var queryComponents=new Array();
for(var i=0;i<elements.length;i++){
var queryComponent=Form.Element.serialize(elements[i]);
if(queryComponent)
queryComponents.push(queryComponent);
}
return queryComponents.join('&');
},
getElements:function(form){
form=$(form);
var elements=new Array();
for(tagName in Form.Element.Serializers){
var tagElements=form.getElementsByTagName(tagName);
for(var j=0;j<tagElements.length;j++)
elements.push(tagElements[j]);
}
return elements;
},
getInputs:function(form,typeName,name){
form=$(form);
var inputs=form.getElementsByTagName('input');
if(!typeName&&!name)
return inputs;
var matchingInputs=new Array();
for(var i=0;i<inputs.length;i++){
var input=inputs[i];
if((typeName&&input.type!=typeName)||
(name&&input.name!=name))
continue;
matchingInputs.push(input);
}
return matchingInputs;
},
disable:function(form){
var elements=Form.getElements(form);
for(var i=0;i<elements.length;i++){
var element=elements[i];
element.blur();
element.disabled='true';
}
},
enable:function(form){
var elements=Form.getElements(form);
for(var i=0;i<elements.length;i++){
var element=elements[i];
element.disabled='';
}
},
focusFirstElement:function(form){
form=$(form);
var elements=Form.getElements(form);
for(var i=0;i<elements.length;i++){
var element=elements[i];
if(element.type!='hidden'&&!element.disabled){
Field.activate(element);
break;
}
}
},
reset:function(form){
$(form).reset();
}
}
Form.Element={
serialize:function(element){
element=$(element);
var method=element.tagName.toLowerCase();
var parameter=Form.Element.Serializers[method](element);
if(parameter)
return encodeURIComponent(parameter[0])+'='+
encodeURIComponent(parameter[1]);
},
getValue:function(element){
element=$(element);
var method=element.tagName.toLowerCase();
var parameter=Form.Element.Serializers[method](element);
if(parameter)
return parameter[1];
}
}
Form.Element.Serializers={
input:function(element){
switch(element.type.toLowerCase()){
case 'submit':
case 'hidden':
case 'password':
case 'text':
return Form.Element.Serializers.textarea(element);
case 'checkbox':
return Form.Element.Serializers.inputSelector(element);
case 'radio':
return Form.Element.Serializers.radioSelector(element);
}
return false;
},
inputSelector:function(element){
if(element.checked)
return[element.name,element.value];
},
radioSelector:function(element){
var len=eval('element.form["'+element.name+'"].length');
if(!len){
return[element.name,eval('element.form["'+element.name+'"].value')];
}
for(var xi=0;xi<len;xi++)
if(eval('element.form["'+element.name+'"]['+xi+'].checked'))
return[element.name,eval('element.form["'+element.name+'"]['+xi+'].value')];
return '';
},
textarea:function(element){
return[element.name,element.value];
},
select:function(element){
return Form.Element.Serializers[element.type=='select-one'?
'selectOne':'selectMany'](element);
},
selectOne:function(element){
var value='',opt,index=element.selectedIndex;
if(index>=0){
opt=element.options[index];
value=opt.value;
if(!value&&!('value' in opt))
value=opt.text;
}
return[element.name,value];
},
selectMany:function(element){
var value=new Array();
for(var i=0;i<element.length;i++){
var opt=element.options[i];
if(opt.selected){
var optValue=opt.value;
if(!optValue&&!('value' in opt))
optValue=opt.text;
value.push(optValue);
}
}
return[element.name,value];
}
}
var $F=Form.Element.getValue;
Abstract.TimedObserver=function(){}
Abstract.TimedObserver.prototype={
initialize:function(element,frequency,callback){
this.frequency=frequency;
this.element=$(element);
this.callback=callback;
this.lastValue=this.getValue();
this.registerCallback();
},
registerCallback:function(){
setInterval(this.onTimerEvent.bind(this),this.frequency*1000);
},
onTimerEvent:function(){
var value=this.getValue();
if(this.lastValue!=value){
this.callback(this.element,value);
this.lastValue=value;
}
}
}
Form.Element.Observer=Class.create();
Form.Element.Observer.prototype=Object.extend(new Abstract.TimedObserver(),{
getValue:function(){
return Form.Element.getValue(this.element);
}
});
Form.Observer=Class.create();
Form.Observer.prototype=Object.extend(new Abstract.TimedObserver(),{
getValue:function(){
return Form.serialize(this.element);
}
});
Abstract.EventObserver=function(){}
Abstract.EventObserver.prototype={
initialize:function(element,callback){
this.element=$(element);
this.callback=callback;
this.lastValue=this.getValue();
if(this.element.tagName.toLowerCase()=='form')
this.registerFormCallbacks();
else
this.registerCallback(this.element);
},
onElementEvent:function(){
var value=this.getValue();
if(this.lastValue!=value){
this.callback(this.element,value);
this.lastValue=value;
}
},
registerFormCallbacks:function(){
var elements=Form.getElements(this.element);
for(var i=0;i<elements.length;i++)
this.registerCallback(elements[i]);
},
registerCallback:function(element){
if(element.type){
switch(element.type.toLowerCase()){
case 'checkbox':
case 'radio':
element.target=this;
element.prev_onclick=element.onclick||Prototype.emptyFunction;
element.onclick=function(){
this.prev_onclick();
this.target.onElementEvent();
}
break;
case 'password':
case 'text':
case 'textarea':
case 'select-one':
case 'select-multiple':
element.target=this;
element.prev_onchange=element.onchange||Prototype.emptyFunction;
element.onchange=function(){
this.prev_onchange();
this.target.onElementEvent();
}
break;
}
}
}
}
Form.Element.EventObserver=Class.create();
Form.Element.EventObserver.prototype=Object.extend(new Abstract.EventObserver(),{
getValue:function(){
return Form.Element.getValue(this.element);
}
});
Form.EventObserver=Class.create();
Form.EventObserver.prototype=Object.extend(new Abstract.EventObserver(),{
getValue:function(){
return Form.serialize(this.element);
}
});
if(!window.Event){
var Event=new Object();
}
Object.extend(Event,{
KEY_BACKSPACE:8,
KEY_TAB:9,
KEY_RETURN:13,
KEY_ESC:27,
KEY_LEFT:37,
KEY_UP:38,
KEY_RIGHT:39,
KEY_DOWN:40,
KEY_DELETE:46,
element:function(event){
return event.target||event.srcElement;
},
isLeftClick:function(event){
return(((event.which)&&(event.which==1))||
((event.button)&&(event.button==1)));
},
pointerX:function(event){
return event.pageX||(event.clientX+
(document.documentElement.scrollLeft||document.body.scrollLeft));
},
pointerY:function(event){
return event.pageY||(event.clientY+
(document.documentElement.scrollTop||document.body.scrollTop));
},
stop:function(event){
if(event.preventDefault){
event.preventDefault();
event.stopPropagation();
}else{
event.returnValue=false;
event.cancelBubble=true;
}
},
findElement:function(event,tagName){
var element=Event.element(event);
while(element.parentNode&&(!element.tagName||
(element.tagName.toUpperCase()!=tagName.toUpperCase())))
element=element.parentNode;
return element;
},
observers:false,
_observeAndCache:function(element,name,observer,useCapture){
if(!this.observers)this.observers=[];
if(element.addEventListener){
this.observers.push([element,name,observer,useCapture]);
element.addEventListener(name,observer,useCapture);
}else if(element.attachEvent){
this.observers.push([element,name,observer,useCapture]);
element.attachEvent('on'+name,observer);
}
},
unloadCache:function(){
if(!Event.observers)return;
for(var i=0;i<Event.observers.length;i++){
Event.stopObserving.apply(this,Event.observers[i]);
Event.observers[i][0]=null;
}
Event.observers=false;
},
observe:function(element,name,observer,useCapture){
var element=$(element);
useCapture=useCapture||false;
if(name=='keypress'&&
(navigator.appVersion.match(/Konqueror|Safari|KHTML/)
||element.attachEvent))
name='keydown';
this._observeAndCache(element,name,observer,useCapture);
},
stopObserving:function(element,name,observer,useCapture){
var element=$(element);
useCapture=useCapture||false;
if(name=='keypress'&&
(navigator.appVersion.match(/Konqueror|Safari|KHTML/)
||element.detachEvent))
name='keydown';
if(element.removeEventListener){
element.removeEventListener(name,observer,useCapture);
}else if(element.detachEvent){
element.detachEvent('on'+name,observer);
}
}
});
Event.observe(window,'unload',Event.unloadCache,false);
var Position={
includeScrollOffsets:false,
prepare:function(){
this.deltaX=window.pageXOffset
||document.documentElement.scrollLeft
||document.body.scrollLeft
||0;
this.deltaY=window.pageYOffset
||document.documentElement.scrollTop
||document.body.scrollTop
||0;
},
realOffset:function(element){
var valueT=0,valueL=0;
do{
valueT+=element.scrollTop||0;
valueL+=element.scrollLeft||0;
element=element.parentNode;
}while(element);
return[valueL,valueT];
},
cumulativeOffset:function(element){
var valueT=0,valueL=0;
do{
valueT+=element.offsetTop||0;
valueL+=element.offsetLeft||0;
element=element.offsetParent;
}while(element);
return[valueL,valueT];
},
positionedOffset:function(element){
var valueT=0,valueL=0;
do{
valueT+=element.offsetTop||0;
valueL+=element.offsetLeft||0;
element=element.offsetParent;
if(element){
p=Element.getStyle(element,'position');
if(p=='relative'||p=='absolute')break;
}
}while(element);
return[valueL,valueT];
},
offsetParent:function(element){
if(element.offsetParent)return element.offsetParent;
if(element==document.body)return element;
while((element=element.parentNode)&&element!=document.body)
if(Element.getStyle(element,'position')!='static')
return element;
return document.body;
},
within:function(element,x,y){
if(this.includeScrollOffsets)
return this.withinIncludingScrolloffsets(element,x,y);
this.xcomp=x;
this.ycomp=y;
this.offset=this.cumulativeOffset(element);
return(y>=this.offset[1]&&
y<this.offset[1]+element.offsetHeight&&
x>=this.offset[0]&&
x<this.offset[0]+element.offsetWidth);
},
withinIncludingScrolloffsets:function(element,x,y){
var offsetcache=this.realOffset(element);
this.xcomp=x+offsetcache[0]-this.deltaX;
this.ycomp=y+offsetcache[1]-this.deltaY;
this.offset=this.cumulativeOffset(element);
return(this.ycomp>=this.offset[1]&&
this.ycomp<this.offset[1]+element.offsetHeight&&
this.xcomp>=this.offset[0]&&
this.xcomp<this.offset[0]+element.offsetWidth);
},
overlap:function(mode,element){
if(!mode)return 0;
if(mode=='vertical')
return((this.offset[1]+element.offsetHeight)-this.ycomp)/
element.offsetHeight;
if(mode=='horizontal')
return((this.offset[0]+element.offsetWidth)-this.xcomp)/
element.offsetWidth;
},
clone:function(source,target){
source=$(source);
target=$(target);
target.style.position='absolute';
var offsets=this.cumulativeOffset(source);
target.style.top=offsets[1]+'px';
target.style.left=offsets[0]+'px';
target.style.width=source.offsetWidth+'px';
target.style.height=source.offsetHeight+'px';
},
page:function(forElement){
var valueT=0,valueL=0;
var element=forElement;
do{
valueT+=element.offsetTop||0;
valueL+=element.offsetLeft||0;
if(element.offsetParent==document.body)
if(Element.getStyle(element,'position')=='absolute')break;
}while(element=element.offsetParent);
element=forElement;
do{
valueT-=element.scrollTop||0;
valueL-=element.scrollLeft||0;
}while(element=element.parentNode);
return[valueL,valueT];
},
clone:function(source,target){
var options=Object.extend({
setLeft:true,
setTop:true,
setWidth:true,
setHeight:true,
offsetTop:0,
offsetLeft:0
},arguments[2]||{})
source=$(source);
var p=Position.page(source);
target=$(target);
var delta=[0,0];
var parent=null;
if(Element.getStyle(target,'position')=='absolute'){
parent=Position.offsetParent(target);
delta=Position.page(parent);
}
if(parent==document.body){
delta[0]-=document.body.offsetLeft;
delta[1]-=document.body.offsetTop;
}
if(options.setLeft)target.style.left=(p[0]-delta[0]+options.offsetLeft)+'px';
if(options.setTop)target.style.top=(p[1]-delta[1]+options.offsetTop)+'px';
if(options.setWidth)target.style.width=source.offsetWidth+'px';
if(options.setHeight)target.style.height=source.offsetHeight+'px';
},
absolutize:function(element){
element=$(element);
if(element.style.position=='absolute')return;
Position.prepare();
var offsets=Position.positionedOffset(element);
var top=offsets[1];
var left=offsets[0];
var width=element.clientWidth;
var height=element.clientHeight;
element._originalLeft=left-parseFloat(element.style.left||0);
element._originalTop=top-parseFloat(element.style.top||0);
element._originalWidth=element.style.width;
element._originalHeight=element.style.height;
element.style.position='absolute';
element.style.top=top+'px';;
element.style.left=left+'px';;
element.style.width=width+'px';;
element.style.height=height+'px';;
},
relativize:function(element){
element=$(element);
if(element.style.position=='relative')return;
Position.prepare();
element.style.position='relative';
var top=parseFloat(element.style.top||0)-(element._originalTop||0);
var left=parseFloat(element.style.left||0)-(element._originalLeft||0);
element.style.top=top+'px';
element.style.left=left+'px';
element.style.height=element._originalHeight;
element.style.width=element._originalWidth;
}
}
if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){
Position.cumulativeOffset=function(element){
var valueT=0,valueL=0;
do{
valueT+=element.offsetTop||0;
valueL+=element.offsetLeft||0;
if(element.offsetParent==document.body)
if(Element.getStyle(element,'position')=='absolute')break;
element=element.offsetParent;
}while(element);
return[valueL,valueT];
}
}
String.prototype.parseColor=function(){
color="#";
if(this.slice(0,4)=="rgb("){
var cols=this.slice(4,this.length-1).split(',');
var i=0;do{color+=parseInt(cols[i]).toColorPart()}while(++i<3);
}else{
if(this.slice(0,1)=='#'){
if(this.length==4)for(var i=1;i<4;i++)color+=(this.charAt(i)+this.charAt(i)).toLowerCase();
if(this.length==7)color=this.toLowerCase();
}
}
return(color.length==7?color:(arguments[0]||this));
}
Element.collectTextNodesIgnoreClass=function(element,ignoreclass){
var children=$(element).childNodes;
var text="";
var classtest=new RegExp("^([^ ]+ )*"+ignoreclass+"( [^ ]+)*$","i");
for(var i=0;i<children.length;i++){
if(children[i].nodeType==3){
text+=children[i].nodeValue;
}else{
if((!children[i].className.match(classtest))&&children[i].hasChildNodes())
text+=Element.collectTextNodesIgnoreClass(children[i],ignoreclass);
}
}
return text;
}
Element.setContentZoom=function(element,percent){
element=$(element);
element.style.fontSize=(percent/100)+"em";
if(navigator.appVersion.indexOf('AppleWebKit')>0)window.scrollBy(0,0);
}
Element.getOpacity=function(element){
var opacity;
if(opacity=Element.getStyle(element,"opacity"))
return parseFloat(opacity);
if(opacity=(Element.getStyle(element,"filter")||'').match(/alpha\(opacity=(.*)\)/))
if(opacity[1])return parseFloat(opacity[1])/100;
return 1.0;
}
Element.setOpacity=function(element,value){
element=$(element);
var els=element.style;
if(value==1){
els.opacity='0.999999';
if(/MSIE/.test(navigator.userAgent))
els.filter=Element.getStyle(element,'filter').replace(/alpha\([^\)]*\)/gi,'');
}else{
if(value<0.00001)value=0;
els.opacity=value;
if(/MSIE/.test(navigator.userAgent))
els.filter=Element.getStyle(element,'filter').replace(/alpha\([^\)]*\)/gi,'')+
"alpha(opacity="+value*100+")";
}
}
Element.getInlineOpacity=function(element){
element=$(element);
var op;
op=element.style.opacity;
if(typeof op!="undefined"&&op!="")return op;
return "";
}
Element.setInlineOpacity=function(element,value){
element=$(element);
var els=element.style;
els.opacity=value;
}
Element.Class={
toggle:function(element,className){
if(Element.Class.has(element,className)){
Element.Class.remove(element,className);
if(arguments.length==3)Element.Class.add(element,arguments[2]);
}else{
Element.Class.add(element,className);
if(arguments.length==3)Element.Class.remove(element,arguments[2]);
}
},
get:function(element){
return $(element).className.split(' ');
},
remove:function(element){
element=$(element);
var removeClasses=arguments;
$R(1,arguments.length-1).each(function(index){
element.className=
element.className.split(' ').reject(
function(klass){return(klass==removeClasses[index])}).join(' ');
});
},
add:function(element){
element=$(element);
for(var i=1;i<arguments.length;i++){
Element.Class.remove(element,arguments[i]);
element.className+=(element.className.length>0?' ':'')+arguments[i];
}
},
has:function(element){
element=$(element);
if(!element||!element.className)return false;
var regEx;
for(var i=1;i<arguments.length;i++){
if((typeof arguments[i]=='object')&&
(arguments[i].constructor==Array)){
for(var j=0;j<arguments[i].length;j++){
regEx=new RegExp("(^|\\s)"+arguments[i][j]+"(\\s|$)");
if(!regEx.test(element.className))return false;
}
}else{
regEx=new RegExp("(^|\\s)"+arguments[i]+"(\\s|$)");
if(!regEx.test(element.className))return false;
}
}
return true;
},
has_any:function(element){
element=$(element);
if(!element||!element.className)return false;
var regEx;
for(var i=1;i<arguments.length;i++){
if((typeof arguments[i]=='object')&&
(arguments[i].constructor==Array)){
for(var j=0;j<arguments[i].length;j++){
regEx=new RegExp("(^|\\s)"+arguments[i][j]+"(\\s|$)");
if(regEx.test(element.className))return true;
}
}else{
regEx=new RegExp("(^|\\s)"+arguments[i]+"(\\s|$)");
if(regEx.test(element.className))return true;
}
}
return false;
},
childrenWith:function(element,className){
var children=$(element).getElementsByTagName('*');
var elements=new Array();
for(var i=0;i<children.length;i++)
if(Element.Class.has(children[i],className))
elements.push(children[i]);
return elements;
}
}
var Effect={
tagifyText:function(element){
var tagifyStyle="position:relative";
if(/MSIE/.test(navigator.userAgent))tagifyStyle+=";zoom:1";
element=$(element);
$A(element.childNodes).each(function(child){
if(child.nodeType==3){
child.nodeValue.toArray().each(function(character){
element.insertBefore(
Builder.node('span',{style:tagifyStyle},
character==" "?String.fromCharCode(160):character),
child);
});
Element.remove(child);
}
});
},
multiple:function(element,effect){
var elements;
if(((typeof element=='object')||
(typeof element=='function'))&&
(element.length))
elements=element;
else
elements=$(element).childNodes;
var options=Object.extend({
speed:0.1,
delay:0.0
},arguments[2]||{});
var speed=options.speed;
var delay=options.delay;
$A(elements).each(function(element,index){
new effect(element,Object.extend(options,{delay:delay+index*speed}));
});
}
};
var Effect2=Effect;
Effect.Transitions={}
Effect.Transitions.linear=function(pos){
return pos;
}
Effect.Transitions.sinoidal=function(pos){
return(-Math.cos(pos*Math.PI)/2)+0.5;
}
Effect.Transitions.reverse=function(pos){
return 1-pos;
}
Effect.Transitions.flicker=function(pos){
return((-Math.cos(pos*Math.PI)/4) + 0.75) + Math.random()/4;
}
Effect.Transitions.wobble=function(pos){
return(-Math.cos(pos*Math.PI*(9*pos))/2)+0.5;
}
Effect.Transitions.pulse=function(pos){
return(Math.floor(pos*10)%2==0?
(pos*10-Math.floor(pos*10)):1-(pos*10-Math.floor(pos*10)));
}
Effect.Transitions.none=function(pos){
return 0;
}
Effect.Transitions.full=function(pos){
return 1;
}
Effect.Queue={
effects:[],
_each:function(iterator){
this.effects._each(iterator);
},
interval:null,
add:function(effect){
var timestamp=new Date().getTime();
switch(effect.options.queue){
case 'front':
this.effects.findAll(function(e){return e.state=='idle'}).each(function(e){
e.startOn+=effect.finishOn;
e.finishOn+=effect.finishOn;
});
break;
case 'end':
timestamp=this.effects.pluck('finishOn').max()||timestamp;
break;
}
effect.startOn+=timestamp;
effect.finishOn+=timestamp;
this.effects.push(effect);
if(!this.interval)
this.interval=setInterval(this.loop.bind(this),40);
},
remove:function(effect){
this.effects=this.effects.reject(function(e){return e==effect});
if(this.effects.length==0){
clearInterval(this.interval);
this.interval=null;
}
},
loop:function(){
var timePos=new Date().getTime();
this.effects.invoke('loop',timePos);
}
}
Object.extend(Effect.Queue,Enumerable);
Effect.Base=function(){};
Effect.Base.prototype={
position:null,
setOptions:function(options){
this.options=Object.extend({
transition:Effect.Transitions.sinoidal,
duration:1.0,
fps:25.0,
sync:false,
from:0.0,
to:1.0,
delay:0.0,
queue:'parallel'
},options||{});
},
start:function(options){
this.setOptions(options||{});
this.currentFrame=0;
this.state='idle';
this.startOn=this.options.delay*1000;
this.finishOn=this.startOn+(this.options.duration*1000);
this.event('beforeStart');
if(!this.options.sync)Effect.Queue.add(this);
},
loop:function(timePos){
if(timePos>=this.startOn){
if(timePos>=this.finishOn){
this.render(1.0);
this.cancel();
this.event('beforeFinish');
if(this.finish)this.finish();
this.event('afterFinish');
return;
}
var pos=(timePos-this.startOn)/(this.finishOn-this.startOn);
var frame=Math.round(pos*this.options.fps*this.options.duration);
if(frame>this.currentFrame){
this.render(pos);
this.currentFrame=frame;
}
}
},
render:function(pos){
if(this.state=='idle'){
this.state='running';
this.event('beforeSetup');
if(this.setup)this.setup();
this.event('afterSetup');
}
if(this.options.transition)pos=this.options.transition(pos);
pos*=(this.options.to-this.options.from);
pos+=this.options.from;
this.position=pos;
this.event('beforeUpdate');
if(this.update)this.update(pos);
this.event('afterUpdate');
},
cancel:function(){
if(!this.options.sync)Effect.Queue.remove(this);
this.state='finished';
},
event:function(eventName){
if(this.options[eventName+'Internal'])this.options[eventName+'Internal'](this);
if(this.options[eventName])this.options[eventName](this);
}
}
Effect.Parallel=Class.create();
Object.extend(Object.extend(Effect.Parallel.prototype,Effect.Base.prototype),{
initialize:function(effects){
this.effects=effects||[];
this.start(arguments[1]);
},
update:function(position){
this.effects.invoke('render',position);
},
finish:function(position){
this.effects.each(function(effect){
effect.render(1.0);
effect.cancel();
effect.event('beforeFinish');
if(effect.finish)effect.finish(position);
effect.event('afterFinish');
});
}
});
Effect.Opacity=Class.create();
Object.extend(Object.extend(Effect.Opacity.prototype,Effect.Base.prototype),{
initialize:function(element){
this.element=$(element);
if(/MSIE/.test(navigator.userAgent)&&(!this.element.hasLayout))
this.element.style.zoom=1;
var options=Object.extend({
from:Element.getOpacity(this.element)||0.0,
to:1.0
},arguments[1]||{});
this.start(options);
},
update:function(position){
Element.setOpacity(this.element,position);
}
});
Effect.MoveBy=Class.create();
Object.extend(Object.extend(Effect.MoveBy.prototype,Effect.Base.prototype),{
initialize:function(element,toTop,toLeft){
this.element=$(element);
this.toTop=toTop;
this.toLeft=toLeft;
this.start(arguments[3]);
},
setup:function(){
Element.makePositioned(this.element);
this.originalTop=parseFloat(Element.getStyle(this.element,'top')||'0');
this.originalLeft=parseFloat(Element.getStyle(this.element,'left')||'0');
},
update:function(position){
var topd=this.toTop*position+this.originalTop;
var leftd=this.toLeft*position+this.originalLeft;
this.setPosition(topd,leftd);
},
setPosition:function(topd,leftd){
this.element.style.top=topd+"px";
this.element.style.left=leftd+"px";
}
});
Effect.Scale=Class.create();
Object.extend(Object.extend(Effect.Scale.prototype,Effect.Base.prototype),{
initialize:function(element,percent){
this.element=$(element)
var options=Object.extend({
scaleX:true,
scaleY:true,
scaleContent:true,
scaleFromCenter:false,
scaleMode:'box',
scaleFrom:100.0,
scaleTo:percent
},arguments[2]||{});
this.start(options);
},
setup:function(){
var effect=this;
this.restoreAfterFinish=this.options.restoreAfterFinish||false;
this.elementPositioning=Element.getStyle(this.element,'position');
effect.originalStyle={};
['top','left','width','height','fontSize'].each(function(k){
effect.originalStyle[k]=effect.element.style[k];
});
this.originalTop=this.element.offsetTop;
this.originalLeft=this.element.offsetLeft;
var fontSize=Element.getStyle(this.element,'font-size')||"100%";
['em','px','%'].each(function(fontSizeType){
if(fontSize.indexOf(fontSizeType)>0){
effect.fontSize=parseFloat(fontSize);
effect.fontSizeType=fontSizeType;
}
});
this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;
this.dims=null;
if(this.options.scaleMode=='box')
this.dims=[this.element.clientHeight,this.element.clientWidth];
if(this.options.scaleMode=='content')
this.dims=[this.element.scrollHeight,this.element.scrollWidth];
if(!this.dims)
this.dims=[this.options.scaleMode.originalHeight,
this.options.scaleMode.originalWidth];
},
update:function(position){
var currentScale=(this.options.scaleFrom/100.0)+(this.factor*position);
if(this.options.scaleContent&&this.fontSize)
this.element.style.fontSize=this.fontSize*currentScale+this.fontSizeType;
this.setDimensions(this.dims[0]*currentScale,this.dims[1]*currentScale);
},
finish:function(position){
if(this.restoreAfterFinish){
var effect=this;
['top','left','width','height','fontSize'].each(function(k){
effect.element.style[k]=effect.originalStyle[k];
});
}
},
setDimensions:function(height,width){
var els=this.element.style;
if(this.options.scaleX)els.width=width+'px';
if(this.options.scaleY)els.height=height+'px';
if(this.options.scaleFromCenter){
var topd=(height-this.dims[0])/2;
var leftd=(width-this.dims[1])/2;
if(this.elementPositioning=='absolute'){
if(this.options.scaleY)els.top=this.originalTop-topd+"px";
if(this.options.scaleX)els.left=this.originalLeft-leftd+"px";
}else{
if(this.options.scaleY)els.top=-topd+"px";
if(this.options.scaleX)els.left=-leftd+"px";
}
}
}
});
Effect.Highlight=Class.create();
Object.extend(Object.extend(Effect.Highlight.prototype,Effect.Base.prototype),{
initialize:function(element){
this.element=$(element);
var options=Object.extend({
startcolor:"#ffff99"
},arguments[1]||{});
this.start(options);
},
setup:function(){
if(this.element.style.display=='none'){this.cancel();return;}
this.oldBgImage=this.element.style.backgroundImage;
this.element.style.backgroundImage="none";
if(!this.options.endcolor)
this.options.endcolor=Element.getStyle(this.element,'background-color').parseColor('#ffffff');
if(typeof this.options.restorecolor=="undefined")
this.options.restorecolor=this.element.style.backgroundColor;
this.colors_base=[
parseInt(this.options.startcolor.slice(1,3),16),
parseInt(this.options.startcolor.slice(3,5),16),
parseInt(this.options.startcolor.slice(5),16)];
this.colors_delta=[
parseInt(this.options.endcolor.slice(1,3),16)-this.colors_base[0],
parseInt(this.options.endcolor.slice(3,5),16)-this.colors_base[1],
parseInt(this.options.endcolor.slice(5),16)-this.colors_base[2]];
},
update:function(position){
var effect=this;var colors=$R(0,2).map(function(i){
return Math.round(effect.colors_base[i]+(effect.colors_delta[i]*position))
});
this.element.style.backgroundColor="#"+
colors[0].toColorPart()+colors[1].toColorPart()+colors[2].toColorPart();
},
finish:function(){
this.element.style.backgroundColor=this.options.restorecolor;
this.element.style.backgroundImage=this.oldBgImage;
}
});
Effect.ScrollTo=Class.create();
Object.extend(Object.extend(Effect.ScrollTo.prototype,Effect.Base.prototype),{
initialize:function(element){
this.element=$(element);
this.start(arguments[1]||{});
},
setup:function(){
Position.prepare();
var offsets=Position.cumulativeOffset(this.element);
var max=window.innerHeight?
window.height-window.innerHeight:
document.body.scrollHeight-
(document.documentElement.clientHeight?
document.documentElement.clientHeight:document.body.clientHeight);
this.scrollStart=Position.deltaY;
this.delta=(offsets[1]>max?max:offsets[1])-this.scrollStart;
},
update:function(position){
Position.prepare();
window.scrollTo(Position.deltaX,
this.scrollStart+(position*this.delta));
}
});
Effect.Fade=function(element){
var oldOpacity=Element.getInlineOpacity(element);
var options=Object.extend({
from:Element.getOpacity(element)||1.0,
to:0.0,
afterFinishInternal:function(effect)
{if(effect.options.to==0){
Element.hide(effect.element);
Element.setInlineOpacity(effect.element,oldOpacity);
}
}
},arguments[1]||{});
return new Effect.Opacity(element,options);
}
Effect.Appear=function(element){
var options=Object.extend({
from:(Element.getStyle(element,"display")=="none"?0.0:Element.getOpacity(element)||0.0),
to:1.0,
beforeSetup:function(effect)
{Element.setOpacity(effect.element,effect.options.from);
Element.show(effect.element);}
},arguments[1]||{});
return new Effect.Opacity(element,options);
}
Effect.Puff=function(element){
element=$(element);
var oldOpacity=Element.getInlineOpacity(element);
var oldPosition=element.style.position;
return new Effect.Parallel(
[new Effect.Scale(element,200,
{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),
new Effect.Opacity(element,{sync:true,to:0.0})],
Object.extend({duration:1.0,
beforeSetupInternal:function(effect)
{effect.effects[0].element.style.position='absolute';},
afterFinishInternal:function(effect)
{Element.hide(effect.effects[0].element);
effect.effects[0].element.style.position=oldPosition;
Element.setInlineOpacity(effect.effects[0].element,oldOpacity);}
},arguments[1]||{})
);
}
Effect.BlindUp=function(element){
element=$(element);
Element.makeClipping(element);
return new Effect.Scale(element,0,
Object.extend({scaleContent:false,
scaleX:false,
restoreAfterFinish:true,
afterFinishInternal:function(effect)
{
Element.hide(effect.element);
Element.undoClipping(effect.element);
}
},arguments[1]||{})
);
}
Effect.BlindDown=function(element){
element=$(element);
var oldHeight=element.style.height;
var elementDimensions=Element.getDimensions(element);
return new Effect.Scale(element,100,
Object.extend({scaleContent:false,
scaleX:false,
scaleFrom:0,
scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},
restoreAfterFinish:true,
afterSetup:function(effect){
Element.makeClipping(effect.element);
effect.element.style.height="0px";
Element.show(effect.element);
},
afterFinishInternal:function(effect){
Element.undoClipping(effect.element);
effect.element.style.height=oldHeight;
}
},arguments[1]||{})
);
}
Effect.SwitchOff=function(element){
element=$(element);
var oldOpacity=Element.getInlineOpacity(element);
return new Effect.Appear(element,{
duration:0.4,
from:0,
transition:Effect.Transitions.flicker,
afterFinishInternal:function(effect){
new Effect.Scale(effect.element,1,{
duration:0.3,scaleFromCenter:true,
scaleX:false,scaleContent:false,restoreAfterFinish:true,
beforeSetup:function(effect){
Element.makePositioned(effect.element);
Element.makeClipping(effect.element);
},
afterFinishInternal:function(effect){
Element.hide(effect.element);
Element.undoClipping(effect.element);
Element.undoPositioned(effect.element);
Element.setInlineOpacity(effect.element,oldOpacity);
}
})
}
});
}
Effect.DropOut=function(element){
element=$(element);
var oldTop=element.style.top;
var oldLeft=element.style.left;
var oldOpacity=Element.getInlineOpacity(element);
return new Effect.Parallel(
[new Effect.MoveBy(element,100,0,{sync:true}),
new Effect.Opacity(element,{sync:true,to:0.0})],
Object.extend(
{duration:0.5,
beforeSetup:function(effect){
Element.makePositioned(effect.effects[0].element);},
afterFinishInternal:function(effect){
Element.hide(effect.effects[0].element);
Element.undoPositioned(effect.effects[0].element);
effect.effects[0].element.style.left=oldLeft;
effect.effects[0].element.style.top=oldTop;
Element.setInlineOpacity(effect.effects[0].element,oldOpacity);}
},arguments[1]||{}));
}
Effect.Shake=function(element){
element=$(element);
var oldTop=element.style.top;
var oldLeft=element.style.left;
return new Effect.MoveBy(element,0,20,
{duration:0.05,afterFinishInternal:function(effect){
new Effect.MoveBy(effect.element,0,-40,
{duration:0.1,afterFinishInternal:function(effect){
new Effect.MoveBy(effect.element,0,40,
{duration:0.1,afterFinishInternal:function(effect){
new Effect.MoveBy(effect.element,0,-40,
{duration:0.1,afterFinishInternal:function(effect){
new Effect.MoveBy(effect.element,0,40,
{duration:0.1,afterFinishInternal:function(effect){
new Effect.MoveBy(effect.element,0,-20,
{duration:0.05,afterFinishInternal:function(effect){
Element.undoPositioned(effect.element);
effect.element.style.left=oldLeft;
effect.element.style.top=oldTop;
}})}})}})}})}})}});
}
Effect.SlideDown=function(element){
element=$(element);
Element.cleanWhitespace(element);
var oldInnerBottom=element.firstChild.style.bottom;
var elementDimensions=Element.getDimensions(element);
return new Effect.Scale(element,100,
Object.extend({scaleContent:false,
scaleX:false,
scaleFrom:0,
scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},
restoreAfterFinish:true,
afterSetup:function(effect){
Element.makePositioned(effect.element.firstChild);
if(window.opera)effect.element.firstChild.style.top="";
Element.makeClipping(effect.element);
element.style.height='0';
Element.show(element);
},
afterUpdateInternal:function(effect){
effect.element.firstChild.style.bottom=
(effect.dims[0]-effect.element.clientHeight)+'px';},
afterFinishInternal:function(effect){
Element.undoClipping(effect.element);
Element.undoPositioned(effect.element.firstChild);
effect.element.firstChild.style.bottom=oldInnerBottom;}
},arguments[1]||{})
);
}
Effect.SlideUp=function(element){
element=$(element);
Element.cleanWhitespace(element);
var oldInnerBottom=element.firstChild.style.bottom;
return new Effect.Scale(element,0,
Object.extend({scaleContent:false,
scaleX:false,
scaleMode:'box',
scaleFrom:100,
restoreAfterFinish:true,
beforeStartInternal:function(effect){
Element.makePositioned(effect.element.firstChild);
if(window.opera)effect.element.firstChild.style.top="";
Element.makeClipping(effect.element);
Element.show(element);
},
afterUpdateInternal:function(effect){
effect.element.firstChild.style.bottom=
(effect.dims[0]-effect.element.clientHeight)+'px';},
afterFinishInternal:function(effect){
Element.hide(effect.element);
Element.undoClipping(effect.element);
Element.undoPositioned(effect.element.firstChild);
effect.element.firstChild.style.bottom=oldInnerBottom;}
},arguments[1]||{})
);
}
Effect.Squish=function(element){
return new Effect.Scale(element,window.opera?1:0,
{restoreAfterFinish:true,
beforeSetup:function(effect){
Element.makeClipping(effect.element);},
afterFinishInternal:function(effect){
Element.hide(effect.element);
Element.undoClipping(effect.element);}
});
}
Effect.Grow=function(element){
element=$(element);
var options=arguments[1]||{};
var elementDimensions=Element.getDimensions(element);
var originalWidth=elementDimensions.width;
var originalHeight=elementDimensions.height;
var oldTop=element.style.top;
var oldLeft=element.style.left;
var oldHeight=element.style.height;
var oldWidth=element.style.width;
var oldOpacity=Element.getInlineOpacity(element);
var direction=options.direction||'center';
var moveTransition=options.moveTransition||Effect.Transitions.sinoidal;
var scaleTransition=options.scaleTransition||Effect.Transitions.sinoidal;
var opacityTransition=options.opacityTransition||Effect.Transitions.full;
var initialMoveX,initialMoveY;
var moveX,moveY;
switch(direction){
case 'top-left':
initialMoveX=initialMoveY=moveX=moveY=0;
break;
case 'top-right':
initialMoveX=originalWidth;
initialMoveY=moveY=0;
moveX=-originalWidth;
break;
case 'bottom-left':
initialMoveX=moveX=0;
initialMoveY=originalHeight;
moveY=-originalHeight;
break;
case 'bottom-right':
initialMoveX=originalWidth;
initialMoveY=originalHeight;
moveX=-originalWidth;
moveY=-originalHeight;
break;
case 'center':
initialMoveX=originalWidth/2;
initialMoveY=originalHeight/2;
moveX=-originalWidth/2;
moveY=-originalHeight/2;
break;
}
return new Effect.MoveBy(element,initialMoveY,initialMoveX,{
duration:0.01,
beforeSetup:function(effect){
Element.hide(effect.element);
Element.makeClipping(effect.element);
Element.makePositioned(effect.element);
},
afterFinishInternal:function(effect){
new Effect.Parallel(
[new Effect.Opacity(effect.element,{sync:true,to:1.0,from:0.0,transition:opacityTransition}),
new Effect.MoveBy(effect.element,moveY,moveX,{sync:true,transition:moveTransition}),
new Effect.Scale(effect.element,100,{
scaleMode:{originalHeight:originalHeight,originalWidth:originalWidth},
sync:true,scaleFrom:window.opera?1:0,transition:scaleTransition,restoreAfterFinish:true})
],Object.extend({
beforeSetup:function(effect){
effect.effects[0].element.style.height=0;
Element.show(effect.effects[0].element);
},
afterFinishInternal:function(effect){
var el=effect.effects[0].element;
var els=el.style;
Element.undoClipping(el);
Element.undoPositioned(el);
els.top=oldTop;
els.left=oldLeft;
els.height=oldHeight;
els.width=originalWidth+'px';
Element.setInlineOpacity(el,oldOpacity);
}
},options)
)
}
});
}
Effect.Shrink=function(element){
element=$(element);
var options=arguments[1]||{};
var originalWidth=element.clientWidth;
var originalHeight=element.clientHeight;
var oldTop=element.style.top;
var oldLeft=element.style.left;
var oldHeight=element.style.height;
var oldWidth=element.style.width;
var oldOpacity=Element.getInlineOpacity(element);
var direction=options.direction||'center';
var moveTransition=options.moveTransition||Effect.Transitions.sinoidal;
var scaleTransition=options.scaleTransition||Effect.Transitions.sinoidal;
var opacityTransition=options.opacityTransition||Effect.Transitions.none;
var moveX,moveY;
switch(direction){
case 'top-left':
moveX=moveY=0;
break;
case 'top-right':
moveX=originalWidth;
moveY=0;
break;
case 'bottom-left':
moveX=0;
moveY=originalHeight;
break;
case 'bottom-right':
moveX=originalWidth;
moveY=originalHeight;
break;
case 'center':
moveX=originalWidth/2;
moveY=originalHeight/2;
break;
}
return new Effect.Parallel(
[new Effect.Opacity(element,{sync:true,to:0.0,from:1.0,transition:opacityTransition}),
new Effect.Scale(element,window.opera?1:0,{sync:true,transition:scaleTransition,restoreAfterFinish:true}),
new Effect.MoveBy(element,moveY,moveX,{sync:true,transition:moveTransition})
],Object.extend({
beforeStartInternal:function(effect){
Element.makePositioned(effect.effects[0].element);
Element.makeClipping(effect.effects[0].element);
},
afterFinishInternal:function(effect){
var el=effect.effects[0].element;
var els=el.style;
Element.hide(el);
Element.undoClipping(el);
Element.undoPositioned(el);
els.top=oldTop;
els.left=oldLeft;
els.height=oldHeight;
els.width=oldWidth;
Element.setInlineOpacity(el,oldOpacity);
}
},options)
);
}
Effect.Pulsate=function(element){
element=$(element);
var options=arguments[1]||{};
var oldOpacity=Element.getInlineOpacity(element);
var transition=options.transition||Effect.Transitions.sinoidal;
var reverser=function(pos){return transition(1-Effect.Transitions.pulse(pos))};
reverser.bind(transition);
return new Effect.Opacity(element,
Object.extend(Object.extend({duration:3.0,from:0,
afterFinishInternal:function(effect){Element.setInlineOpacity(effect.element,oldOpacity);}
},options),{transition:reverser}));
}
Effect.Fold=function(element){
element=$(element);
var originalTop=element.style.top;
var originalLeft=element.style.left;
var originalWidth=element.style.width;
var originalHeight=element.style.height;
Element.makeClipping(element);
return new Effect.Scale(element,5,Object.extend({
scaleContent:false,
scaleX:false,
afterFinishInternal:function(effect){
new Effect.Scale(element,1,{
scaleContent:false,
scaleY:false,
afterFinishInternal:function(effect){
Element.hide(effect.element);
Element.undoClipping(effect.element);
effect.element.style.top=originalTop;
effect.element.style.left=originalLeft;
effect.element.style.width=originalWidth;
effect.element.style.height=originalHeight;
}});
}},arguments[1]||{}));
}
var Autocompleter={}
Autocompleter.Base=function(){};
Autocompleter.Base.prototype={
baseInitialize:function(element,update,options){
this.element=$(element);
this.update=$(update);
this.hasFocus=false;
this.changed=false;
this.active=false;
this.index=0;
this.entryCount=0;
if(this.setOptions)
this.setOptions(options);
else
this.options=options||{};
this.options.paramName=this.options.paramName||this.element.name;
this.options.tokens=this.options.tokens||[];
this.options.frequency=this.options.frequency||0.4;
this.options.minChars=this.options.minChars||1;
this.options.onShow=this.options.onShow||
function(element,update){
if(!update.style.position||update.style.position=='absolute'){
update.style.position='absolute';
Position.clone(element,update,{setHeight:false,offsetTop:element.offsetHeight});
}
Effect.Appear(update,{duration:0.15});
};
this.options.onHide=this.options.onHide||
function(element,update){new Effect.Fade(update,{duration:0.15})};
if(typeof(this.options.tokens)=='string')
this.options.tokens=new Array(this.options.tokens);
this.observer=null;
this.element.setAttribute('autocomplete','off');
Element.hide(this.update);
Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));
Event.observe(this.element,"keypress",this.onKeyPress.bindAsEventListener(this));
},
show:function(){
if(Element.getStyle(this.update,'display')=='none')this.options.onShow(this.element,this.update);
if(!this.iefix&&(navigator.appVersion.indexOf('MSIE')>0)&&(Element.getStyle(this.update,'position')=='absolute')){
new Insertion.After(this.update,
'<iframe id="'+this.update.id+'_iefix" '+
'style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+
'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');
this.iefix=$(this.update.id+'_iefix');
}
if(this.iefix)setTimeout(this.fixIEOverlapping.bind(this),50);
},
fixIEOverlapping:function(){
Position.clone(this.update,this.iefix);
this.iefix.style.zIndex=1;
this.update.style.zIndex=2;
Element.show(this.iefix);
},
hide:function(){
this.stopIndicator();
if(Element.getStyle(this.update,'display')!='none')this.options.onHide(this.element,this.update);
if(this.iefix)Element.hide(this.iefix);
},
startIndicator:function(){
if(this.options.indicator)Element.show(this.options.indicator);
},
stopIndicator:function(){
if(this.options.indicator)Element.hide(this.options.indicator);
},
onKeyPress:function(event){
if(this.active)
switch(event.keyCode){
case Event.KEY_TAB:
case Event.KEY_RETURN:
this.selectEntry();
Event.stop(event);
case Event.KEY_ESC:
this.hide();
this.active=false;
Event.stop(event);
return;
case Event.KEY_LEFT:
case Event.KEY_RIGHT:
return;
case Event.KEY_UP:
this.markPrevious();
this.render();
if(navigator.appVersion.indexOf('AppleWebKit')>0)Event.stop(event);
return;
case Event.KEY_DOWN:
this.markNext();
this.render();
if(navigator.appVersion.indexOf('AppleWebKit')>0)Event.stop(event);
return;
}
else
if(event.keyCode==Event.KEY_TAB||event.keyCode==Event.KEY_RETURN)
return;
this.changed=true;
this.hasFocus=true;
if(this.observer)clearTimeout(this.observer);
this.observer=
setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000);
},
onHover:function(event){
var element=Event.findElement(event,'LI');
if(this.index!=element.autocompleteIndex)
{
this.index=element.autocompleteIndex;
this.render();
}
Event.stop(event);
},
onClick:function(event){
var element=Event.findElement(event,'LI');
this.index=element.autocompleteIndex;
this.selectEntry();
this.hide();
},
onBlur:function(event){
setTimeout(this.hide.bind(this),250);
this.hasFocus=false;
this.active=false;
},
render:function(){
if(this.entryCount>0){
for(var i=0;i<this.entryCount;i++)
this.index==i?
Element.addClassName(this.getEntry(i),"selected"):
Element.removeClassName(this.getEntry(i),"selected");
if(this.hasFocus){
this.show();
this.active=true;
}
}else{
this.active=false;
this.hide();
}
},
markPrevious:function(){
if(this.index>0)this.index--
else this.index=this.entryCount-1;
},
markNext:function(){
if(this.index<this.entryCount-1)this.index++
else this.index=0;
},
getEntry:function(index){
return this.update.firstChild.childNodes[index];
},
getCurrentEntry:function(){
return this.getEntry(this.index);
},
selectEntry:function(){
this.active=false;
this.updateElement(this.getCurrentEntry());
},
updateElement:function(selectedElement){
if(this.options.updateElement){
this.options.updateElement(selectedElement);
return;
}
var value=Element.collectTextNodesIgnoreClass(selectedElement,'informal');
var lastTokenPos=this.findLastToken();
if(lastTokenPos!=-1){
var newValue=this.element.value.substr(0,lastTokenPos+1);
var whitespace=this.element.value.substr(lastTokenPos+1).match(/^\s+/);
if(whitespace)
newValue+=whitespace[0];
this.element.value=newValue+value;
}else{
this.element.value=value;
}
this.element.focus();
if(this.options.afterUpdateElement)
this.options.afterUpdateElement(this.element,selectedElement);
},
updateChoices:function(choices){
if(!this.changed&&this.hasFocus){
this.update.innerHTML=choices;
Element.cleanWhitespace(this.update);
Element.cleanWhitespace(this.update.firstChild);
if(this.update.firstChild&&this.update.firstChild.childNodes){
this.entryCount=
this.update.firstChild.childNodes.length;
for(var i=0;i<this.entryCount;i++){
var entry=this.getEntry(i);
entry.autocompleteIndex=i;
this.addObservers(entry);
}
}else{
this.entryCount=0;
}
this.stopIndicator();
this.index=0;
this.render();
}
},
addObservers:function(element){
Event.observe(element,"mouseover",this.onHover.bindAsEventListener(this));
Event.observe(element,"click",this.onClick.bindAsEventListener(this));
},
onObserverEvent:function(){
this.changed=false;
if(this.getToken().length>=this.options.minChars){
this.startIndicator();
this.getUpdatedChoices();
}else{
this.active=false;
this.hide();
}
},
getToken:function(){
var tokenPos=this.findLastToken();
if(tokenPos!=-1)
var ret=this.element.value.substr(tokenPos+1).replace(/^\s+/,'').replace(/\s+$/,'');
else
var ret=this.element.value;
return/\n/.test(ret)?'':ret;
},
findLastToken:function(){
var lastTokenPos=-1;
for(var i=0;i<this.options.tokens.length;i++){
var thisTokenPos=this.element.value.lastIndexOf(this.options.tokens[i]);
if(thisTokenPos>lastTokenPos)
lastTokenPos=thisTokenPos;
}
return lastTokenPos;
}
}
Ajax.Autocompleter=Class.create();
Object.extend(Object.extend(Ajax.Autocompleter.prototype,Autocompleter.Base.prototype),{
initialize:function(element,update,url,options){
this.baseInitialize(element,update,options);
this.options.asynchronous=true;
this.options.onComplete=this.onComplete.bind(this);
this.options.defaultParams=this.options.parameters||null;
this.url=url;
},
getUpdatedChoices:function(){
entry=encodeURIComponent(this.options.paramName)+'='+
encodeURIComponent(this.getToken());
this.options.parameters=this.options.callback?
this.options.callback(this.element,entry):entry;
if(this.options.defaultParams)
this.options.parameters+='&'+this.options.defaultParams;
new Ajax.Request(this.url,this.options);
},
onComplete:function(request){
this.updateChoices(request.responseText);
}
});
Autocompleter.Local=Class.create();
Autocompleter.Local.prototype=Object.extend(new Autocompleter.Base(),{
initialize:function(element,update,array,options){
this.baseInitialize(element,update,options);
this.options.array=array;
},
getUpdatedChoices:function(){
this.updateChoices(this.options.selector(this));
},
setOptions:function(options){
this.options=Object.extend({
choices:10,
partialSearch:true,
partialChars:2,
ignoreCase:true,
fullSearch:false,
selector:function(instance){
var ret=[];
var partial=[];
var entry=instance.getToken();
var count=0;
for(var i=0;i<instance.options.array.length&&
ret.length<instance.options.choices;i++){
var elem=instance.options.array[i];
var foundPos=instance.options.ignoreCase?
elem.toLowerCase().indexOf(entry.toLowerCase()):
elem.indexOf(entry);
while(foundPos!=-1){
if(foundPos==0&&elem.length!=entry.length){
ret.push("<li><strong>"+elem.substr(0,entry.length)+"</strong>"+
elem.substr(entry.length)+"</li>");
break;
}else if(entry.length>=instance.options.partialChars&&
instance.options.partialSearch&&foundPos!=-1){
if(instance.options.fullSearch||/\s/.test(elem.substr(foundPos-1,1))){
partial.push("<li>"+elem.substr(0,foundPos)+"<strong>"+
elem.substr(foundPos,entry.length)+"</strong>"+elem.substr(
foundPos+entry.length)+"</li>");
break;
}
}
foundPos=instance.options.ignoreCase?
elem.toLowerCase().indexOf(entry.toLowerCase(),foundPos+1):
elem.indexOf(entry,foundPos+1);
}
}
if(partial.length)
ret=ret.concat(partial.slice(0,instance.options.choices-ret.length))
return "<ul>"+ret.join('')+"</ul>";
}
},options||{});
}
});
Field.scrollFreeActivate=function(field){
setTimeout(function(){
Field.activate(field);
},1);
}
Ajax.InPlaceEditor=Class.create();
Ajax.InPlaceEditor.defaultHighlightColor="#FFFF99";
Ajax.InPlaceEditor.prototype={
initialize:function(element,url,options){
this.url=url;
this.element=$(element);
this.options=Object.extend({
okText:"ok",
cancelText:"cancel",
savingText:"Saving...",
clickToEditText:"Click to edit",
okText:"ok",
rows:1,
onComplete:function(transport,element){
new Effect.Highlight(element,{startcolor:this.options.highlightcolor});
},
onFailure:function(transport){
alert("Error communicating with the server: "+transport.responseText.stripTags());
},
callback:function(form){
return Form.serialize(form);
},
handleLineBreaks:true,
loadingText:'Loading...',
savingClassName:'inplaceeditor-saving',
loadingClassName:'inplaceeditor-loading',
formClassName:'inplaceeditor-form',
highlightcolor:Ajax.InPlaceEditor.defaultHighlightColor,
highlightendcolor:"#FFFFFF",
externalControl:null,
ajaxOptions:{}
},options||{});
if(!this.options.formId&&this.element.id){
this.options.formId=this.element.id+"-inplaceeditor";
if($(this.options.formId)){
this.options.formId=null;
}
}
if(this.options.externalControl){
this.options.externalControl=$(this.options.externalControl);
}
this.originalBackground=Element.getStyle(this.element,'background-color');
if(!this.originalBackground){
this.originalBackground="transparent";
}
this.element.title=this.options.clickToEditText;
this.onclickListener=this.enterEditMode.bindAsEventListener(this);
this.mouseoverListener=this.enterHover.bindAsEventListener(this);
this.mouseoutListener=this.leaveHover.bindAsEventListener(this);
Event.observe(this.element,'click',this.onclickListener);
Event.observe(this.element,'mouseover',this.mouseoverListener);
Event.observe(this.element,'mouseout',this.mouseoutListener);
if(this.options.externalControl){
Event.observe(this.options.externalControl,'click',this.onclickListener);
Event.observe(this.options.externalControl,'mouseover',this.mouseoverListener);
Event.observe(this.options.externalControl,'mouseout',this.mouseoutListener);
}
},
enterEditMode:function(evt){
if(this.saving)return;
if(this.editing)return;
this.editing=true;
this.onEnterEditMode();
if(this.options.externalControl){
Element.hide(this.options.externalControl);
}
Element.hide(this.element);
this.createForm();
this.element.parentNode.insertBefore(this.form,this.element);
Field.scrollFreeActivate(this.editField);
if(evt){
Event.stop(evt);
}
return false;
},
createForm:function(){
this.form=document.createElement("form");
this.form.id=this.options.formId;
Element.addClassName(this.form,this.options.formClassName)
this.form.onsubmit=this.onSubmit.bind(this);
this.createEditField();
if(this.options.textarea){
var br=document.createElement("br");
this.form.appendChild(br);
}
okButton=document.createElement("input");
okButton.type="submit";
okButton.value=this.options.okText;
this.form.appendChild(okButton);
cancelLink=document.createElement("a");
cancelLink.href="#";
cancelLink.appendChild(document.createTextNode(this.options.cancelText));
cancelLink.onclick=this.onclickCancel.bind(this);
this.form.appendChild(cancelLink);
},
hasHTMLLineBreaks:function(string){
if(!this.options.handleLineBreaks)return false;
return string.match(/<br/i)||string.match(/<p>/i);
},
convertHTMLLineBreaks:function(string){
return string.replace(/<br>/gi,"\n").replace(/<br\/>/gi, "\n").replace(/<\/p>/gi,"\n").replace(/<p>/gi,"");
},
createEditField:function(){
var text;
if(this.options.loadTextURL){
text=this.options.loadingText;
}else{
text=this.getText();
}
if(this.options.rows==1&&!this.hasHTMLLineBreaks(text)){
this.options.textarea=false;
var textField=document.createElement("input");
textField.type="text";
textField.name="value";
textField.value=text;
textField.style.backgroundColor=this.options.highlightcolor;
var size=this.options.size||this.options.cols||0;
if(size!=0)textField.size=size;
this.editField=textField;
}else{
this.options.textarea=true;
var textArea=document.createElement("textarea");
textArea.name="value";
textArea.value=this.convertHTMLLineBreaks(text);
textArea.rows=this.options.rows;
textArea.cols=this.options.cols||40;
this.editField=textArea;
}
if(this.options.loadTextURL){
this.loadExternalText();
}
this.form.appendChild(this.editField);
},
getText:function(){
return this.element.innerHTML;
},
loadExternalText:function(){
Element.addClassName(this.form,this.options.loadingClassName);
this.editField.disabled=true;
new Ajax.Request(
this.options.loadTextURL,
Object.extend({
asynchronous:true,
onComplete:this.onLoadedExternalText.bind(this)
},this.options.ajaxOptions)
);
},
onLoadedExternalText:function(transport){
Element.removeClassName(this.form,this.options.loadingClassName);
this.editField.disabled=false;
this.editField.value=transport.responseText.stripTags();
},
onclickCancel:function(){
this.onComplete();
this.leaveEditMode();
return false;
},
onFailure:function(transport){
this.options.onFailure(transport);
if(this.oldInnerHTML){
this.element.innerHTML=this.oldInnerHTML;
this.oldInnerHTML=null;
}
return false;
},
onSubmit:function(){
var form=this.form;
var value=this.editField.value;
this.onLoading();
new Ajax.Updater(
{
success:this.element,
failure:null
},
this.url,
Object.extend({
parameters:this.options.callback(form,value),
onComplete:this.onComplete.bind(this),
onFailure:this.onFailure.bind(this)
},this.options.ajaxOptions)
);
if(arguments.length>1){
Event.stop(arguments[0]);
}
return false;
},
onLoading:function(){
this.saving=true;
this.removeForm();
this.leaveHover();
this.showSaving();
},
showSaving:function(){
this.oldInnerHTML=this.element.innerHTML;
this.element.innerHTML=this.options.savingText;
Element.addClassName(this.element,this.options.savingClassName);
this.element.style.backgroundColor=this.originalBackground;
Element.show(this.element);
},
removeForm:function(){
if(this.form){
if(this.form.parentNode)Element.remove(this.form);
this.form=null;
}
},
enterHover:function(){
if(this.saving)return;
this.element.style.backgroundColor=this.options.highlightcolor;
if(this.effect){
this.effect.cancel();
}
Element.addClassName(this.element,this.options.hoverClassName)
},
leaveHover:function(){
if(this.options.backgroundColor){
this.element.style.backgroundColor=this.oldBackground;
}
Element.removeClassName(this.element,this.options.hoverClassName)
if(this.saving)return;
this.effect=new Effect.Highlight(this.element,{
startcolor:this.options.highlightcolor,
endcolor:this.options.highlightendcolor,
restorecolor:this.originalBackground
});
},
leaveEditMode:function(){
Element.removeClassName(this.element,this.options.savingClassName);
this.removeForm();
this.leaveHover();
this.element.style.backgroundColor=this.originalBackground;
Element.show(this.element);
if(this.options.externalControl){
Element.show(this.options.externalControl);
}
this.editing=false;
this.saving=false;
this.oldInnerHTML=null;
this.onLeaveEditMode();
},
onComplete:function(transport){
this.leaveEditMode();
this.options.onComplete.bind(this)(transport,this.element);
},
onEnterEditMode:function(){},
onLeaveEditMode:function(){},
dispose:function(){
if(this.oldInnerHTML){
this.element.innerHTML=this.oldInnerHTML;
}
this.leaveEditMode();
Event.stopObserving(this.element,'click',this.onclickListener);
Event.stopObserving(this.element,'mouseover',this.mouseoverListener);
Event.stopObserving(this.element,'mouseout',this.mouseoutListener);
if(this.options.externalControl){
Event.stopObserving(this.options.externalControl,'click',this.onclickListener);
Event.stopObserving(this.options.externalControl,'mouseover',this.mouseoverListener);
Event.stopObserving(this.options.externalControl,'mouseout',this.mouseoutListener);
}
}
};
var Droppables={
drops:[],
remove:function(element){
this.drops=this.drops.reject(function(d){return d.element==element});
},
add:function(element){
element=$(element);
var options=Object.extend({
greedy:true,
hoverclass:null
},arguments[1]||{});
if(options.containment){
options._containers=[];
var containment=options.containment;
if((typeof containment=='object')&&
(containment.constructor==Array)){
containment.each(function(c){options._containers.push($(c))});
}else{
options._containers.push($(containment));
}
}
Element.makePositioned(element);
options.element=element;
this.drops.push(options);
},
isContained:function(element,drop){
var parentNode=element.parentNode;
return drop._containers.detect(function(c){return parentNode==c});
},
isAffected:function(pX,pY,element,drop){
return(
(drop.element!=element)&&
((!drop._containers)||
this.isContained(element,drop))&&
((!drop.accept)||
(Element.Class.has_any(element,drop.accept)))&&
Position.within(drop.element,pX,pY));
},
deactivate:function(drop){
if(drop.hoverclass)
Element.Class.remove(drop.element,drop.hoverclass);
this.last_active=null;
},
activate:function(drop){
if(this.last_active)this.deactivate(this.last_active);
if(drop.hoverclass)
Element.Class.add(drop.element,drop.hoverclass);
this.last_active=drop;
},
show:function(event,element){
if(!this.drops.length)return;
var pX=Event.pointerX(event);
var pY=Event.pointerY(event);
Position.prepare();
var i=this.drops.length-1;do{
var drop=this.drops[i];
if(this.isAffected(pX,pY,element,drop)){
if(drop.onHover)
drop.onHover(element,drop.element,Position.overlap(drop.overlap,drop.element));
if(drop.greedy){
this.activate(drop);
return;
}
}
}while(i--);
if(this.last_active)this.deactivate(this.last_active);
},
fire:function(event,element){
if(!this.last_active)return;
Position.prepare();
if(this.isAffected(Event.pointerX(event),Event.pointerY(event),element,this.last_active))
if(this.last_active.onDrop)
this.last_active.onDrop(element,this.last_active.element,event);
},
reset:function(){
if(this.last_active)
this.deactivate(this.last_active);
}
}
var Draggables={
observers:[],
addObserver:function(observer){
this.observers.push(observer);
},
removeObserver:function(element){
this.observers=this.observers.reject(function(o){return o.element==element});
},
notify:function(eventName,draggable){
this.observers.invoke(eventName,draggable);
}
}
var Draggable=Class.create();
Draggable.prototype={
initialize:function(element){
var options=Object.extend({
handle:false,
starteffect:function(element){
new Effect.Opacity(element,{duration:0.2,from:1.0,to:0.7});
},
reverteffect:function(element,top_offset,left_offset){
var dur=Math.sqrt(Math.abs(top_offset^2)+Math.abs(left_offset^2))*0.02;
new Effect.MoveBy(element,-top_offset,-left_offset,{duration:dur});
},
endeffect:function(element){
new Effect.Opacity(element,{duration:0.2,from:0.7,to:1.0});
},
zindex:1000,
revert:false
},arguments[1]||{});
this.element=$(element);
if(options.handle&&(typeof options.handle=='string'))
this.handle=Element.Class.childrenWith(this.element,options.handle)[0];
if(!this.handle)this.handle=$(options.handle);
if(!this.handle)this.handle=this.element;
Element.makePositioned(this.element);
this.offsetX=0;
this.offsetY=0;
this.originalLeft=this.currentLeft();
this.originalTop=this.currentTop();
this.originalX=this.element.offsetLeft;
this.originalY=this.element.offsetTop;
this.options=options;
this.active=false;
this.dragging=false;
this.eventMouseDown=this.startDrag.bindAsEventListener(this);
this.eventMouseUp=this.endDrag.bindAsEventListener(this);
this.eventMouseMove=this.update.bindAsEventListener(this);
this.eventKeypress=this.keyPress.bindAsEventListener(this);
this.registerEvents();
},
destroy:function(){
Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);
this.unregisterEvents();
},
registerEvents:function(){
Event.observe(document,"mouseup",this.eventMouseUp);
Event.observe(document,"mousemove",this.eventMouseMove);
Event.observe(document,"keypress",this.eventKeypress);
Event.observe(this.handle,"mousedown",this.eventMouseDown);
},
unregisterEvents:function(){
},
currentLeft:function(){
return parseInt(this.element.style.left||'0');
},
currentTop:function(){
return parseInt(this.element.style.top||'0')
},
startDrag:function(event){
if(Event.isLeftClick(event)){
var src=Event.element(event);
if(src.tagName&&(
src.tagName=='INPUT'||
src.tagName=='SELECT'||
src.tagName=='BUTTON'||
src.tagName=='TEXTAREA'))return;
this.active=true;
var pointer=[Event.pointerX(event),Event.pointerY(event)];
var offsets=Position.cumulativeOffset(this.element);
this.offsetX=(pointer[0]-offsets[0]);
this.offsetY=(pointer[1]-offsets[1]);
Event.stop(event);
}
},
finishDrag:function(event,success){
this.active=false;
this.dragging=false;
if(this.options.ghosting){
Position.relativize(this.element);
Element.remove(this._clone);
this._clone=null;
}
if(success)Droppables.fire(event,this.element);
Draggables.notify('onEnd',this);
var revert=this.options.revert;
if(revert&&typeof revert=='function')revert=revert(this.element);
if(revert&&this.options.reverteffect){
this.options.reverteffect(this.element,
this.currentTop()-this.originalTop,
this.currentLeft()-this.originalLeft);
}else{
this.originalLeft=this.currentLeft();
this.originalTop=this.currentTop();
}
if(this.options.zindex)
this.element.style.zIndex=this.originalZ;
if(this.options.endeffect)
this.options.endeffect(this.element);
Droppables.reset();
},
keyPress:function(event){
if(this.active){
if(event.keyCode==Event.KEY_ESC){
this.finishDrag(event,false);
Event.stop(event);
}
}
},
endDrag:function(event){
if(this.active&&this.dragging){
this.finishDrag(event,true);
Event.stop(event);
}
this.active=false;
this.dragging=false;
},
draw:function(event){
var pointer=[Event.pointerX(event),Event.pointerY(event)];
var offsets=Position.cumulativeOffset(this.element);
offsets[0]-=this.currentLeft();
offsets[1]-=this.currentTop();
var style=this.element.style;
if((!this.options.constraint)||(this.options.constraint=='horizontal'))
style.left=(pointer[0]-offsets[0]-this.offsetX)+"px";
if((!this.options.constraint)||(this.options.constraint=='vertical'))
style.top=(pointer[1]-offsets[1]-this.offsetY)+"px";
if(style.visibility=="hidden")style.visibility="";
},
update:function(event){
if(this.active){
if(!this.dragging){
var style=this.element.style;
this.dragging=true;
if(Element.getStyle(this.element,'position')=='')
style.position="relative";
if(this.options.zindex){
this.originalZ=parseInt(Element.getStyle(this.element,'z-index')||0);
style.zIndex=this.options.zindex;
}
if(this.options.ghosting){
this._clone=this.element.cloneNode(true);
Position.absolutize(this.element);
this.element.parentNode.insertBefore(this._clone,this.element);
}
Draggables.notify('onStart',this);
if(this.options.starteffect)this.options.starteffect(this.element);
}
Droppables.show(event,this.element);
this.draw(event);
if(this.options.change)this.options.change(this);
if(navigator.appVersion.indexOf('AppleWebKit')>0)window.scrollBy(0,0);
Event.stop(event);
}
}
}
var SortableObserver=Class.create();
SortableObserver.prototype={
initialize:function(element,observer){
this.element=$(element);
this.observer=observer;
this.lastValue=Sortable.serialize(this.element);
},
onStart:function(){
this.lastValue=Sortable.serialize(this.element);
},
onEnd:function(){
Sortable.unmark();
if(this.lastValue!=Sortable.serialize(this.element))
this.observer(this.element)
}
}
var Sortable={
sortables:new Array(),
options:function(element){
element=$(element);
return this.sortables.detect(function(s){return s.element==element});
},
destroy:function(element){
element=$(element);
this.sortables.findAll(function(s){return s.element==element}).each(function(s){
Draggables.removeObserver(s.element);
s.droppables.each(function(d){Droppables.remove(d)});
s.draggables.invoke('destroy');
});
this.sortables=this.sortables.reject(function(s){return s.element==element});
},
create:function(element){
element=$(element);
var options=Object.extend({
element:element,
tag:'li',
dropOnEmpty:false,
tree:false,
overlap:'vertical',
constraint:'vertical',
containment:element,
handle:false,
only:false,
hoverclass:null,
ghosting:false,
format:null,
onChange:Prototype.emptyFunction,
onUpdate:Prototype.emptyFunction
},arguments[1]||{});
this.destroy(element);
var options_for_draggable={
revert:true,
ghosting:options.ghosting,
constraint:options.constraint,
handle:options.handle};
if(options.starteffect)
options_for_draggable.starteffect=options.starteffect;
if(options.reverteffect)
options_for_draggable.reverteffect=options.reverteffect;
else
if(options.ghosting)options_for_draggable.reverteffect=function(element){
element.style.top=0;
element.style.left=0;
};
if(options.endeffect)
options_for_draggable.endeffect=options.endeffect;
if(options.zindex)
options_for_draggable.zindex=options.zindex;
var options_for_droppable={
overlap:options.overlap,
containment:options.containment,
hoverclass:options.hoverclass,
onHover:Sortable.onHover,
greedy:!options.dropOnEmpty
}
Element.cleanWhitespace(element);
options.draggables=[];
options.droppables=[];
if(options.dropOnEmpty){
Droppables.add(element,
{containment:options.containment,onHover:Sortable.onEmptyHover,greedy:false});
options.droppables.push(element);
}
(this.findElements(element,options)||[]).each(function(e){
var handle=options.handle?
Element.Class.childrenWith(e,options.handle)[0]:e;
options.draggables.push(
new Draggable(e,Object.extend(options_for_draggable,{handle:handle})));
Droppables.add(e,options_for_droppable);
options.droppables.push(e);
});
this.sortables.push(options);
Draggables.addObserver(new SortableObserver(element,options.onUpdate));
},
findElements:function(element,options){
if(!element.hasChildNodes())return null;
var elements=[];
$A(element.childNodes).each(function(e){
if(e.tagName&&e.tagName==options.tag.toUpperCase()&&
(!options.only||(Element.Class.has(e,options.only))))
elements.push(e);
if(options.tree){
var grandchildren=this.findElements(e,options);
if(grandchildren)elements.push(grandchildren);
}
});
return(elements.length>0?elements.flatten():null);
},
onHover:function(element,dropon,overlap){
if(overlap>0.5){
Sortable.mark(dropon,'before');
if(dropon.previousSibling!=element){
var oldParentNode=element.parentNode;
element.style.visibility="hidden";
dropon.parentNode.insertBefore(element,dropon);
if(dropon.parentNode!=oldParentNode)
Sortable.options(oldParentNode).onChange(element);
Sortable.options(dropon.parentNode).onChange(element);
}
}else{
Sortable.mark(dropon,'after');
var nextElement=dropon.nextSibling||null;
if(nextElement!=element){
var oldParentNode=element.parentNode;
element.style.visibility="hidden";
dropon.parentNode.insertBefore(element,nextElement);
if(dropon.parentNode!=oldParentNode)
Sortable.options(oldParentNode).onChange(element);
Sortable.options(dropon.parentNode).onChange(element);
}
}
},
onEmptyHover:function(element,dropon){
if(element.parentNode!=dropon){
var oldParentNode=element.parentNode;
dropon.appendChild(element);
Sortable.options(oldParentNode).onChange(element);
Sortable.options(dropon).onChange(element);
}
},
unmark:function(){
if(Sortable._marker)Element.hide(Sortable._marker);
},
mark:function(dropon,position){
var sortable=Sortable.options(dropon.parentNode);
if(sortable&&!sortable.ghosting)return;
if(!Sortable._marker){
Sortable._marker=$('dropmarker')||document.createElement('DIV');
Element.hide(Sortable._marker);
Element.Class.add(Sortable._marker,'dropmarker');
Sortable._marker.style.position='absolute';
document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);
}
var offsets=Position.cumulativeOffset(dropon);
Sortable._marker.style.top=offsets[1]+'px';
if(position=='after')Sortable._marker.style.top=(offsets[1]+dropon.clientHeight)+'px';
Sortable._marker.style.left=offsets[0]+'px';
Element.show(Sortable._marker);
},
serialize:function(element){
element=$(element);
var sortableOptions=this.options(element);
var options=Object.extend({
tag:sortableOptions.tag,
only:sortableOptions.only,
name:element.id,
format:sortableOptions.format||/^[^_]*_(.*)$/
},arguments[1]||{});
return $(this.findElements(element,options)||[]).collect(function(item){
return(encodeURIComponent(options.name)+"[]="+
encodeURIComponent(item.id.match(options.format)?item.id.match(options.format)[1]:''));
}).join("&");
}
}
RegExp.escape=function(text){
if(!arguments.callee.sRE){
var specials=[
'/','.','*','+','?','|','^','$',
'(',')','[',']','{','}','\\'
];
arguments.callee.sRE=new RegExp(
'(\\'+specials.join('|\\')+')','g'
);
}
return text.replace(arguments.callee.sRE,'\\$1');
}
Collection=Class.create();
Collection.prototype={
initialize:function(intitalEnumerable){
this._contents=intitalEnumerable?$A(intitalEnumerable).toArray():[];
this._syncLength();
Object.extend(this,Enumerable);
this.uniqueItemIndexer=0;
},
0:function(){
throw("use itemAt(index).  Remember, this isn't really an 'Array'");
},
1:function(){
throw("use itemAt(index).  Remember, this isn't really an 'Array'");
},
2:function(){
throw("use itemAt(index).  Remember, this isn't really an 'Array'");
},
_each:function(iterator){
var len=this.length;
for(var i=0;i<len;i++)
iterator(this._contents[i]);
},
push:function(item){
item.uniqueItemIndexer=this.uniqueItemIndexed++;
this._contents.push(item);
this._syncLength();
if(this.onPush){
this.onPush();
}
},
pushAt:function(item,index){
item.uniqueItemIndexer=this.uniqueItemIndexed++;
this._contents.splice(index,0,item);
this._syncLength();
if(this.onPush){
this.onPush();
}
},
pop:function(){
this._contents.pop();
this._syncLength();
},
itemAt:function(index){
return this._contents[index];
},
remove:function(objectToRemove){
this.removeElement(objectToRemove)
},
removeElement:function(objectToRemove){
this._contents.splice(this.indexOf(objectToRemove),1);
this._syncLength();
},
_syncLength:function(){
this.length=this._contents.length;
},
first:function(){
return this.itemAt(0);
},
last:function(){
return this.itemAt(this.length-1);
},
indexOf:function(object){
var indexFound=-1;
var result=
this.find(function(item,index){
indexFound=index;
return item==object;
})
if(result==null||indexFound==-1){
return false;
}
return indexFound;
},
findIndicesOfSubset:function(subset){
var me=this;
var indexes=
subset.collect(function(subsetItem){
return me.indexOf(subsetItem);
});
return indexes;
},
inspect:function(){
return '['+this.map(Object.inspect).join(', ')+']';
},
toString:function(){
return this.inspect();
},
isEmpty:function(){
return this.length==0;
}
};
var U=
{
blank:function(object){
return object==undefined||object==null||(typeof object=="string"&&object.length==0)
},
getFormElementByName:function(form,name){
var result=
$A(form.elements).find(function(formElement){
return formElement.name==name;
});
return result;
},
nullIfBlank:function(value){
return !value||value.length==0?null:value;
},
handleTransparentPngs:function(container){
if(!document.all)return;
var imgs=U.elt("img",container);
for(var i=0;i<imgs.length;++i){
var img=imgs[i];
if(img.src.indexOf(".png")>-1){
var height=img.height;
var width=img.width;
if(height==0||width==0){
var tempImg=document.createElement("IMG");
tempImg.src=img.src;
height=tempImg.height;
width=tempImg.width;
}
if(!img.style.width)img.style.width=width;
if(!img.style.height)img.style.height=height;
img.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src='+img.src+',sizingMethod=scale,enabled=1)';
img.src="/images/blank.gif";
}
}
},
findEquivalentPolylineInstance:function(polylineToFind,polylines){
var result=
polylines.find(function(polyline){
if(!polylineToFind.getVertexCount){
alert("Google broke getVertexCount again");
}
var match=polylineToFind.getVertexCount()==polyline.getVertexCount();
if(match){
for(var i=0;i<polyline.getVertexCount();i++){
var myVertex=polylineToFind.getVertex(i);
var otherVertex=polyline.getVertex(i);
match=myVertex.lat()==otherVertex.lat()&&myVertex.lng()==otherVertex.lng();
if(!match){
break;
}
}
}
return match;
});
return result?result:null;
},
removeEquivalentPolylineFromArray:function(polylineToFind,polylines){
var toRemove=U.findEquivalentPolylineInstance(polylineToFind,polylines);
polylines.remove(toRemove);
return toRemove;
},
clearOptions:function(selectElement){
for(var i=selectElement.options.length-1;i>=0;i--){
selectElement.remove(i);
}
},
conditionalElementSwitch:function(container,condition,showIfTrue,showIfFalse){
if(condition){
U.findIdInElement(container,showIfTrue).style.display="";
U.findIdInElement(container,showIfFalse).style.display="none";
}else{
U.findIdInElement(container,showIfTrue).style.display="none";
U.findIdInElement(container,showIfFalse).style.display="";
}
},
toggleDisplay:function(element,duration){
if(element.style.display=="none"){
if(duration)Effect.BlindDown(element,{duration:duration});
else Element.show(element);
}else{
if(duration)Effect.BlindUp(element,{duration:duration});
else Element.hide(element);
}
},
showAndHide:function(container,idToShow,idToHide){
U.findIdInElement(container,idToShow).style.display="";
U.findIdInElement(container,idToHide).style.display="none";
},
findIdInElement:function(container,id){
var elements=U.elt("*",container);
var elementsLength=elements.length;
for(var i=0;i<elementsLength;++i){
if(elements[i].id==id)return elements[i];
}
},
findClassNamesInElement:function(container,className){
var elements=U.elt("*",container);
var returnElements=[];
var elementsLength=elements.length;
for(var i=0;i<elementsLength;++i){
var classNames=elements[i].className.split(" ");
for(var j=0;j<classNames.length;++j){
if(classNames[j]==className){
returnElements.push(elements[i]);
}
}
}
return returnElements;
},
replaceClassName:function(object,replaceClassName,withClassName){
replaceRegExp=new RegExp(replaceClassName,"ig");
object.className=object.className.replace(replaceRegExp,withClassName);
},
elt:function(name,container)
{
if(!container)
{
container=document;
}
return container.getElementsByTagName(name);
},
eln:function(name)
{
return document.getElementsByName(name)[0];
},
inner:function(id,html)
{
$(id).innerHTML=html;
},
metersInMiles:function(meters){
return Math.ceil((meters/ 1609.344)* this._getMeterDivisor(meters))/ this._getMeterDivisor(meters);
},
metersInKilometers:function(meters){
return Math.ceil(meters/(1000/ this._getMeterDivisor(meters)))/this._getMeterDivisor(meters);
},
_getMeterDivisor:function(meters){
var divisor=1;
if(meters<10000000)divisor=10;
if(meters<100000)divisor=100;
if(meters<1000)divisor=1000;
return divisor;
},
comparePoints:function(point1,point2,span,threshold)
{
if(!point1||!point2||point1==null||point2==null)
{
return true;
}
var w=span.width;
var h=span.height;
var xd=Math.abs(point1.x-point2.x);
var yd=Math.abs(point1.y-point2.y);
if((xd<(w*threshold))||(yd<(h*threshold)))
{
return false;
}
return true;
},
highlight:function(id)
{
new Effect.Highlight($(id),{startcolor:"#FFFFFF",endcolor:"#0000C5",restorecolor:"#0000C5",duration:0.4});
setTimeout(function(){
new Effect.Highlight($(id),{startcolor:"#0000C5",endcolor:"#FFFFFF",restorecolor:"#FFFFFF",duration:0.4});
}.bind(this),500);
},
addMessage:function(message)
{
var messages=$("walk_messages");
if(messages==null)
{
return;
}
if(messages.innerHTML.length>0)
{
message="<hr />"+message+"<br/><br/><br/><br/>";
}
messages.innerHTML+=message;
messages.scrollTop=9999;
U.highlight(messages.id);
},
heightWithBorders:function(elem){
return Element.getDimensions(elem).height;
},
widthWithBorders:function(elem){
return Element.getDimensions(elem).width;
},
height:function(elem){
var height=U.heightWithBorders(elem);
height=height-U.computedStyleAsNum(elem,"paddingTop","padding-top");
height=height-U.computedStyleAsNum(elem,"paddingBottom","padding-bottom");
height=height-U.computedStyleAsNum(elem,"borderTopWidth","border-top-width");
height=height-U.computedStyleAsNum(elem,"borderBottomWidth","border-bottom-width");
return height;
},
width:function(elem){
var width=U.widthWithBorders(elem);
width=width-U.computedStyleAsNum(elem,"paddingLeft","padding-left");
width=width-U.computedStyleAsNum(elem,"paddingRight","padding-right");
width=width-U.computedStyleAsNum(elem,"borderLeftWidth","border-left-width");
width=width-U.computedStyleAsNum(elem,"borderRightWidth","border-right-width");
return width;
},
computedStyleAsNum:function(elem,ieProp,mozillaProp){
var computedStyle=U.getElementsComputedStyle(elem,ieProp,mozillaProp);
computedStyle=computedStyle.substr(0,computedStyle.length-2);
if(isNaN(computedStyle)){
return 0;
}
return parseInt(computedStyle);
},
getElementsComputedStyle:function(htmlElement,cssProperty,mozillaEquivalentCSS){
if(arguments.length==2)
mozillaEquivalentCSS=cssProperty;
var el=$(htmlElement);
if(el.currentStyle)
return el.currentStyle[cssProperty];
else
return document.defaultView.getComputedStyle(el,null).getPropertyValue(mozillaEquivalentCSS);
},
ensureVisible:function(container,element)
{
var containerHeight=U.heightWithBorders(container);
var containerWidth=U.widthWithBorders(container);
var containerOffset=Position.cumulativeOffset(container);
var elementHeight=U.heightWithBorders(element);
var elementWidth=U.widthWithBorders(element);
var elementOffset=Position.cumulativeOffset(element);
var verticalOffsetFromContainer=elementOffset[1]-containerOffset[1];
var containerVerticalScroll=container.scrollTop;
if(containerVerticalScroll>verticalOffsetFromContainer){
container.scrollTop=verticalOffsetFromContainer;
}
else if(containerVerticalScroll<verticalOffsetFromContainer-containerHeight+elementHeight){
container.scrollTop=verticalOffsetFromContainer-containerHeight+elementHeight;
}
var horizontalOffsetFromContainer=elementOffset[0]-containerOffset[0];
var containerHorizontalScroll=container.scrollLeft;
if(containerHorizontalScroll>horizontalOffsetFromContainer){
container.scrollLeft=horizontalOffsetFromContainer;
}
else if(containerHorizontalScroll<horizontalOffsetFromContainer-containerWidth+elementWidth){
container.scrollLeft=horizontalOffsetFromContainer-containerWidth+elementWidth;
}
},
displayEdit:function(type,container)
{
U.display(type,container,true);
},
displayRead:function(type,container)
{
U.display(type,container,false);
},
display:function(type,container,edit)
{
var display="read";
var hide="edit";
if(edit)
{
display="edit";
hide="read";
}
var children=container.childNodes;
var childrenLength=children.length;
for(var i=0;i<childrenLength;i++)
{
if(children[i].className)
{
if(children[i].className.indexOf(type+"_"+display)>-1)
{
children[i].className=children[i].className.replace("nodisplay","");
children[i].style.display="";
}
else if(children[i].className.indexOf(type+"_"+hide)>-1)
{
children[i].style.display="none";
}
}
U.display(type,children[i],edit);
}
},
getWindowDimension:function(getHeight)
{
var height=0;
var width=0;
if(typeof(window.innerWidth)=='number')
{
height=window.innerHeight;
width=window.innerWidth;
}
else if(document.documentElement&&
(document.documentElement.clientWidth||document.documentElement.clientHeight))
{
height=document.documentElement.clientHeight;
width=document.documentElement.clientWidth;
}
else if(document.body&&(document.body.clientWidth||document.body.clientHeight))
{
height=document.body.clientHeight;
width=document.body.clientWidth;
}
return getHeight?height:width;
},
getWindowHeight:function()
{
return U.getWindowDimension(true);
},
getWindowHeightSubjectToMin:function(minHeight)
{
var height=U.getWindowHeight();
return(height<minHeight)?minHeight:height;
},
getWindowWidth:function()
{
return U.getWindowDimension(false);
},
openWindow:function(url,height,width,options){
options=options||"resizable=yes,toolbar=no,location=no,status=no";
var uniquename="";
w=open(url,uniquename,'scrollbars=yes,menubar=no,height='+height+',width='+width+','+options);
if(!w)
{
alert("CommunityWalk was unable to open the window. You may have a pop-up blocker that is preventing this window from opening.");
return null;
}
return w;
},
buildIcon:function(src,identifier)
{
icon=new GIcon();
icon.image=src+"/"+identifier+".png";
icon.printImage=src+"/"+identifier+".gif";
icon.mozPrintImage=src+"/"+identifier+".png";
icon.shadow=U.getShadowSrc(src,identifier);
if(identifier=="i"){
var customSrc=src.replace(/\//ig,'_');
var iconInfo=CwCustomIcons[customSrc];
icon.iconSize=new GSize(iconInfo.markerWidth,iconInfo.markerHeight);
icon.shadowSize=new GSize(iconInfo.containerWidth,iconInfo.containerHeight);
icon.iconAnchor=new GPoint(iconInfo.markerOffsetX,iconInfo.markerOffsetY);
icon.infoWindowAnchor=new GPoint(iconInfo.windowOffsetX,iconInfo.windowOffsetY);
}else if(identifier=="dot"){
icon.iconSize=new GSize(11,11);
icon.iconAnchor=new GPoint(5,6);
icon.infoWindowAnchor=new GPoint(8,2);
}else if(identifier=="sm"){
icon.iconSize=new GSize(20,29);
icon.shadowSize=new GSize(43,30);
icon.iconAnchor=new GPoint(8,26);
icon.infoWindowAnchor=new GPoint(8,2);
}else if(identifier<=35||isNaN(identifier)){
icon.iconSize=new GSize(22,36);
icon.shadowSize=new GSize(44,35);
icon.iconAnchor=new GPoint(11,34);
icon.infoWindowAnchor=new GPoint(10,2);
}else{
icon.iconSize=new GSize(36,40);
icon.shadowSize=new GSize(72,40);
icon.iconAnchor=new GPoint(17,36);
icon.infoWindowAnchor=new GPoint(15,2);
}
return icon;
},
getShadowSrc:function(src,identifier){
if(identifier=="i"){
return src+"/shadow.png";
}else if(identifier=="dot"){
return "";
}else if(identifier=="sm"){
return "/images/s_shadow.png";
}else if(identifier<=35||isNaN(identifier)){
return "http://www.google.com/mapfiles/shadow50.png";
}else{
return "http://www.google.com/maplinedraw?width=72&height=40&path=u@c@BAB?BATO?A?AA?K?AABGSFA@K?E?C@C@UN?@B@T?T?FAw@?z@A{@?~@A{@?|@A{@?|@A{@?~@A{@?|@A{@?|@A{@?~@A{@?|@A{@?z@Aw@?h@AS?RAO?NAI?HAE?FAC?}oR&color=0,0,0,191.25&weight=2";
}
},
changeButtonText:function(newText,id)
{
$(id).value=newText;
},
setFrameSrc:function(frameName,href)
{
var iframe=$(frameName);
if(iframe==null){
return;
}
if(document.all)
{
U.setFrameSrcCloneFrame(iframe,href);
}
else
{
U.setFrameSrcReplaceLocation(iframe,href);
}
},
setFrameSrcCloneFrame:function(iframe,href){
setTimeout(function(){
try{
var newIframe=iframe.cloneNode(true);
newIframe.src=href;
var iframeParent=iframe.parentNode;
iframeParent.insertBefore(newIframe,iframe);
iframeParent.removeChild(iframe);
}
catch(e){}
},0);
},
setFrameSrcReplaceLocation:function(iframe,href)
{
setTimeout(function(){
var doc;
if(iframe.contentDocument){
doc=iframe.contentDocument;
}else if(iframe.contentWindow){
doc=iframe.contentWindow.document;
}else if(iframe.document){
doc=iframe.document;
}
if(href.indexOf("/")!=0)
{
href="/iframe/external?url="+href;
}
if(doc){
doc.location.replace(href);
}
},0);
},
storeButtonText:function(id)
{
var button=$(id);
if(undefined==button.storedValue){
button.storedValue=button.value;
}
},
restoreButtonText:function(id){
var button=$(id);
if(undefined !=button.storedValue){
button.value=button.storedValue;
}
},
getUrlHash:function(){
var hash=location.hash;
if(hash.length==0){
return "";
}
if(hash.charAt(0)=="#"){
hash=hash.substr(1);
}
return hash;
},
serializeForUrlHash:function(obj){
var hash="#";
var parameters=[];
for(var key in obj){
if(obj[key]==null)continue;
parameters.push(key+"="+JSON.stringify(obj[key]));
}
hash+=parameters.join("&");
return hash;
},
getParamHash:function(){
if(location.href.indexOf("?")==-1)return{};
var paramArray=location.href.substr(location.href.indexOf("?")+1).split("&");
var paramHash={};
for(var i=0;i<paramArray.length;++i){
var keyValue=paramArray[i].split("=");
paramHash[keyValue[0]]=keyValue[1].replace(/%20/ig,' ');
}
return paramHash;
},
deserializeUrlHash:function(){
var urlHash=U.getUrlHash();
if(urlHash.length==0)return null;
var parameters=urlHash.split("&");
var returnHash={};
for(var i=0;i<parameters.length;i++){
var keyValuePair=parameters[i].split("=");
returnHash[keyValuePair[0]]=JSON.parse(keyValuePair[1]);
}
return returnHash;
},
setQuietUrlHash:function(hash){
var currentHashLength=U.getUrlHash().length;
var href=location.href.substr(0,location.href.length-currentHashLength);
if(href[href.length-1]=="#"){
href=href.substr(0,href.length-2);
}
location.replace(href+"#"+hash);
},
determineObjectCountInHash:function(hash){
return U.hashToArray(hash).length;
},
hashToArray:function(hash){
var array=[];
for(var i in hash){
if(i!="extend"&&hash[i]!=undefined){
array.push(hash[i]);
}
}
return array;
},
unmarshalJson:function(json){
return eval('('+json+')');
},
serializeObject:function(baseName,object){
if(!object)return "";
var serialized=[];
var id=object.id;
for(var key in object){
if(typeof object[key]=="object"){
var value=U.serializeObject(baseName+"["+key+"]",object[key]);
if(value.length>0){
serialized.push(value);
}
}
else if(object[key]!=undefined&&object[key]!=null){
serialized.push(baseName+"["+key+"]="+U.urlEncode(""+object[key]));
}
}
return serialized.join("&");
},
urlEncode:function(string){
return string
.replace(/\%/ig,"%25")
.replace(/\\/ig,"%5C")
.replace(/\$/ig,"%24")
.replace(/&/ig,"%26")
.replace(/\+/ig,"%2B")
.replace(/,/ig,"%2C")
.replace(/\//ig,"%2F")
.replace(/\:/ig,"%3A")
.replace(/\;/ig,"%3B")
.replace(/\=/ig,"%3D")
.replace(/\?/ig,"%3F")
.replace(/\@/ig,"%40")
.replace(/\ /ig,"%20")
.replace(/\"/ig,"%22")
.replace(/\</ig,"%3C")
.replace(/\>/ig,"%3E")
.replace(/\#/ig,"%23")
.replace(/\{/ig,"%7B")
.replace(/\}/ig,"%7D")
.replace(/\|/ig,"%7C")
.replace(/\^/ig,"%5E")
.replace(/\~/ig,"%7E")
.replace(/\[/ig,"%5B")
.replace(/\]/ig,"%5D")
.replace(/\`/ig,"%60");
},
setFieldValueWhenItExists:function(fieldName,value,tries){
if(!tries)tries=100;
if(!fieldName)return;
if($(fieldName)){
U.setFieldValue(fieldName,value);
}
else if(tries>1){
setTimeout(function(){U.setFieldValueWhenItExists(fieldName,value,tries-1);},200);
}
},
setFieldValue:function(fieldName,value){
if($(fieldName))$(fieldName).value=value;
},
debug:function(obj){
var info=[];
if(typeof obj in["string","number"]){
return obj;
}else{
for(property in obj)
if(typeof obj[property]=="function")
info.push(property+' => function');
else
info.push(property+' => '+
(typeof obj[property]=="string"?
'"'+obj[property]+'"':
obj[property]));
}
return("'"+obj+"' #"+typeof obj+
": {"+info.join(", ")+"}");
},
scrollToElement:function(element){
var fromTop=Position.cumulativeOffset(element)[1];
var offset=window.pageYOffset||document.documentElement.scrollTop;
if(fromTop<offset)
{
window.scroll(0,fromTop-100);
}
},
getScaledPhotoDimensions:function(ratio,maxWidth,maxHeight){
var dimensions={width:maxWidth,height:maxHeight};
if(ratio>(maxWidth/maxHeight)){
dimensions.width=maxWidth;
dimensions.height=maxWidth/ratio;
}else{
dimensions.width=maxHeight*ratio;
dimensions.height=maxHeight;
}
return dimensions;
},
getMap:function(){
return window.walkApp?window.walkApp.map:window.walkExplorer.map;
},
translateGoogleGeocodedResults:function(result,calculateZoom){
if(result.Status.code!=200)return[];
var results=result.Placemark;
var resultLength=results.length;
var translatedResults=[];
for(var i=0;i<resultLength;++i){
var translatedResult={
country:'',
region:'',
area:'',
subarea:'',
street1:'',
street2:'',
zipcode:'',
phonenumber:''
};
translatedResult.link_title=results[i].address;
var address=results[i].AddressDetails;
if(calculateZoom)translatedResult.zoom=ZoomLevels()[address.Accuracy];
if(address.Country){
address=address.Country;
translatedResult.country=address.CountryNameCode;
if(address.AdministrativeArea){
address=address.AdministrativeArea;
translatedResult.region=address.AdministrativeAreaName;
if(address.SubAdministrativeArea){
address=address.SubAdministrativeArea;
translatedResult.area=address.SubAdministrativeAreaName;
}
if(address.Locality){
address=address.Locality;
translatedResult.area=address.LocalityName;
}
if(address.Thoroughfare){
translatedResult.street1=address.Thoroughfare.ThoroughfareName;
}
if(address.PostalCode){
translatedResult.zipcode=address.PostalCode.PostalCodeNumber;
}
}
}
translatedResult.x=results[i].Point.coordinates[0];
translatedResult.y=results[i].Point.coordinates[1];
translatedResults.push(translatedResult);
}
return translatedResults;
},
trimWhiteSpace:function(string){
if(!string)return string;
return string.replace(/^[\t]*|[\t]*$/ig,"");
}
};
CommandQueue=Class.create();
CommandQueue.END_OF_QUEUE="End of Queue"
CommandQueue.prototype={
initialize:function(server){
if(!server){
throw("please pass in a server proxy");
}
this.server=server;
this.clear();
this.hasFailed=false;
},
processHead:function(){
if(this.contents.length==0){
return;
}
var commandAtHead=this.contents[0];
CwLog.write("process: "+commandAtHead.toString());
this.sendToServer(commandAtHead);
},
sendToServer:function(command){
this.server.sendCommand(command,this.reactToAjaxResponse.bind(this));
},
reactToAjaxResponse:function(success,responseJson){
if(success){
if(responseJson){
this.passCommandResponseFromServerToCommand(responseJson);
}
this.dequeue();
}else{
if(this.hasFailed)return;
if(confirm('The connection to CommunityWalk has either been lost or has slowed down a great deal.\nPlease click "Ok" to refresh the page and ensure that all of your work has been saved.')){
location.reload();
}
}
},
passCommandResponseFromServerToCommand:function(responseJson){
CwLog.write("passing response: "+JSON.stringify(responseJson)+" to command[0]: "+this.contents[0]);
this.contents[0].responseFromServer(responseJson)
},
enqueue:function(command){
var shouldProcess=this.contents.length==0
this.contents.push(command);
CwLog.write("enqueued: "+command.toString()+", queue contents:\n"+this.toString());
command.execute();
if(shouldProcess){
this.processHead(command);
}
},
dequeue:function(){
if(this.contents.length==0){
CwLog.write("dequeue, END OF QUEUE");
return CommandQueue.END_OF_QUEUE;
}
var shifted=this.contents.shift();
CwLog.write("dequeue"+shifted.toString()+", queue contents:\n"+this.toString());
this.processHead();
return shifted;
},
clear:function(){
this.contents=[];
},
toString:function(){
return $A(this.contents).inspect();
}
}
ServerProxy=Class.create();
ServerProxy.TIMEOUT_LENGTH=10000;
ServerProxy.prototype={
initialize:function(timeout){
if(timeout)ServerProxy.TIMEOUT_LENGTH=timeout;
},
sendCommand:function(command,callback){
var ajaxPayload=command.asAjaxPayload();
if(!ajaxPayload){
callback(true);
return;
}
var parameters=ajaxPayload.parameters;
var request=
new Ajax.Request(ajaxPayload.url,
{
parameters:parameters,
onSuccess:function(response){
if(response.responseText.indexOf("AAA_DOWN_FOR_MAINTENANCE_XXX")>-1){
callback(false,null);
}else if(response.responseText.length>0){
var responseJson=JSON.parse(response.responseText);
callback(true,responseJson);
}else{
callback(true,null);
}
}.bind(this),
onFailure:function(response){
callback(false,null);
}.bind(this),
onComplete:function(){
request.completed=true;
}
});
this.currentAjaxRequest=request;
setTimeout(function(){
if(!request.completed){
callback(false,null);
}
},ServerProxy.TIMEOUT_LENGTH);
}
}
CwLog={};
CwLog.shouldLog=false;
CwLog.write=function(msg){
if(CwLog.shouldLog){
GLog.write(msg);
}
}
HTMLColor=Class.create();
HTMLColor.LIGHT_COLOR="FFFFFF";
HTMLColor.DARK_COLOR="000000";
HTMLColor.LIGHT_COLORS=[
"FFFFFF",'33FEFE','A5FBFE','66FE00','72DD89','B1F666','00CBCB','E0B2D0','FF9900'
];
HTMLColor.prototype={
initialize:function(backgroundColor){
this.setColor(backgroundColor);
},
setColor:function(backgroundColor){
backgroundColor=backgroundColor.replace(/#/ig,"").toUpperCase();
this.backgroundColor="#"+backgroundColor;
this.foregroundColor="#"+this.mapColor(backgroundColor);
this.value=backgroundColor;
},
mapColor:function(backgroundColor){
backgroundColor=backgroundColor;
for(var i=0;i<HTMLColor.LIGHT_COLORS.length;++i){
if(HTMLColor.LIGHT_COLORS[i]==backgroundColor)return HTMLColor.DARK_COLOR;
}
return HTMLColor.LIGHT_COLOR;
}
}
var JSON=function(){
var m={
'\b':'\\b',
'\t':'\\t',
'\n':'\\n',
'\f':'\\f',
'\r':'\\r',
'"':'\\"',
'\\':'\\\\'
},
s={
'boolean':function(x){
return String(x);
},
number:function(x){
return isFinite(x)?String(x):'null';
},
string:function(x){
if(/["\\\x00-\x1f]/.test(x)){
x=x.replace(/([\x00-\x1f\\"])/g,function(a,b){
var c=m[b];
if(c){
return c;
}
c=b.charCodeAt();
return '\\u00'+
Math.floor(c/16).toString(16)+
(c%16).toString(16);
});
}
return '"'+x+'"';
},
object:function(x){
if(x){
var a=[],b,f,i,l,v;
if(x instanceof Array){
a[0]='[';
l=x.length;
for(i=0;i<l;i+=1){
v=x[i];
f=s[typeof v];
if(f){
v=f(v);
if(typeof v=='string'){
if(b){
a[a.length]=',';
}
a[a.length]=v;
b=true;
}
}
}
a[a.length]=']';
}else if(x instanceof Object){
a[0]='{';
for(i in x){
v=x[i];
f=s[typeof v];
if(f){
v=f(v);
if(typeof v=='string'){
if(b){
a[a.length]=',';
}
a.push(s.string(i),':',v);
b=true;
}
}
}
a[a.length]='}';
}else{
return;
}
return a.join('');
}
return 'null';
}
};
return{
copyright:'(c)2005 JSON.org',
license:'http://www.JSON.org/license.html',
stringify:function(v){
var f=s[typeof v];
if(f){
v=f(v);
if(typeof v=='string'){
return v;
}
}
return null;
},
parse:function(text){
try{
return !(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(
text.replace(/"(\\.|[^"\\])*"/g,'')))&&
eval('('+text+')');
}catch(e){
return false;
}
}
};
}();
RoundyCorners={
create:function(containedElement,cornerSpecification){
var theWholeEnchilada=document.createElement('table');
var body=document.createElement("tbody");
if(cornerSpecification.className)theWholeEnchilada.className=cornerSpecification.className
theWholeEnchilada.appendChild(body);
theWholeEnchilada.cellPadding=0;
theWholeEnchilada.cellSpacing=0;
var topRow=document.createElement('tr');
var topLeft=this._buildCornerTd(cornerSpecification.topLeft);
var topMiddle=this._buildMiddleTd({
image:cornerSpecification.topMiddle,
repeat:"repeat-x",
color:cornerSpecification.color,
border:cornerSpecification.border,
side:"Top"
});
var topRight=this._buildCornerTd(cornerSpecification.topRight);
topRow.appendChild(topLeft);
topRow.appendChild(topMiddle);
topRow.appendChild(topRight);
var middleRow=document.createElement('tr');
var middleLeft=this._buildMiddleTd({
image:cornerSpecification.middleLeft,
repeat:"repeat-y",
color:cornerSpecification.color,
border:cornerSpecification.border,
side:"Left"
});
var middleMiddle=this._buildMiddleTd({image:cornerSpecification.middleMiddle,repeat:"repeat",color:cornerSpecification.color});
middleMiddle.appendChild(containedElement);
if(cornerSpecification.expandToFit){
middleMiddle.style.width="100%";
}
var middleRight=this._buildMiddleTd({
image:cornerSpecification.middleRight,
repeat:"repeat-y",
color:cornerSpecification.color,
border:cornerSpecification.border,
side:"Right"
});
middleRow.appendChild(middleLeft);
middleRow.appendChild(middleMiddle);
middleRow.appendChild(middleRight);
var bottomRow=document.createElement('tr');
var bottomLeft=this._buildCornerTd(cornerSpecification.bottomLeft);
var bottomMiddle=this._buildMiddleTd({
image:cornerSpecification.bottomMiddle,
repeat:"repeat-x",
color:cornerSpecification.color,
border:cornerSpecification.border,
side:"Bottom"
});
var bottomRight=this._buildCornerTd(cornerSpecification.bottomRight);
bottomRow.appendChild(bottomLeft);
bottomRow.appendChild(bottomMiddle);
bottomRow.appendChild(bottomRight);
body.appendChild(topRow);
body.appendChild(middleRow);
body.appendChild(bottomRow);
return theWholeEnchilada;
},
_buildCornerTd:function(imgSrc){
var td=document.createElement('td');
var img=document.createElement("img");
img.style.display="block";
if(imgSrc.indexOf("png")>-1&&document.all){
img.src="/images/blank.gif";
img.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src='+imgSrc+',enabled=1)';
}else{
img.src=imgSrc;
}
td.appendChild(img);
return td;
},
_buildMiddleTd:function(instructions){
var td=document.createElement('td');
if(instructions.image){
td.style.backgroundImage='url('+instructions.image+')';
if(instructions.repeat)td.style.backgroundRepeat=repeat;
}else if(instructions.color){
td.style.backgroundColor=instructions.color;
if(instructions.border&&instructions.side){
td.style["border"+instructions.side]=instructions.border;
td.innerHTML="&nbsp;";
td.style.lineHeight="1px";
}
}
return td;
},
wrapExistingElement:function(id,cornerSpecification,displayWhenDone){
var element=document.getElementById(id);
var parent=element.parentNode;
var children=parent.childNodes;
var sibling;
for(var i=0;i<children.length;++i){
if(children[i]==element&&i<children.length-1){
sibling=children[i+1];
break;
}
}
parent.removeChild(element);
if(sibling){
parent.insertBefore(this.create(element,cornerSpecification),sibling);
}else{
parent.appendChild(this.create(element,cornerSpecification));
}
if(displayWhenDone)Element.show(id);
},
wrapExistingElementsOfClass:function(container,className,cornerSpecification,displayWhenDone){
var elements=U.findClassNamesInElement(container,className);
for(var i=0;i<elements.length;++i){
var tempId="wrapExistingElementOfClass"+i;
if(!elements[i].id)elements[i].id=tempId;
this.wrapExistingElement(elements[i].id,cornerSpecification,displayWhenDone);
if(elements[i].id==tempId)elements[i].id="";
}
}
};
var StateResolver=
{
SERIALIZATION_ORDER:['MapType','MapZoom','TabId','PointId','PointStyle','CenterLat','CenterLng','PathId'],
deserialize:function(serializedState,toDec){
var order=StateResolver.SERIALIZATION_ORDER;
var orderLength=order.length;
var returnHash={};
var index=0;
for(var i=0;i<orderLength;i++){
var value=null;
var length=0;
if(index<serializedState.length){
length=parseInt(serializedState.charAt(index));
}
if(length>0){
value=serializedState.substr(index+1,length);
}
if(toDec&&value!=null){
if((order[i]=='CenterLat'||order[i]=='CenterLng')){
var decimal=StateResolver.xToDec(value.substr(value.indexOf('.')+1))
while((""+decimal).length<6)decimal="0"+decimal;
returnHash[order[i]]=parseFloat(value.substring(0,value.indexOf('.')+1)+decimal);
}else{
returnHash[order[i]]=StateResolver.xToDec(value);
}
}else{
returnHash[order[i]]=value;
}
index+=length+1;
}
return returnHash;
},
translateToGMapType:function(type)
{
var mapTypes={0:G_NORMAL_MAP,1:G_SATELLITE_MAP,2:G_HYBRID_MAP};
return mapTypes[type]||mapTypes[0];
},
translateFromGMapType:function(type)
{
switch(type)
{
case G_NORMAL_MAP:
return 0;
case G_SATELLITE_MAP:
return 1;
case G_HYBRID_MAP:
return 2;
default:
return 0;
}
},
translateToStyleName:function(styleId)
{
switch(parseInt(styleId||0))
{
case 0:
return "basic";
break;
case 1:
return "photos";
break;
case 2:
return "directions";
break;
case 3:
return "comments";
break;
case 4:
return "basicedit";
break;
case 5:
return "new";
break;
case 6:
return "move";
break;
case 7:
return "noshow";
break;
default:
return "basic";
break;
}
},
translateFromStyleName:function(style)
{
switch(style)
{
case "basic":
return 0;
break;
case "photos":
return 1;
break;
case "directions":
return 2;
break;
case "comments":
return 3;
break;
case "basicedit":
return 4;
break;
case "new":
return 5;
break;
case "move":
return 6;
break;
case "window":
return 7;
break;
case "media":
return 7;
break;
default:
return 0;
break;
}
},
binToDec:function(b)
{
var result=0;
for(var i=0;i<b.length;i++)
{
result+=parseInt(b.charAt(i))*Math.pow(2,((b.length-1)-i));
}
return result;
},
binToX:function(b)
{
var d=StateResolver.binToDec(b);
return StateResolver.decToX(d);
},
decToBin:function(d)
{
var result="";
if(d>=2)
{
result=StateResolver.decToBin((d-(d%2))/2);
}
result+=String(d%2);
return result;
},
decToX:function(d)
{
var result="";
if(d>=64)
{
result=StateResolver.decToX((d-(d%64))/64);
}
result+=String.fromCharCode((d%64)+48);
return result.replace(/[?]/g,"p").replace(/[>]/g,"q");
},
xToDec:function(x)
{
x=x.replace(/[p]/g,"?").replace(/[q]/g,">");
var result=0;
for(var i=0;i<x.length;i++)
{
result+=(x.charCodeAt(i)-48)*Math.pow(64,((x.length-1)-i));
}
return result;
},
xToBin:function(x)
{
var d=StateResolver.xToDec(x);
return StateResolver.decToBin(d);
}
};
ZoomLevel={};
ZoomLevel.WORLD=1;
ZoomLevel.COUNTRY=4;
ZoomLevel.STATE=8;
ZoomLevel.REGION=10;
ZoomLevel.CITY=12;
ZoomLevel.PLANE=14;
ZoomLevel.SMALL_PLANE=15;
ZoomLevel.HOT_AIR_BALLOON=16;
ZoomLevel.LOW_FLYING_HOT_AIR_BALLOON=17;
ZoomLevel.SKY_SCRAPER=18;
ZoomLevel.BIG_BUILDING=19;
ZoomLevel.SMALL_BUILDING=19;
ZoomLevel.MAX=19;
ZoomLevels=function(){
var levels=[];
for(var level in ZoomLevel){
levels.push(ZoomLevel[level]);
}
return levels;
}
WalkMap=Class.create();
WalkMap.USE_CW_OVERLAY=true;
WalkMap.DOUBLECLICK_WAIT=200;
WalkMap.DOUBLECLICK_WAIT_CUSHION=100;
WalkMap.prototype={
initialize:function(container,mapTypes,initialState,doubleClickToZoom){
doubleClickToZoom=true;
this.mapTypes=mapTypes;
this.container=container;
this.container.style.cursor='default';
this._clickZoomEnabled=!doubleClickToZoom;
this.infoWindowOpened=false;
this.movementDisabled=false;
this.listeners=[];
this.lastIdentifier=0;
this.showTitles=false;
this.displayMarkerMessage=$('display_marker_message');
this.overlays=new Collection();
this.markers={};
},
onBitmapReset:function(){},
unload:function(){
this.overlays.each(function(overlay){
this.removeMarker(overlay);
overlay=null;
}.bind(this));
},
instantiateMapAPI:function(state){
this.gmap=new GMap2(this.container,{mapTypes:this.mapTypes});
if(!this._clickZoomEnabled)this.gmap.enableDoubleClickZoom();
this.registerListeners();
this.changeState(state);
this.zoomLevels=[];
var customLevelContained=false;
for(var level in ZoomLevel){
var levelNumber=ZoomLevel[level];
this.zoomLevels.push(levelNumber);
if(levelNumber==state.MapZoom)customLevelContained=true;
}
if(!customLevelContained)this.zoomLevels.push(state.MapZoom);
this.zoomLevels=this.zoomLevels.sort(function(a,b){return a-b;});
this.instantiateZoomSteps();
if(WalkMap.USE_CW_OVERLAY)this.instantiateFastOverlay();
},
instantiateFastOverlay:function(){
this._fastOverlay=new CwOverlay();
this.gmap.addOverlay(this._fastOverlay);
},
registerListeners:function(){
this.mapClickedCount=0;
this.ctrlClicking=false;
this.listeners.push(GEvent.addListener(this.getMapApp(),"click",this.handleMapClick.bind(this)));
this.listeners.push(GEvent.addListener(this.getMapApp(),"infowindowopen",function(){
setTimeout(function(){
this.infoWindowOpened=true;
}.bind(this),WalkMap.DOUBLECLICK_WAIT+WalkMap.DOUBLECLICK_WAIT_CUSHION)
}.bind(this)));
this.listeners.push(GEvent.addListener(this.getMapApp(),"infowindowclose",function(){
setTimeout(function(){
this.infoWindowOpened=false;
}.bind(this),WalkMap.DOUBLECLICK_WAIT+WalkMap.DOUBLECLICK_WAIT_CUSHION)
}.bind(this)));
this.container.onmouseup=this.handleMapMouseUp.bind(this);
},
clearEventListeners:function(){
var length=this.listeners;
for(var i=0;i<length;i++)
{
GEvent.removeListener(this.listeners[i]);
this.listeners[i]=null;
}
},
clickZoomEnabled:function(){
if(!this._clickZoomEnabled)return false;
if(this.infoWindowOpened)return false;
return true;
},
enableClickZoom:function(){
if(WalkMap.USE_CW_OVERLAY)return;
this._clickZoomEnabled=true;
this.container.style.cursor='default';
},
disableClickZoom:function(){
if(WalkMap.USE_CW_OVERLAY)return;
this._clickZoomEnabled=false;
this.container.style.cursor='pointer';
},
instantiateZoomSteps:function(){
this.zoomSteps={};
var zoomLevelPointer=0;
for(var i=0;i<=ZoomLevel.MAX;++i){
if(this.zoomLevels[zoomLevelPointer]<=i){
zoomLevelPointer++;
}
this.zoomSteps[i]=this.zoomLevels[zoomLevelPointer];
}
},
registerKeyHandlers:function(){
},
changeState:function(state){
var center=new GLatLng(parseFloat(state.CenterLat),parseFloat(state.CenterLng));
var zoom=parseInt(state.MapZoom);
var mapType=StateResolver.translateToGMapType(state.MapType);
this.gmap.setCenter(center,zoom,mapType);
},
zoomTo:function(zoom){
if(this.movementDisabled)return;
this.gmap.setZoom(parseInt(zoom));
},
zoomToNextLevel:function(point){
var newZoom=this.zoomSteps[this.getZoomLevel()];
if(point){
this.zooming=true;
this.centerAndZoom(point,newZoom);
}
else{
this.zoomTo(newZoom);
}
},
zoomToPrevLevel:function(point){
var zoom=this.getZoomLevel();
var newFixedLevel=0;
for(var i=0;i<this.zoomLevels.length;++i){
var fixedLevel=this.zoomLevels[i];
if(fixedLevel<zoom&&fixedLevel>newFixedLevel){
newFixedLevel=fixedLevel;
}
}
if(point){
this.centerAndZoom(point,newFixedLevel);
}
else{
this.zoomTo(newFixedLevel);
}
},
gotoLatLng:function(coordinate){
this.getMapApp().panTo(coordinate);
},
getMapApp:function(){
return this.gmap;
},
setHeight:function(height){
this.container.style.height=height+"px";
if(this.gmap){
this.gmap.checkResize();
}
},
getCenterLatLng:function(){
return this.gmap.getCenter();
},
disableDragging:function(){
this.gmap.disableDragging();
},
disableInfoWindow:function(){
this.gmap.disableInfoWindow();
},
centerAndZoom:function(latlng,zoom){
if(this.movementDisabled)return;
if(this.gmap.draggingEnabled()){
this.gmap.setCenter(latlng,zoom);
}else{
this.zoomTo(zoom);
}
},
closeInfoWindow:function(){
this.gmap.closeInfoWindow();
},
centerAtLatLng:function(latlng){
this.gmap.setCenter(latlng);
},
recenterOrPanToLatLng:function(latlng){
if(this.movementDisabled)return;
this.gmap.panTo(latlng);
},
addControl:function(control,position){
this.gmap.addControl(control,position);
},
addMarker:function(marker){
if(!marker.identifier)this.identify(marker);
this.showDisplayMarkerMessage(true);
setTimeout(function(){
if(window.CwMarker&&marker.type==CwMarker.TYPE&&WalkMap.USE_CW_OVERLAY){
this._fastOverlay.addMarker(marker);
}else{
this.gmap.addOverlay(marker);
}
if(marker.getVertexCount){
this.overlays.push(marker);
}else{
this.markers[marker.identifier]=marker;
}
marker.displayed=true;
if(this.showTitles)GEvent.trigger(marker,"mouseover");
this.showDisplayMarkerMessage(false);
}.bind(this),0);
},
identify:function(marker){
this.lastIdentifier++;
marker.identifier=this.lastIdentifier;
},
isShowingInfoWindow:function(){
return !this.gmap.getInfoWindow().isHidden();
},
getZoomLevel:function(){
return this.gmap.getZoom();
},
setMapType:function(type){
this.gmap.setMapType(StateResolver.translateToGMapType(type));
},
getCurrentMapType:function(){
return StateResolver.translateFromGMapType(this.gmap.getCurrentMapType());
},
getMapTypes:function(){
return this.gmap.getMapTypes();
},
findPolylineInstanceEquivalentTo:function(polylineToFind){
var result=U.findEquivalentPolylineInstance(polylineToFind,this.overlays)
return result;
},
removeMarkerByIdentifier:function(markerIdentifier){
if(this.markers[markerIdentifier]){
this.removeMarker(this.markers[markerIdentifier]);
}
},
removeMarker:function(marker){
this.showDisplayMarkerMessage(true);
setTimeout(function(){
if(marker.getVertexCount){
var overlayInstanceToRemove=U.removeEquivalentPolylineFromArray(marker,this.overlays);
this.gmap.removeOverlay(overlayInstanceToRemove);
}else{
if(window.CwMarker&&marker.type==CwMarker.TYPE&&WalkMap.USE_CW_OVERLAY){
this._fastOverlay.removeMarker(marker);
}else{
this.gmap.removeOverlay(marker);
}
delete this.markers[marker.identifier];
}
marker.displayed=false;
this.showDisplayMarkerMessage(false);
}.bind(this),0);
},
removeAllMarkers:function(){
this.gmap.clearOverlays();
},
infoWindowClose:function(){
this.gmap.closeInfoWindow();
},
getBoundsLatLng:function(){
var bounds=this.gmap.getBounds();
bounds.asParams=function(paramName){
var boundingBoxString=paramName+"[top_right_lat]="+this.getNorthEast().lat();
boundingBoxString+="&"+paramName+"[top_right_lng]="+this.getNorthEast().lng();
boundingBoxString+="&"+paramName+"[bottom_left_lat]="+this.getSouthWest().lat();
boundingBoxString+="&"+paramName+"[bottom_left_lng]="+this.getSouthWest().lng();
return boundingBoxString;
}
return bounds;
},
handleMapClick:function(overlay,point){
if(!overlay){
this.infoWindowClose();
}
if(overlay||!this.clickZoomEnabled())return;
},
zoomInClick:function(point){
if(!this.clickZoomEnabled())return;
this.zoomToNextLevel(point);
},
zoomOutClick:function(){
if(!this.clickZoomEnabled()||this.infoWindowOpened){
return;
}
return false;
},
handleMapMouseUp:function(event){
event=event||window.event;
if(event.ctrlKey){
this.ctrlClicking=true;
}
else{
this.ctrlClicking=false;
}
if(event.button==2||this.ctrlClicking){
this.zoomOutClick();
}
if(event.button==1||event.button==0){
++this.mapClickedCount;
setTimeout(function(){
this.mapClickedCount=0;
this.ctrlClicking=false;
this.zooming=false;
}.bind(this),WalkMap.DOUBLECLICK_WAIT+WalkMap.DOUBLECLICK_WAIT_CUSHION);
}
},
setMovementDisabled:function(disable){
this.movementDisabled=disable;
},
showDisplayMarkerMessage:function(starting,message){
if(!this.displayMarkerMessage){
this.displayingMarkerCount=0;
this.displayMarkerMessage=document.createElement("DIV");
this.displayMarkerMessage.style.display="none";
this.displayMarkerMessage.className='map_control';
this.displayMarkerMessage.innerHTML="Working...";
this.displayMarkerMessage.id="display_marker_message";
this.container.appendChild(this.displayMarkerMessage);
}
this.displayingMarkerCount+=starting?1:-1;
if(this.displayingMarkerCount>0){
this.displayMarkerMessage.style.display="block";
}
else{
this.displayMarkerMessage.style.display="none";
}
}
};
WalkMarker={
create:function(latlng,icon,tooltipContents,wrapText,locationId,groupId,offset){
var marker=new GMarker(latlng,icon);
marker.locationId=locationId;
marker.groupId=groupId;
var tooltip=new Tooltip(tooltipContents,wrapText,((!offset||isNaN(offset.height))?marker.getIcon().iconSize:offset),marker.getPoint.bind(marker),locationId,groupId);
GEvent.addListener(marker,"mouseover",tooltip.show.bind(tooltip));
GEvent.addListener(marker,"mouseout",tooltip.hide.bind(tooltip));
GEvent.addListener(marker,"remove",function(){this.hide(true)}.bind(tooltip));
marker.tooltip=tooltip;
marker.withinBounds=this.withinBounds.bind(marker);
marker.replaceTooltipText=this.replaceTooltipText.bind(marker);
return marker;
},
withinBounds:function(bounds){
var point=this.getPoint();
return(point.lng()>bounds.getSouthWest().lng()&&
point.lat()>bounds.getSouthWest().lat()&&
point.lng()<bounds.getNorthEast().lng()&&
point.lat()<bounds.getNorthEast().lat())
},
replaceTooltipText:function(text){
this.tooltip.changeContents(text);
}
}
WalkGLocalResult=Class.create();
WalkGLocalResult.prototype={
initialize:function(gLocalResult){
this.gLocalResult=gLocalResult;
},
asInfo:function(){
var g=this.gLocalResult;
var info={
y:g.lat,
x:g.lng,
street1:g.streetAddress.replace(/'/ig,"&#39;"),
area:g.city.replace(/'/ig,"&#39;"),
region:g.region.replace(/'/ig,"&#39;"),
country:g.country.replace(/'/ig,"&#39;"),
phonenumber:this._getPhoneNumber(),
link_title:this._getLinkTitle(),
title:(g.titleNoFormatting==g.streetAddress?"":g.titleNoFormatting.replace(/'/ig,"&#39;")),
href:g.url.replace(/'/ig,"&#39;")
};
return info;
},
_getPhoneNumber:function(){
if(!this.gLocalResult.phoneNumbers)return "";
for(var i=0;i<this.gLocalResult.phoneNumbers.length;++i){
if(this.gLocalResult.phoneNumbers[i].type=="main"){
return this.gLocalResult.phoneNumbers[i].number;
}
}
return "";
},
_getLinkTitle:function(){
var linkTitle=[];
if(this.gLocalResult.titleNoFormatting!=""&&this.gLocalResult.titleNoFormatting!=this.gLocalResult.streetAddress){
linkTitle.push(this.gLocalResult.titleNoFormatting.replace(/'/ig,"&#39;"));
}
if(this.gLocalResult.streetAddress!=""){
linkTitle.push(this.gLocalResult.streetAddress.replace(/'/ig,"&#39;"));
}
var cityState=[];
if(this.gLocalResult.city!=""){
cityState.push(this.gLocalResult.city.replace(/'/ig,"&#39;"));
}
if(this.gLocalResult.region!=""){
cityState.push(this.gLocalResult.region.replace(/'/ig,"&#39;"));
}
if(this.gLocalResult.country!=""){
cityState.push(this.gLocalResult.country.replace(/'/ig,"&#39;"));
}
if(cityState.length>0)linkTitle.push(cityState.join(", "));
if(this._getPhoneNumber()!=""){
linkTitle.push(this._getPhoneNumber());
}
return linkTitle.join("<br/>");
}
}
Tooltip=Class.create();
Tooltip.tooltipCount=0;
Tooltip.prototype={
initialize:function(tooltipContents,wrapText,offset,currentLatLngFunction,locationId,groupId){
this.locationId=locationId;
this.groupId=groupId;
this.tooltipContents=tooltipContents==undefined?"":tooltipContents;
this.currentLatLngFunction=currentLatLngFunction;
this.isShowing=false;
this.offset=offset;
this.id=Tooltip.tooltipCount;
Tooltip.tooltipCount++;
if(U.getMap().showTitles)this.show(true);
},
changeContents:function(contents){
this.tooltipContents=contents;
if(this.isShowing)Element.hide(this.tooltipDiv);
this.tooltipDiv=null;
if(this.isShowing)this.show(false,this.currentlatlng);
},
show:function(force,latlng){
this.currentlatlng=latlng||this.currentLatLngFunction();
var bitmapCoordinate=U.getMap().getMapApp().fromLatLngToDivPixel(this.currentlatlng);
if(!this.tooltipDiv){
this.tooltipDiv=document.createElement("div");
this.tooltipDiv.id='tooltip_'+this.id;
this.tooltipDiv.style.display="none";
this.tooltipDiv.style.cursor="move";
this.tooltipDiv.style.position="absolute";
this.tooltipDiv.style.padding="0";
this.tooltipDiv.style.margin="0";
var html="<div class='tooltip_background'>";
html+="<div class='fake_text printonly'>"+this.tooltipContents+"</div>";
html+="<div class=\"tooltip\" style='";
if(this.wrapText){
html+="white-space: normal;";
}
html+="'>"+this.tooltipContents+"</div></div>";
this.tooltipDiv.innerHTML=html;
U.getMap().getMapApp().getPane(G_MAP_MARKER_MOUSE_TARGET_PANE).appendChild(this.tooltipDiv);
}
this.tooltipDiv.style.zIndex=GOverlay.getZIndex(this.currentlatlng.lat());
this.originalY=bitmapCoordinate.y;
this.originalX=bitmapCoordinate.x
this.tooltipDiv.style.top=(this.originalY-this.offset.height)+"px";
this.tooltipDiv.style.left=(this.originalX+this.offset.width)+"px";
Element.show(this.tooltipDiv);
this.isShowing=true;
new Draggable(this.tooltipDiv,{
starteffect:function(){},
endeffect:this.handleDrag.bind(this)
});
if(force)this.permanentlyShown=true;
},
handleDrag:function(){
this.offset.height=this.originalY-parseInt(this.tooltipDiv.style.top);
this.offset.width=parseInt(this.tooltipDiv.style.left)-this.originalX;
if(this.locationId&&this.groupId){
walkApp.queue.enqueue(new UpdateTitleOffset(this.locationId,this.groupId,this.offset.height,this.offset.width));
}
U.getMap().getMapApp().getPane(G_MAP_MARKER_MOUSE_TARGET_PANE).removeChild(this.tooltipDiv);
this.tooltipDiv=null;
this.show();
},
hide:function(force){
if(!force&&(U.getMap().showTitles||this.permanentlyShown))return;
if(this.tooltipDiv){
Element.hide(this.tooltipDiv);
}
this.isShowing=false;
this.permanentlyShown=false;
}
}
UpdateTitleOffset=Class.create();
UpdateTitleOffset.prototype={
initialize:function(locationId,groupId,offsetTop,offsetLeft){
this.locationId=locationId;
this.groupId=groupId;
this.offsetTop=offsetTop;
this.offsetLeft=offsetLeft;
},
execute:function(){
},
asAjaxPayload:function(){
return{url:"/locations/update_title_offset/"+this.groupId+"/"+this.locationId,
parameters:"location[title_offset_left]="+this.offsetLeft+"&location[title_offset_top]="+this.offsetTop};
},
responseFromServer:function(responseJson){
},
toString:function(){
return "UpdateTitleOffset: locationId="+this.locationId+", offsetTop="+this.offsetTop+", offsetLeft="+this.offsetLeft;
}
};
function CwOverlay(){}
CwOverlay.prototype={
initialize:function(map){
this.map=map;
this.parentNode=map.getPane(G_MAP_MARKER_PANE);
this.container=document.createElement("div");
this.parentNode.appendChild(this.container);
this._markers={};
},
remove:function(){
this._clearContainer();
this.parentNode.removeChild(this.container);
this.container=null;
this.parentNode=null;
},
copy:function(){
return this;
},
redraw:function(force){
if(!this.ready){
this.ready=true
return;
}
if(force)this._clearContainer();
var bounds=this.map.getBounds();
for(var id in this._markers){
this.showMarker(this._markers[id],bounds);
};
},
addMarker:function(marker){
if(this._markers[marker.locationId])return;
this._markers[marker.locationId]=marker;
this.showMarker(marker,this.map.getBounds());
},
removeMarker:function(marker){
this.hideMarker(marker);
delete this._markers[marker.locationId];
},
showMarker:function(marker,bounds){
var point=marker.getPoint();
if(!bounds.contains(point)){
if(marker.icon){
this.hideMarker(marker);
marker.icon=null;
}
return;
}
if(marker.icon)return;
var icon=marker.renderIcon(this);
},
hideMarker:function(marker){
marker.removeIcon();
},
_clearContainer:function(){
this.container.innerHTML="";
for(var id in this._markers){
this.hideMarker(this._markers[id]);
}
}
}
var CwMarker=Class.create();
CwMarker.TYPE="CwMarker"
CwMarker.prototype={
initialize:function(location,src,identifier,tooltipContents,wrapText,groupId,titleOffset){
this.type=CwMarker.TYPE;
this.location=location;
this._src=src;
this._identifier=identifier;
this._groupId=groupId;
this._titleOffset=titleOffset;
this.locationId=location.id;
this.tooltipContents=tooltipContents;
this.wrapText=wrapText;
this.displayed=false;
},
initializeTooltip:function(tooltipContents,wrapText){
var offset=new GSize((this.icon.size.width/2/1),this.icon.size.height);
this.tooltip=new Tooltip(tooltipContents,wrapText,(this._titleOffset||offset),this.getPoint.bind(this),this.locationId,this._groupId);
GEvent.addListener(this.icon.marker,"mouseover",this.tooltip.show.bind(this.tooltip));
GEvent.addListener(this.icon.marker,"mouseout",this.tooltip.hide.bind(this.tooltip));
GEvent.addListener(this.icon,"remove",function(){this.hide(true)}.bind(this.tooltip));
},
replaceToolTipText:function(text){
this.tooltip.changeContents(text);
},
showTooltip:function(force){
if(this.icon)GEvent.trigger(this.icon.marker,"mouseover",force);
},
hideTooltip:function(force){
if(this.icon)GEvent.trigger(this.icon.marker,"mouseout",force);
},
renderIcon:function(overlay){
this.icon=new CwIcon(this._src,this._identifier,overlay.map,this.getPoint())
this.initializeTooltip(this.tooltipContents,this.wrapText);
GEvent.bindDom(this.icon.marker,"click",this.location,this.location.handleClick);
overlay.container.appendChild(this.icon.container);
this.displayed=true;
},
switchIcon:function(src,identifier){
this._src=src||this._src;
this._identifier=identifier||this._identifier;
if(!this.icon)return;
this.icon.transform(this._src,this._identifier);
},
removeIcon:function(){
if(!this.icon)return;
this.icon.remove();
GEvent.trigger(this.icon,"remove");
this.icon=null;
this.displayed=false;
},
withinBounds:function(bounds){
return bounds.contains(this.getPoint());
},
getPoint:function(){
return this.location.asGLatLng();
},
openInfoWindowHtml:function(html){
this._openInfoWindowWithOpener('openInfoWindowHtml',html);
},
openInfoWindowTabsHtml:function(tabs){
this._openInfoWindowWithOpener('openInfoWindowTabsHtml',tabs);
},
_openInfoWindowWithOpener:function(opener,data){
var iconAttributes=CwIcon.getIconAttributes(this._identifier,this._src);
var offsetY=iconAttributes.markerHeight-iconAttributes.windowOffsetY;
var offsetX=(iconAttributes.markerWidth/2)-iconAttributes.windowOffsetX;
var map=U.getMap().getMapApp();
map.closeInfoWindow();
map[opener](this.getPoint(),data,{pixelOffset:new GSize(-offsetX,-offsetY)});
}
}
var CwIcon=Class.create();
CwIcon.SINGLE_DIGIT_MARKER={
containerHeight:36,
containerWidth:40,
markerHeight:36,
markerWidth:22,
markerOffsetX:11,
markerOffsetY:36,
windowOffsetX:11,
windowOffsetY:2
};
CwIcon.DOUBLE_DIGIT_MARKER={
containerHeight:42,
containerWidth:55,
markerHeight:38,
markerWidth:34,
markerOffsetX:17,
markerOffsetY:42,
windowOffsetX:17,
windowOffsetY:2
};
CwIcon.SMALL_MARKER={
containerHeight:29,
containerWidth:36,
markerHeight:29,
markerWidth:20,
markerOffsetX:10,
markerOffsetY:29,
windowOffsetX:10,
windowOffsetY:2
};
CwIcon.DOT_MARKER={
containerHeight:8,
containerWidth:10,
markerHeight:8,
markerWidth:10,
markerOffsetX:5,
markerOffsetY:8,
windowOffsetX:5,
windowOffsetY:2
};
CwIcon.getIconAttributes=function(identifier,customSrc){
if(customSrc)customSrc=customSrc.replace(/\//ig,'_');
if(identifier=="i")return CwCustomIcons[customSrc];
else if(identifier=="sm")return CwIcon.SMALL_MARKER;
else if(identifier=="dot")return CwIcon.DOT_MARKER;
else if(identifier=="l")return CwIcon.SINGLE_DIGIT_MARKER;
else if(identifier<10)return CwIcon.SINGLE_DIGIT_MARKER;
else return CwIcon.DOUBLE_DIGIT_MARKER;
};
CwIcon.prototype={
initialize:function(src,identifier,map,point){
this.map=map;
this.point=point;
this.src=src;
this.identifier=identifier;
this._initializeDomElements();
this.transform(src,identifier);
},
_initializeDomElements:function(){
this.container=document.createElement("DIV");
this.marker=document.createElement("DIV");
this.text=document.createElement("DIV");
this.container.style.position="absolute";
this.marker.style.position="relative";
this.container.appendChild(this.marker);
this.marker.appendChild(this.text);
this.marker.onmouseover=function(){GEvent.trigger(this.marker,"mouseover")}.bind(this);
this.marker.onmouseout=function(){GEvent.trigger(this.marker,"mouseout")}.bind(this);
this.text.onmouseover=function(){GEvent.trigger(this.marker,"mouseover")}.bind(this);
this.text.onmouseout=function(){GEvent.trigger(this.marker,"mouseout")}.bind(this);
},
remove:function(){
if(this.container.parentNode){
this.container.parentNode.removeChild(this.container);
}
},
transform:function(src,identifier){
var isIcon=src.indexOf("icon")>-1;
this.text.innerHTML=(U.blank(identifier)||isIcon)?"":identifier;
this.container.className="single_digit_marker_icon";
var icon=isIcon?"i":"l";
if(isNaN(identifier)){
icon=identifier||this.identifier;
if(icon=="i"){
this.container.className="custom_icon";
if(document.all){
this.container.background="transparent"
this.container.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src='+src+'/shadow.png,enabled=1)';
}else{
this.container.style.backgroundImage="url("+src+"/shadow.png)";
}
}else if(icon=="sm"){
this.container.className="small_marker_icon";
}else if(icon=="dot"){
this.container.className="dot_marker_icon";
}
this.text.innerHTML="";
}else if(identifier>9&&icon!="i"){
icon="big";
this.container.className="double_digit_marker_icon";
}
var src=src||this.src;
if(this.iconImage)this.marker.removeChild(this.iconImage);
if(this.printImage)this.marker.removeChild(this.printImage);
this.iconImage=document.createElement("img");
var iconSrc=src+'/'+icon+'.png';
if(document.all){
this.iconImage.src="/images/blank.gif";
this.iconImage.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src='+iconSrc+',enabled=1)';
this.iconImage.className="screenonly";
this.printImage=document.createElement("img");
this.printImage.className="printonly";
this.printImage.src=src+'/'+icon+'.gif';
this.marker.insertBefore(this.printImage,this.text);
}else{
this.iconImage.src=iconSrc;
}
this.marker.insertBefore(this.iconImage,this.text);
var iconAttributes=CwIcon.getIconAttributes(icon,src);
this.container.style.width=iconAttributes.containerWidth+"px";
this.container.style.height=iconAttributes.containerHeight+"px";
this.marker.className=src.substr(src.lastIndexOf("/"))+"_"+identifier;
this.marker.style.width=iconAttributes.markerWidth+"px";
this.marker.style.height=iconAttributes.markerHeight+"px";
this.size=new GSize(iconAttributes.markerWidth,iconAttributes.markerHeight);
this.iconPosition=this.map.fromLatLngToDivPixel(this.point);
this.container.style.left=(this.iconPosition.x-iconAttributes.markerOffsetX)+"px";
this.container.style.top=(this.iconPosition.y-iconAttributes.containerHeight)+"px";
this.container.style.zIndex=GOverlay.getZIndex(this.point.lat());
}
}
var BrowserDetect={
init:function(){
this.browser=this.searchString(this.dataBrowser)||"An unknown browser";
this.version=this.searchVersion(navigator.userAgent)
||this.searchVersion(navigator.appVersion)
||"an unknown version";
this.OS=this.searchString(this.dataOS)||"an unknown OS";
},
searchString:function(data){
for(var i=0;i<data.length;i++){
var dataString=data[i].string;
var dataProp=data[i].prop;
this.versionSearchString=data[i].versionSearch||data[i].identity;
if(dataString){
if(dataString.indexOf(data[i].subString)!=-1)
return data[i].identity;
}
else if(dataProp)
return data[i].identity;
}
},
searchVersion:function(dataString){
var index=dataString.indexOf(this.versionSearchString);
if(index==-1)return;
return parseFloat(dataString.substring(index+this.versionSearchString.length+1));
},
dataBrowser:[
{string:navigator.userAgent,
subString:"OmniWeb",
versionSearch:"OmniWeb/",
identity:"OmniWeb"
},
{
string:navigator.vendor,
subString:"Apple",
identity:"Safari"
},
{
prop:window.opera,
identity:"Opera"
},
{
string:navigator.vendor,
subString:"iCab",
identity:"iCab"
},
{
string:navigator.vendor,
subString:"KDE",
identity:"Konqueror"
},
{
string:navigator.userAgent,
subString:"Firefox",
identity:"Firefox"
},
{
string:navigator.vendor,
subString:"Camino",
identity:"Camino"
},
{
string:navigator.userAgent,
subString:"Netscape",
identity:"Netscape"
},
{
string:navigator.userAgent,
subString:"MSIE",
identity:"Explorer",
versionSearch:"MSIE"
},
{
string:navigator.userAgent,
subString:"Gecko",
identity:"Mozilla",
versionSearch:"rv"
},
{
string:navigator.userAgent,
subString:"Mozilla",
identity:"Netscape",
versionSearch:"Mozilla"
}
],
dataOS:[
{
string:navigator.platform,
subString:"Win",
identity:"Windows"
},
{
string:navigator.platform,
subString:"Mac",
identity:"Mac"
},
{
string:navigator.platform,
subString:"Linux",
identity:"Linux"
}
]
};
BrowserDetect.init();
Element.ELEMENT_NODE=1;
Element.descendantsWithClassName=function(parentElement,className){
var children=parentElement.getElementsByTagName('*');
return $A(children).inject([],function(elements,child){
if(Element.hasClassName(child,className)){
elements.push(child);
}
return elements;
});
};
Element.conceal=function(element){
element.style.visibility='hidden';
};
Element.reveal=function(element){
element.style.visibility='visible';
};
Element.create=function(name){
return document.createElement(name);
};
Element.newTextNode=function(text){
return document.createTextNode(text);
};
Element.asHTML=function(el){
var bar=Element.create('bar');
bar.appendChild(el);
return bar.innerHTML;
};
Element.previousSiblingElement=function(el){
var sibling=el.previousSibling;
while(sibling&&sibling.nodeType!=Element.ELEMENT_NODE){
sibling=sibling.previousSibling;
}
return sibling;
};
Element.nextSiblingElement=function(el){
var sibling=el.nextSibling;
while(sibling&&sibling.nodeType!=Element.ELEMENT_NODE){
sibling=sibling.nextSibling;
}
return sibling;
};
Element.getPosY=function(element){
return YAHOO.util.DragDropMgr.getPosY(element);
};
Element.getPosX=function(element){
return YAHOO.util.DragDropMgr.getPosX(element);
};
Element.isElementOverVerticalScrollbar=function(element,scrollableElement){
if(scrollableElement.clientHeight>=scrollableElement.scrollHeight){
return false;
}
var elementPosition={
y:Element.getPosY(element),
x:Element.getPosX(element)
}
var scrollableElementPosition={
y:Element.getPosY(scrollableElement),
x:Element.getPosX(scrollableElement)
}
var elementRegion=new Region(
elementPosition.y,
elementPosition.x+element.clientWidth,
elementPosition.y+element.clientHeight,
elementPosition.x);
var verticalScrollbarRegion=new Region(
scrollableElementPosition.y,
scrollableElementPosition.x+scrollableElement.clientWidth,
scrollableElementPosition.y+scrollableElement.clientHeight,
scrollableElementPosition.x+scrollableElement.clientWidth-15);
return elementRegion.intersects(verticalScrollbarRegion);
}
Element.hideScrollbarsUnderElement=function(element,scrollableElementIds){
if(BrowserDetect.OS!="Mac"){
return;
}
for(var i=0;i<scrollableElementIds.length;i++){
var scrollableElement=document.getElementById(scrollableElementIds[i]);
if(scrollableElement){
if(Element.isElementOverHorizontalScrollbar(element,scrollableElement)){
Element.addClassName(scrollableElement,"no_xscroll");
};
if(Element.isElementOverVerticalScrollbar(element,scrollableElement)){
Element.addClassName(scrollableElement,"no_yscroll");
};
}
}
}
Element.unhideScrollbars=function(scrollableElementIds){
for(var i=0;i<scrollableElementIds.length;i++){
var element=document.getElementById(scrollableElementIds[i]);
if(element){
Element.removeClassName(element,"no_xscroll");
Element.removeClassName(element,"no_yscroll");
};
}
}
Element.isElementOverHorizontalScrollbar=function(element,scrollableElement){
if(scrollableElement.clientWidth>=scrollableElement.scrollWidth){
return false;
}
var elementPosition={
y:Element.getPosY(element),
x:Element.getPosX(element)
}
var scrollableElementPosition={
y:Element.getPosY(scrollableElement),
x:Element.getPosX(scrollableElement)
}
var elementRegion=new Region(
elementPosition.y,
elementPosition.x+element.clientWidth,
elementPosition.y+element.clientHeight,
elementPosition.x);
var horizontalScrollbarRegion=new Region(
scrollableElementPosition.y+scrollableElement.clientHeight-15,
scrollableElementPosition.x+scrollableElement.clientWidth,
scrollableElementPosition.y+scrollableElement.clientHeight,
scrollableElementPosition.x);
return elementRegion.intersects(horizontalScrollbarRegion);
}
if(typeof String.prototype.trim=="undefined"){
String.prototype.trim=function(){
var s=this.replace(/^\s*/,"");
return s.replace(/\s*$/,"");
};
}
if(typeof String.prototype.substrCount=="undefined"){
String.prototype.substrCount=function(s){
return this.split(s).length-1;
};
}
String.prototype.isAlpha=function(){
return(this>='a'&&this<='z\uffff')||(this>='A'&&this<='Z\uffff');
};
String.prototype.isDigit=function(){
return(this>='0'&&this<='9');
};
String.prototype.htmlEscape=function(){
var s=this;
s=s.replace(/&/g,'&amp;');
s=s.replace(/>/g,'&gt;');
s=s.replace(/</g,'&lt;');
s=s.replace(/"/g,'&quot;');
return s;
};
Array.prototype.contains=function(value){
return this.indexOf(value)!=-1;
};
Array.prototype.last=function(){
return this[this.length-1];
};
Array.prototype.isEmpty=function(){
return this.length===0;
};
Array.prototype.collect=function(f){
var result=[];
for(var i=0;i<this.length;i++){
result.push(f(this[i]));
}
return result;
};
Array.prototype.detect=function(f){
var result=[];
for(var i=0;i<this.length;i++){
if(f(this[i])){
return this[i];
}
}
return null;
};
var Utils={
centerInWindow:function(element){
this.alignInWindow(element,0.5,0.5);
},
alignInWindow:function(element,horizontalRatio,verticalRatio){
var windowDimensions=Utils.windowDimensions();
var elementDimensions=Element.getDimensions(element);
var new_left=(windowDimensions.width-elementDimensions.width)*horizontalRatio+"px";
var new_top=(windowDimensions.height-elementDimensions.height)*verticalRatio+"px";
element.style.position='absolute';
element.style.left=new_left;
element.style.top=new_top;
},
windowDimensions:function(){
return{
height:this.window().innerHeight||document.documentElement.clientHeight,
width:this.window().innerWidth||document.documentElement.clientWidth
};
},
useMockWindow:function(w){
this.mockedWindow=w;
},
window:function(){
return this.mockedWindow||window;
},
redirectTo:function(url){
window.location.href=url;
},
heightWithBorders:function(elem){
return Element.getDimensions(elem).height;
},
widthWithBorders:function(elem){
return Element.getDimensions(elem).width;
},
widthWithBordersAndMargins:function(elem){
var width=Element.getDimensions(elem).width;
width=width+this.styleAsNum(elem,"margin-left");
width=width+this.styleAsNum(elem,"margin-right");
return width;
},
height:function(elem){
return this.heightWithBorders(elem)-this.heightPaddingAndBorders(elem);
},
heightPaddingAndBorders:function(elem){
var padding=this.styleAsNum(elem,"padding-top");
padding+=this.styleAsNum(elem,"padding-bottom");
padding+=this.styleAsNum(elem,"border-top-width");
padding+=this.styleAsNum(elem,"border-bottom-width");
return padding;
},
width:function(elem){
var width=this.widthWithBorders(elem);
width=width-this.styleAsNum(elem,"padding-left");
width=width-this.styleAsNum(elem,"padding-right");
width=width-this.styleAsNum(elem,"border-left-width");
width=width-this.styleAsNum(elem,"border-right-width");
return width;
},
setWidth:function(elem,pixels){
elem.style.width=this._pixelsAsStyleUnit(pixels);
},
setHeight:function(elem,pixels){
elem.style.height=this._pixelsAsStyleUnit(pixels);
},
_pixelsAsStyleUnit:function(pixels){
if(pixels==NaN||(""+pixels)=="NaN"){pixels=0;}
pixels=parseInt(pixels);
if(pixels<0){pixels=0;}
return pixels.toString()+"px";
},
marginLeft:function(elem){return this.styleAsNum(elem,"margin-left");},
marginRight:function(elem){return this.styleAsNum(elem,"margin-right");},
borderLeft:function(elem){return this.styleAsNum(elem,"border-left-width");},
borderRight:function(elem){return this.styleAsNum(elem,"border-right-width");},
styleAsNum:function(elem,mozillaProp){
var computedStyle=Element.getStyle(elem,mozillaProp);
if(!computedStyle){
return 0;
}
computedStyle=computedStyle.substr(0,computedStyle.length-2);
if(isNaN(computedStyle)){
return 0;
}
return parseInt(computedStyle);
},
asString:function(hash){
var str="{";
for(var key in hash){
str=str+key+":"+hash[key]+",";
}
return str+"}";
},
hashEquals:function(hash1,hash2){
if(hash1==null&&hash2==null){return true;}
if(hash1==null||hash2==null){return false;}
for(var key1 in hash1){
if(hash2[key1]==null){return false;}
if(hash1[key1]!=hash2[key1]){return false;}
}
for(var key2 in hash2){
if(hash1[key2]==null){return false;}
}
return true;
},
debug:function(obj){
var info=[];
if(typeof obj in["string","number"]){
return obj;
}else{
for(property in obj){
if(typeof obj[property]=="function"){
info.push(property+' => function');
}else{
info.push(property+' => '+
(typeof obj[property]=="string"?
'"'+obj[property]+'"':
obj[property]));
}
}
}
return("'"+obj+"' #"+typeof obj+
": {"+info.join(", ")+"}");
},
truncatedText:function(origText,maxLength){
if(origText==null){
return "&nbsp;";
}else if(origText.length>maxLength){
return origText.substr(0,maxLength-2)+"...";
}else{
return origText;
}
},
stripAccents:function(s){
var stripped_string="";
for(var i=0;i<s.length;i++){
ch=s.charAt(i);
stripped=Utils.characterMap[ch];
if(stripped!=null){
ch=stripped;
}
stripped_string+=ch;
}
return stripped_string;
}
};
Utils.isIE=(navigator.userAgent.toLowerCase().indexOf("msie")!=-1);
Utils.isOpera=(navigator.userAgent.toLowerCase().indexOf("opera")!=-1);
Utils.characterMap={
'\u00c0':'A',
'\u00c1':'A',
'\u00c2':'A',
'\u00c3':'A',
'\u00c4':'A',
'\u00c5':'A',
'\u00c6':"AE",
'\u00c7':'C',
'\u00c8':'E',
'\u00c9':'E',
'\u00ca':'E',
'\u00cb':'E',
'\u00cc':'I',
'\u00cd':'I',
'\u00ce':'I',
'\u00cf':'I',
'\u00d1':'N',
'\u00d2':'O',
'\u00d3':'O',
'\u00d4':'O',
'\u00d5':'O',
'\u00d6':'O',
'\u00d8':'O',
'\u00d9':'U',
'\u00da':'U',
'\u00db':'U',
'\u00dc':'U',
'\u00dd':'Y',
'\u00e0':'a',
'\u00e1':'a',
'\u00e2':'a',
'\u00e3':'a',
'\u00e4':'a',
'\u00e5':'a',
'\u00e6':"ae",
'\u00e7':'c',
'\u00e8':'e',
'\u00e9':'e',
'\u00ea':'e',
'\u00eb':'e',
'\u00ec':'i',
'\u00ed':'i',
'\u00ee':'i',
'\u00ef':'i',
'\u00f1':'n',
'\u00f2':'o',
'\u00f3':'o',
'\u00f4':'o',
'\u00f5':'o',
'\u00f6':'o',
'\u00f8':'o',
'\u00f9':'u',
'\u00fa':'u',
'\u00fb':'u',
'\u00fc':'u',
'\u00fd':'y',
'\u00ff':'y'
};
Object.overrides=function(descendant,base){
for(property in base.prototype){
if(undefined==descendant.prototype[property]){
descendant.prototype[property]=base.prototype[property];
}else{
descendant.prototype["super_"+property]=base.prototype[property];
}
}
};
CruftyPopup=Class.create();
CruftyPopup.prototype={
initialize:function(_popupElementName,_maskElementName){
if(_popupElementName==undefined){
_popupElementName='detailPane';
}
if(_maskElementName==undefined){
_maskElementName='mask';
}
this.popupElement=$(_popupElementName);
if(this.popupElement==null){
this.popupElement=document.createElement('div');
document.body.appendChild(this.popupElement);
this.popupElement.id=_popupElementName;
this.popupElement.style.display="none";
this.popupElement.style.zindex="2000";
}
this.maskElement=$(_maskElementName);
if(this.maskElement==null){
this.maskElement=document.createElement('div');
document.body.appendChild(this.maskElement);
this.maskElement.id=_maskElementName;
this.maskElement.style.width="100%";
this.maskElement.style.height="100%";
this.maskElement.style.position="absolute";
this.maskElement.style.top="0px";
this.maskElement.style.left="0px";
this.maskElement.style.opacity=".50";
this.maskElement.style.zindex="1000";
this.maskElement.style.display="none";
}
this.visible=false;
},
maskAndPopup:function(){
this.mask();
this.popup();
},
maskAndPopupAndCenter:function(){
this.center();
this.maskAndPopup();
},
mask:function(){
Element.show(this.maskElement);
},
popup:function(){
Element.show(this.popupElement);
this.visible=true;
},
popupAndCenter:function(){
this.popup();
this.center();
},
center:function(){
Utils.centerInWindow(this.popupElement);
},
hide:function(){
Element.hide(this.popupElement);
Element.hide(this.maskElement);
this.visible=false;
}
};
Popup2=Class.create();
Popup2.prototype={
initialize:function(popupElementId,options){
this.popupElementId=popupElementId;
this.options={
placement:Placement.CENTER_IN_WINDOW,
maskOpacity:0.5,
maskElementId:"mask",
maskZindex:1000,
maskBackgroundColor:"#FFFFFF",
popupZindex:2000,
popupCssClass:"popup",
scrollableElementIds:[]
};
Object.extend(this.options,options||{});
this._initializePopupElement();
},
visible:function(){
return this.popupElement.visible();
},
showPopup:function(){
this.options.placement.placeElement(this.popupElement);
Element.show(this.popupElement);
Element.hideScrollbarsUnderElement(this.popupElement,this.options.scrollableElementIds);
Element.reveal(this.popupElement);
},
showMask:function(){
this._initializeMaskElement();
Element.reveal(this.maskElement);
Element.hideScrollbarsUnderElement(this.maskElement,this.options.scrollableElementIds);
},
showPopupWithMask:function(){
this.showMask();
this.showPopup();
},
hide:function(){
Element.conceal(this.popupElement);
Element.hide(this.popupElement);
if(this.maskElement){
Element.conceal(this.maskElement);
}
Element.unhideScrollbars(this.options.scrollableElementIds);
},
_initializeMaskElement:function(){
this.maskElement=$(this.options.maskElementId);
if(this.maskElement==null){
this.maskElement=document.createElement('div');
document.body.appendChild(this.maskElement);
document.body.style.height="100%";
this.maskElement.id=this.options.maskElementId;
this.maskElement.style.backgroundColor=this.options.maskBackgroundColor;
this.maskElement.style.width="100%";
this.maskElement.style.height=document.documentElement.scrollHeight+"px";
this.maskElement.style.position="absolute";
this.maskElement.style.top="0px";
this.maskElement.style.left="0px";
Element.setOpacity(this.maskElement,this.options.maskOpacity);
this.maskElement.style.zIndex=this.options.maskZindex.toString();
Element.conceal(this.maskElement);
}
},
_initializePopupElement:function(){
this.popupElement=$(this.popupElementId);
if(this.popupElement==null){
this.popupElement=document.createElement('div');
document.body.appendChild(this.popupElement);
this.popupElement.id=this.popupElementId;
}
this.popupElement.className=this.options.popupCssClass;
this.popupElement.style.zIndex=this.options.popupZindex.toString();
Element.hide(this.popupElement);
Element.conceal(this.popupElement);
}
};
Placement=Class.create();
Placement.prototype={
initialize:function(positionCode,options){
this.positionCode=positionCode;
this.options={
spacingPixels:5,
align:Placement.ALIGN_LEFT_EDGE,
offsetHorizontal:0,
offsetVertical:0
};
Object.extend(this.options,options||{});
},
placeElement:function(element){
switch(this.positionCode){
case Placement.CENTER_CODE:
Utils.centerInWindow(element);
break;
case Placement.DO_NOT_POSITION_CODE:
break;
case Placement.BELOW_CODE:
var relatedElement=$(this.options.relatedElementId);
var relatedOffset=this.getOffsetFor(relatedElement);
var relatedHeight=Utils.heightWithBorders(relatedElement);
element.style.position="absolute";
switch(this.options.align){
case Placement.ALIGN_LEFT_EDGE:
element.style.left=(relatedOffset[0]+this.options.offsetHorizontal)+"px";
break;
case Placement.ALIGN_RIGHT_EDGE:
var relatedWidth=Utils.widthWithBorders(relatedElement);
var elementWidth=Utils.widthWithBorders(element);
element.style.left=(relatedOffset[0]+relatedWidth-elementWidth+this.options.offsetHorizontal)+"px";
break;
default:
throw new Error("Unknown alignment - "+this.options.align);
}
element.style.top=(relatedOffset[1]+relatedHeight+this.options.offsetVertical+this.options.spacingPixels)+"px";
break;
default:
throw new Error("Unknown position code - "+this.positionCode);
}
},
getOffsetFor:function(element){
return Position.cumulativeOffset(element);
}
};
Placement.CENTER_CODE="center";
Placement.DO_NOT_POSITION_CODE="noposition";
Placement.BELOW_CODE="below";
Placement.ALIGN_LEFT_EDGE="leftedge";
Placement.ALIGN_RIGHT_EDGE="rightedge";
Placement.CENTER_IN_WINDOW=new Placement(Placement.CENTER_CODE);
Placement.DO_NOT_POSITION=new Placement(Placement.DO_NOT_POSITION_CODE);
Placement.belowElement=function(elementId,options){
options.relatedElementId=elementId;
return new Placement(Placement.BELOW_CODE,options);
}
PopupWindow=Class.create();
PopupWindow.prototype={
initialize:function(url){
this.super_initialize();
this.mask();
new Ajax.Updater(this.popupElement,url,{
asynchronous:true,
evalScripts:true,
method:'get',
onComplete:this.popupAndCenter.bind(this)
});
}
};
Object.overrides(PopupWindow,CruftyPopup);
Confirm=Class.create();
Confirm.prototype={
initialize:function(text,onComplete){
this.onComplete=onComplete;
this.super_initialize();
this.mask();
this.popupElement.innerHTML="";
var popupTemplate=$('popup_window_template').cloneNode(true);
Element.show(popupTemplate);
this.popupElement.appendChild(popupTemplate);
this.setHeader('confirm');
this.setContents(text);
this.confirmButton=this.createButton("/images/b_delete.png",this.clickConfirm.bind(this));
this.cancelButton=this.createButton("/images/b_cancel.png",this.hide.bind(this));
this.addButton(this.confirmButton);
this.addButton(this.cancelButton);
this.popup();
this.center();
},
setHeader:function(headerText){
this.popupHeaderElement=Element.descendantsWithClassName(this.popupElement,'module_box_title')[0];
this.popupHeaderElement.innerHTML=headerText;
},
setContents:function(contents){
this.popupContentsElement=Element.descendantsWithClassName(this.popupElement,'module_box_contents')[0];
this.popupContentsElement.innerHTML=contents;
},
addButton:function(button){
if(this.buttonAreaElement==null){
this.buttonAreaElement=document.createElement("div");
this.buttonAreaElement.className='button_area';
this.popupContentsElement.appendChild(this.buttonAreaElement);
}else{
this.buttonAreaElement.appendChild(document.createTextNode(' '));
}
this.buttonAreaElement.appendChild(button);
},
createButton:function(buttonSrc,buttonFunction){
var button=document.createElement("a");
button.innerHTML="<img src='"+buttonSrc+"' />";
button.onclick=buttonFunction;
return button;
},
clickConfirm:function(){
this.hide();
this.onComplete();
}
};
Object.overrides(Confirm,CruftyPopup);
DateUtils={
SUNDAY:0,
MONDAY:1,
TUESDAY:2,
WEDNESDAY:3,
THURSDAY:4,
FRIDAY:5,
SATURDAY:6,
systemTime:null,
now:function(){
if(this.systemTime!=null){
return this.systemTime;
}else{
return new Date();
}
},
setTime:function(date){
this.systemTime=date;
},
previousMonday:function(fromDate){
var date=fromDate?new Date(fromDate):DateUtils.now();
var dayOfWeek=date.getDay();
if(dayOfWeek==DateUtils.SUNDAY){dayOfWeek=7;}
var rightDayWrongTime=new Date(date-DateUtils.days(dayOfWeek-1));
var monday=rightDayWrongTime.atMidnight();
if(monday.getDay()!=1){
throw "Monday isn't Monday";
}
return monday;
},
weeks:function(numberOfWeeks){
return numberOfWeeks*DateUtils.days(7);
},
days:function(numberOfDays){
return numberOfDays*60*60*24*1000;
}
};
Date.prototype.previousMonday=function(){
return DateUtils.previousMonday(this);
};
Date.prototype.beginningOfWeekWithStartDay=function(weekStartDay){
var daysAgo;
if(weekStartDay<=this.getDay()){
daysAgo=this.getDay()-weekStartDay;
}else{
daysAgo=7-(weekStartDay-this.getDay());
}
return this.plusDays(0-daysAgo).atMidnight();
};
Date.prototype.atMidnight=function(){
return new Date(this.getFullYear(),this.getMonth(),this.getDate());
}
Date.prototype.elapsedDaysFrom=function(anotherDate){
var timeDifference=this.getTime()-anotherDate.getTime();
return Math.floor((timeDifference+3600000)/DateUtils.days(1));
};
Date.prototype.isBetween=function(start,finish){
if(finish<start){
var x=start;
start=finish;
finish=x;
}
if(this<start){return false;}
if(start<finish&&this>=finish){return false;}
return true;
};
Date.prototype.plusMsec=function(msec){
return new Date(this.getTime()+msec);
};
Date.prototype.plusDays=function(days){
var newDate=new Date(this.getTime());
newDate.setDate(newDate.getDate()+days);
return newDate;
};
Date.prototype.plusWeeks=function(weeks){
var daysPerWeek=7;
return this.plusDays(daysPerWeek*weeks);
};
Date.equals=function(a,b){
return(
(a==null&&b==null)
||(a!=null&&b!=null&&a.getTime()==b.getTime())
);
}
Date.prototype.toMDYYYY=function(){
var date_str=this.getMonth()+1;
date_str+='/'+this.getDate();
date_str+='/'+this.getFullYear();
return date_str;
}
Date.prototype.isBefore=function(otherDate){
return this.getTime()<otherDate.getTime();
}
Region=Class.create();
Region.prototype={
initialize:function(top,right,bottom,left){
this.top=top;
this.right=right;
this.bottom=bottom;
this.left=left;
}
}
Region.prototype.intersects=function(anotherRectangle){
var verticalOverlap=false;
var horizontalOverlap=false;
if(this.top<=anotherRectangle.top&&this.bottom>=anotherRectangle.bottom){
verticalOverlap=true;
}
if(this.top>=anotherRectangle.top&&this.top<=anotherRectangle.bottom){
verticalOverlap=true;
}
if(this.bottom>=anotherRectangle.top&&this.bottom<=anotherRectangle.bottom){
verticalOverlap=true;
}
if(this.left<=anotherRectangle.left&&this.right>=anotherRectangle.right){
horizontalOverlap=true;
}
if(this.left>=anotherRectangle.left&&this.left<=anotherRectangle.right){
horizontalOverlap=true;
}
if(this.right>=anotherRectangle.left&&this.right<=anotherRectangle.right){
horizontalOverlap=true;
}
return verticalOverlap&&horizontalOverlap;
}
function funcname(f){
var s=f.toString().match(/function (\w*)/)[1];
if((s==null)||(s.length==0))return "anonymous";
return s;
}
function stacktrace(){
var s="";
for(var a=arguments.caller;a!=null;a=a.caller){
s+=funcname(a.callee)+"\n";
if(a.caller==a)break;
}
return s;
}
function rand(max){
return Math.floor(Math.random()*(max));
}
function shuffle(myArray){
var i=myArray.length;
if(i==0){return false;}
while(--i){
var j=rand(i+1);
var tempi=myArray[i];
var tempj=myArray[j];
myArray[i]=tempj;
myArray[j]=tempi;
}
}
var Cookie={
set:function(name,value,daysToExpire){
var expire='';
if(daysToExpire!=undefined){
var d=new Date();
d.setTime(d.getTime()+(86400000*parseFloat(daysToExpire)));
expire='; expires='+d.toGMTString();
}
return(document.cookie=escape(name)+'='+escape(value||'')+expire);
},
get:function(name){
var cookie=document.cookie.match(new RegExp('(^|;)\\s*'+escape(name)+'=([^;\\s]*)'));
return(cookie?unescape(cookie[2]):null);
},
erase:function(name){
var cookie=Cookie.get(name)||true;
Cookie.set(name,'',-1);
return cookie;
},
accept:function(){
if(typeof navigator.cookieEnabled=='boolean'){
return navigator.cookieEnabled;
}
Cookie.set('_test','1');
return(Cookie.erase('_test')==='1');
}
};
function asCgiString(hash,model){
var pairs=[];
for(var key in hash){
var name;
if(model){
name=model+"["+key+"]";
}else{
name=key;
}
pairs[pairs.length]=name+"="+encodeURIComponent(hash[key]);
}
return pairs.join("&");
};
function fromCgiString(cgiString){
var hash={};
var pairs=cgiString.split("&");
for(var i=0;i<pairs.length;++i){
var stuff=pairs[i].split("=");
hash[stuff[0]]=decodeURIComponent(stuff[1]);
}
return hash;
}
function formToCgiHash(form){
var params={};
$A(form.elements).each(function(inputItem){
if(inputItem.type=="submit"||inputItem.type=="button"){
return;
}
if(inputItem.type=='checkbox'||inputItem.type=='radio'){
if(inputItem.checked){
if(params[inputItem.name]){
throw 'Multiple checkboxes/radio buttons with the same name are not supported!';
}
params[inputItem.name]=inputItem.value;
}
}
else{
params[inputItem.name]=inputItem.value;
}
});
return params;
}
Geocoder=Class.create();
Geocoder.prototype={
initialize:function(){
this._googleGeocoder=new GClientGeocoder();
this._geocodeCounter=0;
},
geocode:function(address,handleResultsFunction){
this._address=address;
this._handleResultsFunction=handleResultsFunction;
this._geocodeCounter++;
this._googleGeocode(address,this._telcontarCounter);
},
_googleGeocode:function(address){
this._googleGeocoder.getLocations(address,this._handleGoogleResults.bind(this));
},
_telcontarGeocode:function(address){
var counter=this._geocodeCounter;
new Ajax.Request("/map/find_geocoded_address/?query_type=geo&geo_address_query="+address+"&geo_country_code=GB",{
asynchronous:true,evalScripts:true,post:true,
onSuccess:function(request){
if(counter!=this._geocodeCounter)return;
var translatedResults=JSON.parse(request.responseText);
this._handleResultsFunction(translatedResults);
}.bind(this)
});
},
_handleGoogleResults:function(googleJson){
var translatedResults=U.translateGoogleGeocodedResults(googleJson,true);
if(translatedResults.length==0){
this._telcontarGeocode(this._address);
}else{
this._handleResultsFunction(translatedResults);
}
}
}


//--><!]]>

</script>

        


    

  

    
      <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
      </script>
      <script type="text/javascript">
      _uacct = "UA-52439-4";
      urchinTracker();
      </script>
    

  
    


  
  </head>

	<body class="wedding">
		<div class="wrapper">
			<h1>Policies - Wedding Mapper</h1>
      <div id="header" onclick="window.location = &quot;/&quot;;">
        <div id="header_left"><img alt="Curly_lefttop" src="/images/curly_lefttop.gif"></div>
        <div id="header_image"><img alt="Wedding_logo" src="/images/wedding_logo.gif"></div>
        <div id="header_right"><img alt="Curly_righttop" src="/images/curly_righttop.gif"></div>
      </div>
      

      <div class="content_wrapper">
        <div class="content">
          <div id="content_area">
            <div id="content_area_top" class="no_tabs">
              <div id="content_area_top_left"></div>
              
            </div>
          <div id="content_area_content_right">
            <div id="content_area_content_left">
              <div id="content_area_content_wrapper_left">
                <div id="content_area_content_wrapper_right">
                    <div id="content_area_content">
                      
                      
                      
                      <style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Lucida Grande";}
@font-face
	{font-family:Times;
	panose-1:2 2 6 3 5 4 5 2 3 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:Times;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:9.0pt;
	font-family:"Lucida Grande";}
ins
	{text-decoration:none;}
span.msoIns
	{text-decoration:underline;}
span.msoDel
	{text-decoration:line-through;
	color:red;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<br>
<div class="Section1">

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;;
text-transform:uppercase">Privacy Policy</span></b></p>

<div style="border:none;border-top:solid windowtext 1.0pt;padding:1.0pt 0in 0in 0in">

<p class="MsoNormal" style="border:none;padding:0in"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">Last Updated: December 8, 2006</span></p>
</div>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">
</span></p><p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>
<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">SUMMARY</span></b></p>
<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">We
take the privacy of our users very seriously. Please read this Privacy Policy
to learn more about how we treat personally identifiable information. We
provide this Privacy Policy because you have a right to know what information
we collect, how it is protected and used, and the circumstances under which it
may be disclosed. If you have comments, suggestions, questions, or concerns
about our Privacy Policy, please contact us via email at <a href="mailto:privacy@WeddingMapper.com">privacy@WeddingMapper.com</a> or in
writing at: Privacy Director, Community Walk, 880 Lombard Street, San Francisco,
CA 94133. </span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Online
Privacy Standards. </span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">While
there are no official standards governing privacy practices on the Internet, we
look to the principles supported by the Federal Trade Commission's Fair
Information Practices Principles for guidance, currently available at
http://www.ftc.gov/reports/privacy3/tos.htm. </span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">What
This Policy Covers. </span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">This
policy covers Wedding Mapper's treatment of personally identifiable information
that we obtain when you visit our website or use our services. We regard
personally identifiable information as information that someone can use to
identify or contact you in person, such as real name, telephone number, birth
date, email address, or physical mailing address. Information that we use
internally to identify you as a user in our system, such as your selected
username and password, is not considered personally identifiable information.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">What
This Policy Does Not Cover. </span></b><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">This policy does not cover the privacy practices
of third parties that we do not own or control, such as any partners or
advertisers. In addition, we may provide links to other services and on
occasion to other sites that may interest you. All of these sites operate
independently of Wedding Mapper and they may have their own privacy or security
practices. We encourage you to review their policies before submitting any
personal information to them.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">1. HOW
WE COLLECT INFORMATION</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">A  Information
You Provide</span></b></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Registration
Information.</span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">
During the registration process, we collect your first and last name and email
address. We will send you an email to verify that you are the owner of this
address. You will also choose a username and password that we will use to
identify you in our system.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Optional
User Profile Information.</span></b><span style="font-size:10.0pt;font-family:
&quot;Lucida Grande&quot;"> In the future, we may include optional user profile
information. If we provide that as part of the service, you will be able to
choose to provide us with additional optional information about yourself (for
example, your name, address, age, etc.), which helps us deliver a more
personalized experience to you. This information may be made available in your
publicly available user profile page. </span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Access
To Your Personal Information.</span></b><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;"> In general, we make it easy for you to view your
personally identifiable information in your user profile page, where you can
add, edit, or delete it as you see fit. You can access your user profile page
by logging in at this link: <a href="http://www.WeddingMapper.com/">http://www.WeddingMapper.com</a>
and clicking on "User Information."</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">B. Information
We Do Not Collect </span></b></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Children.</span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;"> As explained further in
our Terms of Service, available at www.WeddingMapper.com/company/policies/terms_of_service,
our website is intended for adults only. You must be 13 years of age or older
to register to use our website. Therefore, we do not knowingly collect
personally identifiable information about children. If you believe that we have
information from or about anyone under 13 years of age, please notify us by
email at privacy@WeddingMapper.com or write to our Privacy Director at the
address noted above.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Social
Security Number.</span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">
We do not ask for or require your social security number to use any part of the
Services or to access any part of our site.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">C. Information
We Track</span></b></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Log
Files.</span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">
Similar to many websites, we gather certain anonymous, non-personal information
automatically and store it in web server log files. This information includes
Internet protocol addresses, browser type, Internet service provider (ISP),
site entry/exit pages, operating system, date/time stamp, and clickstream data.
We use this information to improve our site, analyze trends, administer the
site, track users' movements around the site, and gather aggregate information
about our user base as a whole. Aggregate information is data we collect about
a group or category of services or users from which individual user identities
have been removed, and therefore does not include your personally identifiable
information.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Cookies.</span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;"> As you browse the
Wedding Mapper site, cookies are placed on your computer's hard drive. A cookie
is a small text file that is sent to your browser from a web server and stored
on a user's computer for record-keeping purposes. It can also help us
understand how our site visitors click to our site, and what pages they view
during their visit. Similar to many websites, we store an encrypted cookie on
your computer so we can remember you when you come back to our website without requiring
you to log-in every time. Cookies also allow us to track and understand the
interests of our users to enhance the overall experience on our site. </span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">You
can set your web browser software to disable cookies. To do so, please refer to
the help section of your specific browser for more information on how to manage
or disable cookies. If you disable cookies, you may still view our site, but
some areas of our site will not work properly.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Some
of our business partners, such as advertisers, may also use cookies on our
site. We have no access to or control over these cookies, and, as noted above,
this privacy policy does not govern the use of cookies by our business partners
or advertisers.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">2. HOW
WE USE INFORMATION</span></b></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Communication
of Service-related Announcements.</span></b><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;"> We use emails and/or prominent notifications on
our website as our primary means to inform our users of service-related
announcements from Wedding Mapper. We may use your email address to deliver
important service-related announcements. Example service-related announcements
include: email verification during registration, requests for a password reset,
important security or server maintenance updates, software updates, upgrades,
and new releases, or policy changes. These service-related announcements are
considered a fundamental part of our service, and users cannot opt-out of these
email announcements.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">On
Our Website. </span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">We
may use information provided by you on our website in the following ways:</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<ul style="margin-top:0in" type="square">
 <li class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Identification
     Of Authors By Username.</span></b><span style="font-size:10.0pt;
     font-family:&quot;Lucida Grande&quot;"> We are web-based service that allows users
     to create annotated Google Maps by adding location markers and route
     markers to a map that is saved in a specific state. Users can upload
     images, display content from other sites, leave comments, and get
     directions on your maps through our service. In providing this service, we
     depend in part on the contributions and actions of our users to improve
     the quality of the experience users have with the service. When you make a
     contribution to Wedding Mapper (such as adding a comment, modifying someone
     else's comment or content,<span style="color:red"> </span>you will be
     identified by your username as the author of that contribution. In any of
     these circumstances, we will only identify you by your username.</span></li>
</ul>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<ul style="margin-top:0in" type="square">
 <li class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">In
     Your Public User Profile. </span></b><span style="font-size:10.0pt;
     font-family:&quot;Lucida Grande&quot;">If we provide a public user profile page in
     the future, you will have the option to include your personally
     identifiable information in your public user profile, but you are not
     required to do so. You can easily add, edit, and delete information in
     your public user profile through the user profile page.</span></li>
</ul>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<ul style="margin-top:0in" type="square">
 <li class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">For<span style="color:red"> </span>Site Statistics.</span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;"> As noted above, we
     use information collected from our web log files to calculate and publish
     anonymous, non-personal, aggregate statistics that we believe our users
     are interested in viewing. For example, we track and publish the total
     number of users who have viewed a particular web page. We publish this
     data in aggregate form only, and do not tie it to any personally
     identifiable information.</span></li>
</ul>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">For
Internal Reporting and Internal Analysis. </span></b><span style="font-size:
10.0pt;font-family:&quot;Lucida Grande&quot;">As noted above, we use information gathered
from log files and cookies to improve our site, analyze trends, administer the
site, track users' movements around the site, and to gather aggregate
information about our user base as a whole. We do not tie this data to
personally identifiable information.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">3. HOW
WE DISCLOSE INFORMATION</span></b></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">On
Our Website. </span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">We
may choose to provide a group blog or message board in the future. These
features would allow you to communicate with other users by posting public
messages. Please be aware that what you write in these public messages can be
viewed, collected or used by anyone who visits our website. We are not
responsible for any personally identifiable information that you submit or
permit others to submit through public messages.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Sharing,
Renting, and Selling Information We Collect With Third-Parties.</span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;"> Except as described in
this section, we will not rent or sell your personally identifiable information
to third parties without notifying you of our intent to share the information
and giving you an opportunity to prevent your information from being shared. We
occasionally use other companies, agents or contractors to perform services
necessary to our operations. For example, we have partnered with other
companies to develop our website, personalize our web pages and analyze users'
interaction with our site. By contractual agreement, these companies must
treat your information in accordance with this privacy policy. We will not be
liable for any damages that may result from the misuse of your personal information
by these companies. In addition, we share anonymous, non-personal, aggregate
information about our user base with partners or advertisers, and, as mentioned
above, we may publish these aggregate usage statistics on our website for the
interest of our users. We do not tie this shared or published data to
personally identifiable information. </span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">As
Necessary In Legal Circumstances.</span></b><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;"> We reserve the right to disclose your personally
identifiable information as required by law and when we believe that disclosure
is necessary to protect our rights and/or to comply with a judicial proceeding,
court order, or legal process served on our website.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">As
Necessary In An Acquisition.</span></b><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;"> If our company is acquired, all of our assets,
including user information, may be transferred to the acquiring company. At
that time, your user information may become subject to the acquiring company's
privacy policy. Before we transfer your user information, we will notify you
either by email or by posting a notice on our site.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">4. HOW
WE KEEP INFORMATION SECURE</span></b></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Security
of User Profile Information.</span></b><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;"> Your user profile information is
password-protected. We will not share your password with anyone. Please do not
share your password with anyone, and remember to change your password from time
to time, to keep your user information secure.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Network
Security.</span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">
We have implemented a variety of commercially standard encryption and security
technologies and procedures to protect information, including your personal
information, stored in our computer systems from unauthorized access. Please be
aware that no method of transmission over the Internet, or method of electronic
storage, is 100% secure, thus we strive to use commercially acceptable means to
protect your personal information, but we cannot guarantee its absolute
security.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Management
Procedures.</span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">
We also maintain standard physical and electronic procedural safeguards that
limit access to your personally identifiable information to our employees (or
people working on our behalf and under confidentiality agreements) who, through
the course of standard business activities, need to access your personally
identifiable information.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">5. YOUR
PERSONAL CHOICES</span></b></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Information
With Other Users.</span></b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">
If we provide a public user profile page in the future, you will be able to
control what personal information about you is shared with other users in your
public user profile, and what information you choose to keep private. You can
view, add, edit, and delete information in your public user profile through
your user profile page.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">Editing
and Deleting User Profile Information.</span></b><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;"> You can view the personally identifiable
information we have collected from you in your user profile page where you can
add, edit, or delete it as you see fit. You may also request deletion of your
user account through your user profile page.</span></p>

<p class="MsoNormal"><span style="font-size:10.0pt;font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal" style="page-break-after:avoid"><b><span style="font-size:
10.0pt;font-family:&quot;Lucida Grande&quot;">6.  UPDATES TO OUR PRIVACY POLICY</span></b></p>

<p class="MsoNormal" style="page-break-after:avoid"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal" style="page-break-after:avoid"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">From time to time, we will review and make changes
to our privacy policy. When we do so, we will either notify you by email or
place a notice on our website. Users should check back for updates to this
policy. The most recent version of our privacy policy is always available from
a link on our homepage, and at <span style="color:black"><a href="http://www.WeddingMapper.com/company/policies/privacy"><span style="color:black;text-decoration:none">www.WeddingMapper.com/company/policies/privacy</span></a>.</span></span></p>

<p class="MsoNormal" style="page-break-after:avoid"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal" style="page-break-after:avoid"><b><span style="font-size:
10.0pt;font-family:&quot;Lucida Grande&quot;">7.  YOUR CONSENT TO THIS POLICY</span></b></p>

<p class="MsoNormal" style="page-break-after:avoid"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal" style="page-break-after:avoid"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">By using the Wedding Mapper website, you agree to
this privacy policy. This is our entire and exclusive privacy policy and it
supercedes any earlier version. Our Terms of Service take precedence over any
conflicting privacy policy provision.</span></p>

<p class="MsoNormal" style="page-break-after:avoid"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal" style="page-break-after:avoid"><b><span style="font-size:
10.0pt;font-family:&quot;Lucida Grande&quot;">8.  LEGAL DISCLAIMER</span></b></p>

<p class="MsoNormal" style="page-break-after:avoid"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal" style="page-break-after:avoid"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">The Wedding Mapper website operates AS-IS and
AS-AVAILABLE, without liability of any kind. We are not responsible for events
beyond our control. This privacy policy is governed by California law,
excluding conflicts of law principles.</span></p>

<p class="MsoNormal" style="page-break-after:avoid"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

<p class="MsoNormal" style="page-break-after:avoid"><span style="font-size:10.0pt;
font-family:&quot;Lucida Grande&quot;">&nbsp;</span></p>

</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          

          
        </div>
      </div>

      <div class="footer screenonly">
        <div>
          <table style="margin:auto;">
            <tbody><tr>
              <td>
                <a href="/about">About</a> / <a href="http://blog.weddingmapper.com/">Blog</a>
              </td>
              <td class="divider">|</td>
              <td><a href="mailto:%63%6f%6e%74%61%63%74@%77%65%64%64%69%6e%67%6d%61%70%70%65%72.%63%6f%6d" target="_top">Contact</a></td>
            </tr>
            <tr>
              <td><a href="/company/policies/terms_of_service">Terms of Service</a></td>
              <td class="divider">|</td>
              <td><a href="/company/policies/privacy">Privacy Policy</a></td>
            </tr>
          </tbody></table>
        </div>
      </div>

      <br>

      <div style="width:60%; margin: 10px auto;">
        <hr>
        <div style="margin: auto; text-align: center; font-size: 9pt; color: #666; font-family: georgia, times new roman;">
          Are you a local vendor serving the wedding industry?
          <a href="/vendors/prevendor_signup" style="font-size: 9pt; color: #666; font-family: georgia, times new roman;">Click Here</a>
        </div>
        <hr>
      </div>

      <div style="width:60%; margin: 10px auto;">
        <hr>
        <div style="margin: auto; text-align: center; font-size: 9pt; color: #666; font-family: georgia, times new roman;">
          <a href="http://blog.weddingmapper.com/2007/05/17/refer-a-great-product-and-make-money/" style="font-size: 9pt; color: #666; font-family: georgia, times new roman;">Help us spread the word, become a Wedding Mapper Affiliate</a>
        </div>
        <hr>
      </div>

      <div style="width:60%; margin: 10px auto;">
        <hr>
        <div style="margin: auto; text-align: center; font-size: 9pt; color: #666; font-family: georgia, times new roman;">
          Are you a wedding planner? We have bulk packages available.
          <a href="/wedding/planners" style="font-size: 9pt; color: #666; font-family: georgia, times new roman;">Read more...</a>
        </div>
        <hr>
      </div>

      

    </div>
	
</body></html>